ID,Title,Created At,Closed At,Issues,Errors,Messages,Body
1828,layout.html - missing id required for showing collapsed menu ,2017-12-23T18:49:26Z,,,,,"Clicking the toggler button doesn't show collapsed menu.

The correction should be simple:
in the layout.html file we need to add the id on the navbar-collapse

`<div id=""navbarNavDropdown"" class=""collapse navbar-collapse"">`
"
1827,is this a super bug in scheduler in version web2py.2.14.6 ?,2017-12-22T14:14:54Z,2017-12-23T01:24:09Z,,SyntaxError,SyntaxError: table already defined: scheduler_task,"Traceback (most recent call last):
  File ""/home/www-data/web2py2000/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""applications/player/models/0.py"", line 83, in <module>
    scheduler = Scheduler(session_service.db, migrate=False)
  File ""/home/www-data/web2py2000/gluon/scheduler.py"", line 585, in __init__
    self.define_tables(db, migrate=migrate)
  File ""/home/www-data/web2py2000/gluon/scheduler.py"", line 653, in define_tables
    migrate=self.__get_migrate('scheduler_task', migrate),
  File ""/home/www-data/web2py2000/gluon/packages/dal/pydal/base.py"", line 819, in define_table
    raise SyntaxError('table already defined: %s' % tablename)
SyntaxError: table already defined: scheduler_task"
1826,made sorting of translation keys py3 safe,2017-12-13T18:50:10Z,,,,,
1825,python3 compatibility for woth sorted-cmp as well as unicode,2017-12-12T19:55:10Z,2017-12-13T10:04:10Z,,,,To fix the languages editor in admin application when running python 3
1824,Fix py3 urllib quote_plus ,2017-12-12T18:30:12Z,,,,,
1823,Fix dependencies in setup.py,2017-12-11T16:53:14Z,,,,,
1822,python3.5 : AttributeError: module 'urllib' has no attribute 'quote_plus',2017-12-10T12:13:54Z,,,AttributeError,"AttributeError: module 'urllib' has no attribute 'quote_plus'","python 3.5, web2py version 2.16.1-stable+timestamp.2017.11.14.05.54.25

```
ERROR:Rocket.Errors.Thread-4:Traceback (most recent call last):

  File ""/home/web2py/gluon/rocket.py"", line 1319, in run
    self.run_app(conn)

  File ""/home/web2py/gluon/rocket.py"", line 1820, in run_app
    output = self.app(environ, self.start_response)

  File ""/home/web2py/gluon/main.py"", line 650, in app_with_logging
    ret[0] = wsgiapp(environ, responder2)

  File ""/home/web2py/gluon/main.py"", line 559, in wsgibase
    http_response, request, environ, ticket)

  File ""/home/web2py/gluon/rewrite.py"", line 238, in try_rewrite_on_error
    (status, ticket, urllib.quote_plus(

AttributeError: module 'urllib' has no attribute 'quote_plus'
```"
1821,Update db.py,2017-12-07T13:10:43Z,,,,,Possible typo?
1820,AttributeError: 'NoneType' object has no attribute 'startswith',2017-12-04T11:40:58Z,,,AttributeError,"AttributeError: 'NoneType' object has no attribute 'startswith'","Version 2.16.1-stable+timestamp.2017.11.14.05.54.25
```
def joint_field(db, fields=[]):
    e = Expression(db, db._adapter.dialect.concat(*fields[:2]))
    for f in fields[2:]:
        e = Expression(db, db._adapter.dialect.concat(e, f))
    return e
```
```
full_name_field = joint_field(db, [db.staff_employee.first_name, ' ', db.staff_employee.last_name])
records = db(full_name_field.contains(request.vars.term)).select(
    full_name_field,
    groupby=full_name_field,
    orderby=full_name_field,
    limitby=(0, 10)
)
```
```
Traceback (most recent call last):
  File ""/vagrant/grand3/web2py/gluon/restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""/vagrant/grand3/web2py/applications/app/controllers/staff.py"", line 286, in <module>
  File ""/vagrant/grand3/web2py/gluon/globals.py"", line 419, in <lambda>
    self._caller = lambda f: f()
  File ""/vagrant/grand3/web2py/gluon/tools.py"", line 3982, in f
    return action(*a, **b)
  File ""/vagrant/grand3/web2py/applications/app/controllers/staff.py"", line 48, in autocomplete_employee_full_name
    records = db(full_name_field.contains(request.vars.term)).select(
  File ""/vagrant/grand3/web2py/gluon/packages/dal/pydal/objects.py"", line 1457, in contains
    self.type.startswith('list:'):
AttributeError: 'NoneType' object has no attribute 'startswith'
```
Was working with version 2.14, not sure about 2.15"
1819,<type 'exceptions.AttributeError'> 'NoneType' object has no attribute '_tablename',2017-12-04T11:35:54Z,,,AttributeError,"AttributeError: 'NoneType' object has no attribute '_tablename'","Version 2.16.1-stable+timestamp.2017.11.14.05.54.25

```
db.define_table('measurement',
    Field('title', label=T('measurement__title'), requires=IS_NOT_EMPTY()),
    Field('systemic', 'boolean', writable=False, readable=False, default=False),
    Field('sys_name', writable=False, readable=False),
    format='%(title)s'
)

title_field = db.translation_field.value.coalesce(db.measurement.title)
TOTAL_ROWS = 'COUNT(*) OVER()'

records = db(db.measurement).select(
        db.measurement.ALL, title_field, TOTAL_ROWS,
        left=[
            db.translation_field.on(
                (db.translation_field.tablename == 'measurement') &
                (db.translation_field.fieldname == 'title') &
                (db.translation_field.rid == db.measurement.id) &
                (db.translation_field.language_id == auth.user.language_id)
            )
        ],
        orderby=title_field
    )

# translate
for i, r in enumerate(records):
    records[i].measurement.title = r[title_field]

result = SQLTABLE(records, headers='labels', truncate=None, columns=['measurement.title')
```
Error:

```
File ""/vagrant/grand3/web2py/gluon/sqlhtml.py"", line 3433, in __init__
    tablemap = dict(((f.tablename, f.table) if isinstance(f, Field) else (f._table._tablename, f._table) for f in fieldmap.values()))
  File ""/vagrant/grand3/web2py/gluon/sqlhtml.py"", line 3433, in <genexpr>
    tablemap = dict(((f.tablename, f.table) if isinstance(f, Field) else (f._table._tablename, f._table) for f in fieldmap.values()))
AttributeError: 'NoneType' object has no attribute '_tablename'
```

Was working until Version 2.15.4-stable+timestamp.2017.09.02.04.02.22 came out"
1818," fix include_meta for py35, added tests",2017-12-02T09:27:44Z,2017-12-02T19:01:13Z,,,,
1817,urllib not imported for pydal,2017-11-29T16:14:54Z,,,,,"Path: /web2py/gluon/packages/dal/pydal/base.py

Line 403 uses urllib in the lambda. Causes NameError: global name 'urllib' is not defined

""import urllib"" required"
1816,response.include_meta() bug,2017-11-28T04:03:55Z,2017-12-02T19:01:14Z,,,,"Hi!
I have a function in my modules

```python
    def set_open_graph(type=""website"", title=None, url=None, image=None, description=None, site_name=None, locale=None, locale_alternate={}):
        data = locals()
        for name in ['type', 'title', 'url', 'description', 'site_name', 'locale']:
            my_dict = {}
            if data[name]:
                my_dict['name'] = ""og:"" + name
                my_dict['content'] = data[name]
                current.response.meta['og_' + name] = my_dict
```

Then in my 'layout.html:

`{{response.include_meta()}}`

It produces follow code:

```html
<meta b'name'=""og:description"" b'content'=""My content"" />
<meta b'name'=""og:locale"" b'content'=""RU"" />
```

OS: Linux Mint 18.2 (Ubuntu 16.04),
Web2py 2.16.1-stable+timestamp.2017.11.14.05.54.25
(Running on Rocket 1.2.6, Python 3.5.2)  "
1815,[2.16.1] <type 'exceptions.AttributeError'> 'FieldVirtual' object has no attribute 'listable',2017-11-20T23:33:57Z,,,,,"Version windows EXE, 2.16.1-stable+timestamp.2017.11.14.05.54.25

Error in sqlform.grid with virtual field

> File ""C:\web2py_sitio\gluon\sqlhtml.py"", line 2453, in grid
>     columns = [f for f in fields if f.tablename in tablenames and f.listable]
> AttributeError: 'FieldVirtual' object has no attribute 'listable'

model:
>   table familiares
>   ------------
>     Field.Virtual('famedad', lambda row: fchsDifAnios(row.familiares.famnacfch, request.now.date())[0]),

>   table afifam
>   ------------
>     Field.Virtual('afifamedad',
>                        lambda row: db(db.familiares.id==row.afifam.famid).select().first().famedad,
>                        label='edad'

In web2py 2.15.4 run ok.




"
1814,Fix update_languages script (use application folder),2017-11-20T20:54:18Z,2017-11-22T20:51:20Z,,,,"Admittedly after preparing this script for others to use, I kind of forgot to test it...  Whoops!  This is an update that should fix the script and make Gluon happy.  Instead of taking the languages folder, it takes the application folder, to help resolve conflicts with Gluon.  The script was also originally configured to run with the language folder being the current working directory, and as such, the changes to the language files would never be saved."
1813,[2.16.1] <type 'exceptions.AttributeError'> 'Field' object has no attribute 'options',2017-11-20T08:56:40Z,,,AttributeError,"AttributeError: 'Field' object has no attribute 'options'","Since I updated to 2.16 I get this error on every page (even new apps, but not admin):
```
<type 'exceptions.AttributeError'>('Field' object has no attribute 'options')

Traceback (most recent call last):
  File ""/home/robin/Documents/web2py/gluon/restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""/home/robin/Documents/web2py/applications/newversion/models/db.py"", line 95, in <module>
    auth.define_tables(username=False, signature=False)
  File ""/home/robin/Documents/web2py/gluon/tools.py"", line 2216, in define_tables
    super(Auth, self).define_tables(username, signature, migrate, fake_migrate)._table_signature_list
  File ""/home/robin/Documents/web2py/gluon/authapi.py"", line 350, in define_tables
    format='%(first_name)s %(last_name)s (%(id)s)'))
  File ""/home/robin/.local/lib/python2.7/site-packages/pydal/base.py"", line 587, in define_table
    table = self.lazy_define_table(tablename, *fields, **args)
  File ""/home/robin/.local/lib/python2.7/site-packages/pydal/base.py"", line 606, in lazy_define_table
    field.requires = auto_validators(field)
  File ""/home/robin/.local/lib/python2.7/site-packages/pydal/helpers/methods.py"", line 260, in auto_validators
    return db.validators_method(field)
  File ""/home/robin/Documents/web2py/gluon/dal.py"", line 35, in _default_validators
    if isinstance(field.options, list) and field.requires:
AttributeError: 'Field' object has no attribute 'options'
```"
1812,computed field problem on update record - Web2py 2.16.1,2017-11-19T01:03:07Z,,,,,"I have this code:

my model:

```
def mysum(a,b):
    a=int(a)
    b=int(b)
    return a+b
db.define_table('mytable',
                Field('number1','integer'),
                Field('number2','integer'),
                Field('mysum', 'integer', compute=lambda row: mysum(row['number1'], row['number2']))
                )
```

my controller:

```
def index():
    if request.args(0):
        form=SQLFORM(db.mytable, request.args(0)).process()
    else:
        form=SQLFORM(db.mytable).process()
    if form.accepted:
        response.flash=""Ok""
    else:
        print form.errors
        response.falsh=form.errors
    return dict(form=form)
```

my view:
```
{{extend 'layout.html'}}

{{block header}}
<center style=""background-color: #333; color:white; padding:30px"">
  <h1>/{{=request.application}}/{{=request.controller}}/{{=request.function}}
</center>
{{end}}


{{=form.custom.begin}}
    <div>Number1</div>
    {{=form.custom.widget.number1}}
    <br>
    <div>Number2</div>
    {{=form.custom.widget.number2}}
    <br>
    {{=form.custom.submit}}
{{=form.custom.end}}
```

on update (appadmin too), the record not update.

 see in action (reproduce)
[https://drive.google.com/file/d/0B7J2UqggMO7eaHNPTkEycUY3VlhNN2NCUkw3T1FwRWgyT1ZR/view?usp=sharing](url)

[https://drive.google.com/file/d/0B7J2UqggMO7eUDZ5NktpUTJubFlVVVd2dUhYZy14eEoyWXlB/view?usp=sharing](url)

[https://drive.google.com/file/d/0B7J2UqggMO7eNC1ZZEsyVUtFeFdHTGZNUFBTTXA0OFA3aFhF/view?usp=sharing](url)

"
1811,Update SQLFORM deleted = False if readonly,2017-11-17T16:56:06Z,2017-11-22T20:50:40Z,,,,"This fixes the following syntax:
```
form = SQLFORM(table, record, readonly=readonly, deletable=True)

form.process()

if form.deleted:
   pass
elif form.accepted:
   pass
```

Otherwise, form.deleted is never set when readonly=True, and throws an attribute error.

It's possible, instead, that deleted should be set to False as a part of __init__.  That way, it always has the correct default value, to be overridden on deletion."
1810,Rocket has problems with large uploads from wininet client,2017-11-16T20:20:46Z,,,,,"If files are greater than about 1M, Rocket has delays posting the upload, and may show a timeout in the log.  User thinks transfer took a few seconds and was successful.

Reported in
<URL:https://groups.google.com/d/msg/web2py/dTK5lxWBsIA/JwskeLCrBwAJ>
and earlier in
<URL:https://groups.google.com/d/msg/web2py/lSdsqHLftVQ/Hf1j7z5jCwAJ>

web2py 2.14.6 on AWS Linux

/dps
"
1809,Rocket doesn't log enough information to diagnose connection issues.,2017-11-16T20:01:45Z,,,,,"After certificate renewal, Rocket restarts but connections are refused.  Log says ""listening"", but has no information about why connection was refused.

Reported at
<URL:https://groups.google.com/d/topic/web2py/G0hV1MALUJ0/discussion>

/dps
"
1808,translator params_substitution fails ,2017-11-16T06:36:38Z,,,TypeError,"TypeError: character mapping must return integer, None or unicode","The error appears in 2.15 in appadmin html template
and have survived after update
it is unicode related IMHO

web2py‚Ñ¢ | Version 2.16.1-stable+timestamp.2017.11.14.05.54.25
Python 2.7.11
sys.setdefaultencoding('utf-8')  at sitecustomize.py


To reproduce open link 
/welcome/appadmin/select/db?query=db.auth_user.id>0
with Russian locale

```
Traceback (most recent call last):
  File ""C:\a\w2p\gluon\restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""C:/a/w2p/applications/welcome/views/appadmin.html"", line 196, in <module>
    <p>
  File ""C:\a\w2p\gluon\globals.py"", line 432, in write
    self.body.write(to_native(xmlescape(data)))
  File ""C:\a\w2p\gluon\html.py"", line 125, in xmlescape
    return to_bytes(data.xml())
  File ""C:\a\w2p\gluon\languages.py"", line 431, in xml
    return str(self) if self.M else local_html_escape(str(self), quote=False)
  File ""C:\a\w2p\gluon\languages.py"", line 391, in __str__
    self.T.translate(self.m, self.s))
  File ""C:\a\w2p\gluon\languages.py"", line 951, in translate
    return message.translate(ttab_out)
TypeError: character mapping must return integer, None or unicode
```

If to comment out translate calls and to reload the app then

```py
                    else str(value)#.translate(ttab_in)
                    for value in symbols)
            message = self.params_substitution(message, symbols)
        return message#.translate(ttab_out)
```

appadmin works but  texts w params stay encoded like ""\x10\x34\x11...""
in place of the message  (string from /welcome/languages/ru.py)
`'%s selected': '%%{!–≤—ã–±—Ä–∞–Ω–∞[0]} %s %%{–∑–∞–ø–∏—Å—å[0]}',`

So encoded translated text fails to be translated back.

If to remove /welcome/languages/ru.py then the error disappears.
The message is simply:
`0 selected`

"
1807,Fix Janrain due to change in behavior,2017-11-15T19:54:23Z,2017-11-22T20:50:31Z,,,,"Janrain has started providing the login token via a POST request
in addition to including it in the query string. This results
in request.vars.token being a list containing two copies of the
token, which breaks the web2py code. This change keeps just a single
copy of the token."
1806,Update list of TLDs,2017-11-14T18:20:37Z,2017-11-22T20:50:22Z,,,,
1805,Url not found,2017-11-14T11:12:14Z,,,,,"In the code
web2py/applications/admin/static/js/jqueryMultiSelect.js
there is  a reference to this url
Visit http://abeautifulsite.net/notebook.php?article=62

but the url is ""not found!!!""
"
1804,Update supported python versions,2017-11-13T22:40:50Z,2017-11-14T03:12:37Z,,,,
1803,Fix #1715,2017-11-13T15:31:23Z,2017-11-14T03:13:06Z,,,,
1802,Fix a problem with Expressions in SQLTABLE,2017-11-08T22:23:09Z,2017-11-11T00:12:51Z,,,,probably Fixes #1735 and Fixes web2py/pydal#487
1801,Fixes #1800,2017-11-07T23:36:01Z,2017-11-11T00:12:17Z,,,,Use a new instance of CRYPT instead of setting min_length to 0 in the instance that will later be used with the new_password
1800,Auth change_password does not enforce settings.password_min_length,2017-11-07T22:28:18Z,2017-11-11T00:12:18Z,,,,"In authapi.py at https://github.com/web2py/web2py/blob/c4e08eeeb34cb51d9048a0eabc07586494ac8c8c/gluon/authapi.py#L991 and in tools.py at https://github.com/web2py/web2py/blob/c4e08eeeb34cb51d9048a0eabc07586494ac8c8c/gluon/tools.py#L3696, the `change_password` code sets the `CRYPT` `min_length` attribute to `0` (so the minimum length requirement will not be enforced on the old password). However, the instance of the `CRYPT` validator that is mutated is still the same instance attached to the `db.auth_user.password` field, so the subsequent validation of the new password does not enforce any minimum length.

The code should instead create a copy of the existing `CRYPT` validator rather than mutating the existing one."
1799,Add two scripts,2017-11-06T09:44:44Z,2017-11-11T00:12:03Z,,,,"Add both an update_languages script (which updates all languages and strips unused strings) and a check_lang_progress script.  These are two that I created for my own use, and I thought, why not share them with all?  üòâ "
1798,Image BLOG fails looking for myconf,2017-11-05T19:30:26Z,,,,,"Following instructions for creating 'An image blog'. When I try to run http://127.0.0.1:8000/images/appadmin I get: '<type 'exceptions.NameError'> name 'myconf' is not defined'. A Stackoverflow user suggested deleting menu.py model to resolve the problem and that worked.

What's up with that?"
1797,Set entry animation to 'fadeIn' and provide an easy switch for 'slideDown',2017-11-03T19:23:31Z,2017-11-11T00:10:13Z,,,,"The `fadeIn` effect for error messages, flashes, etc... is a nicer default. I added an easy variable to `web2py.js` for switching the entry animation to `slideDown`."
1796,gluon.http expects status code as integer while LazyWSGI generates str,2017-11-02T10:54:34Z,2017-11-11T00:09:38Z,,,,Fix for #1795
1795,Internal middleware returns incorrect status code,2017-11-02T10:50:11Z,2017-11-11T09:49:14Z,,,,Example from http://web2py.com/books/default/chapter/29/04/the-core#Internal-middleware returns 500 status code on latest web2py version (while still converting 'hello world' to 'HELLO WORLD' correctly).
1794,sys.stdout in scheduler.py not redifined,2017-10-30T02:19:28Z,,,,,"run_output not synchronize with print function in my task, instead, data is printed in the console. web2py running in windows OS."
1793,A step to PY3  closes #1792 and may be closes #1727,2017-10-28T16:39:21Z,2017-11-01T23:59:53Z,,,,"Add compatible reload to 2 places

Also fixes unicode conversion in languages.py
But in PY2 there were back conversion to plain str (bytes)
Here util functions return the unicode. Needs tests?
But I am user only. Have no much experience in unittests"
1792,reload for PY3 support,2017-10-27T15:21:41Z,2017-11-01T23:59:55Z,,,,"for someone who cares

@_compat.py:
#if PY2
+39     reload = reload
#else:
+78    from importlib import reload

@compileapp.py:
- from gluon._compat import builtin, PY2, unicodeT, to_native, to_bytes, iteritems, basestring, reduce, xrange, long
+ from gluon._compat import builtin, PY2, unicodeT, to_native, to_bytes, iteritems, basestring, reduce, xrange, long, reload


"
1791,current object apparently empty when instantiate validator in a module file,2017-10-23T18:34:06Z,,,,,"Hello, Im having a problem with the validators translation..

 I set requires to a SQLFORM in a module file and then process the form

On validators.py have_current is True but is empty.

```
try:
    from globals import current
    have_current = True
except ImportError:
    have_current = False
```

When function translate(text) call hasattr(current, 'T') return False
```
def translate(text):
    if text is None:
        return None
    elif isinstance(text, (str, unicode)) and have_current:
        if hasattr(current, 'T'):
            return str(current.T(text))
    return str(text)
```
Only work with validators instantiated in models.

Is a bug or I am missing something??
Thanks!"
1790,Invoking sql queries from threads results in error,2017-10-20T09:48:10Z,,,`AttributeError,"`AttributeError: 'thread._local' object has no attribute '_pydal_connection_139988697348176_13906'`","I've switched to newer version (2.15.4-stable) and found out that my code for retrieving data from database does not work anymore. It crashes on invoking 'executesql' from thread with error:
`AttributeError: 'thread._local' object has no attribute '_pydal_connection_139988697348176_13906'`

Invoking queries from main thread works correctly, this happens only calling it from threads.
Sample code:
```import threading
from gluon import current

class runSQL(threading.Thread):
	def __init__(self, sql, db_node):
		super(runSQL, self).__init__()
		self.sql = sql
		self.db_node = db_node

	def run(self):
		print ""THREAD RESULT:"", self.db_node.executesql(self.sql)
		
def test():
	db_nodes = current.data_nodes
	sql = ""SELECT 1""
	
	threads = []
	for db in db_nodes:
		print ""MAIN RESULT:"", db.executesql(sql)
		
		new_thread = runSQL(sql, db)
		threads.append(new_thread)
		new_thread.start()
		
	for t in threads:
		t.join()
```
Where data_nodes are DAL objects connecting to postgres database.

That same code worked correctly on version 2.14.6-stable. Am i doing something wrong, is there a new way to run sql queries in threads? Or can anyone confirm this as a bug?
Thanks.
"
1789,Fix setting 'ac' in request.vars,2017-10-12T16:20:23Z,2017-10-19T03:13:16Z,,,,"Currently, if an autocomplete is defined, request.vars.ac is set to 1 with every request, because sqlhtml updates request.vars to generate a URL, rather than cloning it. "
1788,Autocomplete widgets set request.vars every request,2017-10-12T16:12:46Z,2017-11-13T22:56:39Z,,,,"See the following lines, where request.vars.ac is set to 1 every call:

https://github.com/web2py/web2py/blob/5975e4767fd7339b5c588305ec9e8eebd9c079c5/gluon/sqlhtml.py#L685

I'm guessing it should be using copy.copy() to set urlvars = request.vars?"
1787,Scheduler: debug message causes multiple tickers to appear on web2py,2017-10-11T02:34:48Z,,,,,"https://github.com/web2py/web2py/blob/5975e4767fd7339b5c588305ec9e8eebd9c079c5/gluon/scheduler.py#L1228-L1239

The code above causes multiple workers to set themselves as tickers under the following circumstances:

1. The function ""being_a_ticker()"" successfully executes itself until the point updating the worker as the ticker (is_ticker=True)
2. Then when it wants to set all other workers as is_ticker=False it fails half way.
3. The exception is correctly captured, error prints out correctly but in line 1236 the half successfull code is commited... so there is more than one ticker on the database.
4. Scheduler stops working.

Fix:
Adding a simple raise after printing the message should be enough to fix it:
```
         try: 
             self.is_a_ticker = self.being_a_ticker() 
         except: 
             logger.error('Error coordinating TICKER') 
             raise
```"
1786,python3.4 : can not concat bytes to str,2017-09-28T09:22:59Z,2017-10-02T09:23:53Z,,,,"hello,
i start web2py from the source code. 

> Version 2.15.4-stable+timestamp.2017.09.01.22.38.25

after starting i receive a ticket containing this error

> File ""...\gluon\html.py"", line 950, in _xml
> TypeError: can't concat bytes to str

could someone tell me please what is going wrong ?
thanks in advance"
1785,"Enhances/fixes validators/is_empty() for Python 3 compatibility, fix #1764",2017-09-22T16:06:53Z,2017-10-19T03:12:10Z,,,,Fix #1764
1784,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:38Z,2017-09-22T10:53:13Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1783,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:38Z,2017-09-22T10:53:34Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1782,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:36Z,2017-09-22T10:53:42Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1781,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:35Z,2017-09-22T10:53:52Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1780,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:35Z,2017-09-22T10:53:59Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1779,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:34Z,2017-09-22T10:54:08Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1778,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:34Z,2017-09-22T10:54:17Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1777,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:33Z,2017-09-22T10:54:24Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1776,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:32Z,2017-09-22T10:54:31Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1775,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:31Z,2017-09-22T10:54:39Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1774,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:31Z,2017-09-22T10:54:47Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1773,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:30Z,2017-09-22T10:54:54Z,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename']+'.'+name.split('.')[-1]`.
It works."
1772,"A solution for adding file extension when streaming uploaded file whose filename is truncated by the Field('',length=somevalue,)",2017-09-22T10:52:30Z,,,,,"web2py 2.15.4, windows 10, python 3.6. I upload a file whose name is very long with Field('',length=200,). The file can be stored into the upload folder with a hash name with file extension  successfully. However when I try to stream the file according smartgrid() I get the truncated filename without file extension. After debugging I find a solution. 
Modify the line 1735 in pydal/objects.py from`filename = file_properties['filename']`
to `filename = file_properties['filename'].split(""."")[0]+'.'+name.split('.')[-1]`.
It works."
1771,"Bug:  upload field whose filename is cutoff  by length=""some even value"" will raise ""Odd-length string""  when I click the field link under the SQLFORM.smartgrid view",2017-09-22T06:10:38Z,,,binascii.Error,"binascii.Error: Odd-length string**","windows 10 or server 2012 r2(can both reproduce the bug), python 3.6, web2py 2.15.4.
I define a table in db.py as following:
`db.define_table('table_up_file',
                Field('input_year', 'string',default=request.now.strftime(""%Y"")),
                Field('up_file', 'upload',length=200,autodelete=True), )`
In default controller I use the following code
`query=db.table_up_file.id>0
grid=SQLFORM.smartgrid(db.table_up_file,
                           constraints=dict(table_up_file=query))
return dict(grid=grid)`
I uploaded a file with SQLFORM successfully. The uploaded filename is longer than the length limit which is ruled in the db.py. So the filename is cut off. But when click the field link under the grid view which is returned by the SQLFORM.smartgrid() function, I got the following error infos:

Traceback (most recent call last):
  File ""D:\web2py\gluon\restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""D:/web2py/applications/soma/controllers/default.py"", line 2048, in <module>
  File ""D:\web2py\gluon\globals.py"", line 414, in <lambda>
    self._caller = lambda f: f()
  File ""D:\web2py\gluon\tools.py"", line 3981, in f
    return action(*a, **b)
  File ""D:/web2py/applications/soma/controllers/default.py"", line 555, in school_upload_file
    constraints=dict(table_up_file=query)
  File ""D:\web2py\gluon\sqlhtml.py"", line 3235, in smartgrid
    user_signature=user_signature, **kwargs)
  File ""D:\web2py\gluon\sqlhtml.py"", line 2384, in grid
    stream = response.download(request, db)
  File ""D:\web2py\gluon\globals.py"", line 666, in download
    (filename, stream) = field.retrieve(name, nameonly=True)
  File ""D:\web2py\gluon\packages\dal\pydal\objects.py"", line 1734, in retrieve
    file_properties = self.retrieve_file_properties(name, path)
  File ""D:\web2py\gluon\packages\dal\pydal\objects.py"", line 1765, in retrieve_file_properties
    filename = base64.b16decode(m.group('name'), True).decode('utf-8')
  **File ""C:\Users\liuyibing\AppData\Local\Programs\Python\Python36\lib\base64.py"", line 275, in b16decode
    return binascii.unhexlify(s)
binascii.Error: Odd-length string**
After debugging, I change the length limit which is defined in db.py to some odd value, this can solve the problem. I think the length limit of upload fieldname can be either odd or even. So i think this is a bug."
1770,"submit with null input in request_reset_password raise an error ""Target receiver address not specified""",2017-09-21T02:52:55Z,,,,,"python 3.6, web2py 2.15.4, windows server 2012 r2. Submit with null input in request_reset_password raise an error ""Target receiver address not specified"". However I think an is_email validator will take action not rasing an error ticker."
1769,Scheduler database transaction nesting causes middleware to stall during shutdown,2017-09-20T11:29:47Z,,,,,"I have a web2py application using PostgreSQL running via uWSGI with roughly following configuration
```ini
[uwsgi]
uid = app
gid = app
chown-socket = www-data:www-data
chdir = /srv/app
module = wsgihandler
workers = 4
mule = run_scheduler.py
cron = 10 -1 -1 -1 -1 python web2py.py -Q -S app -M -R scripts/sessions2trash.py -A -o
```

When I need to restart the app, I observe a 30 second delay
```
root@debian:~# time systemctl restart uwsgi
real    0m30.214s
user    0m0.000s
sys     0m0.000s
```

however when I don't use the scheduler mule, the app restarts quickly, as expected
```
root@debian:~# time systemctl restart uwsgi
real    0m1.189s
user    0m0.000s
sys     0m0.000s
```

I've tried to track the behavior and found out that the scheduler doesn't close the database transactions  for polling properly and leaves them open until the next poll run. See following PostgreSQL query log. The number in the parenthesis before `LOG:` string is the number of open transactions and current virtual transaction ID.
```
2017-09-20 12:50:16.502 CEST [4435] user@db (3/66) LOG:  statement: BEGIN  <-- Transaction 66 start (inner)
2017-09-20 12:50:16.503 CEST [4435] user@db (3/66) LOG:  statement: SELECT ""scheduler_worker"".""id"", ""scheduler_worker"".""worker_name"", ""scheduler_worker"".""first_heartbeat"", ""scheduler_worker"".""last_heartbeat"", ""scheduler_worker"".""status"", ""scheduler_worker"".""is_ticker"", ""scheduler_worker"".""group_names"", ""scheduler_worker"".""worker_stats"" FROM ""scheduler_worker"" WHERE (""scheduler_worker"".""worker_name"" = 'debian#4429');
2017-09-20 12:50:16.505 CEST [4435] user@db (3/66) LOG:  statement: UPDATE ""scheduler_worker"" SET ""status""='ACTIVE',""last_heartbeat""='2017-09-20 12:50:16',""worker_stats""='{""status"": ""ACTIVE"", ""errors"": 0, ""workers"": 1, ""queue"": 0, ""empty_runs"": 40, ""sleep"": 3, ""distribution"": {""main"": {""workers"": [{""c"": 0, ""name"": ""debian#4429""}]}}, ""total"": 2}' WHERE (""scheduler_worker"".""worker_name"" = 'debian#4429');
2017-09-20 12:50:16.506 CEST [4435] user@db (3/66) LOG:  statement: COMMIT <-- Transaction 66 end (inner)
2017-09-20 12:50:16.667 CEST [4430] user@db (2/85) LOG:  statement: COMMIT <-- Transaction 85 end (outer) :(
--> 2017-09-20 12:50:16.669 CEST [4430] user@db (2/86) LOG:  statement: BEGIN  <-- Transaction 86 start (outer)
2017-09-20 12:50:16.669 CEST [4430] user@db (2/86) LOG:  statement: SELECT ""scheduler_task"".""id"", ""scheduler_task"".""application_name"", ""scheduler_task"".""task_name"", ""scheduler_task"".""group_name"", ""scheduler_task"".""status"", ""scheduler_task"".""function_name"", ""scheduler_task"".""uuid"", ""scheduler_task"".""args"", ""scheduler_task"".""vars"", ""scheduler_task"".""enabled"", ""scheduler_task"".""start_time"", ""scheduler_task"".""next_run_time"", ""scheduler_task"".""stop_time"", ""scheduler_task"".""repeats"", ""scheduler_task"".""retry_failed"", ""scheduler_task"".""period"", ""scheduler_task"".""prevent_drift"", ""scheduler_task"".""cronline"", ""scheduler_task"".""timeout"", ""scheduler_task"".""sync_output"", ""scheduler_task"".""times_run"", ""scheduler_task"".""times_failed"", ""scheduler_task"".""last_run_time"", ""scheduler_task"".""assigned_worker_name"" FROM ""scheduler_task"" WHERE ((""scheduler_task"".""assigned_worker_name"" = 'debian#4429') AND (""scheduler_task"".""status"" = 'ASSIGNED')) ORDER BY ""scheduler_task"".""next_run_time"" LIMIT 1 OFFSET 0;

-- 3 sec sleep

2017-09-20 12:50:19.512 CEST [4435] user@db (3/67) LOG:  statement: BEGIN  <-- Transaction 67 start (inner)
2017-09-20 12:50:19.512 CEST [4435] user@db (3/67) LOG:  statement: SELECT ""scheduler_worker"".""id"", ""scheduler_worker"".""worker_name"", ""scheduler_worker"".""first_heartbeat"", ""scheduler_worker"".""last_heartbeat"", ""scheduler_worker"".""status"", ""scheduler_worker"".""is_ticker"", ""scheduler_worker"".""group_names"", ""scheduler_worker"".""worker_stats"" FROM ""scheduler_worker"" WHERE (""scheduler_worker"".""worker_name"" = 'debian#4429');
2017-09-20 12:50:19.515 CEST [4435] user@db (3/67) LOG:  statement: UPDATE ""scheduler_worker"" SET ""status""='ACTIVE',""last_heartbeat""='2017-09-20 12:50:19',""worker_stats""='{""status"": ""ACTIVE"", ""errors"": 0, ""workers"": 1, ""queue"": 0, ""empty_runs"": 41, ""sleep"": 3, ""distribution"": {""main"": {""workers"": [{""c"": 0, ""name"": ""debian#4429""}]}}, ""total"": 2}' WHERE (""scheduler_worker"".""worker_name"" = 'debian#4429');
2017-09-20 12:50:19.516 CEST [4435] user@db (3/67) LOG:  statement: COMMIT <-- Transaction 67 end (inner)
--> 2017-09-20 12:50:19.675 CEST [4430] user@db (2/86) LOG:  statement: COMMIT <-- Transaction 86 end (outer) :(
2017-09-20 12:50:19.677 CEST [4430] user@db (2/87) LOG:  statement: BEGIN  <-- Transaction 87 start (outer)
2017-09-20 12:50:19.677 CEST [4430] user@db (2/87) LOG:  statement: SELECT ""scheduler_task"".""id"", ""scheduler_task"".""application_name"", ""scheduler_task"".""task_name"", ""scheduler_task"".""group_name"", ""scheduler_task"".""status"", ""scheduler_task"".""function_name"", ""scheduler_task"".""uuid"", ""scheduler_task"".""args"", ""scheduler_task"".""vars"", ""scheduler_task"".""enabled"", ""scheduler_task"".""start_time"", ""scheduler_task"".""next_run_time"", ""scheduler_task"".""stop_time"", ""scheduler_task"".""repeats"", ""scheduler_task"".""retry_failed"", ""scheduler_task"".""period"", ""scheduler_task"".""prevent_drift"", ""scheduler_task"".""cronline"", ""scheduler_task"".""timeout"", ""scheduler_task"".""sync_output"", ""scheduler_task"".""times_run"", ""scheduler_task"".""times_failed"", ""scheduler_task"".""last_run_time"", ""scheduler_task"".""assigned_worker_name"" FROM ""scheduler_task"" WHERE ((""scheduler_task"".""assigned_worker_name"" = 'debian#4429') AND (""scheduler_task"".""status"" = 'ASSIGNED')) ORDER BY ""scheduler_task"".""next_run_time"" LIMIT 1 OFFSET 0;
```

When I stop the uWSGI at this point, the *inner* poll loop repeats but the *outer* transaction (in this case transaction 87) never finishes.
```
2017-09-20 12:50:22.626 CEST [4435] user@db (3/68) LOG:  statement: BEGIN  <-- Transaction 68 start (inner)
2017-09-20 12:50:22.626 CEST [4435] user@db (3/68) LOG:  statement: SELECT ""scheduler_worker"".""id"", ""scheduler_worker"".""worker_name"", ""scheduler_worker"".""first_heartbeat"", ""scheduler_worker"".""last_heartbeat"", ""scheduler_worker"".""status"", ""scheduler_worker"".""is_ticker"", ""scheduler_worker"".""group_names"", ""scheduler_worker"".""worker_stats"" FROM ""scheduler_worker"" WHERE (""scheduler_worker"".""worker_name"" = 'debian#4429');
2017-09-20 12:50:22.629 CEST [4435] user@db (3/68) LOG:  statement: UPDATE ""scheduler_worker"" SET ""status""='ACTIVE',""last_heartbeat""='2017-09-20 12:50:22',""worker_stats""='{""status"": ""ACTIVE"", ""errors"": 0, ""workers"": 1, ""queue"": 0, ""empty_runs"": 42, ""sleep"": 3, ""distribution"": {""main"": {""workers"": [{""c"": 0, ""name"": ""debian#4429""}]}}, ""total"": 6}' WHERE (""scheduler_worker"".""worker_name"" = 'debian#4429');
2017-09-20 12:50:22.630 CEST [4435] user@db (3/68) LOG:  statement: COMMIT <-- Transaction 68 end (inner)
```

This repeats for 30 seconds (imposed by uWSGI service wrapper) and then the transaction is forcefully killed. PostgreSQL log reports this on the last line
```
2017-09-20 12:50:50.060 CEST [4430] user@db (2/87) LOG:  unexpected EOF on client connection with an open transaction
```

Expected behavior would be to close the outer transaction immediately after the necessary DML queries are finished."
1768,env,2017-09-18T03:13:54Z,,,,,
1767,How to write Unit Tests with web2py?,2017-09-15T11:51:03Z,,,,,Is there a way to write Unit Tests for an Application/Module within web2py runtime?
1766,Fix grid TSV export bug,2017-09-14T22:56:00Z,2017-09-21T05:23:18Z,,,,"The grid TSV export stopped working due to double quotes being added to `rows.colnames` by the grid code (i.e., `""tablename"".""fieldname""` instead of `tablename.fieldname`). The `represented` method of the base `ExportClass` class extracts the tablename and fieldname to get the `Field` object from the table definition, so it ended up doing `db['""tablename""']['""fieldname""']`, which generated an error. The `ExportTSV` class is the only exporter that uses the `represented` method, so it was the only one affected."
1765,fpdf 1.72 in 2.15.4 produces incorrect pdf files on windows and mac,2017-09-14T19:13:58Z,,,,,"pdf files can be read by ubuntu's pdf viewer but not by any standard viewer on windows or mac.
Workaround is to go back to pyfpdf 1.71 by replacing the fpdf folder in web2py's gluon folder.
Thus the problem is obviously the new version of fpdf released with web2py 2.15.1-4
(also see https://stackoverflow.com/questions/45733455/pdf-created-by-fpdf-python-works-fine-with-browser-and-ubuntu-but-showing-blank)"
1764,Bug in gluon/validators.py/is_empty() in Python 3,2017-09-14T05:02:44Z,2017-10-19T03:12:10Z,,,,"I was digging around trying to save an edit/sqlform with an upload field and it was failing with ""Invalid image"" error message. My upload field is using ""requires=IS_EMPTY_OR(IS_IMAGE())"" validator.
Since the field already have an image and I just want to update others fields it does not make sense to fire this error. Debugging a bit I found that upload field value (from input) is sent empty (b'') and the is_empty() function (called from IS_EMPTY_OR()) is returning ""NOT EMPTY"" cause only value '' and [] are treated as empty (not b''). It worked fine when I changed the bold line in is_empty() function to:

<pre>
def is_empty(value, empty_regex=None):
    _value = value
    """"""test empty field""""""
    if isinstance(value, (str, unicodeT)):
        value = value.strip()
        if empty_regex is not None and empty_regex.match(value):
            value = ''
    <b>if value is None or value == '' or value == b'' or value == []:</b>
        return (_value, True)
    return (_value, False)
</pre>

Thanks in advance.
"
1763,Fix bug with compiled views in compiled-only apps,2017-09-13T15:54:54Z,2017-09-21T05:22:54Z,,,,"Commit https://github.com/web2py/web2py/commit/a31cf09dd3d2dc682f58ee77529bd41ba644106e broke compiled views in apps containing only compiled files (i.e., generated via the admin ""Pack compiled"" functionality). Originally reported here: https://groups.google.com/forum/#!topic/web2py/R7ie7_neg7E."
1762,Bug in \pydal\adapters\oracle.py line 69-70 (not all arguments converted during string formatting),2017-09-13T09:47:48Z,,,TypeError,"TypeError: not all arguments converted during string formatting","Bug in oracle.py line 69-70 (not all arguments converted during string formatting):

Reason: % operator has higher precedence than unary operations (specifically in this example+)

web2py\gluon\packages\dal\pydal\adapters\oracle.py
self.execute(
    'CREATE SEQUENCE %s START WITH 1 INCREMENT BY 1 NOMAXVALUE ' +
    'MINVALUE -1;' % sequence_name)

example:

sequence_name = ""test""

print(
    'CREATE SEQUENCE %s START WITH 1 INCREMENT BY 1 NOMAXVALUE ' +
    'MINVALUE -1;' % sequence_name)

Traceback (most recent call last):

  File ""<ipython-input-2-73dbb10ce44d>"", line 3, in <module>
    'MINVALUE -1;' % sequence_name)

TypeError: not all arguments converted during string formatting

Fix add brackets to ensure :

print(
    ('CREATE SEQUENCE %s START WITH 1 INCREMENT BY 1 NOMAXVALUE ' +
    'MINVALUE -1;') % sequence_name)

CREATE SEQUENCE test START WITH 1 INCREMENT BY 1 NOMAXVALUE MINVALUE -1;"
1761,Update groups on edit profile,2017-09-13T09:26:36Z,2017-11-14T03:14:03Z,,,,When profile is updated `self._update_session_user(user)` set session.user_groups to None.  After the update self.update_groups() should be executed to keep session consistent.
1760,Problem with web2py compilation,2017-09-12T17:25:16Z,,,,,"Hi there

Very simple to show this issue:

1. download latest version of web2py (I use Mac OS version for Normal users)
2. From Admin interface compile and pack the 'Welcome' application that comes as standard with web2py
3. Then from the Admin interface upload and install the compiled 'Welcome' application you have just created (calling a different name of course)
4. When you try to run this compiled application you will get an error e.g. Invalid function or similar

Kind Regards
"
1759,"ignore_field_case=True, is not working in new DAL with psycopg2/Postgresql",2017-09-08T17:50:05Z,2017-09-10T16:37:06Z,,,,"After updating to the newest version I got this problem with table field names with capitalized letters. It  gives an error until I change the field name to all non capitals. See the attached file with the screen error.
[Web2py Issue.pdf](https://github.com/web2py/web2py/files/1288707/Web2py.Issue.pdf)

"
1758,Fix #1757,2017-09-07T09:19:00Z,2017-09-21T05:21:10Z,,,,
1757,user_agent.is_mobile fails with NoneType,2017-09-07T05:35:47Z,2017-09-21T05:21:11Z,,TypeError,"TypeError: argument of type 'NoneType' is not iterable","web2py‚Ñ¢ | Version 2.15.4-stable+timestamp.2017.09.02.04.02.22
Python 2.7.13: /usr/bin/python (prefix: /usr)

```
Traceback (most recent call last):
  File ""/home/www-data/web2py/gluon/restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""/home/www-data/web2py/applications/myapp/compiled/views.strategy.index.html.py"", line 32, in <module>
  File ""/home/www-data/web2py/gluon/globals.py"", line 340, in user_agent
    user_agent.is_mobile = 'Mobile' in http_user_agent
TypeError: argument of type 'NoneType' is not iterable
```
"
1756,Make _compat accept ducks,2017-09-06T14:34:53Z,2017-09-21T05:20:55Z,,,,Fixing issues with LazyT in the process
1755,Fixes #1753,2017-09-05T14:47:12Z,2017-09-21T05:20:27Z,,,,
1754,uncasted db var overloads apache,2017-09-05T10:49:49Z,,,,,"Until 2.14.6 this code worked:
model:
```
db.define_table('mytable', Field('myfield','list:integer'))
db.define_table('othertable', Field('otherfield','integer'))
```

controller:
```
def fail():
    form = SQLFORM(db.mytable,fields = ['myfield'])
    if form.process().accepted:
        rec_id = db.othertable.insert(otherfield=1)
        db.mytable[form.vars.id].update_record(myfield=rec_id) # fail here
        return dict(message=""no fail"")
    return dict(message=form)

```
The rec_id variable seemed to be autocasted.
After the upgrade, Apache 2.4 (wsgi) goes to 100% cpu load.

I cannot figure out, where the Problem is found in the libs."
1753,LOAD() error which result from the python3 map function in gluon/compileapp.py line 208,2017-09-03T15:51:32Z,2017-09-21T05:20:29Z,,,,"I am using python3.6 and  web2py 2.15.4. When I use the LOAD() funtion I find an error ""can only concatenate list (not ""map"") to list"". After searching and debugging, I find that python3 change the behavior of map function. In python3 map() function return an map object not a list. So the gloun/compileapp line 208 `        other_request.env.path_info = '/' + \
            '/'.join([request.application, c, f] +
                     map(str, other_request.args))` throw out an error. Then I change the ‚Äòmap(str, other_request.args)‚Äô to 'list(map(str, other_request.args))'. This make the LOAD() works fine. "
1752,non ASCII characters cause exception in email verification subject field,2017-09-03T14:35:46Z,2017-09-21T05:20:56Z,,`UnicodeDecodeError,"`UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 8: ordinal not in range(128)`","**Reproduction:**
1. Translate the string ""Email verification"" in your language file like this in the hu.py:
`Regisztr√°ci√≥ meger≈ës√≠t√©se`

2. Register to your site

After clicking the Register button, you will get a ticket with error message like this:
`UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 8: ordinal not in range(128)`

The trace shows that error comes from here:
`File ""/home/web2py/dev2py/gluon/tools.py"", line 748, in send`
`payload['Subject'] = encoded_or_raw(to_unicode(subject, encoding))`

The issue appears only in version 2.15.3. Former releases are not affected.
"
1751,"MARKMIN(T(...)) no longer works, at least in templates",2017-08-30T17:52:04Z,2017-09-21T05:20:56Z,,TypeError,"TypeError: Expected bytes","Py27
This doesn't work for me in templates (was Ok in version from 2016):

{{=MARKMIN(T(""**something bold** something more""))}}
This works:
{{=T(""**something** something"")}}

Error for the 1st case is 
  File ""/home/www-data/web2py/gluon/restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""<string>"", line 113, in <module>
  File ""/home/www-data/web2py/gluon/html.py"", line 2791, in __init__
    self.text = to_bytes(text)
  File ""/home/www-data/web2py/gluon/_compat.py"", line 68, in to_bytes
    raise TypeError('Expected bytes')
TypeError: Expected bytes

---------------
It will work if we add .....+"""" into 1st line of MARKMIN constructor (gluon/html.py),
however I don't believe this is a good fix.
So I don't try repair it (create a pull request).

class MARKMIN(XmlComponent):
    """"""
    For documentation: http://web2py.com/examples/static/markmin.html
    """"""
    def __init__(self,
                 text, extra=None, allowed=None, sep='p',
                 url=None, environment=None, latex='google',
                 autolinks='default',
                 protolinks='default',
                 class_prefix='',
                 id_prefix='markmin_',
                 **kwargs):
        self.text = to_bytes(text + '')  # hotfix 2.15.3: + ''
"
1750,Print statement fails in command line script (v2.15.3),2017-08-30T15:05:18Z,,,,,"After upgrading to v2.15.3, when scripts are run from the command line, print statements produce a SyntaxError. The print function works. This was not a problem in v2.14.6. (Tested with Python 2.7.11)

To illustrate:

    $ cat test.py
    #!/usr/bin/env python
    if __name__ == '__main__':
        print 'Hello!'

    $ python web2py.sh --no-banner -S myapp -R test.py
    Traceback (most recent call last):
      File ""/srv/http/web2py/2.15.3/web2py/gluon/shell.py"", line 270, in run
        execfile(startfile, _env)
      File ""/root/tmp/test.py"", line 4
        print 'abc'
    SyntaxError: invalid syntax

This works:

    $ cat test2.py
    #!/usr/bin/env python
    if __name__ == '__main__':
        print('Hello!')

    $ python web2py.py --no-banner -S myapp -R test2.py
    Hello!

This isn't a huge problem but it does break backwards compatibility.
"
1749,Minor error in EOF instructions,2017-08-29T18:27:32Z,2017-08-31T22:29:56Z,,,,"Dear web2py developer,

I found a minor mistake in the installer. Please review.

start -> stop"
1748,Modules do not reflect code change unless web2py proccess is killed.,2017-08-29T12:45:43Z,,,,,"Hi there. I'm having a strange behavior on the version 2.15.3. Every time I change the code in a .py file that is located in the modules, the changes are never reflected unless I kill web2py process (stop/start web2py server does not solve the issue).

I'm a newcomer to web2py so I was assuming that this should not occur. It seems that the server will always use the .pyc files and ignore the changes to .py. Is there a way while in development stage to change this behavior? The imported modules should have the same behavior as the controllers when editing in the web2py user interface.

Poc:
. Create _\_\_init_\_\_.py inside the /applications/app/modules/ folder
. Create mytest.py inside the /applications/app/modules/ folder with a function with a print string
. Inside one of the controllers import the module as 

> from mytest import function

. Call the function inside one of the methods of the controller
. Confirm the output in the console
. Change the output string of the function and confirm that it does not reflect the change next time the function is called.

web2py version : 2.15.3-stable
SO:  Linux kali 4.9.0-kali4-amd64 #1 SMP Debian 4.9.25-1kali1

EDIT: In windows 7 x64 have the same behavior with version 2.15.2-stable.

Thanks"
1747,Ignore,2017-08-25T23:18:28Z,2017-08-25T23:22:24Z,,,,
1746,Fix submit button disable bug,2017-08-23T15:44:57Z,2017-08-28T16:25:56Z,,,,"When a form includes more than one submit button, after being disabled
all buttons are re-enabled with the value of the first button rather
than having their original values restored. This change iterates over
each button separately to disable and enable.

See https://groups.google.com/forum/#!topic/web2py/nWawC_RdOys."
1745,"after_delete set, not iterable",2017-08-20T15:49:37Z,2017-08-20T15:59:43Z,,,,"Hi,

I have found a strange behavior in **after_delete** (db.mytable._after_delete). ""queryset"" is the return variable, If I do:
```
print type(queryset)
<Set (`auth_user`.`id` = 18)>
```

```
print queryset.count()
0
```

```
print queryset.select(mytable._id)
nothing
```

```
print queryset.select()
nothing
```

```
print queryset.isempty()
True
```

To get the deleted ID I have to do:
```
print queryset.query.second
18
```

Is this the right be behavior?

"
1744,<type 'exceptions.MemoryError'> from appadmin,2017-08-20T00:08:07Z,2017-12-06T03:10:30Z,,,,"I am trying to view a record such as
https://10.1.10.29/remail/appadmin/update/db/recipient_cc/110898
from the admin UI
Error is:
<type 'exceptions.MemoryError'>

Version
web2py‚Ñ¢	Version 2.15.3-stable+timestamp.2017.08.07.07.32.04
Python	Python 2.7.12: /usr/local/bin/uwsgi (prefix: /usr)
Traceback
Traceback (most recent call last):
  File ""/home/www-data/web2py/gluon/restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""<string>"", line 220, in <module>
  File ""/home/www-data/web2py/gluon/globals.py"", line 427, in write
    self.body.write(to_native(xmlescape(data)))
  File ""/home/www-data/web2py/gluon/html.py"", line 125, in xmlescape
    return to_bytes(data.xml())
  File ""/home/www-data/web2py/gluon/html.py"", line 2182, in xml
    return DIV.xml(newform)
  File ""/home/www-data/web2py/gluon/html.py"", line 960, in xml
    (fa, co) = self._xml()
  File ""/home/www-data/web2py/gluon/html.py"", line 952, in _xml
    co = b''.join([xmlescape(component) for component in self.components])
  File ""/home/www-data/web2py/gluon/html.py"", line 125, in xmlescape
    return to_bytes(data.xml())
  File ""/home/www-data/web2py/gluon/html.py"", line 960, in xml
    (fa, co) = self._xml()
  File ""/home/www-data/web2py/gluon/html.py"", line 952, in _xml
    co = b''.join([xmlescape(component) for component in self.components])
  File ""/home/www-data/web2py/gluon/html.py"", line 125, in xmlescape
    return to_bytes(data.xml())
  File ""/home/www-data/web2py/gluon/html.py"", line 960, in xml
    (fa, co) = self._xml()
  File ""/home/www-data/web2py/gluon/html.py"", line 952, in _xml
    co = b''.join([xmlescape(component) for component in self.components])
  File ""/home/www-data/web2py/gluon/html.py"", line 125, in xmlescape
    return to_bytes(data.xml())
  File ""/home/www-data/web2py/gluon/html.py"", line 960, in xml
    (fa, co) = self._xml()
  File ""/home/www-data/web2py/gluon/html.py"", line 952, in _xml
    co = b''.join([xmlescape(component) for component in self.components])
  File ""/home/www-data/web2py/gluon/html.py"", line 125, in xmlescape
    return to_bytes(data.xml())
  File ""/home/www-data/web2py/gluon/html.py"", line 1930, in xml
    return DIV.xml(self)
  File ""/home/www-data/web2py/gluon/html.py"", line 960, in xml
    (fa, co) = self._xml()
  File ""/home/www-data/web2py/gluon/html.py"", line 952, in _xml
    co = b''.join([xmlescape(component) for component in self.components])
  File ""/home/www-data/web2py/gluon/html.py"", line 125, in xmlescape
    return to_bytes(data.xml())
  File ""/home/www-data/web2py/gluon/html.py"", line 960, in xml
    (fa, co) = self._xml()
  File ""/home/www-data/web2py/gluon/html.py"", line 949, in _xml
    fa += (b' %s=""%s""') % (to_bytes(name), xmlescape(value, True))
  File ""/home/www-data/web2py/gluon/html.py"", line 133, in xmlescape
    data = local_html_escape(data, quote)
  File ""/home/www-data/web2py/gluon/utils.py"", line 450, in local_html_escape
    import cgi
  File ""/home/www-data/web2py/gluon/custom_import.py"", line 111, in custom_importer
    return NATIVE_IMPORTER(name, globals, locals, fromlist, level)
MemoryError
Error snapshot  help
<type 'exceptions.MemoryError'>()

Function argument list

(name='cgi', globals={'AES_dec': <function AES_dec>, 'AES_enc': <function AES_enc>, 'AES_new': <function AES_new>, 'DIGEST_ALG_BY_SIZE': {32: 'md5', 40: 'sha1', 56: 'sha224', 64: 'sha256', 96: 'sha384', 128: 'sha512'}, 'HAVE_AES': False, 'HAVE_COMPARE_DIGEST': True, 'HAVE_PBKDF2': True, 'HAVE_URANDOM': True, 'PY2': True, 'PYAES': <module 'gluon.contrib.pyaes' from '/home/www-data/web2py/gluon/contrib/pyaes/__init__.pyc'>, ...}, locals={}, fromlist=[], level=-1)

"
1743,Fix view file name in ticket traceback,2017-08-19T08:24:23Z,2017-08-28T16:25:41Z,,,,"Explicitly compiling view to set file name, this will appear in traceback instead of `<string>`."
1742,contrib/pg8000 is old and causes weird postgres errors,2017-08-17T12:26:29Z,,,,,"Please update the contrib/pg8000 driver to the current version.
Otherwise errors like Broken Pipe, Operationalerror,.. occur,
- at least for postgres 9.6,
- especially for long running task (ie. scheduler, where they are not properly handled (scheduler workers will restart and earlier run rmains as RUNNING).

related links:
https://github.com/mfenniak/pg8000/issues/73
https://groups.google.com/forum/#!topic/web2py/HAeJevtGtdU

..in copy into issues: web2py/web2py, web2py/pydal
"
1741,execfile shim for python 3 compatibility,2017-08-16T15:36:53Z,2017-08-28T16:25:28Z,,,,Fixes #1739
1740,Admin UI - Error ticket with less information in the latest web2py releases,2017-08-16T13:11:22Z,2017-08-28T16:25:42Z,,,,"In a view, I have a trivial 

> NameError: name 'fattura' is not defined

 due to

```
{{for ft in fatture:}}
{{=fattura.id}}
{{pass}}
```

But the Error Ticket returned by web2py is different depending on the development environment.
Below some cases.

Case 1 (best)
OS: windows 8
Web2py: Version 2.14.6-stable + timestamp.2016.05.10.00.21.47
Python: Python 2.7.13

![image](https://user-images.githubusercontent.com/3496662/29364536-1883c44a-8294-11e7-899d-a1e22df1437c.png)

Case 2
OS: windows 8
Web2py: Version 2.15.3-stable + timestamp.2017.08.07.12.51.45
Python: Python 2.7.13
**Filename missing**

![image](https://user-images.githubusercontent.com/3496662/29364577-33471048-8294-11e7-92d9-44df000ebb5f.png)

Case 3
OS: Linux MInt 8.2
Web2py: Version 2.15.3-stable + timestamp.2017.08.07.12.51.45
Python: Python 2.7.12
**The same as the case 2 but also Error snapshot and Python version are missing.** 

![image](https://user-images.githubusercontent.com/3496662/29364605-5295177e-8294-11e7-8c1a-74c27cf4a9c1.png)

Case 4 (worse)
OS: Linux MInt 8.2
Web2py: Version 2.15.3-stable + timestamp.2017.08.07.12.51.45
Python: Python 3.6.2
**Python version, reference to filename and line are missing. New exception occurred.**

![image](https://user-images.githubusercontent.com/3496662/29364651-828fb06a-8294-11e7-90fd-a201e7eb835d.png)
"
1739,Shell.py doesn't work in Python 3,2017-08-16T08:53:17Z,2017-08-28T16:25:28Z,,NameError,"NameError: name 'execfile' is not defined","When trying to run web2py from shell under python3 it throws an exception since shell.py calls execfile() func:

Traceback (most recent call last):
  File ""/Users/dev/Projects/www/gluon/shell.py"", line 270, in run
    execfile(startfile, _env)
NameError: name 'execfile' is not defined

"
1738,Fixes #1737,2017-08-15T14:34:42Z,2017-08-28T16:25:08Z,,,,getproxies is in urllib.request for python 3
1737,python 3 web2py2.15.3 urllib has no getproxies,2017-08-15T12:20:17Z,2017-08-28T16:25:11Z,,AttributeError,"AttributeError: module 'urllib' has no attribute 'getproxies'","ben@x1:/home/www-data/web2py$ python3 /home/www-data/web2py/web2py.py -K app-name,app-name

web2py Web Framework
Created by Massimo Di Pierro, Copyright 2007-2017
Version 2.15.3-stable+timestamp.2017.08.07.07.32.04
Database drivers available: pymysql, imaplib, psycopg2, sqlite3, pg8000
Traceback (most recent call last):
  File ""/home/www-data/web2py/web2py.py"", line 33, in <module>
    gluon.widget.start(cron=True)
  File ""/home/www-data/web2py/gluon/widget.py"", line 1170, in start
    start_schedulers(options)
  File ""/home/www-data/web2py/gluon/widget.py"", line 1080, in start_schedulers
    urllib.getproxies()
AttributeError: module 'urllib' has no attribute 'getproxies'
"
1736,Web2py on Windows not migrating JSON Field properly on Postgres 9.6,2017-08-15T07:55:56Z,,,,,"**Setup:**
Windows 10
Web2py 2.14.6
PostgreSQL 9.6

**Error on first migration:**
`column is of type json but expression is of type text`

The same setup gives no problem when running Web2py on Linux. The host operating system of PostgreSQL seems immaterial to the problem as JSON is created correctly while connecting Linux-based Web2py to a Windows-based PostgreSQL server.

**sql.log (original table info obscured):**
> timestamp: 2017-08-15T15:16:52.688000
> CREATE TABLE ""table1""(
>     ""id"" SERIAL PRIMARY KEY,
>     ""search_result"" JSON,
>     ""is_active"" CHAR(1),
>     ""created_on"" TIMESTAMP,
>     ""created_by"" INTEGER REFERENCES ""auth_user"" (""id"") ON DELETE CASCADE  ,
>     ""modified_on"" TIMESTAMP,
>     ""modified_by"" INTEGER REFERENCES ""auth_user"" (""id"") ON DELETE CASCADE  
> );
> success!
> timestamp: 2017-08-15T15:16:57.341000
> ALTER TABLE ""table1"" ADD ""search_result__tmp"" TEXT;
> UPDATE ""table1"" SET ""search_result__tmp""=""search_result"";
> ALTER TABLE ""table1"" DROP COLUMN ""search_result"";
> ALTER TABLE ""table1"" ADD ""search_result"" TEXT;
> UPDATE ""table1"" SET ""search_result""=""search_result__tmp"";
> ALTER TABLE ""table1"" DROP COLUMN ""search_result__tmp"";
> success!

In the above example ""table1"".""search_result"" becomes a **TEXT** field, instead of the desired **JSON** type."
1735,'Expression' object has no attribute 'tablename',2017-08-15T01:00:15Z,2017-11-11T00:12:51Z,,,,"Has this problem been resolved:

https://groups.google.com/forum/#!topic/web2py/-6Xz48ECcEM


Still see this on
web2py‚Ñ¢ | Version 2.15.3
-- | --
 rows = db(q).select(t.ALL, max, groupby=t.ALL, join=join) # this produces the error above :(
 rows = db(q).select(t.ALL, max, groupby=t.ALL, join=join).as_list() #this doesn't throw the error :)




"
1734,Feature Request: Add bulk update_or_insert,2017-08-14T20:50:34Z,2017-09-13T04:44:25Z,,,,"The title says it all, I think a simple `insert into table values (c1, c2), (c1, c2)...;` could work. This sql idiom is available on almost all db engines except oracle it seems."
1733,github export problem,2017-08-12T21:02:17Z,,,,,"From: https://groups.google.com/forum/#!topic/web2py/TGKkRINprG0

Since updating from 2.14.6 to 2.15.2 (and also 2.15.3 released just moments ago) I have some problems with the default ExportClasses in SQLFORM.grid.
I am using MSSQL as database.
The grid displays just fine, only the export faild (to tsv and, in some cases, to csv - I did not test others).

I'll spare you the complete traceback and get directly to what I could find by implementing my own ExportClass.

At first I got a <type 'exceptions.AttributeError'>, the relevant traceback was:
File ""C:\Users\riek\PycharmProjects\web2py\gluon\sqlhtml.py"", line 3563, in represented
    row.append(record._extra[col])
I didn't use any type _extra fields, meaning that the regex check in line 3562 failed (self.rows.db._adapter.REGEX_TABLE_DOT_FIELD.match(col)).

I then overwrote the ""represented""-Function with my own, ignoring this check and forcing the else-branch. 

This lead to the following exception: <type 'exceptions.AttributeError'> 'DAL' object has no attribute '""t_schule""'. So my tables and fields are quoted and thus not found.

I tried a solution I found somewhere else, setting entity_quoting=False in my DAL-instance, didn't change anything.

I then searched some more and found this bugfix: https://github.com/web2py/web2py/issues/1542
It appears that this fix quotes the tables and fields, no matter if entity_quoting is enabled or not.

I could solve my particular problem with an ugly hack, by removing the quotes in the represent-function of my ExportClass (line 3565 in sqlhtml.py: (t, f) = col.replace('""','').split('.')  instead of (t, f) = col.split('.')) 
I am wondering though if this is a bug or I am not properly understanding how the quoting works."
1732,fixes #1724,2017-08-10T04:55:35Z,2017-08-13T18:55:10Z,,,,call func instead of module in url_is_acceptable
1731,Fix include files,2017-08-09T00:09:17Z,2017-08-09T20:46:52Z,,,,"Also see this discussion
https://groups.google.com/forum/#!topic/web2py-developers/kJ5ZT8eral4"
1730,save_password function error,2017-08-08T21:31:43Z,,,ImportError,"ImportError: cannot import name InDBMigrator","I do usually set the web2py password programmatically, this worked in older versions of web2py:

```
python2 -c 'from gluon.main import save_password; save_password(""web2py"",8000)'
Traceback (most recent call last):
  File ""<string>"", line 1, in <module>
  File ""gluon/__init__.py"", line 38, in <module>
    from .dal import DAL, Field
  File ""gluon/dal.py"", line 17, in <module>
    from pydal.migrator import Migrator, InDBMigrator
ImportError: cannot import name InDBMigrator
```"
1729,Error when using @cache.action with cache_model=None and time_expire=None,2017-08-08T14:52:21Z,,,,,"Recently, I've found that using @cache.action with time_expire=None would throw an error.

In my specific scenario, I use @cache.action with variable arguments, and in some situations I need to set all parameters to None, in order to tell @cache.action ""hey, don't do anything, just do as if you weren't there"". 

Here I explained my case:
[https://groups.google.com/forum/#!topic/web2py/5SuaspDnjoQ](url)

The problem can be solved with this simple modification to gluon/cache.py:
[https://github.com/gonguinguen/web2py/commit/93cd4b9fa18788dd3b6cb3087f87a71a967aaa85](url)

Could you review the change and accept it if it's ok?
I've done some tests, and it's working ok, but maybe it needs the look of a more experienced developer.

Anyway, no problem if the change isn't accepted.
Regards,
Lisandro."
1728,Don't minify css or js files in other applications,2017-08-08T12:09:06Z,2017-08-08T22:33:58Z,,,,Fixes #1673
1727,Error in appadmin (database admin) on python 3,2017-08-08T09:43:55Z,2017-11-01T23:59:55Z,,,,"When using python3 and database admin, I got this error:

<class 'NameError'> name 'unicode' is not defined

To reproduce, open db admin and click on any table, for example, 
[http://127.0.0.1:8000/welcome/appadmin/select/db?query=db.auth_user.id>0](http://127.0.0.1:8000/welcome/appadmin/select/db?query=db.auth_user.id%3E0)"
1726,auth.has_membership(cached=True) check membership in auth.user_groups,2017-08-07T19:12:18Z,2017-08-08T17:19:26Z,,,,
1725,"main.py in windows has a bug in ""elif not rocket._ssl:""",2017-08-07T17:23:40Z,,,,,"main.py has a bug in line 748 (windows environment at least).

elif not rocket._ssl:

should be:

elif not rocket.has_ssl:

I don't know if it was already corrected since it is working fine under ubuntu Linux but I corrected it in my windows environment as Leonel C√¢mara sugested."
1724,XML sanitize=True throws error on check for acceptable url in py2,2017-08-07T16:08:44Z,2017-08-13T18:55:12Z,,TypeError,"TypeError: 'module' object is not callable","Below code in view throws error
```
{{=XML('<img src=""/myapp/static/images/pict.jpg"" />', sanitize=True)}}
```

Error:
```
Traceback (most recent call last):
  File ""\web2py\gluon\restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""<string>"", line 73, in <module>
  File ""\web2py\gluon\html.py"", line 603, in __init__
    text = sanitizer.sanitize(text, permitted_tags, allowed_attributes)
  File ""\web2py\gluon\sanitizer.py"", line 219, in sanitize
    allowed_attributes=allowed_attributes).strip(text, escape)
  File ""\web2py\gluon\sanitizer.py"", line 170, in strip
    self.feed(rawstring)
  File ""HTMLParser.py"", line 117, in feed
  File ""HTMLParser.py"", line 161, in goahead
  File ""HTMLParser.py"", line 325, in parse_starttag
  File ""HTMLParser.py"", line 407, in handle_startendtag
  File ""\web2py\gluon\sanitizer.py"", line 115, in handle_starttag
    if self.url_is_acceptable(attrs[attribute]):
  File ""\web2py\gluon\sanitizer.py"", line 148, in url_is_acceptable
    parsed = urlparse(url)
TypeError: 'module' object is not callable
```

Environment info:
- platform: win32
- python: 2.7.9 (major=2, minor=7, micro=9, releaselevel='final', serial=0)
- web2py: 2.15.2-stable+timestamp.2017.07.19.12.18.41

Steps to reproduce:
1. Open web2py from console
2. Try execute: `XML('<img src=""/myapp/static/images/pict.jpg"" />', sanitize=True)`

Possible fix:
In gluon._compat.py change line 14 from:
`import urlparse`
to 
`from urlparse import urlparse`"
1723,Small unicode compatibility py3 fixes,2017-08-06T23:21:10Z,2017-08-07T12:09:31Z,,,,
1722,mobilize is back,2017-08-06T18:20:14Z,2017-08-08T04:29:07Z,,,,Fixes #1721
1721,@Mobilize support missing in 2.15.2?,2017-08-06T17:13:30Z,2017-08-08T04:29:07Z,,ImportError,"ImportError: cannot import name mobilize","After upgrading to 2.15.2 views using **mobilize** statement throw an exception.
Before (2.14.6) same views worked fine

I can reproduce this using a minimal example 

from gluon.contrib.user_agent_parser import mobilize
@mobilize
def index():
   return dict()

throws an error
<type 'exceptions.ImportError'> cannot import name mobilize


Traceback (most recent call last):

File ""/home/www-data/web2py/gluon/restricted.py"", line 219, in restricted
exec(ccode, environment)
File ""/home/www-data/web2py/applications/myapp/controllers/stats.py"", line 3, in <module>    from gluon.contrib.user_agent_parser import mobilize

ImportError: cannot import name mobilize

Any ideas?"
1720,Fix BEAUTIFY trying to display uploaded file contents,2017-08-06T16:02:27Z,2017-08-07T12:08:59Z,,,,"Fixes #1717

This is a great example of some of the bugs happening in python 2 that we are finding due to python 3 breaking much more spectacularly."
1719,Fix response.download with nonasccii filenames,2017-08-05T12:27:57Z,2017-08-07T12:08:34Z,,,,Fixes #1718
1718,Can't download file with non ascii characters in the filename,2017-08-05T11:37:48Z,2017-08-07T12:08:34Z,,UnicodeEncodeError,"UnicodeEncodeError: 'ascii' codec can't encode character u'\xe2' in position 33: ordinal not in range(128)","Steps to reproduce:
1 - upload file with non ascii characters in the name
2 - try to download it
  
File ""C:\Users\Leonel\Desktop\web2py\gluon\main.py"", line 564, in wsgibase
    return http_response.to(responder, env=env)

  File ""C:\Users\Leonel\Desktop\web2py\gluon\http.py"", line 120, in to
    rheaders.append((k, str(v)))

UnicodeEncodeError: 'ascii' codec can't encode character u'\xe2' in position 33: ordinal not in range(128)

Example of a header causing this problem:
Content-Disposition attachment; filename=""comacentosc√¢mara.jpg""

I plan to fix this issue."
1717,python 3 upload getting uft8 invalid continuation byte error,2017-08-04T21:34:45Z,2017-08-07T12:08:59Z,,UnicodeDecodeError,"UnicodeDecodeError: 'utf-8' codec can't decode byte 0xd3 in position 33402: invalid continuation byte","Environment: 2.15.2-stable+timestamp.2017.07.19.12.18.41 (Running on Rocket 1.2.6, Python 3.6.2)

used example from http://web2py.com/books/default/chapter/29/07/forms-and-validators#SQLFORM-and-uploads

```
db.define_table('person',
    Field('name', requires=IS_NOT_EMPTY()),
    Field('image', 'upload'))
```

```
def display_form():
   record = db.person(request.args(0))
   form = SQLFORM(db.person, record, deletable=True,
                  upload=URL('download'))
   if form.process().accepted:
       response.flash = 'form accepted'
   elif form.errors:
       response.flash = 'form has errors'
   return dict(form=form)
```

Upload a simple text file, all is well.  Upload a binary file of any kind (PDF, MP4, etc.), and get an error like the following:

```
<class 'UnicodeDecodeError'> 'utf-8' codec can't decode byte 0xd3 in position 33402: invalid continuation byte

Traceback (most recent call last):
  File ""[redacted]\web2py\gluon\restricted.py"", line 219, in restricted
    exec(ccode, environment)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xd3 in position 33402: invalid continuation byte
```

Edit: fixed code block formatting"
1716,When upgrading to web2py 2.15.2 windows environment SSL support stopped working,2017-08-04T16:17:35Z,,,,,"I have just upgraded to web2py 2.15.2 in windows and I use python 2.7.11 for a while now to have the latest SSL protocols and work with PayPal. I use the following command line:

C:\web2py\web2py.py -a admin -i 192.168.8.100 -p 443 -c server.crt -k server.key -Y

and now the following error appears (without changing Python configuration):

--------------------------------------------------------------------------------------------
Version 2.15.2-stable+timestamp.2017.07.19.12.18.41
Database drivers available: psycopg2, pymysql, imaplib, sqlite3, pg8000, pyodbc

please visit:
	https://192.168.8.100:443/
use ""taskkill /f /pid 25308"" to shutdown the web2py server


2017-08-04 17:14:35,680 - web2py - WARNING - Python ""ssl"" module unavailable. SSL is OFF
------------------------------------------------------------------------------------------------------------

Well if the python SSL module was available before why is it not available now in web2py 2.15.2?
This only happens in windows with Rocket Server. I even tried to install python again in windows.
Under Linux with Apache2 server it is working fine.
"
1715,parameter of ajax put request is empty in Python 3,2017-08-04T10:53:05Z,2017-11-14T03:13:07Z,,,,"I tested the latest version 2.15.2 and I've got a problem when accessing ajax post parameters with web2py under Python 3.

The client sends a PUT request using jquery like this:
`$.ajax('<url>', {
    data: JSON.stringify({
        outputFormat: 'pdf'
    }),
    type: ""PUT"", contentType: ""application/json"",
    success: function(data) {
        alert('success');
    },
    error: function(jqXHR, textStatus, errorThrown) {
        alert('error');
    }
});`

in the controller I access the parameter
`output_format = request.vars.outputFormat`

when using Python 2.7 the variable output_format is set to 'pdf' as expected. When using Python 3.5 the variable is None."
1714,Fix wrong rocket.ssl check,2017-08-04T00:36:26Z,2017-08-04T15:35:14Z,,,,Fixes #1712
1713,SQLFORM.factory looks broken in 2.15.2,2017-08-03T12:08:07Z,2017-08-03T12:15:00Z,,,,"Test one (before was working):
```
form=SQLFORM.factory(db.auth_user)
```

ERROR:

> return SQLFORM(DAL(None).define_table(table_name, *[field.clone() for field in fields]),
> AttributeError: 'list' object has no attribute 'clone'

Test two (before was not wokring as well but I just test it in case):
```
field_objects = [f for f in db.auth_user]
form=SQLFORM.factory(field_objects)
```

ERROR:

> SyntaxError: define_table argument is not a Field or Table: ....

The return line in factory has been changed from:

```
        return SQLFORM(DAL(None).define_table(table_name, *fields),
                       **attributes)
```

to

```
        return SQLFORM(DAL(None).define_table(table_name, *[field.clone() for field in fields]),
                       **attributes)

```"
1712,Can not run web2py 2.15.2 in windows with or without ssl,2017-08-02T13:40:41Z,2017-08-07T12:20:00Z,,,,"I can't seem to run rocket server with ssl in windows (development environment - Aptana Studio).

ERR_SSL_PROTOCOL_ERROR
or
module object has no attribute ssl

Before, without SSL it was giving me a lot of ticket issues with the database initialization.

I'm compleately lost.

C:\web2py\web2py.py -i 192.168.8.100 -p 443 -c server.crt -k server.key -Y
or
C:\web2py\web2py.py -i 192.168.8.100 -p 8000 -Y
"
1711,Error with Reading/Updating List:References in web2py 2.15.2 from/to database,2017-08-02T13:28:02Z,2017-08-07T12:20:56Z,,TypeError,"TypeError: 'long' object is not iterable","I have just updated to web2py 2.15.2 and my site www.holidaysenses.com became unstable (unusable).

Line codes like:
image = db(db.intro_lifestyles.tourism_segment_id == segment.id).select().first()
or 
image = db(db.intro_regions.region_id == region.id).select().first()

where db.intro_lifestyles.tourism_segment_id and db.intro_regions.region_id are List:references with only one element each to tables ""segment"" and ""region"" respectively raise the following error:

File ""/home/www-data/web2py/gluon/packages/dal/pydal/helpers/methods.py"", line 95, in bar_encode
    return '|%s|' % '|'.join(bar_escape(item) for item in items if str(item).strip())
TypeError: 'long' object is not iterable

The site was working fine before...



"
1710,Fix Issue 1709,2017-08-02T09:52:00Z,2017-08-07T12:08:11Z,,,,"d3_graph_model fixed, no longer hardcoded for a ‚Äúdb‚Äù database"
1709,"appadmin d3_graph_model expects a database called ""db""",2017-08-02T08:54:35Z,2017-08-07T12:21:08Z,,,,"Need to do something like this (in appadmin.py.
    for db in databases:
"
1708,SQLFORM.grid paginate issue with mongodb DAL,2017-08-02T08:25:17Z,,,,,"Hi Folks, 

While randomly testing, I stumbled upon a bug with SQLFORM.grid with mongodb DAL.
**Bug**
SQLFORM.grid missing a row in display 

**Steps to replicate:**
`
#db = DAL('sqlite://sqlitetest.db' )
#db = DAL('mongodb://********:*******@*****/*****')
db.define_table('testsqlformgrid',
                Field('name', 'string'),
                Field('rollno', 'integer'))
db.testsqlformgrid.truncate()
db.testsqlformgrid.insert(name = ""R1"", rollno = 1)
db.testsqlformgrid.insert(name = ""R2"", rollno = 2)
db.testsqlformgrid.insert(name = ""R3"", rollno = 3)
db.testsqlformgrid.insert(name = ""R4"", rollno = 4)
db.testsqlformgrid.insert(name = ""R5"", rollno = 5)
db.testsqlformgrid.insert(name = ""R6"", rollno = 6)
def TestForm():
    form = SQLFORM.grid(db.testsqlformgrid, paginate = 2, orderby = db.testsqlformgrid.rollno )
    return dict(form = form)

`
While checking App/Test/TestForm, there is (paginate - 1) rows displayed, and row 2 is not displayed in any page. 
This does not happen with sqlite DAL. "
1707,Strange framework error after updating to 2.15.2,2017-08-01T20:14:06Z,2017-08-02T06:44:17Z,,KeyError,"KeyError: 'fields'","Since switching over my website to web2py 2.15.2, which involved upgrading my Python to 2.7, and installing the latest version of mod_wsgi (4.5.17), I have been getting the strange error below. The framework is a bit out of my knowledge, but it appears to be related to wsgi, and trying to remove something that is already not there. I would suggest first checking to see if it exists, but honestly I don't know what that stuff is doing. It doesn't seem to be breaking anything on the site, that I can tell, but obviously I would prefer if there were no errors!

Below is the full error ticket:

Version
web2py‚Ñ¢	Version 2.15.2-stable+timestamp.2017.07.19.12.18.41

Traceback (most recent call last):
  File ""/opt/web-apps/web2py/gluon/main.py"", line 434, in wsgibase
    session.connect(request, response)
  File ""/opt/web-apps/web2py/gluon/globals.py"", line 956, in connect
    session_pickled = pickle.dumps(self, pickle.HIGHEST_PROTOCOL)
  File ""/opt/web-apps/web2py/gluon/packages/dal/pydal/objects.py"", line 2946, in __getstate__
    del ret['fields']
KeyError: 'fields'

In file: Framework
1."
1706,Can't open Graph model after upgrading to 2.15.2,2017-08-01T08:11:26Z,2017-08-02T08:44:46Z,,,,"I just upgraded to 2.15.2 from 2.14.6 and after correcting my DAL-constructor to entity_quoting set to False, the PostgreSQL DB runs just fine...except for the graph model. I just get 
> invalid function (appadmin/d3_graph_model)

when I call it. I can't seem to find any more enlightening log-entries for this. Sorry. Any ideas, what to do?

Regards,
Oliver Holmes"
1705,Enhancement/1557,2017-07-31T17:08:56Z,2017-08-01T14:46:56Z,,,,"These changes I have been testing and working correctly in my computer. If you approve I can merge the changes.

When web2py SAML SP os CAS client is configured as alternate login the system auto create the users once he is logged into the SAML IDP or CAS server. Now with auth.settings.cas_create_user you can specify if the user is autocreated or you need to created first.

Another improvement is to have a custom change password url for external methods. For example, when the user configure the CAS client or SAML SP and click in change password. If change_password_url is configured. The SP will redirect to change_password_url. Good if the you want to configure the IDP change password page.

"
1704,Allow response.json to be sortable or not,2017-07-31T15:56:10Z,2017-08-01T14:46:12Z,,,,Added  sort_keys=False as default parameter to response.json(). This will keep compatibility with previous version to 2.15
1703,Error in ejecution of sessions2trash.py,2017-07-29T15:04:14Z,2017-08-04T00:34:19Z,,,,"Version: 2.15.2-stable+timestamp.2017.07.19.12.18.41
             web2py.exe for windows

Start logging----------
               File ""c:\web2py_sitio\gluon\shell.py"", line 268, in run
                 execfile(startfile, _env)
               File ""scripts/sessions2trash.py"", line 90
                 print 'key: %s' % str(item)
                               ^
               SyntaxError: invalid syntax
End logging----------

Adding any print 'xxxxx' or print('xxxx') or print sys.argv, gives error.
And also, in any source that is launched in cmd mode.
If you comment the print, it works.
It looks like a web2py.exe problem
In version 2.14.6 works.

Regards.

¬°ups! 
Apologies, I did not do all the relevant tests.
You had to change ALL the print to py3 form.
Close or delete this issue."
1702,Fix autocomplete called after user_signature chk,2017-07-28T01:22:14Z,2017-08-01T14:46:01Z,,,,"Fixes #1699 which was caused by the autocomplete widget only being called after a user_signature check and the signature not being there.  

The default values for user_signature and hash_vars make this work with the grid when it has the user_signature=True option without any problem when that isn't the case. Users can disable it if they want or change it according to what they're verifying in their controllers.   
  
The autocomplete widget will still fail with the default kwargs in a situation where it is called in a controller function that first verifies the URL signature with hash_vars=True.  
  
For users having that problem, there's no way around this without inserting a security flaw, so they must sadly change their application code to give the autocomplete widget the needed user_signature and hash_vars argument."
1701,Fixes 1700 - utc and local time inconsistency in AuthJWT,2017-07-27T09:37:26Z,2017-08-01T14:45:47Z,,,,"Fixed inconsistency in using `datetime.utcnow()` and `datetime.now()`.
[https://github.com/web2py/web2py/issues/1700](https://github.com/web2py/web2py/issues/1700)"
1700,AuthJWT token does not expire in expiration time,2017-07-27T09:24:15Z,2017-08-07T12:21:43Z,,,,"When token is generated by code below, I would expect that token expires in 2s but it still authorize after. Refreshing token after 2s is refused as expected.
```
myjwt = AuthJWT(auth, 'secret', expiration=2, leeway=0)
```
```
def token():
    return myjwt.jwt_token_manager()
```
```
@myjwt.allows_jwt()
@auth.requires_login()                                                           
def call():
    return ""hello""
```
There is inconsistency in using UTC and local time (my local time is UTC+2)."
1699,Error with autocomplete in version 2.15.2,2017-07-27T04:18:38Z,2017-08-01T14:46:01Z,,,,"Versi√≥n: web2py.exe para windows 2.15.2-stable+timestamp.2017.07.19.12.18.41
Update all js in the target application with 2.15.2 of welcome
Tested in browsers: Firefox and Chrome.

When entering data in the autocomplete field, the candidate values are not displayed.
When you enter, it indicates an invalid value.
And an image in transparent format appears and disappears from the first part of the displayed panel.
The panel, is to insert record, invoked by the (+) button of a sqlform.grid.
It worked correctly in version 2.14.6 and 2.15.1
This problem occurs in a panel that has been running for months, and has not had updates.

Regards."
1698,Files required for Azure set up.,2017-07-27T03:38:21Z,2017-07-27T03:49:05Z,,,,See https://groups.google.com/forum/#!topic/web2py/XGxM_Tb9nJ4 for guide
1697,psycopg2.ProgrammingError : column does not exist,2017-07-26T09:59:58Z,2017-07-26T18:33:08Z,,ProgrammingError,"ProgrammingError: column organization.emailAttivita does not exist","When I try to run my application in web2py 2.15.2 I encounter this issue:

```
<class 'psycopg2.ProgrammingError'> column organization.emailAttivita does not exist LINE 1: ... ""organization"".""telefono"", ""organization"".""fax"", ""organizat... ^
```

The traceback is:

```
Traceback (most recent call last):
  File ""/home/manuel/web2pydist/gluon/restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""/home/manuel/web2pydist/applications/easytrack/models/menu.py"", line 35, in <module>
    URL('organizzazione', 'set_curr_org', args=[org.id])) for org in db(db.organization.name == False).select()
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/objects.py"", line 2211, in select
    return adapter.select(self.query, fields, attributes)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/adapters/base.py"", line 760, in select
    return self._select_aux(sql, fields, attributes, colnames)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/adapters/base.py"", line 716, in _select_aux
    rows = self._select_aux_execute(sql)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/adapters/base.py"", line 710, in _select_aux_execute
    self.execute(sql)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/adapters/__init__.py"", line 67, in wrap
    return f(*args, **kwargs)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/adapters/base.py"", line 410, in execute
    rv = self.cursor.execute(command, *args[1:], **kwargs)
ProgrammingError: column organization.emailAttivita does not exist
LINE 1: ... ""organization"".""telefono"", ""organization"".""fax"", ""organizat...
```

My model is:

```python
db.define_table('organization', 
                Field('name',
                      type='string',
                      required=True,
                      unique=True,
                      label=T('name'),
                      requires=IS_NOT_IN_DB(db, 'organization.name')),
                Field('ragione_sociale',
                      label=T('Ragione sociale'),
                      type='string',
                      required=False),
                Field('partita_iva',
                      label=T('Partita IVA'),
                      type='string',
                      required=False),
                Field('indirizzo',
                      label=T('Indirizzo'),
                      type='string',
                      required=False),
                Field('localita',
                      label=T('Localit√†'),
                      type='string',
                      required=False),
                Field('telefono',
                      label=T('Telefono'),
                      type='string',
                      required=False),
                Field('fax',
                      label=T('Fax'),
                      type='string',
                      required=False),
                Field('emailAttivita',
                      label=T('emailAttivita'),
                      type='list:string',
                      requires=IS_LIST_OF(IS_EMPTY_OR(IS_EMAIL())),
                      comment='Elenco di indirizzi email contattati in caso di attivit√†'),
                Field('sistema',
                      label=T('org sistema'),
                      type='boolean',
                      default=False,
                      represent=lambda v, r: I(' ', _class='fa %s' % ('fa-check' if v else '')),
                      comment='Organizzazione di sistema'),
                Field('cliente',
                      label=T('Cliente'),
                      type='boolean',
                      default=False,
                      required=False,
                      represent=lambda v, r: I(' ', _class='fa %s' % ('fa-check' if v else '')),
                      ),
                Field('fornitore',
                      label=T('Fornitore'),
                      type='boolean',
                      default=False,
                      required=False,
                      represent=lambda v, r: I(' ', _class='fa %s' % ('fa-check' if v else '')),
                      ),
                format='%(name)s',
                plural='Organizzazioni'
                )
```
The code portion which raises that error is:

```python
clienti = [
            (I(_class=""fa fa-bank"") + SPAN(org.name), False, 
                URL('organizzazione', 'set_curr_org', args=[org.id])) for org in db(db.organization.name == False).select()
          ]
```

I printed out what the SELECT statement would look like and this is the result:

```sql
SELECT ""organization"".""id"", ""organization"".""name"", ""organization"".""ragione_sociale"", ""organization"".""partita_iva"", ""organization"".""indirizzo"", ""organization"".""localita"", ""organization"".""telefono"", ""organization"".""fax"", ""organization"".""emailAttivita"", ""organization"".""sistema"", ""organization"".""cliente"", ""organization"".""fornitore"" FROM ""organization"" WHERE (""organization"".""name"" = 'False');
```

This is the same select(), but in web2py 2.14.6:

```sql
SELECT  organization.id, organization.name, organization.ragione_sociale, organization.partita_iva, organization.indirizzo, organization.localita, organization.telefono, organization.fax, organization.emailAttivita, organization.sistema, organization.cliente, organization.fornitore FROM organization WHERE (organization.name = 'False');
```

Please note the new presence of the quotation marks that force postgres to look for **organization.emailAttivita** column, which it has been created instead as **organization.emailattivita** by the original migration:

```
                                     Table ""public.organization""
     Column      |          Type          |                         Modifiers                         
-----------------+------------------------+-----------------------------------------------------------
 id              | integer                | not null default nextval('organization_id_seq'::regclass)
 name            | character varying(512) | 
 emailattivita   | text[]                 | 
 sistema         | character(1)           | 
 fax             | character varying(512) | 
 indirizzo       | character varying(512) | 
 ragione_sociale | character varying(512) | 
 partita_iva     | character varying(512) | 
 telefono        | character varying(512) | 
 localita        | character varying(512) | 
 fornitore       | character(1)           | 
 cliente         | character(1)           | 
```

**A workaround exists**: setting the `rname` value as 'emailattivita' in the field constructor leads to this SELECT (which works):

```sql
SELECT ""organization"".""id"", ""organization"".""name"", ""organization"".""ragione_sociale"", ""organization"".""partita_iva"", ""organization"".""indirizzo"", ""organization"".""localita"", ""organization"".""telefono"", ""organization"".""fax"", ""organization"".emailattivita, ""organization"".""sistema"", ""organization"".""cliente"", ""organization"".""fornitore"" FROM ""organization"" WHERE (""organization"".""name"" = 'False');
```

Does this issue depend on an adapter (or psycopg) update?"
1696,websocket_messaging in Python 3,2017-07-25T20:51:36Z,2017-08-07T12:27:36Z,,,,"I ran into 3 problems when trying to get WebSockets working on Py3:

1.  `import gluon.utils` failed.
2. Strings were sometimes bytecode, causing mismatches of groups.
3. function `to_native` was unavailable.

For 1) All I had to was to copy the file to web2py root and run from there. Maybe a documentation change would be sufficient?

For 2) I changed line 144 and 145 in the PostHandler post function from:

```
message = self.request.arguments['message'][0]
group = self.request.arguments.get('group', ['default'])[0]
```

to:

```
message = self.request.arguments['message'][0].decode(encoding='UTF-8')
group = self.request.arguments.get('group', ['default'])[0].decode(encoding='UTF-8')
```
The log message on hello world example went from  `MESSAGE to b'mygroup':b'Hello World'` to `MESSAGE to mygroup:Hello World`.

For 3) only an additional import was required: `from gluon._compat import to_native`. Then things ran smoothly.


`Version 2.15.2-stable+timestamp.2017.07.19.12.18.41`"
1695,Custom fieldstyle function silently failing,2017-07-25T00:36:35Z,,,,,"In order to guarantee backwards compatibility, the `SQLFORM.createform` function is wrapping the `formstyle()` call (which might be user-defined) waiting for a `TypeError` exception:

```
            # sqlhtml.py:1411
            try:
                table = formstyle(self, xfields)
                for id, a, b, c in xfields:
                    self.field_parent[id] = getattr(b, 'parent', None) \
                        if isinstance(b, XmlComponent) else None
            except TypeError:
                # backward compatibility, 4 argument function is the old style
                table = TABLE()
                for id, a, b, c in xfields:
                    newrows = formstyle(id, a, b, c)
            # [...]
```

That means that if anything inside the function raises `TypeError` you'll get a confusing traceback. For example, if I have:

```
def my_formstyle(form, fields):
    a = int(request.args(0))
```

And `request.args(0) is None`, then a ticket will be generated with:

> TypeError: semantic_formstyle() takes exactly 2 arguments (4 given)

While the real traceback is:

> TypeError: int() argument must be a string or a number, not 'NoneType'"
1694,Adapter not found for imap,2017-07-24T01:41:31Z,,,SyntaxError,"SyntaxError: Adapter not found for imap","Here is my traceback

Traceback (most recent call last):
 File ""C:\dev\web2py\gluon\restricted.py"", line 219, in restricted
 exec(ccode, environment)
 File ""C:/dev/web2py/applications/wrighthub/models/db.py"", line 38, in <module>
 imapdb = DAL('imap://catchall:2007j0j7&@23.253.201.164:993')
 File ""C:\dev\web2py\gluon\packages\dal\pydal\base.py"", line 170, in __call__
 obj = super(MetaDAL, cls).__call__(*args, **kwargs)
 File ""C:\dev\web2py\gluon\packages\dal\pydal\base.py"", line 454, in __init__
 adapter = adapters.get_for(self._dbname)
 File ""C:\dev\web2py\gluon\packages\dal\pydal\adapters\__init__.py"", line 20, in get_for
 'Adapter not found for %s' % uri
SyntaxError: Adapter not found for imap
web2py‚Ñ¢ Version 2.15.2-stable+timestamp.2017.07.19.12.18.41


Got a reply on the user group from Anthony stating that support was lost during some move to pydal contrib lib.  Suggested opening a ticket.  Should it be here or for pydal?

-Jim"
1693,response.js does not execute in the oncreate SQLFORM.grid callback,2017-07-22T21:27:22Z,,,,,"Hello, I have a component which has an SQLFORM.grid and an oncreate and ondelete callbacks on which I execute a response.js. When I delete a record the response.js javascript function is executed but when I create a record the response.js javascript function does not get executed (but the python's oncreate function gets executed)

This is my controller code:

```
def oncreate_empleado(form):
    # This method executes but the response_gestor_empleados javascript function is not executed
    response.js = 'response_gestor_empleados(%i);' % form.vars.id


def ondelete_empleado(table, id):
    # Here the response_gestor_empleados javascript function gets executed
    response.js = 'response_gestor_empleados(5);'


def index():

    grid_empleados = SQLFORM.grid(db.empleado,
                                  orderby=[db.empleado.apellidos, db.empleado.nombres],
                                  links=[dict(header='',
                                              body=lambda registro: crear_boton_seleccionar_empleado(registro))],
                                  details=False,
                                  csv=False,
                                  formname='grid_empleados',
                                  oncreate=oncreate_empleado,
                                  ondelete=ondelete_empleado)

    return dict(grid_empleados=grid_empleados)
```

Is this a bug or am I doing something wrong? Thank you!"
1692,Fix #1691: Passing tables to SQLFORM.factory() fails,2017-07-21T09:22:01Z,2017-08-01T14:45:22Z,,,,"Still clone fields, in factory(), but leave tables untouched so they get passed to define_table correctly"
1691,Passing tables to SQLFORM.factory() fails,2017-07-21T09:01:42Z,2017-08-01T14:45:23Z,,AttributeError,"AttributeError: 'Table' object has no attribute 'clone'","Example:
`form = SQLFORM.factory(idb.catering, idb.catering_diet)`

File ""/home/www-data/internal-apps/gluon/sqlhtml.py"", line 1922, in factory
    return SQLFORM(DAL(None).define_table(table_name, *[field.clone() for field in fields]),
AttributeError: 'Table' object has no attribute 'clone'

Since .clone() was added to the list comprehension, it tries to clone tables as well, rather than passing them on to define_table() as is."
1690,del_membership prevent update self user if user_id has a value,2017-07-21T08:47:54Z,2017-08-01T14:44:42Z,,,,"Function del_membership in authapi.py:

If membership is updated by admin for example, to another user. Self admin user membership is updated too.
The line:
```
if group_id in self.user_groups: 
 del self.user_groups[group_id]
```
Updated to:
```
if group_id in self.user_groups and user_id == self.user_id: del self.user_groups[group_id]:
 del self.user_groups[group_id]
```"
1689,Issue when del_membership ,2017-07-21T08:36:06Z,2017-08-07T12:30:27Z,,,,"Function del_membership in authapi.py:

If membership is updated by admin for example, to another user. Self admin user membeship is updated too.

The line:
```
if group_id in self.user_groups: 
 del self.user_groups[group_id]
```

Should be change to

```
if group_id in self.user_groups and user_id == self.user_id: del self.user_groups[group_id]:
 del self.user_groups[group_id]
```

Doing a pull request...
"
1688,ImportError: No module named fileutils w/ routes.py,2017-07-15T18:46:59Z,2017-08-07T12:31:18Z,,ImportError,"ImportError: No module named fileutils","Hi,
All was working fine on my previous w2p install, then I just migrated all the environment to another server w/ ubuntu 16.04, nginx/1.10.3 and uwsgi 2.0.15.

(Tested on web2py 2.15.1) 

If routes.py is available in the web2py folder I'm having this error:
`added /home/www-data/web2py/ to pythonpath.
mounting wsgihandler:application on /
Traceback (most recent call last):
  File ""/home/www-data/web2py/wsgihandler.py"", line 29, in <module>
    import gluon.main
  File ""/home/www-data/web2py/gluon/main.py"", line 121, in <module>
    load_routes()
  File ""/home/www-data/web2py/gluon/rewrite.py"", line 379, in load
    load(routes, appname)
  File ""/home/www-data/web2py/gluon/rewrite.py"", line 319, in load
    exec(data, symbols)
  File ""<string>"", line 21, in <module>
ImportError: No module named fileutils
unable to load app 0 (mountpoint='/') (callable not found or import error)
`

Seems that something is breaking the import.

I'm going to test it with a previous version of web2py in a few hours

"
1687,a bug of translation breaks the menu hyperlink of a new simple application.,2017-07-15T16:44:47Z,2017-07-18T08:44:20Z,,,,"Python 3.6, web2py 2.15.1, chrome.
For testing the new version of web2py 2.15.1, I create a new simple application through the administrative interface. I find a very strange bug. When the application name length is shorter than 4 (for example 'soma') and  the T.accepted_language is zh-cn,the index.html of the application looks like the following 
![20170716001839](https://user-images.githubusercontent.com/25625873/28240997-44274a02-69be-11e7-9d32-8ee4927f8af9.png)

the caret symbol disappear and there is no child element of the hyberlink as unusual . After some debugging, I guess the language translation result in this bug when the request language is zh-cn. I am not familiar with gluon/languages.py and gluon/compileapp.py. 

You can recurrent the bug under web2py 2.15.1 with the following steps:
1. create a new simple application whose name is 'soma' or any other string whose length is shorter than 4.
2. add one line code to the index function of the default controller
```
def index():
    T.force('zh-cn') ## add this line to force your T.accepted_language to zh-cn
    response.flash = T(""Hello World"") 
    return dict(message=T('Welcome to web2py!'))
```
Could anyone help to fix this bug.
"
1686,Fixes 6 issues ,2017-07-14T19:24:50Z,2017-07-18T08:44:19Z,,,,
1685,PEP8 fixes break functionality,2017-07-14T17:19:42Z,2017-07-18T08:44:20Z,,**Notes**,"**Notes**: Based on [PEP8](https://www.python.org/dev/peps/pep-0008/#function-annotations) (see the recommendation just above this anchor), there is no way to write this nicely.","**The problem**: in https://github.com/web2py/web2py/commit/590de9c8900ac1d5da58758730ad9c805c7e8429#diff-1e4f774e944ce88607f6bc3debe6f0b7R2770, PEP8 fixes transformed `if self.crypt.salt == True:` to `if self.crypt.salt:`. However, per the [docs for the function](https://github.com/web2py/web2py/blame/master/gluon/validators.py#L2750), ""If a salt is specified use it, if salt is True, set salt to uuid (this should all be backward compatible)."" This change means a specified `salt` will **never** be used. 

**The fix**: revert this change, leaving the line as `if self.crypt.salt == True:`, with perhaps a comment on the necessity of this syntax.

**Notes**: Based on [PEP8](https://www.python.org/dev/peps/pep-0008/#function-annotations) (see the recommendation just above this anchor), there is no way to write this nicely.

"
1684,"a bug when installing plugin :""unable to install plugin***"" with python 3.6 and web2py 2.15.1",2017-07-14T09:42:01Z,2017-07-18T08:44:20Z,,,,"I want to install a plugin with the admin with python 3.6 and web2py 2.15.1. However when I press the upload button, a session.flash ""unable to install plugin ***"" occurs. After a hard debugging I find a solution.
I modify the fix_newlines() function in /gloun/fileutils.py
```
def fix_newlines(path):
    regex = re.compile(r'''(\r|\r|)''')
    for filename in listdir(path, '.*\.(py|html)$', drop=False):
        rdata = read_file(filename, 'rb')
        # wdata = regex.sub('\n', rdata)  ## original code. rdata is bytes, this line will raise type error in python 3.6
        wdata = regex.sub('\n', rdata.decode('utf8')).encode('utf8')  ## the code I modify
        if wdata != rdata:
            write_file(filename, wdata, 'wb')
```
the above code fix the bug."
1683,Field is already bound to a table when defining tables,2017-07-12T15:08:08Z,2017-07-17T08:47:46Z,,ValueError,"ValueError: Field filiale.organization_id is already bound to a table","I'm trying to port my application to web2py 2.15.1 and when I try to run it the error ""Field filiale.organization_id is already bound to a table"" is raised in a model file.
The significant section is:

```python
db._common_fields.append(Field('organization_id',
                               'reference organization',
                               requires=IS_IN_DB(db, db.organization.id,
                                                 '%(name)s', zero=T('choose one')),
                               default=DEFAULT_TENANT,
                               writable=False,
                               widget=wdg_select2,
                               label=T('Organizzazione')))

db.define_table('filiale',
                Field('codice',
                      type='string'),
                Field('descrizione',
                      type='string',
                      requires=IS_NOT_EMPTY(error_message=T('Inserire una descrizione')),
                      required=True),
                Field('indirizzo',
                      type='string'),
                Field('telefono',
                      type='string'),
                auth.signature,
                format='%(codice)s %(descrizione)s',
                plural='Filiali',
                common_filter=lambda query: db.filiale.organization_id == auth.user.organization_id if 'auth' in session else False)
db.filiale._enable_record_versioning()

db.define_table('coda_assistenza',
                Field('descrizione',
                      type='string',
                      requires=IS_NOT_EMPTY(error_message=T('Inserire una descrizione')),
                      required=True),
                Field('utenti',
                      type='list:reference auth_user',
                      required=False,
                      widget=SQLFORM.widgets.checkboxes.widget,
                      requires=IS_IN_DB(db, db.auth_user.id,
                                        '%(first_name)s %(last_name)s',
                                        zero=T('Seleziona uno o pi√π utenti)'),
                                        multiple=(0, 1000))),
                Field('email_supplementari',
                      type='list:string',
                      notnull=False,
                      required=False,
                      requires=IS_LIST_OF(IS_EMPTY_OR(IS_EMAIL())),
                      label=T(""Email Supplementari"")),
                Field('coda_default',
                      type='boolean',
                      label=T('Default'),
                      represent=repr_bool,
                      required=True),
                Field('interna',
                      type='boolean',
                      label=T('Interna'),
                      represent=repr_bool,
                      required=True),
                auth.signature,
                format='%(descrizione)s',
                plural=T('Code assistenza'),
                singular=T('Coda assistenza'),
                common_filter=lambda query: db.coda_assistenza.organization_id == auth.user.organization_id if 'auth' in session else False)
db.coda_assistenza._enable_record_versioning()
db.coda_assistenza.utenti.widget = wdg_select2_multiple

```
The traceback:
```
Traceback (most recent call last):
  File ""/home/manuel/web2pydist/gluon/restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""/home/manuel/web2pydist/applications/easytrack/models/db_002_ticket.py"", line 236, in <module>
    common_filter=lambda query: db.coda_assistenza.organization_id == auth.user.organization_id if 'auth' in session else False)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/base.py"", line 587, in define_table
    table = self.lazy_define_table(tablename, *fields, **args)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/base.py"", line 599, in lazy_define_table
    table = table_class(self, tablename, *fields, **args)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/objects.py"", line 351, in __init__
    field.bind(self)
  File ""/home/manuel/web2pydist/gluon/packages/dal/pydal/objects.py"", line 1633, in bind
    'Field %s is already bound to a table' % self.longname)
ValueError: Field filiale.organization_id is already bound to a table
```

Function argument list
```
(self=<pydal.objects.Field object>, table=<Table coda_assistenza (id, descrizione, utenti,...d_by, modified_on, modified_by, organization_id)>)
```

Variables
```
self <pydal.objects.Field object>
self.longname 'filiale.organization_id'
```

The weird thing is that the error refers to the **second** table (coda_assistenza), where there shouldn't be any reference to the field filiale.organization_id since this field it's added as a common field in the first table. Another similar common field is added to the second table, but it should be completely independent from the first one.

This code works fine in version 2.14.6"
1682,Fixheroku,2017-07-10T20:35:36Z,2017-07-18T08:43:46Z,,,,"Warning I haven't tested it because I don't use heroku, if someone can test this works it would be great."
1681,"table wizard throws misleading, inaccurate error that should be caught at validation stage",2017-07-10T15:02:08Z,,,,," I downloaded web2py from git and am using Apache 2.4 with
MySQL. When using the wizard to create an application, I get the error
'invalid table names (auth_* tables already defined)' but in checking
the database that I defined, there are no such tables in the
database... none at all in fact.

I saved the entire ticket as a complete webpage available here:
http://tmp.metaperl.org/ticket%20admin_45.79.206.182.2017-07-09.20-33-45.3ad3d1bf-a1b9-42f8-af81-00423fa67ad2.html

The wizard should never have let me create a table beginning with `auth_`. If it had prevented this, then I would not have experienced the misleading, inaccurate error that I did.

The error message is inaccurate. It claims that the auth_* tables are already created. But upon inspecting my database tables, I do not see any such tables created. The error message is misleading because the real issue is using `auth_` to prefix my personal table names."
1680,Python 3 compatibility need to retain integer division in sqlhtml.py,2017-07-09T22:01:17Z,2017-07-18T08:44:20Z,,,,"There are two lines currently 408 and 474 in gluon/sqlhtml.py which I believe need to be changed from

        rows = totals / cols
to
        rows = totals // cols
This is only for python 3 to avoid iterating over a float a few lines further down the file - but possibly a more general search for / operators should also be carried out in case there are other similar instances in other files."
1679,"Fixes #1675 dropdown not working in the ""manage"" button",2017-07-07T17:11:00Z,2017-07-10T19:18:18Z,,,,
1678,Issue/1674,2017-07-07T09:20:33Z,2017-07-10T19:17:57Z,,,,Fixed.
1677,Path to css file changed to explicitly point to admin app,2017-07-07T08:41:10Z,2017-07-07T09:18:39Z,,,,
1676,appadmin errors page didn't show detail information,2017-07-06T23:06:56Z,2017-08-28T16:25:42Z,,,,"appadmin errors page didn't show like inspect attributes, code, arguments, variables, locals, request, response, session like in previous version (2.14.6)"
1675,"admin page, manage button (dropdown) not work (no errors occured)",2017-07-06T22:53:44Z,2017-07-10T19:18:19Z,,,,"tested in osx with chrome and firefox
other user tested in : 
- windows 7 /Chrome/Firefox/Internet Explorer
- older fedora with firefox"
1674,graph model didn't show the erd like in previous version,2017-07-06T22:51:31Z,2017-07-10T19:25:55Z,,,,"go to http://127.0.0.1:8000/welcome/appadmin/d3_graph_model
graph model didn't show the erd like in previous version :
- relation between table not shown
- table fields shown is stacked with another table name"
1673,"can't use response.optimize_js in models/db.py, previous version can work",2017-07-06T22:50:05Z,2017-08-09T20:46:54Z,,IOError,IOError: [Errno 2] No such file or directory: '/Users/MacBookPro/site/web2py/applications/welcome/static/min.js',"in models/db.py
response.optimize_js = 'concat,minify,inline'

Traceback (most recent call last):
  File ""/Users/MacBookPro/site/web2py/gluon/restricted.py"", line 219, in restricted
    exec(ccode, environment)
  File ""<string>"", line 36, in <module>
  File ""/Users/MacBookPro/site/web2py/gluon/globals.py"", line 501, in include_files
    time_expire)
  File ""/Users/MacBookPro/site/web2py/gluon/cache.py"", line 247, in __call__
    value = f()
  File ""/Users/MacBookPro/site/web2py/gluon/globals.py"", line 496, in call_minify
    self.optimize_js)
  File ""/Users/MacBookPro/site/web2py/gluon/contrib/minify/minify.py"", line 101, in minify
    contents = read_binary_file(abs_filename)
  File ""/Users/MacBookPro/site/web2py/gluon/contrib/minify/minify.py"", line 19, in read_binary_file
    f = open(filename, 'rb')
IOError: [Errno 2] No such file or directory: '/Users/MacBookPro/site/web2py/applications/welcome/static/min.js'"
1672,SQLFORM.factory - Field is already bound to a table,2017-07-05T10:50:26Z,2017-07-18T08:44:21Z,,,,"**web2py 2.15.0b1**

SQLFORM.factory problem

Put in a controller:

    def index():

        db = DAL('sqlite:memory')

        db.define_table('table1',
                Field('f1'),
                )

        form = SQLFORM.factory(db.table1.f1) 
        return form

This gives an exception:

    (...)

    File ""web2py-2.15.0b1/gluon/packages/dal/pydal/objects.py"", line 1633, in bind
        'Field %s is already bound to a table' % self.longname)
    ValueError: Field table1.f1 is already bound to a table


Using instead:

    form = SQLFORM.factory(db.table1) 

Doesn't raise any error.


Maybe a pydal issue???"
1671,markmin blockquotes are rendered wrong and other problems,2017-07-03T18:02:37Z,,,,,"About:
https://github.com/web2py/web2py/blob/master/gluon/contrib/markmin/markmin2html.py

# 1. Blockquotes
The description of markmin2html promises, that there could be a table or any other markmin code inside. This does not work, nothing inside a blockquote is changed.

Why?

Line 1209ff reads:
```python
s = '<blockquote%s%s>%s</blockquote>%s' \
                    % (t_cls,
                       t_id,
                       '\n'.join(strings[bq_begin:lineno]), pp)
```

The text is only joined, without any markmin interpretation.
I think, it should be the following code (I have found it in another version on markmin2html.py

```python
s = '<blockquote%s%s>%s</blockquote>%s' \
                         % (t_cls,
                            t_id,
                            render('\n'.join(strings[bq_begin:lineno]),
                                   extra,
                                   allowed,
                                   'br',
                                   URL,
                                   environment,
                                   latex,
                                   autolinks,
                                   protolinks,
                                   class_prefix,
                                   id_prefix,
                                   pretty_print),
                            pp
                           )
```

# 2. Version number
There is a lot of different versions of markmin2html.py
I think there should be version number and/or a date of the last revision inside the file.

# 3. Links line 226ff
## Download
- http://web2py.googlecode.com/hg/gluon/contrib/markmin/markmin2html.py
- http://web2py.googlecode.com/hg/gluon/contrib/markmin/markmin2latex.py
- http://web2py.googlecode.com/hg/gluon/contrib/markmin/markmin2pdf.py
are not valid

# 4. Line 232 says:
markmin2html.py and markmin2latex.py are single files and have no web2py dependence. Their license is BSD.
This is wrong. markmin2html needs now gluon - see line 9 and 10
It would be nice to have it again all together in only one file.
"
1670,Referencing wiki content with https,2017-06-30T18:00:23Z,,,,,"The generated links for wiki content/media (e.g. image links) should use the same protocol as the host page because we get a possible security issue warning.

For example https://rjas.ro/ for the pages that contain wiki pages with embedded images, chrome issues the following warning:
`Your connection to this site is not fully secure.

Attackers might be able to see the images you are looking at on this site and trick you by modifying them.`"
1669,"Testing pypy3.5 in travis, switching to ubuntu trusty",2017-06-24T06:12:44Z,2017-07-10T19:17:21Z,,,,"Current master runs on pypy3.5 too
@gi0baro would you add a similar env in pydal ?"
1668,fix performance regression with compiled views,2017-06-24T06:04:52Z,2017-07-10T19:17:05Z,,,,see https://github.com/web2py/web2py/issues/1467#issuecomment-310739172
1667,Enhance main.py PEP8,2017-06-22T13:58:56Z,2017-07-10T19:16:09Z,,,,
1666,Enable Ajax file uploads,2017-06-21T20:32:37Z,2017-07-10T19:15:02Z,,,,These changes to web2py.js allow file uploads via Ajax in browsers that support the `FormData` API. Older browsers will continue to fall back to the jQuery `.serialize()` method.
1665,Close #1664 remaining py2.6 specific code,2017-06-21T19:36:53Z,2017-07-10T19:14:45Z,,,,
1664,remain py2.6 stuff that can be delete,2017-06-21T19:29:11Z,2017-07-10T19:14:46Z,,,,"Here :
https://github.com/web2py/web2py/blob/0d646fa5e7c731cb5c392adf6a885351e77e4903/gluon/import_all.py#L86

py26_deprecated is used before been declared...

Since we drop py2.6 : https://groups.google.com/d/msg/web2py-developers/xz5o_CF4GOo/ZJm0HImTAAAJ

Shall we delete those line??

I send a PR if you take it..."
1663,Enhance http.py PEP8,2017-06-21T19:18:37Z,2017-07-10T19:14:10Z,,,,
1662,Enhance html.py PEP8,2017-06-21T19:13:14Z,2017-07-10T19:13:53Z,,,,
1661,Enhance globals.py PEP8,2017-06-21T19:04:50Z,2017-07-10T19:20:56Z,,,,
1660,Enhance highlight.py PEP8,2017-06-21T19:04:42Z,2017-07-10T19:13:20Z,,,,
1659,Enhance decoder.py PEP8,2017-06-21T18:42:29Z,2017-07-10T19:13:04Z,,,,
1658,"fix minify, added tests",2017-06-21T18:12:03Z,2017-07-10T19:09:53Z,,,,@niphlod would you update https://github.com/web2py/web2py/issues/1353 too?
1657,Enhance dal.py PEP8,2017-06-21T17:44:20Z,2017-07-10T19:12:55Z,,,,
1656,Enhance contenttype.py PEP8,2017-06-21T17:35:39Z,2017-07-10T19:12:46Z,,,,
1655,Enhance compileapp.py PEP8,2017-06-21T17:33:18Z,2017-07-10T19:12:31Z,,,,
1654,Enhance admin.py PEP8,2017-06-21T17:25:29Z,2017-07-10T19:12:17Z,,,,
1653,Enhance validators.py PEP8 and fix docstring py3 compatibility,2017-06-21T15:59:57Z,2017-07-10T19:11:59Z,,,,
1652,Enhance tools.py PEP8 compliancy,2017-06-21T15:30:43Z,2017-07-10T19:11:12Z,,,,
1651,Enhance authapi.py PEP8 compliancy,2017-06-20T20:18:54Z,2017-06-20T21:44:18Z,,,,
1650,Posible security bug,2017-06-15T09:38:57Z,2017-06-16T09:38:53Z,,,,"Please, let me know an email to share information privately.
Kind regards."
1649,fix Pickler.dispatch_table,2017-06-14T19:48:35Z,2017-06-15T09:01:14Z,,,,
1648,Minor bug in access.py,2017-06-14T19:11:52Z,2017-06-20T16:53:59Z,,,,"In 'admin/models/dkaccess.py' there is a (mostly harmless) error in line 55:13.  Specifically, a '-' (minus) where there should be an '=' (assignment operator).

    elif not _config.get('password'):
        ret = False  # Tanny Bear fixed was 'ret - False'.
    elif _config['password'].startswith('pam_user:'):
"
1647,Update html.py,2017-06-11T23:49:58Z,2017-06-15T09:00:42Z,,,,"adding in helpers for the following HTML tags:

<article></article>
<footer></footer>
<header></header>"
1646,Replace Calendar by flatpickr,2017-06-09T20:49:21Z,,,,,"As discuss here : https://groups.google.com/d/msg/web2py/9D2nKl5ULPc/m9uWFR4sAgAJ

I am working on it at a slow pace... I get it to work, but for some reason it only kick it the second time to focus the field, I guess there is some class that didn't get set properly as I only replace Calendar.set() by flatpickr jquery syntax... I have been able to init flatpickr for time type field as asked by Anthony with faltpickr API.

It remains to figure how we are going to handle the localization as for ISO format for date and 24hrs for time. Not sure what the web2py Calendar date default format, but flatpickr use ISO. Calendar was set with 24hrs format for time with datetime type field. We may want to allow this to be configure without having to go in web2py.js???

If anyone want to make it happen faster let me know I will push a branch on my fork and you can work from this branch"
1645,Scheduler queue_task dumping json strings into Oracle DB with cx_Oracle,2017-06-07T23:14:57Z,,,ValueError,"ValueError: No JSON object could be decoded","When following the documentation and setting up scheduler for first time I came across the following error when my tasks started failing.

2017-06-07 23:22:26,785 DEBUG 3040 139872588486464 __init__():158    traceback: Traceback (most recent call last):
  File ""/opt/web-apps/web2py/gluon/scheduler.py"", line 311, in executor
    args = _decode_list(loads(task.args))
  File ""/usr/lib64/python2.7/json/__init__.py"", line 338, in loads
    return _default_decoder.decode(s)
  File ""/usr/lib64/python2.7/json/decoder.py"", line 366, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File ""/usr/lib64/python2.7/json/decoder.py"", line 384, in raw_decode
    raise ValueError(""No JSON object could be decoded"")
ValueError: No JSON object could be decoded

After investigation it appears that queue_task is writing dictionary values into oracle DB as string represented JSON in order to save this value as VARCHAR2(512) into the vars and args columns of database  table scheduler_task.

As a work around I have had to put the below trigger on the Oracle database in order to remove the single quotes from the values before insert into the db for any of my tasks to complete. 

create or replace trigger replace_quotes
before insert on SCHEDULER_TASK
for each row
begin
:new.args := replace( :new.args, '''', '' );
:new.vars := replace( :new.vars, '''', '' );
end;
/ 

Versions
2.14.6-stable+timestamp.2016.05.10.00.21.47
(Running on Apache/2.4.6 (Red Hat Enterprise Linux) OpenSSL/1.0.1e-fips PHP/5.4.16 mod_wsgi/3.4 Python/2.7.5, Python 2.7.5)
cx-Oracle (5.3)
Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit"
1644,Changed URL validation to use urlparse instead of regex for spliting ‚Ä¶,2017-06-07T03:59:41Z,2017-06-15T09:00:31Z,,,,"‚Ä¶the URL

Enabled test_is_url in Python 3 since it is now passing
This might be one of the last fixes to #1353
Fixes #1598"
1643,Fixes #1598,2017-06-06T17:44:54Z,2017-06-06T20:37:56Z,,,,Also added a few more tests for IS_URL
1642,"Fixes #1634 by adding a parameter ""ignore_extension"" to Request.restf‚Ä¶",2017-06-06T00:54:34Z,2017-06-14T14:30:53Z,,,,‚Ä¶ul which allows you to leave the args untouched if you set it to True.
1641,Fixes #1639,2017-06-05T22:52:45Z,2017-06-14T14:30:26Z,,,,
1640,Fixes #1628,2017-06-05T22:36:18Z,2017-06-05T22:44:02Z,,,,Without the problems of code duplication seen in the previous pull request
1639,IS_IN_DB breaks with None values and id/integer fields,2017-06-05T16:36:40Z,2017-06-14T14:30:29Z,,,,"If the `field` argument to `IS_IN_DB` is an `id` or `integer` field (which is the case for all reference fields) and the value submitted for validation is `None` (or anything other than an integer or a digit string), an exception is thrown at [this line](https://github.com/web2py/web2py/blob/8a741023d8a2631a0a33dc47ee08f73e71018efc/gluon/validators.py#L635) or [this line](https://github.com/web2py/web2py/blob/8a741023d8a2631a0a33dc47ee08f73e71018efc/gluon/validators.py#L662).

We could probably change:

    if isinstance(value, (int, long)) or value.isdigit():

to:

    if isinstance(value, (int, long)) or (hasattr(value, 'isdigit') and value.isdigit()):
"
1638,Auth add_membership and del_membership mistakenly alter the logged-in user's session,2017-06-04T23:54:42Z,2017-06-20T17:02:52Z,,,,"Auth `add_membership` and `del_membership` not only add and delete records in the `auth_membership` table, but they also add and remove items from the `self.user_groups` dictionary of the currently logged in user (see https://github.com/web2py/web2py/blob/8a741023d8a2631a0a33dc47ee08f73e71018efc/gluon/authapi.py#L529).

The problem is that the `self.user_groups` dictionary should only be updated if the membership being added or deleted is for the currently logged in user. However, the code does the update regardless of the user_id. The following condition:

    if role:

should be changed to:

    if role and user_id == self.user_id:
"
1637,fix to #1636: sqlgrid left= (left outer join) fails because db._adapt‚Ä¶,2017-06-01T06:54:22Z,2017-06-05T16:48:34Z,,,,‚Ä¶er.tables() now returns dict (previously a list)
1636,sqlhtml.py throws exception when there is a left in query,2017-05-31T09:19:30Z,2017-06-06T13:13:41Z,,,,"Line 2332 on sqlthml.py has a problem for me. 
This is the context: 

The grid causing this:

```
grid = SQLFORM.grid(db_vciadmin.patient_entity_link,
                        left = db_vciadmin.appt_reminder_status.on(db_vciadmin.patient_entity_link.unified_id == db_vciadmin.appt_reminder_status.clinic_patient), ...
```

snippet surrounding line 2332 
```
 tablenames = db._adapter.tables(dbset.query)  #tablenames is a dictionary
        if left is not None:
            if not isinstance(left, (list, tuple)):
                left = [left]
            for join in left:
                tablenames += db._adapter.tables(join)  #this is line 2332
```
The last line in that snippet throws an exception. 
`<type 'exceptions.TypeError'> unsupported operand type(s) for +=: 'dict' and 'dict'
`

` db._adapter.tables(join) `evaluates to
```
{'appt_reminder_status': <Table appt_reminder_status (id, appt_summary_id, email_id, appt_confirmed, callback_id, sms_id, appt_date, email_sent_when, email_reply_when, sms_sent_when, second_sms_sent_when, sms_reply_when, location, entity, patient_name, patient_phone, patient_email, clinic_patient, email_link_visit, appt_startdatetime, inactive_row, callback_url, sms_process_complete, email_process_complete, confirmation_method, notes, sms_fail_message_sent, email_fail_message_sent, do_not_contact, sms_reply_text)>,
 'patient_entity_link': <Table patient_entity_link (id, unified_id)>}
```
so we are trying to do += on two dicts


"
1635,heroku ADAPTERS error,2017-05-20T19:03:45Z,2017-07-18T08:43:48Z,,ImportError,"ImportError: cannot import name ADAPTERS","I'm looking to use Heroku for deployment of my web2py project. However, when I add 
`from gluon.contrib.heroku import get_db`
`db = get_db(name=None, pool_size=myconf.get('db.pool_size'))`

I get a ticket with the error:

> File ""/Users/huangyu/dev/web2py/gluon/contrib/heroku.py"", line 10, in <module>
    from pydal.adapters import ADAPTERS, PostgreSQLAdapter
ImportError: cannot import name ADAPTERS

It looks like web2py has moved on from using ADAPTERS? Has that been replaced by 
`@adapters.register_for('postgres')`

But the heroku file has not been updated. "
1634,"REST - IP address as parameter, web2py thinks the last octet is an extension",2017-05-18T13:27:12Z,2017-06-14T14:30:54Z,,,,"Hi, 

I am currently building a rather simple REST-interface based on Web2py (Version 2.14.6-stable+timestamp.2016.05.10.00.21.47) and found a bug. 

I want to provide an interface which queries our IPAM-solution for infos about a specified IP address/network, e.g.
1- https://web2pyhost/rest/net/192.168.1.1
2- https://web2pyhost/rest/net/192.168.1.0/24
3- https://web2pyhost/rest/net/192.168.1.1.

This is my controller:
```python
@request.restful()
def net():
    response.view = 'generic.json'

    def GET(ip, mask=0):
        if IS_IPV4()(ip)[1]:
            return dict(result=dict(error=""Invalid ip address""))
        if IS_INT_IN_RANGE(0, 33)(mask)[1]:
            return dict(result=dict(error=""Invalid mask""))
        if mask != 0:
            return dict(result=getRESTInfoForNetwork(""%s/%s""%(ip,mask)))
        else:
            return dict(result=getRESTInfoForIP(ip))
    return locals()
```
The first URL does not work, but the second does. It seems like the parameter ip only contains the first three octets. A simple workaround is to append another ""."" and it works (URL 3). 

Everything after the last ""."" (if there is any) is considered an extension and therefore does not work for an ip address (line 371+372):

**web2py/gluon/globals.py:**
```python
 364     def restful(self):
 365         def wrapper(action, request=self):
 366             def f(_action=action, *a, **b):
 367                 request.is_restful = True
 368                 env = request.env
 369                 is_json = env.content_type=='application/json'
 370                 method = env.request_method
 371                 if len(request.args) and '.' in request.args[-1]:
 372                     request.args[-1], _, request.extension = request.args[-1].rpartition('.')
 373                     current.response.headers['Content-Type'] = \
 374                         contenttype('.' + request.extension.lower())
 375                 rest_action = _action().get(method, None)
 376                 if not (rest_action and method == method.upper()
 377                         and callable(rest_action)):
 378                     raise HTTP(405, ""method not allowed"")
 379                 try:
 380                     res = rest_action(*request.args, **request.vars)
 381                     if is_json and not isinstance(res, str):
 382                         res = json(res)
 383                     return res
 384                 except TypeError, e:
 385                     exc_type, exc_value, exc_traceback = sys.exc_info()
 386                     if len(traceback.extract_tb(exc_traceback)) == 1:
 387                         raise HTTP(400, ""invalid arguments"")
 388                     else:
 389                         raise
 390             f.__doc__ = action.__doc__
 391             f.__name__ = action.__name__
 392             return f
 393         return wrapper
```

This may be a very special and I can live with my workaround. It is up to you, if you want to handle arguments with an ""."" that's not meant as a separator between filename and extension. A simple solution would be to check if there is more than one ""."", if it is just one, than it is probably an extension, if more than one, it might not be an extension.

best regards, 
Peter




"
1633,'Mongo' object has no attribute 'server_version_major',2017-05-18T02:25:44Z,,,AttributeError,"AttributeError: 'Mongo' object has no attribute 'server_version_major'","Once every few requests i will get bugged down with this. 

> 'Mongo' object has no attribute 'server_version_major'
> Traceback (most recent call last):
  File ""/home/www-data/web2py/gluon/restricted.py"", line 216, in restricted
    exec(ccode, environment)
  File ""/home/www-data/web2py/applications/verzimpel_mozi_dev/models/db.py"", line 67, in <module>
    is_admin = auth.has_membership('admin')
  File ""/home/www-data/web2py/gluon/authapi.py"", line 566, in has_membership
    group_id = self.id_group(group_id)  # interpret group_id as a role
  File ""/home/www-data/web2py/gluon/authapi.py"", line 446, in id_group
    rows = self.db(self.table_group().role == role).select()
  File ""/home/www-data/web2py/gluon/packages/dal/pydal/objects.py"", line 2041, in select
    return adapter.select(self.query, fields, attributes)
  File ""/home/www-data/web2py/gluon/packages/dal/pydal/adapters/mongo.py"", line 232, in select
    return self.__select(query, fields, **attributes)
  File ""/home/www-data/web2py/gluon/packages/dal/pydal/adapters/mongo.py"", line 344, in __select
    if self.server_version_major < 2.6:
AttributeError: 'Mongo' object has no attribute 'server_version_major'

(uwsing nginx, uwsgi, emperor, latest web2py from master )"
1632,Fixes #1628 missing signature list,2017-05-15T15:24:17Z,2017-06-05T22:36:49Z,,,,
1631,Left join changes behavior,2017-05-15T01:05:05Z,2017-05-15T10:55:11Z,,,,"When trying to make two left joins i noticed that the DAL returns two different rows for the same left join but one using a list.

`db(...).select(left=db.mytable.on(..))`

Returns a different selection that

`db(...).select(left=[db.mytable.on(..)])`

for a single left join."
1630,fix web debugger,2017-05-13T06:30:18Z,2017-06-05T16:41:25Z,,,,"Fix few issues with web debugger, thank @nicozanf for reporting and tests."
1629,The integrated web-based debugger is broken with current MASTER branch,2017-05-10T20:26:19Z,2017-06-05T16:41:27Z,,AttributeError,"AttributeError: Qdb instance has no attribute 'Frontend'","I've found that the integrated web-based debugger functionality (http://web2py.com/books/default/chapter/29/03/overview?search=debugger#Integrated-web-based-debugger) is broken with current MASTER branch - while it works fine with the current static source.

In particular, adding the lines:

```
from gluon.debug import dbg
dbg.set_trace()
```
 
to the standard Welcome app gives the following traceback (with Python 2.7 and 3.5, too)

<type 'exceptions.AttributeError'> Qdb instance has no attribute 'Frontend'

  File ""/home/nicoz/web2py-master.27/gluon/restricted.py"", line 216, in restricted
    exec(ccode, environment)
  File ""/home/nicoz/web2py-master.27/applications/admin/controllers/debug.py:interact"", line 238, in <module>
  File ""/home/nicoz/web2py-master.27/gluon/globals.py"", line 405, in <lambda>
    self._caller = lambda f: f()
  File ""/home/nicoz/web2py-master.27/applications/admin/controllers/debug.py:interact"", line 49, in interact
  File ""/home/nicoz/web2py-master.27/gluon/debug.py"", line 131, in run
    dbg.Frontend.run(self)
AttributeError: Qdb instance has no attribute 'Frontend'
In file: /home/nicoz/web2py-master.27/applications/admin/controllers/debug.py

I've wrote this to Mariano Reingart, and he told me that it looks like a naming collision, and to try to comment the following line (gluon/debug.py:190):

https://github.com/web2py/web2py/blob/master/gluon/debug.py#L190

For example:

# dbg = dbg_debugger

But this didn't work either, giving the traceback:

  File ""/home/nicoz/web2py-static.27/gluon/main.py"", line 447, in wsgibase
    gluon.debug.dbg.do_debug(mainpyfile=request.folder)
AttributeError: 'module' object has no attribute 'dbg'
"
1628,NameError: global name 'signature_list' is not defined,2017-05-10T18:34:54Z,2017-06-05T22:44:03Z,,NameError,"NameError: global name 'signature_list' is not defined","```python
Traceback (most recent call last):
  File ""/Users/abhishesh/Dropbox/WORK/web2py/gluon/restricted.py"", line 216, in restricted
    exec(ccode, environment)
  File ""/Users/abhishesh/Dropbox/WORK/web2py/applications/artemis/models/db.py"", line 231, in <module>
    auth.define_tables(username=False, signature=False, enable_tokens=True)
  File ""/Users/abhishesh/Dropbox/WORK/web2py/gluon/tools.py"", line 2238, in define_tables
    settings.table_token_name, []) + signature_list
NameError: global name 'signature_list' is not defined
```"
1627,It cost a long time to load page,2017-05-08T11:43:47Z,2017-06-20T17:20:39Z,,,,"I have about 4 client connect to the server, every client will upload data by @service.xmlrpc every 3 - 6 second. However it lead to long time to load webpage, even an empty page, it cost about 6-10 second to load it.
Seems it will execute models every time client upload dates. does it influence the cpu usage? I checked the CPU(top), python CPU usage is about 110%(quad-core)„ÄÇ"
1626,Issue/1472,2017-05-07T19:04:05Z,2017-06-05T16:40:38Z,,,,"Replaced by d3 force graph.
graphviz related code removed in this PR"
1625,Fix #1624 -- Unicode in XML sanitizing causes error,2017-05-07T11:34:35Z,2017-06-05T16:39:52Z,,,,Fix #1624 and add a unit test for it.
1624,Unicode in XML sanitizing causes error,2017-05-07T11:20:51Z,2017-06-05T16:39:52Z,,UnicodeEncodeError,"UnicodeEncodeError: 'ascii' codec can't encode character u'\xe8' in position 5: ordinal not in range(128)","If i pass a unicode string to the `XML` helper with `sanitize=True`, it throws an error:

```python
In [39]: XML(u'<div>√®</div>', sanitize=True)
---------------------------------------------------------------------------
UnicodeEncodeError                        Traceback (most recent call last)
----> 1 XML(u'<div>√®</div>', sanitize=True)

./web2py/gluon/html.pyc in __init__(self, text, sanitize, permitted_tags, allowed_attributes)
    607 
    608         if sanitize:
--> 609             text = sanitizer.sanitize(text, permitted_tags, allowed_attributes)
    610         if isinstance(text, unicode):
    611             text = text.encode('utf8', 'xmlcharrefreplace')

./web2py/gluon/sanitizer.pyc in sanitize(text, permitted_tags, allowed_attributes, escape)
    219         return str(text)
    220     return XssCleaner(permitted_tags=permitted_tags,
--> 221                       allowed_attributes=allowed_attributes).strip(text, escape)

./web2py/gluon/sanitizer.pyc in strip(self, rawstring, escape)
    164 
    165         if not isinstance(rawstring, str):
--> 166             return str(rawstring)
    167         for tag in self.requires_no_close:
    168             rawstring = rawstring.replace(""<%s/>"" % tag, ""<%s />"" % tag)

UnicodeEncodeError: 'ascii' codec can't encode character u'\xe8' in position 5: ordinal not in range(128)
```"
1623,fix TAG helper on PY3,2017-05-05T19:21:34Z,2017-06-05T16:39:15Z,,,,"PY3 fix on html.py, added tests"
1622,Enhancement/d3 graph,2017-05-03T19:19:44Z,2017-05-04T04:57:43Z,,,,Updated Pull Request to create Graph Models based on d3.js layouts
1621,Traceback problem with Python 3,2017-05-03T09:29:49Z,2017-06-20T17:26:22Z,,"`AttributeError, **Note**","`AttributeError: 'NoneType' object has no attribute 'strip'`, **Note**: the problem can be partly resolved by using different values of the limit parameter, like ","With the current master branch, there is a traceback compatibility problem with Python 3 - you always get 'no traceback because template parsing error' instead of the real traceback. 

The real traceback can be generated on the command line by changing https://github.com/web2py/web2py/blob/master/gluon/restricted.py#L139 ; removing the try/except and leaving only

 `self.traceback = traceback.format_exc()`

Here is attached an example of the output:
[full_traceback.txt](https://github.com/web2py/web2py/files/972896/full_traceback.txt)

In fact, you've many occurence of 

`AttributeError: 'NoneType' object has no attribute 'strip'`

Massimo wrote that ""It is caused by traceback.format_exc() which is not our function and we pass no value to it.""

**Note**: the problem can be partly resolved by using different values of the limit parameter, like 
 `self.traceback = traceback.format_exc(limit=1)`"
1620,"fix cron with py3, added initial tests, close #1618",2017-05-01T13:18:53Z,2017-05-04T04:57:12Z,,,,
1619,auth.settings.username_case_sensitive = False not usable on python 3,2017-04-30T22:18:08Z,2017-05-01T20:31:42Z,,,,The above setting results in an invalid email message ie fails validation so while you can register you can't then log back in again on python3 only.  
1618,Cron does not work in Git master,2017-04-28T19:00:22Z,2017-05-04T04:57:14Z,,,,"Attempt to enable  cron with -Y leads to following stack trace:

 python2.7 web2py.py -Y  -i 0.0.0.0
web2py Web Framework
Created by Massimo Di Pierro, Copyright 2007-2017
Version 2.14.6-stable+timestamp.2016.05.09.19.18.48
Database drivers available: sqlite3, imaplib, pyodbc, pymysql, pg8000
Traceback (most recent call last):
  File ""web2py.py"", line 33, in <module>
    gluon.widget.start(cron=True)
  File ""/home/alexiade/build/homely/web2py_git/gluon/widget.py"", line 1184, in start
    newcron.hardcron(options.folder).start()
  File ""/home/alexiade/build/homely/web2py_git/gluon/newcron.py"", line 85, in __init__
    crondance(self.path, 'hard', startup=True)
  File ""/home/alexiade/build/homely/web2py_git/gluon/newcron.py"", line 284, in crondance
    token = Token(cron_path)
  File ""/home/alexiade/build/homely/web2py_git/gluon/newcron.py"", line 119, in __init__
    fileutils.write_file(self.path, '', 'wb')

Removing gluon. prefix from the relevant import in newcron.py fixes it...
"
1617,fix open file in py3,2017-04-27T16:16:56Z,2017-04-28T13:12:54Z,,,,
1616,Fixes in generic layouts for python 3 compatibility,2017-04-27T14:41:20Z,2017-04-28T13:11:43Z,,,,"Python 3 dict.values() function behaviour has changed, replaced by a python 2.7 and 3.x compatible alternative."
1615,Is it possible to build a realtime chat application with web2py?,2017-04-27T13:46:19Z,2017-04-29T09:25:26Z,,,,"Is it possible to build a realtime chat application with web2py?

If so, can anybody point to some beginner friendly examples or tutorials please. "
1614,Next release??,2017-04-27T01:54:03Z,2017-06-20T17:26:31Z,,,,"Hello, first of all, thanks for this great framework!!! 
I would like to know if you are going to upload a new version. I need to upgrade to a stable version to get the fixes and improvements.

Thanks!!"
1613,Cannot connect to 2nd generation Google Cloud SQL instance,2017-04-26T15:34:32Z,,,,,"1st generation (now declared legacy) Google Cloud SQL instances do not require user / password to be specified to connect from an App Engine app to an SQL instance. That's why, i guess, the connection string, unlike most others, does not include user/password: ""google:sql://project:instance/database""

2nd generation instances do require user/password, and there's nowhere to set it in web2py, at least not in a documented way. Therefore connection to a 2nd generation SQL instance is not possible.


"
1612,Python 3 compatibility?,2017-04-25T08:44:33Z,2017-05-13T11:21:58Z,,,,Is web2py fully Python 3 compatible?
1611,select returns records from a table different of my select,2017-04-21T23:47:09Z,2017-06-20T19:13:57Z,,,,"Hi, I have this table:

`db.define_table('contrato',
                Field('empleado_id', 'reference empleado'),
                Field('empresa_id', 'reference empresa', label='Empresa', requires=IS_IN_DB(db(db.empresa.id.belongs(get_id_empresas_usuario_logueado())),
                                                                                            'empresa.id', '%(razon_social)s')),
                Field('tipo_contrato_id', 'reference tipo_contrato', label='Tipo de Contrato'),
                Field('estado', 'string', default='Activo', requires=IS_IN_SET(['Pendiente','Activo','Vencido','Terminado','Liquidado']) ),
                Field('fecha_inicio', 'date', required=True),
                Field('fecha_fin', 'date'),
                format=lambda registro: format_contrato(registro),
                common_filter=lambda query: db.contrato.empresa_id.belongs(get_id_empresas_usuario_logueado()))`

Inside a component I run this select:
`contratos = db(db.contrato.empleado_id == id_empleado).select(db.contrato.id,
                                                                      db.contrato.tipo_contrato_id,
                                                                      orderby=db.contrato.estado)`
When I inspect the 'contratos' variable value using the pycharm debugger I have noted that it returns a Row object for the 'auth_group' table and the 'role' column of that table.

Going further on my debugging I have noticed that in the adapters/base.py the table name changes from contratos to auth_group. I don't understand very well the code inside that file but it seems that there is a bug somewhere.

Can anyone help me with this? let it be reproducing the error, explaining the code or something? If this is a bug please fix it! Thanks!"
1610,handle reference fields for keyed tables,2017-04-20T17:24:08Z,2017-11-14T03:24:08Z,,,,added code to support reference fields to keyed tables and reference fields that don't have a format defined in the referenced table.
1609,py3: Error importing csv file (using appadmin and in code) ,2017-04-20T17:17:40Z,2017-04-28T13:12:55Z,,,,"When trying to import a csv file in appadmin, I get a flash message:
```
iterator should return strings, not bytes (did you open the file in text mode?)
```

I tried to import using code:
```
db.mytable.import_from_csv_file(open('db_mytable.csv', 'r'))
```

and got exactly the same message: 

```
<class '_csv.Error'> iterator should return strings, not bytes (did you open the file in text mode?)
```
I got it working in my code with 
```
db.mytable.import_from_csv_file(open('db_mytable.csv', 'r',encoding='utf-8'))
```
Looks for it works with python3, needs to be explicit declared the encoding. 

"
1608,Enhancement/d3 graph,2017-04-14T01:23:19Z,2017-05-02T20:16:17Z,,,,"Updated Welcome app to show model graphs with d3.
admin app's design.html view changed to check if d3_graph.js is in target app, otherwise uses existing graphviz code.

Graphviz code has not been altered and should still work for apps that haven't included the d3 code.
How does the welcome.w2p file get created ?  Should that be included in a Pull Request ?"
1607,appadmin can use ccache with cache.ram = cache.disk = cache.memcache,2017-04-12T23:38:03Z,2017-04-28T13:09:18Z,,,,ref : https://groups.google.com/forum/#!topic/web2py/ycOvyOBPCMQ
1606,Added on_succes and custom options for web2py ajax function,2017-04-10T16:45:18Z,2017-04-28T13:08:40Z,,,,"Added posibility to append an ""add"" hook and rewrite default jquery ajax options in the web2py ajax function.

Example:

    ajax{
        ""url"",
        ['name'],
        'target',
        {
            add: function(){
                console.log(""ok!!!"");
            },
            error: function(){
                console.log(""error!!!"");
            }
        }
    }"
1605,Error while view graph model - admin application,2017-04-08T19:38:50Z,2017-04-09T04:42:20Z,,,,"When I gone view the Graph model in admin application show that `pygraphviz` library is required.

Didn't would be better already include this library in dependencies's framework?

This missing break any feature that uses this library from admin app

## Details:

Version 2.14.6-stable+timestamp.2016.05.10.00.21.47

## Error:

```python
<type 'exceptions.AttributeError'> 'NoneType' object has no attribute 'AGraph'
```

Probably include the library solve this.


"
1604,"prevent is_empty from stripping whitespaces, close #1570",2017-04-06T18:50:31Z,2017-04-28T13:07:21Z,,,,updated few tests.
1603,fix IS_EMAIL for internationalized domain names,2017-04-06T18:30:14Z,2017-04-28T13:05:30Z,,,,Fix issue #1582 see https://docs.python.org/2/library/codecs.html#module-encodings.idna
1602,Create a CookieJar on __init__ instead of creating a new one each post,2017-04-03T18:54:51Z,2017-04-28T13:04:57Z,,,,Fixes #1505
1601,Make web2pyDialog Python 3 compatible,2017-03-31T11:06:05Z,2017-04-28T13:04:06Z,,,,"checks ""port web2pyDialog"" in #1353"
1600,how can fix the administrator issue. i fed the wrong administrator password and now it can't allow me to access the admin side,2017-03-31T04:21:54Z,2017-06-20T19:14:22Z,,,,
1599,Adapter not found for oracle,2017-03-30T16:48:27Z,2017-04-28T13:14:49Z,,SyntaxError,"SyntaxError: Adapter not found for oracle","We use web2py to build monitoring for processes running inside Oracle databases. However, we are experiencing an error when attempting to use the cx_Oracle driver in the current web2py master.

When starting the server, the following output is produced:
```
web2py Web Framework
Created by Massimo Di Pierro, Copyright 2007-2017
Version 2.14.6-stable+timestamp.2016.05.09.19.18.48
Database drivers available: psycopg2, cx_Oracle, pymysql, imaplib, sqlite3, pg8000, pyodbc

please visit:
	http://127.0.0.1/
use ""taskkill /f /pid 25440"" to shutdown the web2py server
```

However, when calling a controller that attempts to access an Oracle database, it produces a trouble ticket with the following error:

```
Traceback (most recent call last):
  File ""C:\Users\dfeeney\Sandbox\vcs\web2py\gluon\restricted.py"", line 216, in restricted
    exec(ccode, environment)
  File ""C:\Users\dfeeney\Sandbox\vcs\web2py\applications\jr\controllers/default.py:current_activity"", line 308, in <module>
  File ""C:\Users\dfeeney\Sandbox\vcs\web2py\gluon\globals.py"", line 405, in <lambda>
    self._caller = lambda f: f()
  File ""C:\Users\dfeeney\Sandbox\vcs\web2py\applications\jr\controllers/default.py:current_activity"", line 157, in current_activity
  File ""applications\jr\modules\runner.py"", line 214, in get_jrdb
    jrdb = DAL(uri, check_reserved=['oracle'], lazy_tables=lazy)
  File ""C:\Users\dfeeney\Sandbox\vcs\web2py\gluon\packages\dal\pydal\base.py"", line 170, in __call__
    obj = super(MetaDAL, cls).__call__(*args, **kwargs)
  File ""C:\Users\dfeeney\Sandbox\vcs\web2py\gluon\packages\dal\pydal\base.py"", line 454, in __init__
    adapter = adapters.get_for(self._dbname)
  File ""C:\Users\dfeeney\Sandbox\vcs\web2py\gluon\packages\dal\pydal\adapters\__init__.py"", line 20, in get_for
    'Adapter not found for %s' % uri
SyntaxError: Adapter not found for oracle
```
The last commit that connects to Oracle without error is c5bafa1"
1598,"URL having character | in fragment part, does not pass IS_URL validator",2017-03-29T14:31:51Z,2017-06-15T09:00:31Z,,,,"`IS_URL()` validator doesn't accepts following url and similar google group urls. 
Example: https://groups.google.com/forum/#!searchin/web2py/url$20validation$20problem|sort:relevance/web2py/69KmsrYAF44/Sgk_hA_6TlcJ

Character | should be allowed in fragment part of the url
"
1597,trouble with handling request.vars.checkbox list,2017-03-28T14:36:39Z,2017-06-20T19:16:44Z,,,,"Hi all,

This is my first question for the list; up to now i have been lurking and learning mainly. 
I think it is fair to say I am not an experienced python programmer so - this might just be my lack of knowledge. Forgive me please if my question shows just that.

I built a form that enables users to choose more than 1 row through a checkbox.
This form and the subsequent handling just works fine, as long as I choose more than 1 row.

If you want to take a look at  the piece of code from the view below  - the value for the box is the ID of the table-record:

---
         {{for lijst in lijsten:}}
            <tr>
                <td>{{=lijst.methode.titel}}</td>
                <td>{{=lijst.woordenlijst.titel}}</td>
                <td style=""width:100px"">{{=lijst.woordenlijst.taal_links}}</td>
                <td style=""width:100px"">{{=lijst.woordenlijst.taal_rechts}}</td>
                <td><input type=""checkbox"" name=""keuzelijst"" value=""{{=lijst.woordenlijst.id}}""/></td> !!!!! 
            </tr>
        {{pass}}
---

If I however choose just one row that has an ID say 38 --> then the following happens when dealing with the choices:

---
   if request.vars:
        for x in range(len(request.vars.keuzelijst)):
            db.lijst_ovh.insert(gebruiker=auth.user_id,wlijst=request.vars.keuzelijst[x],overhoring=currentOvh)
---
First of all: the length of request.vars.keuzelijst appears to be 2 ??
The ID (38) is being split into 2 separate values: first loop  3 and the next loop 8

So what am I doing wrong here?

I hope you can help me with this 

Regards

Frank Claessen"
1596,In scheduled tasks or background tasks request.folder is relative path only,2017-03-24T13:55:57Z,,,,,"When a module is called with parameters ""-K"" as scheduled task or ""-Q -M -S"" as a subtask request.folder returns a path relative to the execution folder. It is not an absolute path as stated in the book (http://web2py.com/books/default/chapter/29/04/the-core#request)."
1595,field.set_attributes(..) could return the instance,2017-03-21T10:57:30Z,2017-06-20T19:17:52Z,,,,"Would let the code be  more straightforward -- example, when passing the ""decorated"" field to the function...
Now I have to   ""scatter"" the code in two places for each field...

https://github.com/web2py/pydal/compare/master...dz0:patch-1"
1594,Improve french translation and close #1592,2017-03-15T05:09:10Z,2017-03-21T17:24:44Z,,,,
1593,Improve french translation and close #1592,2017-03-15T02:49:25Z,2017-03-15T05:06:43Z,,,,
1592,LOAD(ajax=True) is missing a translation,2017-03-14T23:49:37Z,2017-03-21T17:24:45Z,,,,"When I call `{{=LOAD('default','page.load', ajax=True)}}` in a view, it displays the text ""loading..."" while the component is being loaded. On my version of web2py (Version 2.14.6-stable+timestamp.2016.05.10.00.21.47, on OS X), the string 'loading...' is not translated into different languages, e.g. if I visit the page with a browser set to default to french."
1591,Some fixes on ldap_auth,2017-03-14T17:15:25Z,2017-03-21T17:24:06Z,,,,
1590,Small fixes to AuthJWT,2017-03-13T11:55:36Z,2017-03-13T13:53:24Z,,,,"- Generation of Timestamp in a separate function. Make sure that the timestamp is uniformly UTC seconds past 1970 epoch

- Return code from alter_payload callback is used.
"
1589,Small fixes to AuthJWT,2017-03-12T20:09:23Z,2017-03-13T09:16:36Z,,,,"
- The time stamp was being generated in a needlessly complicated fashion.  In addition, it was inconsistent in its use of UTC; which could have led to errors in non-utc locales. Simplified this.

- the internal api clearly allows for the altered payload to be returned from the alter_payload function, or the callable self.additional_payload member.
"
1588,Virtual Fields do not appear to work with Autocomplete widget,2017-03-09T17:18:56Z,2017-06-20T20:05:52Z,,,,"I've seen a few posts in the mailing list where people could not figure out how to get a Virtual Field to work in the Autocomplete widget. Most just say it isn't supported. One post noted that `db=db(db.table)` should be included into the Autocomplete widget. That certainly helps, but I see an error.

```
Set object has no attribute __getitem__
```

This is because `db(db.table)` is a Set object, and the following code won't work with a Set object:
https://github.com/web2py/web2py/blob/9978e63621d8f14e5d93ae5feb767b200a77e797/gluon/sqlhtml.py#L693-L697

Notice that the Autocomplete widget actively looks for `Field.Virtual`, so it seems like it is supported.

What I don't understand is line 697: `field.tablename`. Clearly, `field` is a `Virtual.Field` based on line 695, and the virtual field class seems to always have `tablename` set to `None` (at least in the most recent release R-2.14.6). Regardless of my `Set` error above, I'm not sure I understand why this chunk of code is written this way.

I must be missing something about virtual fields to make them work with Autocomplete, but I have not been able to find anything in the mailing list or Github issues. A dive into the code only raises more questions, like why bother with `field.tablename` if it is guaranteed to be `None`?"
1587,eclipse+pydev breakpoint not work with the latest cloned web2py.,2017-03-08T01:08:27Z,2017-06-21T09:15:35Z,,,,"My computer is win7 x64. I am using eclipse(4.6.2) ,pydev(5.5.0), python(2.7.13) and the web2py latest cloned from the github. Compared with the 2.14.6 stable version web2py, the latest cloned web2py has many additonal files which I guess may be used for compiling and debugging. However when I debug my application which based on the latest cloned web2py, the breakpoint I set in my controller/default/index  not stop. Only the breakpoint in the web2py.py can work. This is very confusing. So I change the web2py to the 2.14.6 stable version  and the breakpoint is ok.  What should I do with the latest cloned web2py to make the breakpoint work under the eclipse+pydev?"
1586,Added tests for py36,2017-03-07T19:03:00Z,2017-03-21T17:28:35Z,,,,minor change in test_router.py
1585,"CVE-2016-4806, CVE-2016-4807, CVE-2016-4808",2017-03-05T02:29:48Z,,,,,"Hello,

several security vulnerabilities were reported for web2py and they already got CVEs assigned. I could not find any information about them in your git repository. Are you aware of them and are there any fixes available?

https://security-tracker.debian.org/tracker/source-package/web2py
"
1584,Problem with installing web2py in mac,2017-03-03T02:54:32Z,,,,,"The web2py.app file in the extracted folder did not execute when I open it. I found out that I need to put it into a folder that is included in the path environment variable to make it executable. If so, you may want to put that in the install instruction or make edit to the app. "
1583,Mail.send may fail at converting None to unicode on GAE,2017-03-02T20:35:16Z,2017-06-20T19:24:45Z,,,,"See [lines 783 and similar in tools.py](https://github.com/web2py/web2py/blob/master/gluon/tools.py#L783) where text may be None (for an html only mail) and thus raise an exception:
```
TypeError('coercing to Unicode: need string or buffer, NoneType found',)
```"
1582,IS_EMAIL does not handle Internationalized Domain Names,2017-03-01T16:01:27Z,2017-04-28T13:05:32Z,,,,"[Internationalized domain names](https://en.wikipedia.org/wiki/Internationalized_domain_name) allows for unicode characters in domain names.

As thus IS_EMAIL default regex should be updated to allow for such domain, else it would for example prevent people with mail addresses on IDN to subscribe."
1581,Update SQLTABLE for API changes in PyDAL 17.01,2017-03-01T15:11:48Z,2017-03-21T17:06:00Z,,,,This pull request updates `SQLTABLE` to work with the new unquoted colname format used in the `Rows` class since PyDAL version 17.01. The colname format change also fixes a discrepancy between Web2py documentation and implementation.
1580,Manual image upload,2017-02-27T07:49:48Z,2017-02-27T10:10:24Z,,,,"Hi All,

This is support question. I don't have access to gmail so here I am asking.

I am taking a image in mobile app and need to upload a image from mobile to web2py web interface using API. How can I do that ?

Thanks,
Jigar

"
1579,test_expose_base_inside_dir2_state fails on OSX pointing to tools.Expose() failing in similar cases,2017-02-26T23:26:58Z,2017-06-20T19:30:02Z,,AssertionError,"AssertionError: Lists differ: [] != ['link_to_dir1']","checked in trunk: commit16f60d5 (30 jan 2017)

## Problem
The test below checks the class Expose in gluon/tools by creating a folder structure in  /var/folders, but it fails in macos. I think I know why but I'm not sure about the fix.

## What's happening
As a security measure issue (#1261) the files found in the exposed folder passed to Expose() are checked by calling isprivate() (and by calling issymlink() to prevent linking to 'outside' the folder)

**from class Expose in gluon.tools.py**
>6274 self.base = self.normalize_path(
>6275                     base or os.path.join(current.request.folder, 'static'))
>...
>6277: self.base = base = os.path.realpath(base or os.path.join(current.request.folder, 'static'))
>...
>6296: allowed = [f for f in sorted(glob.glob(path))
>6297:                   if not any([self.isprivate(f), self.issymlink_out(f)])]
>... 
>6355: def isprivate(f):
>6355        return 'private' in f or f.startswith('.') or f.endswith('~')

The filenames are based on the parameter 'base' which are first conditionaly converted by self.normalize_path() and then again unconditionaly (why two times?) by os.path.realpath(). os.path.realpath() follows the symlinks this results at least on OS X El Capitan in a problem. 

*/var/folders* is really */private/var/folders* . This causes isprivate() to return True allways and as a consequence *self.folders* isn't updated and neither is *self.filenames* in line 6298-6301. This causes the test below to fail and of course Expose() to fail when it is pointing to /var or other folders in /private, again possibly limited to OS X. 

Note that in stable 2.14 realpath() is not used. It was added in trunk for good security reasons in https://github.com/web2py/web2py/pull/1357 

## Possible fix:
Change class  Expose() to allow starting with '/private' in function isprivate() or better remove '/private' from the filename if present before the test? 

Little hacky maybe and not in line with the current documentation which promises hiding on the occurrence of the string *private* see http://www.web2py.com/books/default/chapter/29/14/other-recipes?search=Publishing%20a%20folder
Better ideas?


======================================================================
FAIL: test_expose_base_inside_dir2_state (gluon.tests.test_tools.TestExpose)
----------------------------------------------------------------------
Traceback (most recent call last):
  File ""gluon/tests/test_tools.py"", line 1372, in test_expose_base_inside_dir2_state
    self.assertEqual(expose.folders, ['link_to_dir1'])
AssertionError: Lists differ: [] != ['link_to_dir1']

Second list contains 1 additional elements.
First extra element 0:
'link_to_dir1'

- []
+ ['link_to_dir1']"
1578,minor cleanup removed unused class 'navbar-ex1-collapse' see https://‚Ä¶,2017-02-26T13:01:34Z,2017-03-21T17:22:48Z,,,,"layout.html had an unused class picked up from an (now) old example on bootstrap site. See https://github.com/twbs/bootstrap/issues/10948.
Nothing serious, wasn't referenced anywhere. Just fluff."
1577,SQLFORM.widgets.options.widget in case of [IS_EMPTY(..)],2017-02-26T08:51:44Z,,,,,"I have the following field definition:

Field('seniority', length=64, default='', requires=[IS_EMPTY_OR(IS_IN_DB(db_st, 'st_seniority.name', '%(name)s', orderby=db_st.st_seniority.id, zero='Select a value'))], widget=SQLFORM.widgets.options.widget, label='Seniority'),

When the form containing this field contains an error the options widget is rendered without the form-control selector in the class i.e. class=""generic-widget"" instead of class=""generic-widget form-control""

When I remove [IS_EMPTY(..)] and widget=... the field is rendered correctly."
1576,problem with json fields,2017-02-23T10:09:44Z,,,RuntimeError,"RuntimeError: json data not a string","I noticed some problems passing from pydal **v16.03** to a newer version using json field and postgresql adapter.
Defining a table with a json field and exploring the data using the admin interface this exception is raised:

```
Traceback (most recent call last):
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/restricted.py"",
line 227, in restricted
    exec ccode in environment
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/applications/ValisBuggerTracker/controllers/appadmin.py"",
line 703, in <module>
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/globals.py"",
line 417, in <lambda>
    self._caller = lambda f: f()
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/applications/ValisBuggerTracker/controllers/appadmin.py"",
line 325, in update
    2)).select().first()
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/objects.py"",
line 2045, in select
    return adapter.select(self.query, fields, attributes)
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/adapters/base.py"",
line 746, in select
    return self._select_aux(sql, fields, attributes, colnames)
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/adapters/base.py"",
line 727, in _select_aux
    return processor(rows, fields, colnames, cacheable=cacheable)
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/adapters/base.py"",
line 305, in parse
    for row in rows
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/adapters/base.py"",
line 229, in _parse
    value = self.parse_value(value, fit, ft, blob_decode)
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/adapters/base.py"",
line 196, in parse_value
    return self.parser.parse(value, field_itype, field_type)
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/parsers/__init__.py"",
line 101, in parse
    return self.registered[field_itype](value, field_type)
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/parsers/__init__.py"",
line 76, in __call__
    return self.call(value, field_type)
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/parsers/__init__.py"",
line 73, in _call
    return self.f(self.parser, value)
  File
""/home/manuele/development/web/web2py/web2py_R-2.14.6/gluon/packages/dal/pydal/parsers/base.py"",
line 129, in _json
    raise RuntimeError('json data not a string')
RuntimeError: json data not a string
```

The strange thing is that reloading the webserver I can reload the page with no errors but an exception is raised exploring a single record... again if I reload the framework I can see the single record data but going back to the tabular view the previous exception is raised.

The same table downgrading the pydal to v16.03 give absolutely no problem.

Cheers
    Manuele"
1575,fix download file error with chinesefilename,2017-02-23T05:20:52Z,2017-03-01T06:19:20Z,,UnicodeEncodeError,"UnicodeEncodeError: 'ascii' codec can't encode characters in position 25-30: ordinal not in range(128)","when using `response.download(request, db)` to download a file name was chinese . (just like ""hisÁ≥ªÁªüÁî®Êà∑Á°ÆËÆ§.txt"") ,
 i got server error.  
```
ERROR:Rocket.Errors.Thread-6:Traceback (most recent call last):

  File ""/root/web2py/gluon/rocket.py"", line 1320, in run
    self.run_app(conn)

  File ""/root/web2py/gluon/rocket.py"", line 1821, in run_app
    output = self.app(environ, self.start_response)

  File ""/root/web2py/gluon/main.py"", line 651, in app_with_logging
    ret[0] = wsgiapp(environ, responder2)

  File ""/root/web2py/gluon/main.py"", line 565, in wsgibase
    return http_response.to(responder, env=env)

  File ""/root/web2py/gluon/http.py"", line 120, in to
    rheaders.append((k, str(v)))

UnicodeEncodeError: 'ascii' codec can't encode characters in position 25-30: ordinal not in range(128)
```
when i debug  `http.py `. 
 i find the error cause by `headers['Content-Disposition']`  ,
when i download the  file name by chinese , the content of `headers['Content-Disposition']` will be `unicode` .
```
for k, v in iteritems(headers):
    if isinstance(v, list):
        rheaders += [(k, str(item)) for item in v]
    elif not v is None:
        rheaders.append((k, str(v)))
```
ops , str() a unicode string will error.
so i encode the filename into utf-8 in file `ingluon/globals.py` before using it .
```
         if attachment:
+            download_filename =download_filename.encode(""utf-8"")
             headers['Content-Disposition'] = \
                 'attachment; filename=""%s""' % download_filename.replace('""', '\""')
```
and it works. "
1574,Scheduler menu empty in admin widget,2017-02-16T13:02:41Z,,,,,"Using the stable downloadable source version. The ""Scheduler"" menu remains empty even if app includes scheduler.py in models. The only way that works is to start scheduler with -K myapp independently. The combined -K myapp -X also does not seem to work. (MacOSX 10.10.5)

![image](https://cloud.githubusercontent.com/assets/23602/23022330/87283764-f450-11e6-8d02-f3fd73e34b5e.png)
"
1573,auth.has_membership('groupname') error in menu.py GAE,2017-02-14T23:18:47Z,2017-06-27T21:34:23Z,"bug, Priority-Critical",InternalError,"InternalError: internal error.`","This error started today in a year working application.

`Unable to store in FILE: /base/data/home/apps/e~xxxxxxxxx/0.39/applications/xxxxxxxx/models/menu.py

Traceback (most recent call last):
  File ""/base/data/home/apps/e~xxxxxxxxxxxx/0.39/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/base/data/home/apps/e~c/0.399/applications/xxxxxxx/models/menu.py"", line 3, in <module>
    elif auth.has_membership('operaciones'):
  File ""/base/data/home/apps/e~xxxxxxxxxx/0.39/gluon/tools.py"", line 4360, in has_membership
    group_id = self.id_group(group_id)  # interpret group_id as a role
  File ""/base/data/home/apps/e~xxxxxxxx/0.39918/gluon/tools.py"", line 4331, in id_group
    rows = self.db(self.table_group().role == role).select()
  File ""/base/data/home/apps/e~xxxxxxxxxxx/0.399180762665654903/gluon/packages/dal/pydal/objects.py"", line 2020, in select
    return adapter.select(self.query, fields, attributes)
  File ""/base/data/home/apps/e~xxxxxxx/0.399180762665654903/gluon/packages/dal/pydal/adapters/google_adapters.py"", line 504, in select
    for t in fields] for item in items]
  File ""/base/data/home/runtimes/python27_experiment/python27_lib/versions/1/google/appengine/ext/ndb/query.py"", line 1810, in next
    self._more_results) = self._fut.get_result()
  File ""/base/data/home/runtimes/python27_experiment/python27_lib/versions/1/google/appengine/ext/ndb/tasklets.py"", line 383, in get_result
    self.check_success()
  File ""/base/data/home/runtimes/python27_experiment/python27_lib/versions/1/google/appengine/ext/ndb/context.py"", line 890, in helper
    batch, i, ent = yield inq.getq()
  File ""/base/data/home/runtimes/python27_experiment/python27_lib/versions/1/google/appengine/ext/ndb/query.py"", line 969, in run_to_queue
    batch = yield rpc
  File ""/base/data/home/runtimes/python27_experiment/python27_lib/versions/1/google/appengine/ext/ndb/tasklets.py"", line 513, in _on_rpc_completion
    result = rpc.get_result()
  File ""/base/data/home/runtimes/python27_experiment/python27_lib/versions/1/google/appengine/api/apiproxy_stub_map.py"", line 613, in get_result
    return self.__get_result_hook(self)
  File ""/base/data/home/runtimes/python27_experiment/python27_lib/versions/1/google/appengine/datastore/datastore_query.py"", line 2906, in __query_result_hook
    self._batch_shared.conn.check_rpc_success(rpc)
  File ""/base/data/home/runtimes/python27_experiment/python27_lib/versions/1/google/appengine/datastore/datastore_rpc.py"", line 1371, in check_rpc_success
    raise _ToDatastoreError(err)
InternalError: internal error.`

The error raises width any auth.has_membership in menu.py. 
Deployed in Google Appengine"
1572,Windows Cron error when enabling,2017-02-14T14:51:53Z,2017-06-20T19:36:10Z,,AttributeError,AttributeError: 'thread._local' object has no attribute '_scheduler',"When enabling Cron on windows from CMD with:
web2py.exe -K AppName

The following error is displayed

C:\Windows\System32>web2py.exe -K TrackingApp
web2py Web Framework
Created by Massimo Di Pierro, Copyright 2007-2017
Version 2.14.6-stable+timestamp.2016.05.10.00.21.47
Database drivers available: psycopg2, pymysql, imaplib, MySQLdb, sqlite3, pyodbc
starting single-scheduler for ""AppName""...
Traceback (most recent call last):
  File ""C:\Program Files\web2py\gluon\shell.py"", line 273, in run
    exec(python_code, _env)
  File ""<string>"", line 1, in <module>
AttributeError: 'thread._local' object has no attribute '_scheduler'"
1571,Information disclosure vulnerability in AutocompleteWidget,2017-02-12T11:22:55Z,2017-07-18T08:44:20Z,,,,"Executing `AutocompleteWidget.callback()` from `AutocompleteWidget` constructor is a bad idea. When you instantiate the factory class in a model file, the callback will become exposed from every page in your application. The callback should be executed from `AutocompleteWidget.__call__()` so that it'll be subject to the same access control restrictions as its parent form."
1570,IS_NOT_EMPTY and IS_EMPTY_OR should not strip whitespace,2017-02-10T20:17:25Z,2017-04-28T13:07:23Z,,,,"When checking values for being empty, the IS_NOT_EMPTY and IS_EMTPY_OR validators first strip whitespace to ensure the value isn't just whitespace. The problem is that these validators then return the stripped version of the value instead of the original value. This means that values that are not just whitespace but include some whitespace will be transformed before being inserted in the database. For example, "" hello "" will be transformed to ""hello"". This behavior is unexpected, as the purpose of these validators is not to remove whitespace from otherwise non-empty strings.

It may be appropriate to strip whitespace in order to determine whether a string should be considered empty (and we probably have to continue that to maintain backward compatibility), but I think returned the stripped value instead of the original value should be considered a bug. If the developer wants to strip whitespace from submitted values, that should be handled explicitly via another validator or some other method.

See https://groups.google.com/forum/#!topic/web2py/_SfUxePTaN0."
1569,error in SQLFORM.grid with table auth_membership ,2017-02-09T15:36:58Z,,,,,"Error snapshot : <type 'exceptions.TypeError'>(reduce() of empty sequence with no initial value)
The table auth_membership has some data correctly inserted."
1568,Remove ! from tag,2017-02-07T18:49:17Z,2017-03-21T17:22:16Z,,,,
1567,Removed ! from tag,2017-02-07T18:47:36Z,2017-03-21T17:21:13Z,,,,
1566,"Add FlexibleService, which allows @service-style methods with varargs",2017-01-28T22:12:29Z,2017-03-21T17:18:10Z,,,,"This addresses #1561 .

I don't know what your testing procedure is for things like this.  I see that the current test_tools.py just has TestService as ""todo"" so this would be in line with that.  I've done some simple tests by creating a sample app and calling the service endpoints and it works.  In any case, this change only adds a new class, so it shouldn't affect any existing behavior.

The PR defines a new FlexibleService class that inherits from the existing Service.  It overrides that various `serve_whatever` methods so that instead of using `universal_caller`, they use a method `call_service_function` provided by FlexibleService.  The default implementation of this method just directly calls the function, passing whatever arguments were given to the ""call"" controller function.  This means the service function can accept `*args` and/or `**kwargs`.  This also means that if the service function doesn't accept the passed arguments, an exception will be raised, rather than returning an ""Object does not exist"" 404 as Service currently does.  Using a method for `call_service_function` instead of a module-level function means that it's possible to write new classes that inherit from FlexibleService and add more sophisticated argument checking if they want to.

The new FlexibleService class also addresses bug #1560 by fixing the errors in the CSV and XML methods so that they store and find the procedures in the right place.  This does not, however, fix the bug in Service itself that stores these procedures in the wrong place."
1565,Update compileapp.py,2017-01-25T20:14:39Z,2017-01-30T18:48:38Z,,,,"Issue #1552
The  ""current"" may have been altered by the controller.  This is the case for admin/controllers/shell.py, in callback(), where a new shell environment is created (from gluon/shell)
If this happens, the incorrect ""response"" is being referenced and the output of the controller is lost."
1564,Adding extra form elements does not pass value in SQLFORM.grid,2017-01-25T19:40:30Z,2017-06-27T21:37:57Z,enhancement,,,"I am using web2py 2.14.6.

The following instruction works great for SQLFORM:
http://web2py.com/books/default/chapter/29/07/forms-and-validators#Adding-extra-form-elements-to-SQLFORM

...and partially for SQLFORM.grid (you can **add** additional fields) but the value from the extra element is not passed in the form:

> After submission, `form.vars.agree` will contain the status of the checkbox, which could then be used in an onvalidation function, for instance.

**for SQLFORM.grid `form.vars.agree `does not exist in the onvalidation/oncreate/onupdate.**"
1563,"'not authorized' issue when deleting entry with "";"" in value",2017-01-25T19:34:13Z,,"enhancement, Priority-Medium",,,"I'm running web2py 2.14.6. The table is created externally and does not have ""id"" field:
```
db.define_table('somename',
                           Field('commit_id', 'string'),
                           primarykey=['commit_id'],
                           migrate=False,
                           )
```
If you create a SQLFORM.grid and add a ""commit_id"" with "";"" as value everything works fine and the entry is added to the db as well as properly displayed by SQLFORM.grid. 
**If you try to remove it (clicking on ""delete"" button in the SQLFORM.grid) it shows ""not authorized"" popup (sometimes no popup at all(?)).**

Doing the same with multiple other ""commit_id""s (WITHOUT semicolon "";"" as value) works fine. It seems that input data validation might be the issue."
1562,don't write to /dev/urandom on Windows platforms,2017-01-22T20:16:01Z,2017-01-30T18:47:51Z,,,,"Fixes a bug on Windows which only shows up when the following requirement is met: There is a folder named ""dev"" which is a base folder on the same drive where web2py is. In this special case a file named ""urandom"" is written into the ""dev"" folder. Clearly this was never meant to happen, as it doesn't serve the intended purpose."
1561,"Provide a way to write ""service"" functions that accept *args/**kwargs",2017-01-21T04:31:54Z,2017-05-11T06:24:52Z,,,,"Currently, if you write a ""service"" function using the decorators like `@service.json`, etc., it can't usefull accept varargs.  This is because the `universal_caller` function in gluon.tools only passes arguments that explicitly correspond to named arguments in the service function's signature.  (This in turn is likely because `universal_caller` is working based on things like `co_argcount`, which doesn't provide a way to see whether a function accepts varargs.)  See mailing list discussion [here](https://groups.google.com/forum/#!topic/web2py/Xlrobpwv5Aw).

It would be nice to be able to write a service function that accepts arbitrary `*args` and/or `**kwargs`, passed as part of the URL path or as URL parameters, respectively.

Since `universal_caller` is a standalone function, this would probably require creating a new analogue of the Service class that rewrites the various `serve_*` methods to use a different function instead.  (Modifying `Service` directly could change the behavior of existing code.)  The simplest alternative is just:

```
def new_universal_caller(f, *a, **b):
    f(*a, **b)
```

This is basically what `request.restful` does.

If we do want to maintain the convention of passing only accepted arguments, we could use something like this:

```
def new_universal_caller(f, *a, **b):  
    argspec = inspect.getargspec(f)

    requiredArgs = argspec.args if argspec.defaults is None else argspec.args[0:-len(argspec.defaults)] 

    # if it accepts *args, we pass all positional arguments, otherwise only the number it accepts
    args = a if argspec.varargs is not None else a[:len(argspec.args)]
    
    # if it accepts **kwargs, we pass all keyword arguments, otherwise only those it accepts
    kwargs = b if argspec.keywords is not None else {argName: b[argName] for argName in argspec.args if argName in b}
       
    # it's an error to pass an argument both positionally and by keyword
    if any(argName in argspec.args[:len(args)] for argName in kwargs):
        raise HTTP(404, ""Argument passed positionally and by keyword"")
    # if we didn't get enough positional arguments, any missing ones must have been passed by keyword
    if any(argName not in kwargs for argName in requiredArgs[len(args):]):
        raise HTTP(404, ""Not enough arguments passed"")
    # otherwise, ok
    else:
        return f(*args, **kwargs)
```

`inspect.getargspec` provides a way to tell if the function accepts varargs or not.

One question is: is there a reason that the existing `Service` class doesn't just pass all arguments to the service function?  Or would it be better to just pass them all, as `request.restful` does, and accept that an exception will be raised if the arguments aren't right?"
1560,Some Service types lumped together incorrectly,2017-01-18T23:05:24Z,2017-05-11T06:24:45Z,,,,"In gluon.tools, the Service class defines a number of attributes run_procedures, json_procedures, etc., for storing different types of service functions.  However, some of the decorator methods store the decorated functions in an incorrect place.  For instance:

```
    def csv(self, f):
        """"""
        Example:
            Use as::

                service = Service()
                @service.csv
                def myfunction(a, b):
                    return a + b
                def call():
                    return service()

            Then call it with::

                wget http://..../app/default/call/csv/myfunction?a=3&b=4

        """"""
        self.run_procedures[f.__name__] = f
        return f
```

You can see at the end it is putting it in `run_procedures`, but this is the `csv` decorator, so it should be putting it in `csv_procedures`.  The `xml` decorator likewise stores the function it gets under `run_procedures` rather than `xml_procedures`.  In fact, the `csv_procedures` and `xml_procedures` attributes are never used at all.

More worrisome, both `serve_csv` and `serve_xml` actually look in `run_procedures` rather than `csv_procedures` or `xml_procedures` to see if the passed service is valid.  This means that if you define a function with `@service.csv`, you will be able to access it with a URL like `.../call/run/my_function`, and vice versa.  Effectively there is no distinction between ""run"", CSV, and xml services.  This can potentially lead to strange errors; you can for instance define a `@service.run` function that doesn't return data in a CSV format, which will cause an error if you try to access it via `../call/csv` since the handler is unable to parse it as CSV.

Looking at git blame, it appears the error has been present for several years (maybe since Service was added?), but apparently hasn't been noticed."
1559,"feature request: filter by aggregates  in  dataset  ""generators"" like  IS_IN_DB, SQLFORM.grid  ",2017-01-16T10:12:16Z,,,,,"I run into situations, when I'd like to have ""having"" parameter in  functions, generating  data sets ( IS_IN_DB, SQLFORM.grid  )...

would it be hard to implement?"
1558,Fix router functions check,2017-01-13T21:11:17Z,2017-01-19T15:23:17Z,,,,"Consider the following router:

    routers=dict(
        BASE=dict(
            default_controller='default',
            default_function='index',
                functions=['index', 'func1', 'comp1']
        )
    )

Now include the following component in a view:

    {{=LOAD('default', 'comp1.load', ajax=True)}}

This component will make an Ajax request to `/comp1.load`. The router must then determine whether `""comp1.load""` is a URL arg for the `/default/index` function, or whether it is actually a function itself (to be routed to `/default/comp.load`). To make this determination, it simply checks whether `""comp.load""` is in the `router['BASE']['functions']` list. This check fails, so the request gets routed to `/default/index/comp.load` rather than the correct `/default/comp.load`.

Currently, the `functions` list in the router only works properly if it includes all permutations of functions and extensions that the app will use. In the above example, it would have to be:

                functions=['index', 'func1', 'comp1.load']

This pull request strips the extension before checking the functions list, so a request to ""comp.load"" would correctly match ""comp"" in the functions list.

Perhaps there is some rationale for the current behavior, but in that case, the rewrite code that maps outgoing URLs must be changed. Given the above example, `URL('default', 'comp1.load')` would generate `/comp1.load`, which will then be routed to `/default/index/comp1.load`. It should instead generate `/default/comp1.load` -- otherwise, there is no way to generate a URL for the `/default/comp1.load` route."
1557,Improvement on alternate login methods (CAS and SAML),2017-01-09T10:51:25Z,,,,,"These changes I have been testing and working correctly in my computer. If you approve I can merge the changes.

When web2py SAML SP os CAS client is configured as alternate login the system auto create the users once he is logged into the SAML IDP or CAS server. I suggest to have a extra value to customize if you want to have auto create users or if you want them to be created manually into your SAML SP or CAS client. It will be easy with a new variable: auth.settings.cas_create_user

```
def get_or_create_user(self, keys, update_fields=['email'],
                           login=True, get=True):
....

     elif checks:
            **if self.settings.cas_create_user is False:
                   raise HTTP(403, ""Forbidden. User need to be created first."")**

            if 'first_name' not in keys and 'first_name' in table_user.fields:
....

```

Another improvement is to have a custom change password url for external methods. For example, when the user configure the CAS client or SAML SP and click in change password could be great if the link redirects to the server. For example, to have the next code (option) into saml_auth.py and cas_auth.py:

```
def change_password_url(self, next=""/""):
        self._SAML_change_password()
        return next

def change_password_url(self, next=""/""):
        self._CAS_change_password()
        return next
```

Please let me know if you want me to update tools.py and saml_auth.py and cas_auth.py files."
1556,Enable file uploads via Ajax components,2017-01-06T22:23:07Z,2017-07-16T15:26:31Z,,,,"web2py.js currently uses jQuery `.serialize()` when submitting forms via Ajax, which does not allow files to be uploaded. We should instead consider using the [`FormData` API](https://developer.mozilla.org/en-US/docs/Web/API/FormData), as outlined [here](http://blog.teamtreehouse.com/uploading-files-ajax), which would allow file uploads."
1555,ccache page fix for disk cache statistics value,2017-01-05T02:13:44Z,2017-01-19T15:23:03Z,,,,value of the web2py_cache_statistics disk cache key was left over from ram cache iteration
1554,"Field.Virtual (and Field.Method) could have ""needed_fields"" as attribute",2017-01-03T06:44:32Z,,,,,"Now, one needs to define separately, what needs to be selected for Virtual or Method, 

but if I define it inside object would be easier to manage big selections (o grid could be even smarter, and include needed fields in select:

instead:
```py  
Field.Virtual('total_price', lambda row: row.item.unit_price * row.item.quantity)
```

```py
Field.Virtual('total_price', lambda row: row.item.unit_price * row.item.quantity, 
                    needed_fields = [db.item.unit_price, db.item.quantity] ) 
```

ps.: ```needed_fields``` could be also from other tables  ( in this case joins would be to manage by programmer -- though in far future could be automatically derived from db schema :) ) "
1553,Possibility to add Expression to  grid?,2017-01-03T06:37:00Z,,,,,"Hi, 
 now one can [add  virtual fiels (book example)](http://web2py.com/books/default/chapter/29/06/the-database-abstraction-layer?#New-style-virtual-fields), but they are calculated in Python layer, though  this could also be done in DB layer.

I would like to pass Expressions in similar way:

instead of 
```py
db.item.total_price =  Field.Virtual('total_price', lambda row: row.item.unit_price * row.item.quantity)
```

Would be nice to have
```py
db.item.total_price =  Field.Expression('total_price', db.item.unit_price * db.item.quantity)
```



ps.:
- this could also be applied to aggregates (as I suspect they are not supported in grid)
- ten the search filters  would need to be dispatched to WHERE or HAVING clauses


ps.: forum link https://groups.google.com/forum/#!topic/web2py/q02x5qQIjcY"
1552,web-based shell not working,2017-01-01T14:52:21Z,2017-04-15T10:05:14Z,,,,"admin/controllers/shell.py isn't working.  All output is returned as ""None"".
After much digging, I traced the problem to this line in compileapp.py/run_controller_in():
`response = current.response`
The problem is that the shell controller creates its own environment to run the command in, modifying current.response.
Changing this line to:
`response = environment[""response""]`
Fixes the problem.  This is also arguably more clear since ""environment[""response""]._vars is undoubtably the intended target of the controller, a tls global is not required to access it.

A separate is arguably that env() (as called from shell.py/callback()) creates a new environment, ""current"" is clobbered, and not restored after calling gluon.contrib.shell.run()


"
1551,web2py_osx error on macOS Sierra (OS X 10.12),2016-12-31T14:43:17Z,,"bug, Priority-Critical",,,"I'm on macOS 10.12.1

I downloaded the web2py app from http://www.web2py.com/examples/static/web2py_osx.zip

When I try to run it, I get this web2py error dialog: http://take.ms/IIXG5

Here are the details from the console: http://take.ms/tTTgG

""Detected missing constraints for <private>.  It cannot be placed because there are not enough constraints to fully define the size and origin. Add the missing constraints, or set translatesAutoresizingMaskIntoConstraints=YES and constraints will be generated for you. If this view is laid out manually on macOS 10.12 and later, you may choose to not call [super layout] from your override. Set a breakpoint on DETECTED_MISSING_CONSTRAINTS to debug. This error will only be logged once.""
"
1550,fix css validation error,2016-12-26T11:21:54Z,2017-01-19T15:22:39Z,,,,
1549,typo fix,2016-12-21T19:17:34Z,2016-12-24T03:57:57Z,,,,
1548,Include Auth and Crud messages in language file updates,2016-12-20T18:25:07Z,2016-12-20T21:42:38Z,,,,"This little change will probably fix a major headache for anybody who's using the standard `Auth` interface for non-English websites. When you click the ""Update all languages"" button in the Web2py app editor, default messages from `Auth` and `Crud` classes will be dumped into language files as well."
1547,multiple strikeouts in markmin are not rendered correctly,2016-12-16T07:34:13Z,2017-06-20T19:48:09Z,,,,"## description of the behaviour

When trying to render as html
``~~strikeout~~ and ~~another strikeout~~``
the result is:
``<p><del>strikeout~~ and ~~strikeout</del></p>``
the correct result should be:
``<p><del>strikeout</del> and <del>strikeout</del></p>``

code:
```python
>>> from gluon.contrib import markmin
>>> markmin.markmin2html.render(""~~strikeout~~ and ~~strikeout~~"")
'<p><del>strikeout~~ and ~~strikeout</del></p>'
```
## web2py version

(as stated in the file ``web2py/VERSION``)
Version 2.14.6-stable+timestamp.2016.05.10.00.21.47


## reason for incorrect rendering
incorrect regular expression in ``web2py/gluon/contrib/markmin/markmin2hmtl.py``, line 550

## fix:
replacing ``regex_del = re.compile(r'~~(?P<t>[^\s*]+( +[^\s*]+)*)~~')``
by ``regex_del = re.compile(r'~~(?P<t>[^\s~]+( +[^\s~]+)*)~~')``

"
1546,Fix for #1443 - PR will enable emperor.uwsgi.service on boot,2016-12-09T16:25:43Z,2016-12-20T21:42:10Z,,,,"Currently emperor.uwsgi.service is not started on boot, see https://github.com/web2py/web2py/issues/1443
"
1545,setup-web2py-nginx-uwsgi-ubuntu.sh doesn't enable systemd record for uwsgi,2016-12-09T15:57:55Z,2016-12-09T16:04:42Z,,,,"setup-web2py-nginx-uwsgi-ubuntu.sh is intended to setup a complete ubuntu/nginx/uwsgi stack.

Previous versions of this script worked perfectly with an upstart record for the uwsgi emperor created and enabled on boot.

Current master version creates a systemd record for uwsgi emperor, **but doesn't enabled it.**
Upon next boot user will see a BAD GATEWAY error, as the uwsgi service isn't running

What's missing here is a call to

**systemctl enable emperor.uwsgi.service**

which would restore previous behaviour.

Version: script from github web2py master
OS: Ubuntu 16.04"
1544,response.layout,2016-12-09T15:30:43Z,2016-12-12T12:59:56Z,,,,"What about this?
Together with setting (inside model, controller)
 response.layout=""layout_stupid.html""
 response.layout=""layout_w3.html""

it could help to switch standard/mobile, standard/experimental, ... designs.

Good or bad idea?"
1543,Too many conflicts when generating session IDs,2016-12-08T19:34:00Z,,,RuntimeError,"RuntimeError: Too many ID conflicts","I've got this error happening on my app (complete filesystem redacted, but it shouldn't be relevant):

```
Traceback (most recent call last): (.../gluon/restricted.py:174)
  File "".../gluon/main.py"", line 464, in wsgibase
    session._try_store_in_db(request, response)
  File "".../gluon/globals.py"", line 1183, in _try_store_in_db
    record_id = table.insert(**dd)
  File "".../gluon/contrib/memdb.py"", line 264, in insert
    raise RuntimeError(""Too many ID conflicts"")
RuntimeError: Too many ID conflicts
```

It's running on Google App Engine, with web2py Version 2.14.6-stable+timestamp.2016.05.10.00.21.47.

There were about 14k items on memcache with less than an 8% hit ratio. I'm not very familiar with this part of web2py/appengine but I'm assuming the session ids were being stored there.

Aren't the IDs UUIDs that are generated up to 3 times to avoid conflicts? A 3-way conflict with UUIDs should have a probability of conflict that's almost 0, right? It would be weird enough if it happened once, but we've seen 5 requests within 20 seconds of each other failing with this error."
1542,bug in csv export with entity_quoting = True,2016-12-06T12:39:14Z,2017-06-20T20:05:11Z,,,,"solve
```diff
diff --git a/gluon/sqlhtml.py b/gluon/sqlhtml.py
index aa2e561..a71f1fb 100644
--- a/gluon/sqlhtml.py
+++ b/gluon/sqlhtml.py
@@ -2559,7 +2559,7 @@ class SQLFORM(FORM):
                     for (field_name, field) in iteritems(table):
                         if isinstance(field, Field.Virtual) and not str(field) in expcolumns:
                             expcolumns.append(str(field))
-
+            expcolumns = ['""%s""' % '"".""'.join(f.split('.')) for f in expcolumns]
             if export_type in exportManager and exportManager[export_type]:
                 if keywords:
                     try:
```"
1541,Allow adding records from a SQLFORM.grid or .smartgrid when using groupby,2016-12-03T18:33:54Z,,,,,"When groupby is used in a SQLFORM.grid or .smartgrid, the ability to add a record is disabled.  Why this is, and how it might be allowed, is described in the following thread: https://groups.google.com/forum/#!topic/web2py/QLN6HzItpS8"
1540,Replaced ipaddr with ipaddress.py (backported from py3),2016-12-03T07:50:48Z,2016-12-24T03:58:13Z,,,,
1539,"when mkdir of missing app folders, handle broken links properly",2016-12-01T15:34:39Z,2016-12-20T21:40:31Z,,,,"The code for creating missing application folders doesn't take symlinks into account.

If a web2py app is configured to have symlinks for some system folders (in my case `uploads` exists on a larger volume), and the link is broken because the target dir was removed, then the code in try_mkdir won't work.

`if not os.path.exists(path)` will return True when path is a broken symlink, but `os.mkdir(path)` will fail because the file exists (as a symlink). 

The fix is to identify broken links and mkdir the target instead of the link."
1538,Add web2py componentBegin event,2016-11-29T22:06:20Z,2016-12-20T21:39:55Z,,,,"Like the ‚Äúw2p:componentComplete‚Äù event I added a while back, this is
another event that I use in my website, and I thought it would be
helpful to share it with others.  This way, you can easily catch when a
web2py component starts loading, and write a handler for whatever
reason (in my case, determining when the user is navigating to a new
page through a smooth loading function piggybacking off of the web2py
component system)"
1537,Create a new app from command line options,2016-11-26T21:45:06Z,2017-06-20T19:51:53Z,,,,"Proposal to create a command to create a new applications from command line by example:

python web2py.py newapp name_app

without need copy and paste welcome application or access admin application from browser.

Or already exists this?

Just a proposal .. may be that this not be necessary.

"
1536,Update of float is not working ,2016-11-26T10:47:31Z,,,,,"When I try to update a float field dal is behaving very strange.
Instead of executing the float expression, it is converting the field to text and is trying to concatenate.
To overcome this problem I am doing double subctartion.
You can see this problem if you copy the following code into a controller:
```
def initTestTable():
    db.testTable.insert(testFloat=0.1)
    tuples=db(db.testTable.id>0).select(db.testTable.ALL)
    return locals()

def updateTestTable():
    db(db.testTable.id==1).update(testFloat=db.testTable.testFloat+1.0) # EITHER NOT WORKING AT ALL OR IS TRYING TO CONCATINATE
    print db._lastsql

    db(db.testTable.id==1).update(testFloat=db.testTable.testFloat-(-1.0)) # THIS IS WORKING
    print db._lastsql
    
    tuples=db(db.testTable.id>0).select(db.testTable.ALL)
    return locals()
```

and the following code into db.py:
`db.define_table('testTable', Field('testFloat', 'float',   default=0.0))
`

In the past I was using postgresql and I had not seen that problem.
Now I have migrated to the last mySql, the last web2py and to a new developing PC and I saw this problem."
1535,Appadmin orderby invalid syntax,2016-11-24T00:32:30Z,2017-06-27T21:49:29Z,bug,,,"When i click on a column to chose it's order by, the get query is submitting it with quotes which show an alert saying 'invalid syntax'. Removing the quotes of get vars make it work again
![captura de tela de 2016-11-23 22 23 41](https://cloud.githubusercontent.com/assets/3034354/20582795/88343a76-b1cb-11e6-8396-01bc5c180cab.png)
![captura de tela de 2016-11-23 22 24 22](https://cloud.githubusercontent.com/assets/3034354/20582811/9aa97d60-b1cb-11e6-813d-74bc12e93f78.png)

Using:
Version 2.14.6-stable+timestamp.2016.05.09.19.18.48 - (From git)
pip freeze:
CDDB==1.4
cffi==0.8.6
chardet==2.3.0
colorama==0.3.2
cryptography==0.6.1
defusedxml==0.4.1
docutils==0.12
dropbox==7.1.1
feedparser==5.1.3
html5lib==0.999
lxml==3.4.0
mercurial==3.1.2
mutagen==1.25.1
ndg-httpsclient==0.3.2
numpy==1.8.2
pexpect==3.2
Pillow==2.6.1
ply==3.4
psycopg2==2.5.4
pyasn1==0.1.7
pycparser==2.10
pycups==1.9.63
pycurl==7.19.5
Pygments==2.0.1
pygobject==3.14.0
pygpgme==0.3
pyinotify==0.9.4
pyOpenSSL==0.14
pysmbc==1.0.15.3
python-apt==0.9.3.12
python-dateutil==2.2
python-debian==0.1.27
python-debianbts==1.11
python-musicbrainz2==0.7.4
pyxdg==0.25
quodlibet==3.2.2
reportbug==6.6.3
reportlab==3.1.8
requests==2.12.1
roman==2.0.0
six==1.8.0
SOAPpy==0.12.22
typing==3.5.2.2
urllib3==1.9.1
uTidylib==0.2
wstools==0.4.3


"
1534,"lazyT in _compat (PY2, to_bytes())",2016-11-21T09:54:53Z,2017-06-20T19:54:09Z,,TypeError,"TypeError: Expected bytes","Probably lazyT can entry into to_bytes(), but this is not prepared for lazyT instance.

Traceback (most recent call last):
  File ""/home/mirek/mz/web2py/gluon/restricted.py"", line 216, in restricted
    exec(ccode, environment)
  File ""<string>"", line 113, in <module>
  File ""/home/mirek/mz/web2py/gluon/html.py"", line 2802, in __init__
    self.text = to_bytes(text)
  File ""/home/mirek/mz/web2py/gluon/_compat.py"", line 67, in to_bytes
    raise TypeError('Expected bytes')
TypeError: Expected bytes
In 'text' is my message, lazyT instance."
1533,implemented base support for CASv3,2016-11-17T12:35:01Z,2016-11-21T15:13:41Z,,,,"This commit extend the base CAS support also to v3 protocol. The only assumption is that the url for cas login for 'servicevalidate' and 'proxyvalidate' for V3 of protocol is like the following: 

```
- v3:
provider/default/user/cas/p3/{serviceValidate, proxyValidate}
- v2:
provider/default/user/cas/{serviceValidate, proxyValidate}
```
"
1532,Fix T.M() not adding to language files,2016-11-11T23:51:47Z,2016-11-21T15:12:42Z,,,,
1531,Mobile (iOS) flash dismissal fix,2016-11-11T21:53:55Z,2016-11-14T14:34:00Z,,,,"iOS devices don‚Äôt like listening to clicks on most objects. They
typically prefer a and button objects. This fix replaces the
#closeflash span with a link to ‚Äújavascript:null;‚Äù instead (while also inheriting
text-decoration and color styling), so that mobile (iOS) devices will
allow you to close the flash."
1530,Update extract_mysql_models.py,2016-11-11T09:30:37Z,2016-11-14T14:33:30Z,,,,"Previus script allows to connect to databases only on 'localhost'. Now it's possible to specify an optional host.
The parameter that specify the db connection string has now the following syntax:

**_extract_mysql_models.py username:password@[host/]data_basename_**

the host is optional, so old syntax: 

**_extract_mysql_models.py username:password@data_basename_**

will work as usual

"
1529,Mobile (iOS) fix for dismissing flashes,2016-11-10T09:19:31Z,2016-11-11T21:50:09Z,,,,"iOS devices don‚Äôt like listening to clicks on most objects.  They
typically prefer a and button objects.  This fix replaces the
#closeflash span with a link to ‚Äújavascript:null;‚Äù instead (while also inheriting
text-decoration and color styling), so that mobile (iOS) devices will
allow you to close the flash."
1528,New app not visible until server reload,2016-11-09T17:38:38Z,2017-06-27T21:44:10Z,bug,,,"Create a new app using **admin**, for example, **newapp** and go to `http://127.0.0.1:8000/newapp`. You'll get:

> invalid function (default/newapp)

(Considering the default app doesn't have a function called `newapp`).

To get the new app working is necessary to hit **stop server** and then **start server**. I think this is an issue with the latest version, since I remember creating an app in previous versions and getting them working instantly.

Tested on Windows 8 with web2py 2.14.6."
1527,Auth refactor,2016-11-05T16:39:51Z,2017-05-01T14:13:19Z,,,,"Extracted many methods into a base class for more generic auth mechanisms.

Partially addresses #1526
Includes a solution for IS_LOWER and IS_UPPER validator problems I mentioned in #1353"
1526,problems in code for reset password flow,2016-11-05T01:06:39Z,,,,,"There are a few worrisome lines of code

never executed:
https://github.com/web2py/web2py/blob/master/gluon/tools.py#L3688

things to avoid in any code: generic exceptions
https://github.com/web2py/web2py/blob/master/gluon/tools.py#L3681
https://github.com/web2py/web2py/blob/master/gluon/tools.py#L3684

a catchall exception:
https://github.com/web2py/web2py/blob/master/gluon/tools.py#L3685

a mysterious test parameter which could potentially leak some security info:
https://github.com/web2py/web2py/blob/master/gluon/tools.py#L3687"
1525,keep the _next while doing the redirect,2016-11-04T09:06:11Z,2016-11-14T14:27:39Z,,,,"@leonelcamara @niphlod @abastardi 

keeping the next causes a security threat?
Without this fix, next  redirect is not available if prevent_password_reset_attacks is enabled.
"
1524,Merge pull request #1 from web2py/master,2016-11-02T16:58:53Z,2016-11-02T16:59:10Z,,,,updating fork
1523,File permission problem,2016-11-02T04:18:45Z,2016-11-02T10:56:19Z,,,,"Hi, In my application, I try to create file and folder, which was successfully created by application, but I get read, write and execute problem, on created file. After creation of file, I cannot use, for write content or execute. Please help.
I am using linux(Ubuntu 14), with administrator login."
1522,MSSQL connectivity,2016-11-02T04:14:06Z,2016-11-02T10:55:34Z,,,,"DAL cannot connect MSSQL database, I used all three possibility uri strings give in web2py documents http://www.web2py.com/books/default/chapter/29/06/the-database-abstraction-layer#Connection-strings--the-uri-parameter. Please help. "
1521,form resubmission in refresh or reload,2016-11-02T04:09:34Z,2016-11-02T10:54:26Z,,,,Form will be resubmitted if I refresh or reload the page. I didnot use Form or SQLForm to display or update data from database. Please help.
1520,fix wrong import in default controller of admin app,2016-11-01T23:42:37Z,2016-11-03T11:00:15Z,,,,
1519,Allow for firstname and lastname in verify_email message,2016-11-01T11:04:27Z,2016-11-14T14:27:10Z,,,,"Should fix #1518.

I have not find a simple way to add a test, as there is no existing test for registration.
We could add one by mocking smtp library, but it requires a bit more work to set up."
1518,Allow the use of firstname and lastname in auth.messages.verify_email ,2016-10-31T22:16:33Z,2016-11-14T14:27:10Z,,,,"auth.messages.verify allows only for username to identify people in a name, but username may be the user mail.
It would be nice to allow more personal first and last name.

Other messages may be concerned too.

(I will submit a PR soon)."
1517,Provide a way to locate applications outside the web2py tree,2016-10-31T00:13:45Z,2017-06-20T19:57:45Z,,,,"See mailing list thread [here](https://groups.google.com/d/topic/web2py/tdpbnXMsxlg/discussion).  The issue is that sometimes a web2py application is only one part of a larger project.  The current design of web2py forces the entire application to reside inside the web2py directory subtree.  The `folders=` config option can be used to move the `applications` directory outside the web2py dir, but each app still needs to be located inside that global apps directory.

What is needed is a way to specify an arbitrary directory for each app individually.  Each app should be able to stored anywhere in the file system, and there should be a way to tell web2py where to find it if it's not in the default apps directory.
"
1516,Corrected use of 'lowercase' and 'uppercase' to fix #1515,2016-10-28T20:24:14Z,2016-11-14T14:26:44Z,,,,"Just noticed some grammar ""errors"" / misuse of words and wanted to correct the validation messages. See #1515
"
1515,"Change ""upper case"" and ""lower case"" to ""uppercase"" and ""lowercase"" in UI text",2016-10-28T19:57:22Z,2016-11-14T14:26:46Z,,,,"Uppercase and lowercase are the correct words, so now our grammatically correct custom text is different from the Web2Py validator messages.

In case you don't believe me. üòÑ 
- http://www.merriam-webster.com/dictionary/uppercase
"
1514,named args in jsrpc client,2016-10-27T12:44:24Z,2017-06-20T20:05:11Z,,,,"``` diff
diff --git a/gluon/contrib/simplejsonrpc.py b/gluon/contrib/simplejsonrpc.py
index f60dc4c..438b75b 100644
--- a/gluon/contrib/simplejsonrpc.py
+++ b/gluon/contrib/simplejsonrpc.py
@@ -105,14 +105,14 @@ class ServerProxy(object):

     def __getattr__(self, attr):
         ""pseudo method that can be called""
-        return lambda *args: self.call(attr, *args)
+        return lambda *args, **vars: self.call(attr, *args, **vars)

-    def call(self, method, *args):
+    def call(self, method, *args, **vars):
         ""JSON RPC communication (method invocation)""

         # build data sent to the service
         request_id = random.randint(0, sys.maxsize)
-        data = {'id': request_id, 'method': method, 'params': args, }
+        data = {'id': request_id, 'method': method, 'params': args or vars, }
         if self.version:
             data['jsonrpc'] = self.version #mandatory key/value for jsonrpc2 validation else err -32600
         request = json.dumps(data)
```
"
1513,bug in appadmin cache,2016-10-27T05:15:44Z,2017-06-20T20:00:50Z,,UnboundLocalError,UnboundLocalError: local variable 'value' referenced before assignment,"UnboundLocalError: local variable 'value' referenced before assignment

``` python
        for key in cache.disk.storage:
            if key == 'web2py_cache_statistics' and isinstance(value[1], dict):
```
"
1512,when to support cassandra?,2016-10-27T04:16:07Z,2016-11-22T19:22:51Z,,,,"Cassandra is a important database in big data area. But unhappily it is not supported in web2py.  Is there a plan to support cassandra?
"
1511,synat error,2016-10-26T12:04:18Z,2017-06-20T20:01:32Z,,,,"solve

``` diff
diff --git a/applications/admin/views/default.mobile/layout.html b/applications/admin/views/default.mobile/layout.html
index 8f004ce..b17e0d7 100644
--- a/applications/admin/views/default.mobile/layout.html
+++ b/applications/admin/views/default.mobile/layout.html
@@ -34,7 +34,7 @@
     <link rel=""stylesheet"" href=""{{=URL('static','plugin_jqmobile/jquery.mobile-1.3.1.min.css')}}"">

     <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
-    <script src=""{{=URL('static','js/modernizr.custom.js')}}""></script!>
+    <script src=""{{=URL('static','js/modernizr.custom.js')}}""></script>

     {{include 'web2py_ajax.html'}}

diff --git a/applications/admin/views/plugin_jqmobile/layout.html b/applications/admin/views/plugin_jqmobile/layout.html
index 8910c2f..1f6419c 100644
--- a/applications/admin/views/plugin_jqmobile/layout.html
+++ b/applications/admin/views/plugin_jqmobile/layout.html
@@ -34,7 +34,7 @@
     <link rel=""stylesheet"" href=""{{=URL('static','plugin_jqmobile/jquery.mobile-1.3.1.min.css')}}"">

     <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
-    <script src=""{{=URL('static','js/modernizr.custom.js')}}""></script!>
+    <script src=""{{=URL('static','js/modernizr.custom.js')}}""></script>

     {{include 'web2py_ajax.html'}}

```
"
1510,Setting obj.foo = None actually doesn't delete foo,2016-10-25T02:19:21Z,2017-06-20T20:03:01Z,,,,"The `Storage` documentation says:

> A Storage object is like a dictionary except `obj.foo` can be used in addition to `obj['foo']`, and setting obj.foo = None deletes item foo.

Actually doing `obj.foo = None` just changes the value of `obj` to `None`, which is not deleting the item if you rely in `Storage.__contains__`. Instead, only `del obj.foo` really deletes the item.

```
>>> a = Storage()
>>> a.something = 1
>>> ""something"" in a
True
>>> a.something = None
>>> ""something"" in a
True
>>> del a.something
>>> ""something"" in a
False
```
"
1509,"Wiki is not stable in ""stable version""",2016-10-24T13:03:55Z,2016-10-24T13:55:58Z,,UnboundLocalError,UnboundLocalError: local variable 'gid' referenced before assignment,"If you download the stable version in web2py.com, version 2.14.6, the wiki funcionality is broken with the follow ticket:

``` python
auth.add_membership(gid)
UnboundLocalError: local variable 'gid' referenced before assignment
```

This seems already fixed in master. Maybe a 2.14.7 with this ffixed can be releasead.
"
1508,Auth Refactor (WIP),2016-10-21T18:03:51Z,2016-10-31T18:43:54Z,,,,"Refactored Auth so you can have different implementations of it's main user functionality (for instance, and implementation not depending on SQLFORM) without breaking backwards compatibility.  
"
1507,Fire event after web2py component completed (Enhancement),2016-10-19T01:28:29Z,2016-10-22T15:14:43Z,,,,"Sometimes we may want to know when the component is finished with it‚Äôs
loading process entirely to trigger animations or something similar.  I
added this for my own website, and I think that others may want to use
this.  It‚Äôs a small addition, but I hope that it will be helpful to
others!
"
1506,"auth.define_tables(signature=Table(Field(...), Field(...)) broken since 2.12.3",2016-10-18T09:26:28Z,2017-05-01T14:13:20Z,,,,"In the past, at least until version 2.12.3, you could pass your own signature fields to auth.
In the current version, this does not work anymore.

In auth.define_tables the logic to process the signature is changed at some point:

In gluon/tools.py 2343 : 2350 current version:
        if signature:
            signature_list = [self.signature]
        elif not signature:
            signature_list = []
        elif isinstance(signature, Table):
            signature_list = [signature]
        else:
            signature_list = signature

Does not work, because the statement if signature: checks wether signature is None or not.

In 2.12.3 it was:
        if signature == True:
            signature_list = [self.signature]
        elif not signature:
            signature_list = []
        elif isinstance(signature, Table):
            signature_list = [signature]
        else:
            signature_list = signature

Is it possible to change this back to the old syntax?

Thanks!
Bart
"
1505,webclient lose the session when session.forget is used,2016-10-11T19:42:00Z,2017-04-28T13:04:57Z,,AssertionError,AssertionError: False is not true,"When `session.forget` is added to an action like `index` we can observe that on subsequent call a logged user is logged out.

To reproduce, modify  `TestWeb.testRegisterAndLogin` in gluon/tests/test_web.py (tryed on  commit e6a3081b42ecd58441419930266baf286561c4c7) so as adding `session.forget(response)` at the first line of the `index` controller.

The test is run with :

```
python2 -m unittest -v gluon.tests.test_web.TestWeb.testRegisterAndLogin
```

And fails with :

```
======================================================================
FAIL: testRegisterAndLogin (gluon.tests.test_web.TestWeb)
----------------------------------------------------------------------
Traceback (most recent call last):
  File ""gluon/tests/test_web.py"", line 92, in testRegisterAndLogin
    self.assertTrue('Welcome Homer' in client.text)
AssertionError: False is not true

----------------------------------------------------------------------
```

Which seems unexpected according to the google group exchanges about this subject.

I'd like to help, but I have only a rough idea of the expected behaviour of a browser with respect to cookies, sessions and headers‚Ä¶ Link to documentation is welcomed.
"
1504,Updated and functional version of #1420,2016-10-11T03:55:41Z,2016-10-14T15:12:36Z,,,,"Having read the comments about pull request #1420 two months later, I have applied the proper fixes.  Less stupidity (on my end), more functionality!
"
1503,update_or_insert returns none when updating,2016-10-10T13:11:08Z,2016-10-21T20:48:17Z,,,,"The dal update_or_insert method return None when updating.  This is fine when doing plain inserts or updates, but if you need to then create a foreign key reference to that row, you're left to query the id yourself if it was an update, which makes the method pointless in that case.  Can we have it return the id of the row in both cases?
"
1502,Allow cookie to contains several '=',2016-10-09T19:55:31Z,2016-10-14T15:12:05Z,,,,"fixes #1500

Replacement for PR #1501, squashing commits and adding unit test.
"
1501,Allow cookie to contains several '=',2016-10-08T14:44:12Z,2016-10-09T19:51:47Z,,,,"close #1500
"
1500,webclient : cookie may contains several '=' ,2016-10-08T14:39:52Z,2016-10-14T15:12:05Z,,,,"Which leads to a ValueError: too many values to unpack.

A PR to correct the problem will follow
"
1499,"fix few app admin py3 issues, updated qdb (close #1471)",2016-10-08T10:29:07Z,2016-10-14T15:11:36Z,,,,"Fixed few p3 app admin issues listed in https://github.com/web2py/web2py/issues/1353:
- debug (perhaps related to #1471)
- wizard step6
- update_languages
- appadmin/ccache
"
1498,fixes #1491,2016-10-07T20:50:53Z,2016-10-14T15:10:16Z,,,,
1497,fixes #1489,2016-10-07T19:23:29Z,2016-10-14T15:09:25Z,,,,
1496,fixes #1493 (at @abastardi's bidding),2016-10-07T19:20:41Z,2016-10-14T15:09:05Z,,,,
1495,"fix ccache page in appadmin, thanks MDSIII",2016-10-07T19:15:38Z,2016-10-14T15:08:41Z,,,,"fixes the ccache page to now raise an exception if a dict is stored in
cache
"
1494,fix issue with regex,2016-10-07T11:11:02Z,2016-10-07T16:17:45Z,,,,
1493,"IS_EMPTY_OR validator returns incorrect ""empty"" value",2016-10-06T18:13:23Z,2016-10-14T15:09:06Z,,,,"When setting default validators, the https://github.com/web2py/web2py/commit/bdbc053285b67fd3ee02f2ea862b30ca495f33e2 commit mistakenly sets the `null` attribute of the `IS_EMPTY_OR` validator to `''` for _all_ field types rather than just the string based field types.

[This line](https://github.com/web2py/web2py/blob/1877f497309e71918aa78e1a1288cbe3cb5392ec/gluon/dal.py#L81):

```
 requires[0] = validators.IS_EMPTY_OR(requires[0], null='' if field in ('string', 'text', 'password') else None)
```

should instead be:

```
 requires[0] = validators.IS_EMPTY_OR(requires[0], null='' if field.type in ('string', 'text', 'password') else None)
```

Notice, `field.type` rather than `field`.
"
1492,Make pass test_login_bare() and little other improvements,2016-10-05T16:44:24Z,2016-10-14T15:08:20Z,,,,"login_bare() is not broken, it just picky how user get created,  Close #1477
"
1491,unittest response.render() inside scheduler,2016-10-04T18:48:22Z,2016-10-14T15:10:17Z,,,,"to avoid #1485 to happen again
"
1490,"fixes #1485, thanks @abastardi once again",2016-10-03T22:41:48Z,2016-10-05T00:40:11Z,,,,
1489,remove __pycache__ from the list of apps,2016-10-03T22:30:46Z,2016-10-05T00:39:50Z,,,,"in case someone wonders how many core devs are actively using the admin
app...here's the evidence ^_^'
"
1488,removing pycrypto hard dep,2016-10-03T22:24:34Z,2016-10-03T22:43:00Z,,,,"another hard dependency bytes the dust (the last one).

Very very important notes:
- pbkdf2_ctypes.py comes from our very own @michele-comitini : dunno why we lived on a slightly older release
- pbkdf2.py was refreshed from the latest version
- apps using directly gluon.contrib.aes will need to rewrite code (in case) to use pyaes
- @mdipierro : pyaes comes from https://github.com/ricmoo/pyaes . I included license and readme: feel free to drop those in favour of a license recap of all 3rd party
- nowhere in the readme or the book (I noticed just reading the code) mentions that a big speedup on web2py and secure cookies needs pycrypto (or the more versatile pycryptodome) installed...we should:
  - make a note on the book and remember to fetch the dep on the installation scripts for prod environment
  - cook next release binaries with pycrypto included
"
1487,updates pg8000 driver and freshens travis.yml,2016-10-03T20:18:54Z,2016-10-03T22:27:03Z,,,,
1486,"fixes #1484, thanks @abastardi",2016-10-03T19:34:27Z,2016-10-03T19:48:53Z,,,,
1485,response._view_environment missing in scheduler and shell,2016-10-03T16:29:25Z,2016-10-05T00:40:11Z,,,,"https://github.com/web2py/web2py/commit/b4acfd0724845633f667a55e593a15576379554d results in a failure to create `response._view_environment` when running scheduler tasks or the shell. Now, `response._view_environment` is only created in `gluon.main.serve_controller`, which only gets called for HTTP requests. A fix, is to create `response._view_environment` in `gluon.shell.env`, after the models have been run (just as in `gluon.main.serve_controller`).

```
    if import_models:
        try:
            run_models_in(environment)
        except RestrictedError as e:
            sys.stderr.write(e.traceback + '\n')
            sys.exit(1)

    response._view_environment = copy.copy(environment)  # <-- ADD THIS LINE
```

Note, this should actually be an improvement over the previous situation. In the original code, `response._view_environment` was set in `gluon.compileapp.build_environment`, which was run _before_ `run_models_in` -- so, the `_view_environment` did not includes objects created in the models. This change rectifies that problem.
"
1484,Scheduler - request.is_scheduler = None instead of True,2016-10-03T13:27:05Z,2016-10-03T19:48:54Z,,,,"When you access request.is_scheduler from outside of the scheduler you get False as one would expect. However, while running scheduler tasks request.is_scheduler = None instead of True. The current None value seems strange/non-intuitive.

```
#this won't work
if request.is_scheduler:
   #do special scheduler stuff

#To really know if you're running under the scheduler you must use this which makes no sense
if request.is_scheduler == None:
   #do special scheduler stuff
```

This has been the case for a while and is still happening with the latest git trunk
"
1483,make pymysql usable inside web2py,2016-09-30T22:18:03Z,2016-10-03T19:48:30Z,,,,
1482,fixes #1407 passing a properly escaped string,2016-09-28T22:04:40Z,2016-09-30T22:14:45Z,,,,"supeseeds https://github.com/web2py/web2py/pull/1478
"
1481,minor compileapp refactor,2016-09-28T19:23:08Z,2016-09-30T22:15:18Z,,,,
1480,Updated pyDAL to 16.9,2016-09-28T11:11:25Z,2016-09-30T22:15:25Z,,,,
1479,error with client certificate,2016-09-28T06:00:20Z,2017-06-20T20:03:45Z,,,,"solve

``` diff
diff --git a/gluon/rocket.py b/gluon/rocket.py
index c41ac32..a29d55d 100644
--- a/gluon/rocket.py
+++ b/gluon/rocket.py
@@ -11,7 +11,7 @@ import errno
 import socket
 import logging
 import platform
-from gluon._compat import iteritems, to_bytes, StringIO, urllib_unquote
+from gluon._compat import iteritems, to_bytes, StringIO, urllib_unquote, to_native

 # Define Constants
 VERSION = '1.2.6'
@@ -1661,7 +1661,7 @@ class WSGIWorker(Worker):
             try:
                 peercert = conn.socket.getpeercert(binary_form=True)
                 environ['SSL_CLIENT_RAW_CERT'] = \
-                    peercert and ssl.DER_cert_to_PEM_cert(peercert)
+                    peercert and to_native(ssl.DER_cert_to_PEM_cert(peercert))
             except Exception:
                 print(sys.exc_info()[1])
         else:
```
"
1478,fixes definitely #1407 passing a proper escaped string,2016-09-27T20:27:18Z,2016-09-28T22:04:49Z,,,,
1477,auth.login_bare() is broken,2016-09-27T17:58:41Z,2016-10-14T15:08:20Z,,AssertionError,AssertionError: False is not true,"I thought I had open a ticket about this one, but it appears I didn't : https://github.com/web2py/web2py/issues/1264

login_bare() don't work and it commented test failed in uncomment : 
# 
## FAIL: test_login_bare (gluon.tests.test_tools.TestAuth)

Traceback (most recent call last):
  File ""gluon/tests/test_tools.py"", line 671, in test_login_bare
    self.assertTrue(self.auth.is_logged_in())
AssertionError: False is not true
"
1476,Translation for serbian,2016-09-25T18:17:44Z,2016-09-27T21:37:01Z,,,,"My second attempt for - issue 1451. 
I hope this is ok.
Sorry for inconvenience, just learning git
"
1475,Issue/1451,2016-09-25T15:06:51Z,2016-09-27T19:51:07Z,,,,"PR for issue 1451 - new sr-lt and sr-cr translation.

PS: My first PR ever
"
1474,ImportError  cannot import name 'portalocker',2016-09-24T19:16:16Z,2016-09-27T21:36:33Z,,,,"`Error ticket for ""welcome""
Ticket ID

127.0.0.1.2016-09-24.21-13-14.d7d9c12e-8158-49a9-a755-d3e9103b27e8
<class 'ImportError'> cannot import name 'portalocker'
Verzija
web2py‚Ñ¢   Version 2.14.6-stable+timestamp.2016.05.09.19.18.48
Traceback

no traceback because template parsing error

In file: /home/sasa/WorkDir/project/web2py/applications/welcome/controllers/appadmin.py`
"
1473,ImportError: No module named 'applications.admin.modules.xmlrpclib',2016-09-24T18:54:07Z,2016-09-27T21:36:33Z,,ImportError,ImportError: No module named 'xmlrpclib',"Ticket ID

127.0.0.1.2016-09-24.20-51-32.9d84981e-2ffe-4ede-8487-10bf264415dd
<class 'ImportError'> (ImportError(""No module named 'applications.admin.modules.xmlrpclib'"",), <traceback object at 0x7f448c47a1c8>)
Verzija
web2py‚Ñ¢   Version 2.14.6-stable+timestamp.2016.05.09.19.18.48
Python  Python 3.5.2: /usr/bin/python3 (prefix: /usr)
Traceback

Traceback (most recent call last):
  File ""/home/sasa/WorkDir/project/web2py/gluon/custom_import.py"", line 77, in custom_importer
    return NATIVE_IMPORTER(oname, globals, locals, fromlist, level)
ImportError: No module named 'xmlrpclib'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""/home/sasa/WorkDir/project/web2py/gluon/custom_import.py"", line 98, in custom_importer
    return base_importer(pname, globals, locals, fromlist, level)
ImportError: No module named 'applications.admin.modules.xmlrpclib'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""/home/sasa/WorkDir/project/web2py/gluon/custom_import.py"", line 102, in custom_importer
    return NATIVE_IMPORTER(name, globals, locals, fromlist, level)
ImportError: No module named 'xmlrpclib'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""/home/sasa/WorkDir/project/web2py/gluon/restricted.py"", line 220, in restricted
    exec(ccode, environment)
  File ""/home/sasa/WorkDir/project/web2py/applications/admin/controllers/pythonanywhere.py"", line 8, in <module>
    from xmlrpclib import ProtocolError
  File ""/home/sasa/WorkDir/project/web2py/gluon/custom_import.py"", line 104, in custom_importer
    raise ImportError(e1, import_tb)  # there an import error in the module
ImportError: (ImportError(""No module named 'applications.admin.modules.xmlrpclib'"",), <traceback object at 0x7f448c47a1c8>)
"
1472, No translation for pygraphviz library not found,2016-09-24T17:31:00Z,2017-06-20T20:07:22Z,,,,"in language file:
pygraphviz library not found': 'pygraphviz biblioteka nije pronaƒëena',

web2py show:
Graph Model
pygraphviz library not found 
"
1471,"Missing parentheses in call to 'exec' (qdb.py, line 338)",2016-09-24T17:05:13Z,2016-10-14T15:11:36Z,,SyntaxError,SyntaxError: Missing parentheses in call to 'exec',"Ticket ID

127.0.0.1.2016-09-24.19-01-42.d059899a-f956-4dbe-8a51-bd5515ae3222
<class 'SyntaxError'> Missing parentheses in call to 'exec' (qdb.py, line 338)
Verzija
web2py‚Ñ¢   Version 2.14.6-stable+timestamp.2016.05.09.19.18.48
Python  Python 3.5.2: /usr/bin/python3 (prefix: /usr)
Traceback

Traceback (most recent call last):
  File ""/home/sasa/WorkDir/project/web2py/gluon/restricted.py"", line 220, in restricted
    exec(ccode, environment)
  File ""/home/sasa/WorkDir/project/web2py/applications/admin/controllers/debug.py"", line 7, in <module>
    from gluon.debug import communicate, web_debugger, qdb_debugger
  File ""/home/sasa/WorkDir/project/web2py/gluon/custom_import.py"", line 111, in custom_importer
    return NATIVE_IMPORTER(name, globals, locals, fromlist, level)
  File ""/home/sasa/WorkDir/project/web2py/gluon/debug.py"", line 92, in <module>
    import gluon.contrib.qdb as qdb
  File ""/home/sasa/WorkDir/project/web2py/gluon/custom_import.py"", line 111, in custom_importer
    return NATIVE_IMPORTER(name, globals, locals, fromlist, level)
  File ""/home/sasa/WorkDir/project/web2py/gluon/contrib/qdb.py"", line 338
    exec code in globals, locals
            ^
SyntaxError: Missing parentheses in call to 'exec'
"
1470,"cache (and compile) views, models and controllers",2016-09-24T08:11:24Z,2016-09-27T21:36:32Z,,,,"Continuation of https://github.com/web2py/web2py/pull/1461 https://github.com/web2py/web2py/pull/1450
With this PR `restricted()` receives only compiled (and cached) code
"
1469,"fixes #1069, untangles the js, modernizes the approach",2016-09-23T21:45:50Z,2016-09-27T21:36:02Z,,,,"plus, avoids hitting the backend for each and every keypress...
"
1468,"here here, we can update pydal in the wait for a new release soon",2016-09-23T19:26:48Z,2016-09-27T21:35:13Z,,,,"BTW, we should NOW think about https://github.com/web2py/web2py/issues/1441 before hitting the same wall again.
"
1467,ideas shared on #1450,2016-09-23T19:07:00Z,,enhancement,,,"let's discuss here the move of caching models, controllers and views (both compiled or not).
@ilvalle ran some benchmarks that should be replicated by the most of us if we want to ""consolidate"" the change.
Also,  @mdipierro commented

> The test function allows to run doctests from admin. Wan't this break backward compatibility for compiled apps? I am on with it but we should make a very prominent note of it.
"
1466,fix launching system_tests without coverage,2016-09-23T18:53:09Z,2016-09-27T21:34:50Z,,,,
1465,fixes #1190,2016-09-22T19:31:32Z,2016-09-23T18:51:54Z,,,,
1464,"fixes #1309 (and sessions2trash.py, too)",2016-09-21T23:37:07Z,2016-09-23T18:51:22Z,,,,
1463,"fixes #1407, encouraging a sane default",2016-09-21T22:39:14Z,2016-09-23T18:50:30Z,,,,"this makes everything enclosed in a double quote, that has less chance to occurr in a translated string. Though it isn't a ""scientific fix"", but because of the above and the ""de-facto"" recommendation of quoting with double quotes in js, should be enough in a world of ""consenting adults"".
The ""scientific fix"" would be to pass a json object and assign vars from there. I think that would be an overkill.
"
1462,avoid downloading pip as 2.7 has ensurepip,2016-09-21T22:30:23Z,2016-09-23T18:50:16Z,,,,
1461,fixes #1310 and improves upon ideas shared on #1450,2016-09-21T22:01:53Z,2016-09-23T18:52:08Z,,,,
1460,removed leftover (be careful (BOTH contributors and mergers)),2016-09-21T21:14:24Z,2016-09-23T18:47:10Z,,,,
1459,fixes #1413,2016-09-21T21:01:33Z,2016-09-23T18:46:55Z,,,,
1458,fixes #1455,2016-09-21T20:35:36Z,2016-09-23T18:46:36Z,,,,
1457,Impersonate in menu,2016-09-21T07:39:24Z,2017-06-20T20:07:47Z,,,,"``` diff
diff --git a/gluon/tools.py b/gluon/tools.py
index e0838f9..d69672f 100644
--- a/gluon/tools.py
+++ b/gluon/tools.py
@@ -2050,6 +2050,9 @@ class Auth(object):
             if 'profile' not in self.settings.actions_disabled:
                 items.append({'name': T('Profile'), 'href': href('profile'),
                               'icon': 'icon-user'})
+            if 'impersonate' not in self.settings.actions_disabled:
+                items.append({'name': T('Impersonate'), 'href': href('impersonate'),
+                              'icon': 'icon-user'})
             if 'change_password' not in self.settings.actions_disabled:
                 items.append({'name': T('Password'),
                               'href': href('change_password'),
```
"
1456,change threading.Thread to multiprocessing.Process,2016-09-21T05:43:00Z,2016-09-21T12:07:29Z,,,,"Why web2py uses threading.Thread instead multiprocessing.Process?
The following example

``` python
from time import time
from threading import Thread
from multiprocessing import Pool, Process

N = 20
numbers = [10000000] * N

def counter(number):
    while number > 0: number -= 1

def line():
    for number in numbers: counter(number)

def thread():
    threads = []
    for number in numbers:
        thread = Thread(target=counter, args=[number])
        thread.start()
        threads.append(thread)
    for thread in threads: thread.join()

def process():
    processes = []
    for number in numbers:
        process = Process(target=counter, args=[number])
        process.start()
        processes.append(process)
    for process in processes: process.join()

def pool():
    pool = Pool(N)
    pool.map(counter, numbers)
    pool.close()
    pool.join()

if __name__ == '__main__':
    start = time()
    line()
    print 'line', time() - start

    start = time()
    thread()
    print 'thread', time() - start

    start = time()
    process()
    print 'process', time() - start

    start = time()
    pool()
    print 'pool', time() - start
```

produces following output on my computer:

```
line 5.68025112152
thread 9.69578385353
process 1.51231002808
pool 1.52548193932
```

from that we can see, that multiprocessing.Process is more effective than threading.Thread
"
1455,Auth messages: unable_send_email vs. unable_to_send_email,2016-09-21T02:51:28Z,2016-09-23T18:46:39Z,,,,"Is there any reason to have both messages? They have the same value by default (""Unable to send email"") (see [tools.py:1576](https://github.com/web2py/web2py/blob/59315c874de729c3d52904c0e5aa425157b1a726/gluon/tools.py#L1576)) but the code sometimes uses the former and sometimes the later.
"
1454,fixes #1449,2016-09-19T19:38:44Z,2016-09-21T14:52:55Z,,,,"codename ""he who late imports by default makes everybody's life a misery
for no speedup at all""
"
1453,fixes #1452,2016-09-19T18:42:26Z,2016-09-21T14:52:46Z,,,,
1452,Scheduler runs Queued tasks immediately instead of start_time setting,2016-09-19T13:28:28Z,2016-09-21T14:52:47Z,,,,"Please verify scheduler.py. Default of Next_run_time is now. 
Line 1125, 
all_available = db( ... &     (st.next_run_time <= now) &   ...)
, lacks of start_time constrain and will always make queued tasks were run immediately.
"
1451,Admin sr translation,2016-09-18T12:22:01Z,2017-06-22T21:52:26Z,,,,"Update translation for sr-lt and st-cr
"
1450,caching read_pyc,2016-09-16T15:09:13Z,2016-09-21T14:52:32Z,,,,"Running `ab -n 10000 -c 1 http://localhost:8000/welcome/default/index` on an i5 with SSD
I got (current master)

```
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.0      0       0
Processing:    15   23  13.1     18     166
Waiting:       15   23  13.1     18     166
Total:         15   23  13.1     18     166
```

with this PR

```
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.0      0       0
Processing:    15   19  10.4     16     148
Waiting:       15   19  10.4     15     147
Total:         15   19  10.4     16     148
```

The gain is ~15% running welcome default controller. @abastardi would you mind computing TechEmpower Benchmarks?

On the other hand since application files can change, such optimization requires a way to erase the cache (maintained in a dict in cfs.py). An idea is to erase such cache in `compile_application()`. What do you think?
"
1449,error at py3,2016-09-13T10:27:01Z,2016-09-21T14:52:55Z,,,,"solve

``` diff
git diff globals.py
diff --git a/gluon/globals.py b/gluon/globals.py
index 41ac708..ae4e0bc 100644
--- a/gluon/globals.py
+++ b/gluon/globals.py
@@ -13,7 +13,7 @@ Contains the classes for the global used variables:
 - Session

 """"""
-from gluon._compat import pickle, StringIO, copyreg, Cookie, urlparse, PY2, iteritems, to_unicode, to_native, unicodeT
+from gluon._compat import pickle, StringIO, copyreg, Cookie, urlparse, PY2, iteritems, to_unicode, to_native, unicodeT, long
 from gluon.storage import Storage, List
 from gluon.streamer import streamer, stream_file_or_304_or_206, DEFAULT_CHUNK_SIZE
 from gluon.contenttype import contenttype
```
"
1448,Avoid folder creation race condition,2016-09-12T14:02:47Z,2016-09-14T13:49:18Z,,,,"See https://groups.google.com/d/msg/web2py-developers/WcW2YzDuVms/yt3VhfwnFgAJ.
"
1447,Invalid deployment script urls in documentation,2016-09-11T16:21:50Z,2016-09-13T10:32:24Z,,,,"http://web2py.com/books/default/chapter/29/13/deployment-recipes?search=deployment#One-step-production-deployment
"
1446,fix py3.5 xmlescape with bytes,2016-09-09T15:10:11Z,2016-09-11T14:45:07Z,,,,"Prevent `DIV(b'a')` being translated into `b'<div>b&#x27;a&#x27;</div>'` instead of `b'<div>a</div>'`
"
1445,Translations and related improvements,2016-09-09T07:43:45Z,2016-09-11T14:44:49Z,,,,"1. Updates provided for the following languages:
   - French (fr)
   - German (de)
   - Portuguese (pt)
   - Brazilian Portuguese (pt-br)
   - Spanish (es)
2. Language updates run for all applications.
3. Fixed a consistency error when updating T.M() translations
4. Stripped all unused strings (via a custom-made script) from the translations
"
1444,Double invert of Expression fails,2016-09-08T16:58:49Z,2016-09-13T10:33:45Z,,,,"The problem with a double invert of an Expression instance is back. It was originally discussed here:

https://groups.google.com/forum/?hl=en#!topic/web2py/VGNsa21wvrc

Ideally these should be the equivalent:

```
db.person.name
~~db.person.name
```

But instead we get this:

```
str(db.person.name)      'person.name'
str(~db.person.name)     'person.name DESC'
str(~~db.person.name)    'person.name DESC DESC'
```

Regards,
Jim
"
1443,/setup-web2py-nginx-uwsgi-ubuntu.sh  possible bug in ubuntu 16.04 server edition,2016-09-07T19:40:25Z,,,,,"I used this script in a fresh and updated vps from digitalocean.
Unfortunately emperor.uwsgi.service is not starting automatically after boot.
I have to start it manually with `sudo systemctl start emperor.uwsgi.service` after every boot.
Also the owner of  /home/www-data/\* is root instead of www-data so I have to run manually the command `chown -R www-data:www-data /home/www-data` .

Any suggestion to run `sudo systemctl start emperor.uwsgi.service` automatically after every boot ?
"
1442,to_unicode not imported,2016-09-06T21:45:50Z,2016-09-11T14:45:09Z,,,,"This module calls to_unicode() from the gluon._compat module in line 3500, but to_unicode() is not imported. it should be included in line 22.

`
from gluon._compat import StringIO, unichr, urllib_quote, iteritems, basestring, long, unicodeT, to_native, to_unicode
`
"
1441,pydal tests suite embedded in web2py,2016-09-06T18:32:43Z,,,,,"a) the way we load tests for pydal... I guess @gi0baro did his best to make them run, but unfortunately cutting corners to have several runs on travis lead to tests being ran BUT not ""merged"" together in the main result. This means that in order to do a test run on travis for both mysql and postgresql (probably to lower the resulting matrix) we basically gave up tests. Giving that pydal itself doesn't do this, I'd go for restoring the matrix
b)  https://github.com/web2py/pydal/blob/master/tests/sql.py#L1466 groan

I'll open a new issue to discuss how to fix the mess.
"
1440,fixes #1439,2016-09-06T18:18:26Z,2016-09-11T14:40:56Z,,,,
1439,bug in paths,2016-09-06T05:33:35Z,2016-09-11T14:40:58Z,,,,"solve:

``` diff
git diff gluon/admin.py
diff --git a/gluon/admin.py b/gluon/admin.py
index 3eb3bc5..e0372ba 100644
--- a/gluon/admin.py
+++ b/gluon/admin.py
@@ -449,7 +449,7 @@ def create_missing_folders():
     """"""
     paths = (global_settings.gluon_parent, abspath(
         'site-packages', gluon=True), '')
-    [add_path_first(path) for p in paths]
+    [add_path_first(path) for path in paths]


 def create_missing_app_folders(request):

```
"
1438,Possible security bug in default mySQL/web2py setup,2016-09-01T08:26:44Z,2016-10-01T13:52:29Z,,,,"Not sure where to report this: don't want to disclose too much, but the hole is such an obvious one that I might just have misunderstood the web2py syntax. Where should I report so that it is not public?
"
1437,examples application - slow scroll page in Firefox browser,2016-09-01T00:34:16Z,2016-09-21T20:58:05Z,,,,"With reference to
https://groups.google.com/d/msg/web2py/AWd6eMh9j6k/o2cqTdpuEgAJ

Possibile solution
This css rule in stupid.ccs should be enough in order to  prevent android horizontal scrolling
`html, body {max-width: 100vw; overflow-x: hidden}`

The issue should disappear by commented out (or removing) in applications/examples/views/layout.html

```
 <script>
    // prevent android horizontal scrolling
    window.addEventListener(""scroll"", function(){window.scroll(0, window.pageYOffset);}, false);
  </script>
```

but you have to test if it works in android devices.  
"
1436,fix sys.path dance part #2 and scheduler tests for py3,2016-08-31T22:01:33Z,2016-09-01T15:23:29Z,,,,
1435,"template.py - doctest correction, and minor PEP8 changes",2016-08-31T17:06:56Z,2016-09-22T19:08:57Z,,,,"Am trying to use the `template.py` in my project. Before using it, I thought I'll just run the doctest present within it. 
I see this error when running it.

```
**********************************************************************
File ""d:\code\...\template.py"", line 872, in __main__.render
Failed example:
    render(content=''''a""'bc''')
Expected:
    'a""'bc'
Got:
    '\'a""\'bc'
**********************************************************************
1 items had failures:
   1 of  12 in __main__.render
***Test Failed*** 1 failures.
```

I'll send a PR for this, which includes some minor PEP8 changes.
"
1434,first step towards dropping sys.path dance,2016-08-29T21:17:11Z,2016-08-31T13:09:36Z,,,,
1433,No cleartext input password for setup nginx uwsgi ubuntu script,2016-08-24T19:50:30Z,2016-08-28T03:13:35Z,,,,
1432,Field constructor 'update' not working,2016-08-23T18:49:28Z,2016-09-21T20:48:15Z,,,,"Hey guys, I'm trying to achieve the auth.signatures's 'modified_on' behaviour without using the auth.signature on my table because I need a reference to this table from auth.user. (So, I can't use auth.signature)

What I want: a field that is updated with the date everytime the record is modified.
What I've tried: `Field('updated_on', 'datetime', update=request.now, writable=False, readable=False),` (I have also tried adding `default=request.now` too).
What it currently does: When I create the record it fills with the current date, but when I modify it, it does not change and its value remains the same.

The web2py book says: **`update` contains the default value for this field when the record is updated.** Which pretty much describes what I'm trying to achieve.

Thanks!
"
1431,fixed auth.add_membership succeeding with invalid group_id/user_id,2016-08-17T21:18:38Z,2016-08-25T05:12:51Z,,,,"Resolves [issue #1300](https://github.com/web2py/web2py/issues/1300)
"
1430,"fixed ""/app/static"" throwing AttributeError instead of HTTP(404)",2016-08-17T20:52:30Z,2016-08-25T05:11:17Z,,,,"HTTP requests for `/app/static` currently throw an AttributeError due to attempting a string replacement when the filename is None. Patch raises HTTP(404) before attempting the string replacement if filename is None.
"
1429,use constant-time comparison to verify websocket hmac,2016-08-17T20:21:21Z,2016-08-25T05:12:33Z,,,,"fixed websocket using variable time hmac comparison
"
1428,secure_dumps/secure_loads/pad update,2016-08-17T20:09:32Z,2016-08-25T05:10:53Z,,,,"added PKCS #7 v1.5 padding
updated secure_dumps to use SHA256
fixed secure_dumps using truncated encryption_key hash
fixed pad ignoring blocksize argument

Supports older secure_dumps files through __secure_loads_deprecated interface (automatically invoked through secure_dumps for data with old data format).

secure_dumps previously truncated the 20-byte SHA1(encryption_key) output to 16-bytes (hexadecimal). Updated secure_dumps now uses entire 32-byte SHA256(encryption_key) output.
"
1427,pad/secure_dumps/secure_loads update,2016-08-17T16:59:31Z,2016-08-17T19:59:13Z,,,,"added [PKCS #7 v1.5 padding](https://www.ietf.org/rfc/rfc2315.txt)
updated secure_dumps to use SHA256
fixed secure_dumps using truncated encryption_key hash
fixed pad ignoring blocksize argument

Supports older secure_dumps files through __secure_loads_deprecated interface (automatically invoked through secure_dumps for data with old data format).

secure_dumps previously truncated the 20-byte SHA1(encryption_key) output to 16-bytes (hexadecimal). Updated secure_dumps now uses entire 32-byte SHA256(encryption_key) output.
"
1426,dynamic workers in web2py scheduler,2016-08-17T08:59:01Z,,enhancement,,,"Initially, no one workers is running, because of there is no tasks.
Each task has additional parameter called ""workers"" (default it equals one), which means, how many workers are running simultaneously.
Whe we put task into queue, one worker is started. If there is tasks in queue, and additional parameter ""workers"" more then count of running workers, another worker is started. If there is no task in queue some (specified) time, then running workers are terminated.
"
1425,F redirect in admin/default/design (install of plugin),2016-08-16T11:30:30Z,2016-08-16T23:50:09Z,,,,"Otherwise causes error if plugin install fails, because redirects to default/design without args/appname.
"
1424,TAG / web2pyHTMLParser doubles <br/> self closing tag,2016-08-15T10:13:19Z,,,,,"ORIGINALLY:::

TAG() helper is interesting.  i'm running web2py version 2.14.6.  here is a controller function:

```
def viewTest():
    raw = '<html><head><title>ok man</title></head><body><p>this is a test <input type=""text""></input><br />of the American Broadcast System. <input type=""text""></input><br />this is only a test. <input type=""text""></input></p></body></html>'
    rawHead = raw[raw.find('<head>')+6:raw.rfind('</head>')]
    rawBody = raw[raw.find('<body>')+6:raw.rfind('</body>')]
    div = TAG(rawBody)
    ss = div.elements('input')
    return HTML(HEAD(TAG(rawHead)), BODY(CAT(P(""rawHead: "", rawHead, BR(), ""rawBody: "", rawBody), div, P(""%i"" % len(ss), ""%s"" % type(div)))))
```

the most interesting part, and i think it is a bug in TAG of web2py, is that it doubles the `<br />` with `<br></br><br></br>`.  and if you only make it `<br>`, without the slash, it will return the proper single `<br></br>` but then return two more `<br></br>` at the very end before the `</p>`, which totally throws off spacing if that is important.  AND finally, if you have `<br></br>`, instead of `<br />`, it doubles each by replacing it with `<br></br><br></br>`.

BUT THEN I ALSO REALIZED:::

so weird, TAG is changing `<br>` or `<br />` to `<br></br>`, which makes sense and isn't horrible.  but, firefox, IE, and safari translated that into two `<br></br>`, instead of only one.  so it really expands the carriage returns.  but i need it to conserve the br's into `<br>` or `<br/>` and not `<br></br>`.

it also seems that web2py processes the view in such a way as to conserve the br's without adding extra `</br>` end tags, but how do i render and web2pyHTMLParser without adding those extra `</br>` endings?

SO IN THE END:::
anthony on google groups said i should post this issue on github as a bug, and so i did.

lucas
"
1423,Updated pyDAL to 16.08,2016-08-13T13:39:54Z,2016-08-16T23:49:10Z,,,,
1422,"SQLFORM.grid raises KeyError for an invalid ""order"" parameter",2016-08-11T19:59:32Z,,,,,"SQLFORM.grid uses the `order` parameter to know which column needs to be sorted. Something like:

`http://.../a/c/f?keywords=&order=mytable.myfield&_signature=...`

The problem is, changing `order=mytable.myfield` to `order=mytable.myfield1` (or any random string which doesn't satisfy the `table.field` structure) raises a KeyError. 

```
File ""C:\web2py\gluon\sqlhtml.py"", line 2545, in grid
    sort_field = db[otablename][ofieldname]
```

It would be better if that line could be wrapped inside a `try/except KeyError` and just ignore the `order` parameter. 

As a workaround, until this is fixed, the following code could be inserted before calling `SQLFORM.grid`, to ignore the order if an invalid value is provided.

```
if request.vars.order is not None:
    try:
        table, field = request.vars.order.split(""."")
    except ValueError:
        request.vars.order = None
    else:
        if table.startswith(""~""):
            table = table[1:]
        if table not in db or field not in db.mytable.fields:
            request.vars.order = None
```
"
1421,Moved from controller cached function don't give any clue to the user about the issue,2016-08-08T14:17:57Z,2016-09-21T20:51:54Z,,,,"When someone move a function from once controller file to another, if this function is cached... web2py keep trying to access the moved function in the previous controller file. We don't provide any clue to the user about the problem and we don't actually include code to avoid that. I mean, we surely can make a check controller file has change and if so update cache. Or at least we should add a more detailed message then ""invalid function (default/myfunc)""... Something did you move this function from another controller if so, did you think to update cache if this function was cached previously.

Someone can reproduce this issue by creating a dummy() function with a cache decorator. Access the function view/page with a browser to load it in cache then move this function into another controller file (even without cache decorator) and access the page witht the proper controller file name... He will recieve invalid function and the controller specify will be the previous controller instead of the new controller.
"
1420,Custom 503 pages,2016-08-08T10:14:05Z,2016-08-08T22:15:05Z,,,,"Added support for custom down for maintenance pages on disabled apps to fix issue #649 as suggested by Richard:
https://groups.google.com/d/msg/web2py-developers/guV2od3TV6c/T-7ZJX6dWe
EJ
"
1419,enabled tests/test_sqlhtml.py,2016-08-07T08:58:15Z,2016-08-16T23:49:02Z,,,,"enabled tests/test_sqlhtml introduced by @BuhtigithuB 
"
1418,gluon.sqlhtml: give possibility to make options_widget if not field.requires,2016-08-06T07:01:22Z,2017-03-06T15:39:15Z,,,,"Suggestion:
    def widget(cls, field, value, **attributes):
        """"""
        Generates a SELECT tag, including OPTIONs (only 1 option allowed)

```
    see also: `FormWidget.widget`
    """"""
    default = dict(value=value)
    attr = cls._attributes(field, default,
                           **attributes)
    if '_options' in attributes and isinstance(attributes['_options'], (list, tuple)):# suggestion
        options = attributes['_options'] # suggestion
    else:
        requires = field.requires
        if not isinstance(requires, (list, tuple)):
            requires = [requires]
        if requires:
            if hasattr(requires[0], 'options'):
                options = requires[0].options()
        else:
            raise SyntaxError(
                'widget cannot determine options of %s' % (field))
    opts = [OPTION(v, _value=k) for (k, v) in options]
    return SELECT(*opts, **attr)
```
"
1417,smartgrid: form.elements '_title' should not be translated,2016-08-05T06:53:39Z,2016-08-09T12:58:09Z,,,,"Translating the '_title' prevent to do something like this in the controller: 
form.elements(_title='Add record to database', replace '')
since in the html, in French, we retreive  title = ""Ajouter un √©l√©ment √† la base de donn√©es"". So, the replacement of the _title cannot be done!.
Here under the html code :
&lt;span class=""buttontext button"" title=""Ajouter un √©l√©ment √† la base de donn√©es""&gt;Ajouter un √©l√©ment &lt;/span&gt;
"
1416,minor grammatical fix,2016-08-03T22:00:50Z,2016-08-16T23:48:46Z,,,,"Worlds smallest PR...tiny minor grammatical fix.
"
1415,grid export issue,2016-08-01T21:11:51Z,2016-08-08T19:43:47Z,,,,"https://groups.google.com/forum/#!topic/web2py/6W-jf3EPb04
"
1414,CSRF/concurrency issues with sessions in db (e.g. GAE),2016-07-31T11:40:52Z,2016-09-22T00:12:19Z,,,,"With GAE sessions are stored in database and there is no locking like with file-based sessions.

Because concurrent requests are possible, e.g. the following can happen:
1. Request 1 begins, Session is retrieved from DB.
2. Request 2 begins, Session is retrieved from DB.
3. R1 stores r1key = r1value in the Session.
4. R1 ends, Session is stored to DB
5. R2 stores r2key = r2value in the Session.
6. R2 ends, Session is stored to DB.

In the end the session does not actually contain r1key, only r2key.

This can easily happen, for example, with CSRF keys when the user opens multiple records for editing in separate tabs from a table record listing. When the user tries to save their changes (not all at once), they may be silently discarded as the CSRF key was not found in the DB anymore (related: is the silency on purpose?).

In GAE, with the lowest instance class F1, just moderate complexity will result in requests taking hundreds of milliseconds, so there is quite a large window for the issue to trigger.

I'm not immediately sure what exactly could or should be done for this. At minimum it should be documented, though.
"
1413,using web2py with Passenger,2016-07-30T13:51:47Z,2016-09-23T18:46:56Z,,,,"I'm using web2py on [Dreamhost ](https://www.dreamhost.com/)with the recommended [Phusion Passenger](https://www.phusionpassenger.com/) as the  deployment web server.  I configured the web2py [handlers/wsgihandler.py](https://github.com/web2py/web2py/blob/master/handlers/wsgihandler.py) as recommended by Dreamhost users (adding lines to launch python in a virtual environment), creating passenger_wsgi.py.  With just these edits, Passenger reported a timeout error from the application (web2py).  

The Passenger [debugging startup page](https://github.com/phusion/passenger/wiki/Debugging-application-startup-problems) notes that Passenger uses stdout for communication with the application and assumes that it is not ""closed, overwritten, or redirected"" by the application.  

Web2py overwrites stdout with stderr on line 31 in wsgihandler.py.  When I comment out this line, web2py (and Passenger) startup just fine and seem to work, although I haven't done much testing beyond startup.

So, my question is, is this line necessary?  If so, is there a fix to make this setup work properly?  If web2py requires both file descriptors pointing to the same place, maybe set stderr = stdout instead?
"
1412,GAE fake_migrate .table issue,2016-07-29T20:52:30Z,2016-09-21T21:06:07Z,,,,"If you have fake_migrate=True and define a new table, then push to GAE, you will never be able to use that new table's name for anything else because GAE doesn't offer access to a directory storing the *.table files.  Any attempt to do a regular migrate after that will show the table doesn't exist (of course) and web2py will not attempt to create a table in SQL because it thinks it already exists due to the .table file existing in web2py_filesystem on GAE.

Currently the only solution I know is to connect to Cloud SQL via IPv4 and manually delete the .table entry.
"
1411,fixes #1406,2016-07-28T19:38:51Z,2016-07-29T12:06:35Z,,,,
1410,fixes #1403,2016-07-28T19:32:04Z,2016-08-03T07:51:22Z,,,,"and yes, we don't have pywin32 dependency anymore!!!!

@gi0baro : you can fetch portalocker.py and tests as they are and include in pydal, no changes needed, except for the line importing the _compat module. If you agree, I can push a PR to pydal's repo containing these changes
"
1409,Python 2 incompatibility,2016-07-26T14:11:30Z,2016-08-08T20:18:51Z,,,,"This:

https://github.com/web2py/web2py/blob/master/gluon/sqlhtml.py#L62

doesn't quite add up - either it is `func_code` and `func_defaults` (Py2), or it is `__code__` and `__defaults__` (Py3). Crashes in Python 2.7 with AttributeError for callable classes.
"
1408,Sync master,2016-07-25T09:27:46Z,2016-07-25T14:14:04Z,,,,
1407,Single quote in ajax_error_500 message translation breaks jQuery,2016-07-24T13:45:19Z,2016-09-30T22:14:46Z,,,,"in views/web2py_ajax.html, we can read:

```
 var ajax_error_500 = '{{=T.M('An error occured, please [[reload %s]] the page') % URL(args=request.args, vars=request.get_vars) }}'
    //--></script>
```

but using a translation like: 

```
""Une erreur s'est produite, merci de [[recharger %s]] la page""
```

Produces an error in javascript because of a simple quote in a simple quote delimited string. As a consequence, jQuery is not loaded and ajax is not working.

As a workaround, I replaced the quote with a similar looking UTF-8 character, but other people may fall in the same trap.
"
1406,Disabling sessions via routes.py is broken,2016-07-23T16:03:40Z,2016-07-29T12:06:37Z,,,,"Here is the original commit allowing sessions to be disabled via routes.py: https://github.com/web2py/web2py/commit/cbcac3af70251b2ba8274e4f63f08a02dbf276fc#diff-f765c19a6807e5043a9be59d19880938R525

In main.py, that commit added three instances of `if not env.web2py_disable_session:` to conditionally run the session connecting and saving logic. However, at some point, the latter two instances of the `if` statement were removed, which causes an error when sessions have been disabled. It is not clear why those lines were removed, but they should either be restored or some alternative mechanism should be put in place to allow the disabling of sessions.
"
1405,Master,2016-07-23T03:49:02Z,2016-07-29T12:06:03Z,,,,
1404,add 'form-control' to _class of autocomplete input,2016-07-20T08:39:04Z,2016-07-29T13:42:21Z,,,,"This way it looks better because of bootstrap3 integration. 
http://getbootstrap.com/css/#forms
"
1403,portalocker crashes py3,2016-07-19T20:46:02Z,2016-09-05T21:37:30Z,,,,"need to integrate 
https://github.com/WoLpH/portalocker
or
https://sourceforge.net/p/roundup/code/ci/default/tree/roundup/backends/portalocker.py

with our own (that has ""specialized"" GAE ""additions"")
"
1402,this crashes win and 3.5,2016-07-19T20:29:12Z,2016-07-25T17:51:33Z,,,,
1401,Book DAL classes not migrated to pyDAL,2016-07-19T17:55:05Z,2016-07-28T20:04:59Z,,,,"Since pyDAL is now a separate project, there're some classes in the [Chapter 6](http://web2py.com/books/default/chapter/29/06/the-database-abstraction-layer) that are no longer inside the `gluon.sql` module. Specifically:
- `gluon.sql.Table`
- `gluon.sql.Field`
- `gluon.sql.Row`
- `gluon.sql.Rows`

Should be replaced with:
- `pydal.objects.Table`
- `pydal.objects.Field`
- `pydal.objects.Row`
- `pydal.objects.Rows`
"
1400,"fixed most of py3 warnings, output is much cleaner this way",2016-07-18T22:00:34Z,2016-07-18T23:21:24Z,,,,"same should be done with pydal (and (or?) a better ""import"" of pydal unittests)
"
1399,"fixed most of py3 warnings, output is much cleaner this way",2016-07-18T21:32:12Z,2016-07-18T21:42:20Z,,,,"the same thing should be done with pydal...
"
1398,feature parity (cron recurrence) with scheduler,2016-07-18T21:29:55Z,2016-07-25T17:50:42Z,,,,
1397,Massive memory leak in Scheduler with PostgreSQL,2016-07-18T19:09:13Z,2016-07-25T08:58:56Z,,,,"When you run Web2Py scheduler on PostgreSQL, you'll get massive memory leak to the tune of 1GB RAM consumed in 48 hours. The problem is not really a bug as such but rather a horrible design mismatch between PyDAL and the pg8000 driver.

Long story short, pg8000 driver supports multiple user-friendly placeholder formats for query arguments and converts them to the format supported by PosgreSQL server. It also expects that the number of unique query strings will be fairly limited (because the arguments will be passed separately) and stores the converted query strings and some other computationally expensive metadata in cache.

Meanwhile, PyDAL happily dumps all arguments into the query string itself, which means that every single scheduler heartbeat will turn into a unique query string and bloat the pg8000 cache.

This patch is a dirty workaround that disables pg8000 query cache. The correct solution would be rewriting PyDAL to pass query arguments through placeholders. Otherwise you're giving up a pretty big performance boost.
"
1396,webclient.py parse cookies fails if multiple cookies,2016-07-18T16:32:20Z,2016-07-29T13:54:02Z,,,,"The issue is with this code in gluon/contrib/webclient.py:

```
    # parse headers into cookies
    self.cookies = {}
    if 'set-cookie' in self.headers:
        for item in self.headers['set-cookie'].split(','):
            key, value = item[:item.find(';')].split('=')
        self.cookies[key.strip()] = value.strip()
```

If there are multiple cookies, only the last cookie is stored in self.cookies.

This commit introduced the change.

```
commit efcc2cf249c5f7cc15583b1408718f1291a8d6ba
Author: mdipierro <massimo.dipierro@gmail.com>
Date:   Tue Oct 16 06:15:45 2012 -0500

    sessions in secure cookies, session.connect(cookie_key='mypassword')
```

Previously all cookies in the 'set-cookie' header were stored in self.cookies. I don't know enough about the purpose behind that change to recommend a fix. However, just indenting the last line of that sample code solves the problem but that may be introducing side effects I am unaware of.

```
        for item in self.headers['set-cookie'].split(','):
            key, value = item[:item.find(';')].split('=')
            self.cookies[key.strip()] = value.strip()
```
"
1395,env vars in appconfig.ini,2016-07-18T07:01:33Z,2016-07-29T13:56:25Z,,,,"Environment variables support in appconfig.ini.

Discussion: https://groups.google.com/forum/m/#!topic/web2py/3x_aLR3a5iE
"
1394,Error message when not including necessary fields in SQLFORM.grid,2016-07-16T22:03:35Z,,,,,"When passing the `fields` argument to `SQLFORM.grid`, you'll receive an empty `KeyError` if you include a virtual field which required a real field to be present but it's not included in the list. For example.

```
db.define_table(""my_table"",
    Field(""real_field""),
    Field.Virtual(""virtual_field"", lambda row: row.my_table.real_field)
```

And somewhere else:

```
SQLFORM.grid(query, fields=[db.my_table.virtual_field])
```

This raises an empty `KeyError` (since `virtual_field` needs `real_field` to be present), which is caused by the line 2752 inside `sqlhtml.py`:

```
value = row[str(field)]
```

Maybe that line could be wrapped by a `try/except KeyError` and show the proper error message.
"
1393,Server stalls if file name for cache.disk() is too long,2016-07-16T13:12:41Z,2016-07-29T13:58:00Z,,,,"web2py 2.14.6:
In the interactive debugger, I get an exception, but no ticket:

Interaction at /Users/sfx/dev/mdb/web2py.app/Contents/Resources/gluon/cache.py line 473

Exception IOError: (63, 'File name too long', ""/Users/sfx/dev/mdb/web2py.app/Contents/Resources/applications/mdb/cache/05e/1cc/(Score([(u'Hosho', [u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'', u'', u'.', u'']), (u'RI', [u'3', u'', u'', u'5', u'', u'', u'3', u'', u'', u'5', u'', u'', u'3', u'', u'', u'5', u'', u'', u'3', u'', u'', u'6', u'', u'', u'3', u'', u'', u'5', u'', u'', u'5', u'', u'', u'', u'3', u'', u'3', u'', u'3', u'', u'', u'', u'', u'', u'', u'', u'3', u'']), (u'RT', [u'3', u'1', u'', u'', u'1', u'', u'3', u'', u'', u'', u'2', u'', u'3', u'1', u'', u'', u'1', u'', u'3', u'', u'', u'', u'1', u'', u'3', u'1', u'', u'', u'', u'', u'', u'', u'', u'', u'3', u'', u'3', u'', u'3', u'', u'2', u'2', u'', u'', u'1', u'', u'3', u'']), (u'L', [u'', u'1', u'', u'5', u'', u'', u'', u'7', u'', u'5', u'', u'', u'', u'1', u'', u'5', u'', u'', u'', u'7', u'', u'6', u'', u'', u'', u'1', u'', u'5', u'', u'', u'4', u'', u'', u'6', u'', u'', u'6', u'', u'', u'6', u'', u'', u'6', u'1', u'', u'6', u'', u'']), (u'B', [u'', u'', u'', u'', u'', u'', u'', u'', u'', u'', u'5', u'', u'', u'', u'', u'', u'', u'', u'', u'', u'', u'', u'6', u'', u'', u'', u'', u'', u'5', u'', u'', u'4', u'', u'', u'6', u'', u'', u'6', u'', u'', u'2', u'', u'', u'', u'', u'', u'6', u''])]), 2, 4, 240, 'ogg')"")
"
1392,Py3 fixes,2016-07-15T18:41:25Z,2016-07-16T08:01:16Z,,,,"fixed import for contrib submodule.
"
1391,"""download"" file does not include --recursive",2016-07-14T22:46:48Z,2016-07-20T19:00:27Z,,RuntimeError,"RuntimeError: web2py depends on pydal, which apparently you have not installed.","I downloaded the web2py from the source download link and I got the following error:
Traceback (most recent call last):
  File ""web2py.py"", line 21, in <module>
    import gluon.widget
  File ""c:\web2py-master\gluon__init__.py"", line 29, in <module>
    ""You can also download a complete copy from http://www.web2py.com.""
RuntimeError: web2py depends on pydal, which apparently you have not installed.
Probably you cloned the repository using git without '--recursive'
To fix this, please run (from inside your web2py folder):

```
 git submodule update --init --recursive
```

You can also download a complete copy from http://www.web2py.com.
"
1390,.att() -> .prop() for setting autocomplete off,2016-07-10T16:32:45Z,2016-07-11T07:52:24Z,,,,
1389,"Automatic creation of ""wiki_editor"" role is broken",2016-07-08T18:53:00Z,2016-07-11T07:55:53Z,,,,"The change made at https://github.com/web2py/web2py/commit/2f0de8d8a08401ff32534bd38ff9925dd9990231#diff-27d81880c098645f12c4d0f5afb17f1aL6453 needs to be reverted. The original code correctly sets the value of `gid` in all cases (whether or not the ""wiki_editor"" group already exists). However, the new code fails to define `gid` in the case where the ""wiki_editor"" group doesn't yet exist, resulting in an UnboundLocalError. It's not clear why the original code was changed, except perhaps to favor an `if/else` block over a ternary expression.
"
1388,Support to Graph Database at pyDAL,2016-07-07T22:16:58Z,2016-07-11T07:56:20Z,,,,"Are you have some planning in port some graph database to operations in pyDAL?

By example: **Neo4j** , **OrientedDB**...
"
1387,enabled py35 unittests on win,2016-07-05T16:11:11Z,2016-07-07T06:48:39Z,,,,"fixed minor issue with cacheOnDisk
"
1386,Widget - Scheduler button broken,2016-07-05T09:35:28Z,,,,,"I recently move to the latest version of web2py to try and resolve an issue with the scheduler.

However now the widget will not let me start the scheduler thread.

I have a scheduler.py file in the models folder.

I can start the scheduler by passing passing paramerter -K app_name to web2py but this is not ideal.

Any help would be appreciated.

[](http://stackoverflow.com/questions/38193768/why-is-the-option-to-start-web2py-scheduler-no-longer-working-in-widget/38195045#)

![p1](https://cloud.githubusercontent.com/assets/13583665/16580398/9a8c5f3a-42e7-11e6-8810-5992a792e99d.png)
"
1385,Changed tuple to list,2016-07-01T17:27:21Z,2016-07-02T06:04:04Z,,,,"The comparison between parts[1:3] and ('', host) would always evaluate to false because a list and a tuple were being compared.
"
1384,Open Redirect Bug,2016-06-30T21:44:07Z,2016-07-11T08:05:18Z,,,,"Please merge: https://github.com/web2py/web2py/pull/1383 to fix security vulnerability
"
1383,Fixed open redirect security vulnerability ,2016-06-30T21:35:20Z,2016-07-01T07:22:57Z,,,,"The previous filter searched for two forward slashes ""//"" in the ""_next‚Äù parameter and if the two forward slashes were found it would check the URI and determine if the hostname matched the hostname of the web server. If the hostname did not match, it would change the ""next"" variable to the None. However, browsers don't require two forward slashes. As a feature, browsers accept typos such as http:google.com or http:/google.com and redirect to http://google.com. This can be used to leverage an open redirect attack even with the current filter. This commit fixes the open redirect vulnerability in the _next get parameter. Thanks to jnbrex for helping debug/write the patch for this vulnerability.

Note: when testing this vulnerability, you must change the protocol in the URI. For example: if you are hosting the site using http, your redirect must go to a https site. Furthermore: http://web2py.com?_next=https:/malicioussite.com
"
1382,Fix next redirect if only one / exists,2016-06-30T01:04:23Z,2016-07-01T07:00:58Z,,,,"Current next= allows for redirect to an external site if a single / is entered instead of //. Example: next=http:/example.com will redirect as most browsers will fix the single slash and the function only checks for //
"
1381,corner case - fixes #1363,2016-06-28T21:55:10Z,2016-07-01T07:00:18Z,,,,
1380,removed web shell,2016-06-28T21:39:47Z,2016-07-01T06:59:54Z,,,,"again, just taking the responsibility after checking the general mood about the web shell over the years ^___^'
"
1379,put web2py on pypi,2016-06-28T20:24:01Z,,,,,"let's track this log standing issue...we need web2py on pypi!
"
1378,"fixes #1331 (just rocket, really)",2016-06-28T20:22:55Z,2016-07-01T06:56:56Z,,,,
1377,fixes #1347,2016-06-28T19:49:45Z,2016-07-01T06:56:37Z,,,,
1376,fixes #1354,2016-06-28T19:46:28Z,2016-07-01T06:56:21Z,,,,
1375,fixes #1355,2016-06-28T19:44:11Z,2016-07-01T06:56:02Z,,,,
1374,fixes #1364,2016-06-28T19:37:21Z,2016-07-01T06:55:41Z,,,,
1373,Py3 fixes,2016-06-28T16:11:20Z,2016-07-01T06:55:24Z,,,,"minor py3 fixes
"
1372,fpdf error on moving an application,2016-06-26T12:13:32Z,2016-09-30T22:30:56Z,,,,"Set's say I have an application MyApp which uses fpdf. This application is installed on a usb-stick and the drive letter is ""D"". Everything works fine. 

Now we take this usb-stick to another compter and the usb-stick gets the drive letter ""E"". fpdf fails with an error like 

```
<type 'exceptions.IOError'> [Errno 2] No such file or directory:
'D:\\MyApp\\web2py\\gluon\\contrib\\fpdf\\font\\arialnb.ttf'
```

Why? fpdf has created a file ""arialnb.pkl"" and this file contains the **absolute path** 
`D:\\MyApp\\web2py\\gluon\\contrib\\fpdf\\font\\arialnb.ttf`

**The best solution would be not to use an absolute path.**
My solution is ""quick and dirty"":

File fpdf.py, line 427 ff:

```
            name = ''
            if os.path.exists(unifilename):
                fh = open(unifilename)
                try:
                    font_dict = pickle.load(fh)
                finally:
                    fh.close()
            else:
                ttf = TTFontFile()
                ttf.getMetrics(ttffilename)
```

change to:

```
            name = ''
            ttffile_found = False  <<########
            if os.path.exists(unifilename):
                fh = open(unifilename)
                try:
                    font_dict = pickle.load(fh)
                    ttffile_found = os.path.isfile(font_dict['ttffile'])  <<#######
                finally:
                    fh.close()
            if not ttffile_found:  <<##########
                ttf = TTFontFile()
```

This solution is not very beautiful, **but it works.**

Regards Martin Wweissenboeck
"
1371,PY3 fixes ,2016-06-24T14:07:58Z,2016-06-26T05:32:09Z,,,,"- few py3 fixes
- added tests for gluon/admin.py
"
1370,errors in AutocompleteWidget with virtual field,2016-06-23T05:33:02Z,,,,,"1) global name 'Rows' is not defined
solving:

``` diff
git diff sqlhtml.py
diff --git a/gluon/sqlhtml.py b/gluon/sqlhtml.py
index b92a0ee..4db56e0 100644
--- a/gluon/sqlhtml.py
+++ b/gluon/sqlhtml.py
@@ -27,7 +27,7 @@ from gluon.html import FORM, INPUT, LABEL, OPTION, SELECT, COL, COLGROUP
 from gluon.html import TABLE, THEAD, TBODY, TR, TD, TH, STYLE, SCRIPT
 from gluon.html import URL, FIELDSET, P, DEFAULT_PASSWORD_DISPLAY
 from pydal.base import DEFAULT
-from pydal.objects import Table, Row, Expression, Field, Set
+from pydal.objects import Table, Row, Expression, Field, Set, Rows
 from pydal.adapters.base import CALLABLETYPES
 from pydal.helpers.methods import smart_query, bar_encode,  _repr_ref, _fieldformat
 from pydal.helpers.classes import Reference, SQLCustomType
```

2) error, if db argument is dbset
solving:

``` diff
diff sqlhtml.py
diff --git a/gluon/sqlhtml.py b/gluon/sqlhtml.py
index b92a0ee..7d7cc6e 100644
--- a/gluon/sqlhtml.py
+++ b/gluon/sqlhtml.py
@@ -680,7 +680,8 @@ class AutocompleteWidget(object):
             field = self.fields[0]
             if isinstance(field, Field.Virtual):
                 records = []
-                table_rows = self.db(self.db[field.tablename]).select(orderby=self.orderby)
+                _db = getattr(self.db, 'db', self.db)
+                table_rows = self.db(_db[field.tablename]).select(orderby=self.orderby)
                 count = 0
                 for row in table_rows:
                     if self.at_beginning:
@@ -743,12 +744,8 @@ class AutocompleteWidget(object):
             attr['_name'] = key2
             value = attr['value']
             if isinstance(self.fields[0], Field.Virtual):
-                record = None
-                table_rows = self.db(self.db[self.fields[0].tablename]).select(orderby=self.orderby)
-                for row in table_rows:
-                    if row.id == value:
-                        record = row
-                        break
+                record = self.db(
+                    self.fields[1] == value).select().first() if value != '' else None
             else:
                 record = self.db(
                     self.fields[1] == value).select(self.fields[0]).first() if value != '' else None
```
"
1369,cs translation: removed unwanted '@markmin' literal from translated s‚Ä¶,2016-06-22T10:22:08Z,2016-06-22T21:39:09Z,,,,"‚Ä¶trings

to avoid corrupted message after all ajax errors in cs translation.
Thanks.
"
1368,Py3 fixes4,2016-06-21T20:04:33Z,2016-06-22T21:38:59Z,,,,"- Updated pysimplesoap although it is not passing py3 web2py tests, due to https://github.com/pysimplesoap/pysimplesoap/issues/107
- few py3 fixes
"
1367,Updated user_agent_parser,2016-06-19T09:57:15Z,2016-06-19T19:15:58Z,,,,"A couple of PY3 fixes. It should be safe to merge
"
1366,Is it possible to use AppConfig with multiple ini files with the last one win if the same option is set twice?,2016-06-18T02:44:36Z,2016-06-18T10:14:58Z,,,,"This might be related to this https://github.com/web2py/web2py/issues/1093 .  The use case for this is very common.  The installer of the application creates a default config file, but the same application is also used at different stages of the workflow : development, testing, staging, etc.   These other instances need to reuse the same config values except for some exceptions. So, they read the default ini file and then another ini file that only resets the few values that needs to be changed.  OK, this is not really an issue. I just want to know if there is already a module to do that, which also uses a cache and is like a singleton when Reload = false, just like AppConfig.  
"
1365,repeats via cronline expression,2016-06-15T19:39:18Z,2016-06-18T12:49:08Z,,,,
1364,ReferenceError: web2py is not defined,2016-06-14T21:37:38Z,2016-07-01T06:55:42Z,,,,"Applying the validator IS_STRONG to a table field I noticed that I got this error in the browser console:

> ReferenceError: web2py is not defined1 web2py-bootstrap3.js:14:6

The problem is resolved applying the patch suggested [here](https://groups.google.com/forum/#!topic/web2py/cIUMfdmUC4M) by @abastardi simply rewriting the [line](https://github.com/web2py/web2py/blob/master/applications/welcome/static/js/web2py-bootstrap3.js#L14) with the code:
`$.web2py.validate_entropy($(this));`

Thanks!
    Manuele Pesenti
"
1363,XML helper and incorrect HTML,2016-06-14T18:14:00Z,2016-07-01T07:00:19Z,,,,"XML crashes while trying to sanitize some sorts of incorrect html.

For example:

```
a = '</em></em>' # wrong html
b = XML(a, sanitize=True)
```

Result:
`<type 'exceptions.IndexError'> pop from empty list`
"
1362,_default_router and args_match,2016-06-14T13:45:47Z,2016-07-11T08:20:54Z,,,,"gluon/rewrite.py

I am not sure if it is a bug, but I encountered problems when I tried to pass base64 encoded strings in url.

Current default regex is:
`args_match = r'([\w@ -]|(?<=[\w@ -])[.=])*$',         # legal arg in args`
I had to override it as below for my purposes:
`args_match=r'([\w@ -]|(?<=[\w@ -])[.=]=?)*$'`

Maybe more liberal regex should be set as a default one?
"
1361,few py3 fixes,2016-06-13T18:33:40Z,2016-06-18T12:48:39Z,,,,"A few fixes to review
"
1360,"fix request.json, close #1337",2016-06-13T16:02:28Z,2016-06-18T12:48:14Z,,,,
1359,Don't truncate texts on SQLFORM.grid HTML Export,2016-06-13T10:20:05Z,2016-07-29T13:33:25Z,,,,"Allow HTML export to display long texts.
"
1358,Don't truncate texts on SQLFORM.grid HTML Export,2016-06-13T10:08:55Z,2016-09-22T19:11:26Z,,,,"Currently ExporterHTML truncates text fields longer than 16 characters, even if maxtextlength attribute is specified in SQLFORM.

Make ExporterHTML render the whole texts, just as other format exporters do (csv, json, etc).
"
1357,fix issue#1261: security issue: gluon.tools.Expose will follow symlinks,2016-06-11T11:05:13Z,2016-06-13T00:56:40Z,,,,"Adding to Expose.**init**(..., follow_symlink_out=False).

If the user didn't override this, and if the OS supports symlinks, we
test that we will not expose any symlinks that points outside of
self.base.

Expose is now also covered by unit-tests.
"
1356,sqlite date,2016-06-10T15:00:34Z,2016-06-15T18:06:51Z,,,,"Current pydal v16.06.09 is not backward compatible since date fields in aggregated function are no longer parsed.

```
from pydal import DAL, Field
from datetime import datetime
db=DAL('sqlite:memory')
db.define_table('tt', Field('dd', 'date'))
db.tt.insert(dd=datetime.today())
r = db(db.tt).select(db.tt.dd.min()).first()
print type(r[db.tt.dd.min()])
```

returns `<type 'str'>`. With former pydal the same returned `<type 'datetime.date'>`.
@gi0baro is it due to the new refactory?
"
1355,RedisCache fails to delete cached objects when f=None,2016-06-09T19:08:57Z,2016-07-01T06:56:03Z,,,,"For background, see https://groups.google.com/d/msg/web2py/1LoXXrPlIGE/bX2u3CJ2BQAJ.

According to the book, calling `cache.model(key, f=None)` should cause `key` to be deleted from the cache. However, in `gluon.contrib.redis_cache.RedisClient.__call__`, setting `f=None` only deletes the cached object if it has expired.

This causes a problem with `@cache.action` because it relies on the `f=None` deletion method to delete pages that were cached with an invalid HTTP status.

We should change the behavior of the Redis cache to match that of the other cache models (i.e., setting `f=None` should _always_ delete the key from the cache).

Also, for extra safety, perhaps `@cache.action` should delete pages with an invalid status via `cache_model.clear(r'^%s$' % cache_key)` rather than `cache_model(cache_key, None)`.
"
1354,ldap_auth error,2016-06-08T05:26:02Z,2016-07-01T06:56:22Z,,,,"1) problem
2016-06-08 10:14:17.120 WARNING ~/web2py/gluon/contrib/login_methods/ldap_auth.py do_manage_groups:582 [username] Groups are not managed successfully!
2016-06-08 10:14:17.120 DEBUG ~/web2py/gluon/contrib/login_methods/ldap_auth.py do_manage_groups:584 Traceback (most recent call last):
  File ""~/web2py/gluon/contrib/login_methods/ldap_auth.py"", line 535, in do_manage_groups
    db_can_join = db.can_join() if hasattr(db, 'can_join') else True
  File ""~/web2py/gluon/packages/dal/pydal/base.py"", line 878, in can_join
    return self._adapter.can_join()
2) solve

``` diff
diff --git a/gluon/contrib/login_methods/ldap_auth.py b/gluon/contrib/login_methods/ldap_auth.py
index c724d66..490b6d0 100644
--- a/gluon/contrib/login_methods/ldap_auth.py
+++ b/gluon/contrib/login_methods/ldap_auth.py
@@ -532,7 +532,7 @@ def ldap_auth(server='ldap',
                     'There is no username or email for %s!' % username)
                 raise
             # if old pydal version, assume this is a relational database which can do joins
-            db_can_join = db.can_join() if hasattr(db, 'can_join') else True
+            db_can_join = db.can_join() if hasattr(db._adapter, 'can_join') else True
             if db_can_join:
                 db_group_search = \
                     db((db.auth_membership.user_id == db_user_id) &
```
"
1353,py3 compat tracking,2016-06-07T19:57:21Z,,,,,"**fix before merging #1339 (COMPLETED)**
- [x] gluon/cache.py _a more readable ""for key in storage"" would be a better pick, and will possible enable leverage future optimization in python_ **py3 incompatibility**
- [x] contrib/fpdf\* _hopefully it's exactly the 1.7.2 as latest stable in its own repo_ **yep it is**
- [x] gluon/contrib/gateways/fcgi.py _those changes IMHO will break something in 2.7 . Given the rise of uwsgi and scgi we should instead rely on the new (and supported) fcgi which in turn depends on flup. A fat warning stating that users relying on fcgi would need flup (which for python/fastcgi hosters is ALWAYS included) would seal the deal_
- [x] gluon/contrib/login_methods/ldap_auth.py _""if type(allowed_groups) != type(list()):"" got translated to ""if not isinstance(allowed_groups, type(list()))"" . **fixed**
- [x] gluon/globals.py _given the importance of the module, remember to put those #FIXME for py3 in the ""let's discuss"" recap (or clarify what is left to be decided)_
- [x] gluon/highlight.py _nothing breaks 2.7 but cgi.escape should be addressed for 3.x_
- [x] gluon/languages.py _I'd drop iterkeys() alltogether: it doesn't have any improvement over keys() or just the ""dry"" ""for key in dict"" syntax_
- [x] gluon/shell.py as contrib/shell.py: _to me those replacement are not 1:1 . That being said it's on the doctest part which is by far the least utilized part of shell.py_
- [x] gluon/utf8.py  _repr_escape_tab[i] = ur'\x%02x' % i_ **fixed**

**maybe valid, but change in behaviour**
- [x] IS_LENGTH() ?
- [ ] _uwsgi/fgci, nowadays is it visible to support only the former?_ don't think so. But I'd NOT go for altering the included fcgi.py to make it work py3 compatible, rather I'd document a flup requirement and alter fcgi.py accordingly just before releasing the first stable with py3 ""advertised"" compatibility
- [x] here and there: _""from gluon"" instead of ""from .gluon"": cheating circular imports or forgot to rewrite ?_

**curiosity**
- [x] adding current.response.static_version = None on test_router : did some behaviour change ? **test order changed**

**things to remember 1st, AFTER merging this but BEFORE new stable**
- [x] check the merge didn't swallow changes from https://github.com/web2py/web2py/commit/95c1a734d1d80ece75f8e7009cb7bd8bec3574c7 to https://github.com/web2py/web2py/commit/15a26c00b15e83daf1b234ed7533ad4fbd03be65
- [x] checking response.json() #1337
- [x] remember #fixmes in gluon/globals.py
- [x] DAL routine tests should be fixed **waiting for #1361**
- [x] IS_IP\* validators could use the ipaddress library (mostly because it's included in 3 and there is an official backport for 2.7) instead of ipaddr-py from google
- [x] on the CHANGELOG should also be reported as the very first warning that web2py DOES NOT SUPPORT ANYTHING BUT 2.7 (i.e. not only we don't officially support 2.6 but also
  we introduced changes that will surely break running on 2.6)
- [ ] We may consider adding a CHANGELOG entry for brave users to test 3.5 and report back findings
- [x] gluon/recfile.py _it has to do with the initial design concept, nothing will break 2.7 but we should really be concerned about relying on auto-closing the stream (py3 will emits warnings about it)_
- [ ] unrelated to py2, but use SemVer v2 as discussed at length on the group-chat a few months ago (PEP-440)
- [¬†] fix docstring for python 3 (ex.: print something -> print(something))

**things to remember 2nd, AFTER merging this but BEFORE advertising py3 support**
- [x] aes.py ~~@leonelcamara has a solution already~~ moved to pyaes
- [x] cache.disk on win was cited by @leonelcamara, although it seems fixed already
- [x] utf8.py dependency
- [ ] gluon/contrib/login_methods/x509_auth.py _won't work with py3, another method is needed_
- [ ] gluon/tools.py : _again, m2crypto is not available for py3_
- [ ] FIX contrib.minify
- [x] gluon/contrib/shell.py _smells funny, but this would be the 312098312 time we say web shell should not be used. Next release would probably be a REEEEEEALLY good time to drop from the admin app and let the contrib module with a big ""won't ever FIX""_
- [x] gluon/contrib/websocket_messaging.py _won't certainly break 2.7, but I'm not sure it can be considered py3 safe_ **is not py3 ready yet**
- [ ] gluon/contrib/redis_scheduler.py ~~port over cronline feature~~ **and think about travis-ci tests with redis**
- [ ] execute the entire test suite on 3.5 
- [x] enable appveyor too on 3.5
- [x] fix all dependencies --> make the web2py release fully py3 compliant
- [x] fix https://github.com/web2py/web2py/issues/1403
- [x] port web2pyDialog
- [x] debug (perhaps related to #1471)
- [x] wizard step6
- [x] update_languages
- [x] appadmin/ccache
"
1352,revert wiki to earlier (properly working) state,2016-06-07T13:12:59Z,2016-06-08T01:36:52Z,,,,"Seems wiki functionality is broken with some previous commit.
Giving back the working code from 2.14.5:

https://groups.google.com/forum/#!topic/web2py/f3UBu1t4wrQ
"
1351,SQLFORM.smargrid mistakenly deletes some kwargs that are dictionaries,2016-06-06T15:41:58Z,,,,,"See https://github.com/web2py/web2py/blob/R-2.14.6/gluon/sqlhtml.py#L3046:L3060.

```
    for key in ('fields', 'field_id', 'left', 'headers', 'orderby', 'groupby', 'searchable', 
                'sortable', 'paginate', 'deletable', 'editable', 'details', 'selectable',
                'create', 'csv', 'links', 'links_in_grid', 'upload', 'maxtextlengths',
                'maxtextlength', 'onvalidation', 'onfailure', 'oncreate', 'onupdate',
                'ondelete', 'sorter_icons', 'ui', 'showbuttontext', '_class', 'formname',
                'search_widget', 'advanced_search', 'ignore_rw', 'formstyle', 'exportclasses',
                'formargs', 'createargs', 'editargs', 'viewargs', 'selectable_submit_button',
                'buttons_placement', 'links_placement', 'noconfirm', 'cache_count', 'client_side_delete',
                'ignore_common_filters', 'auto_pagination', 'use_cursor'
               ):
        if isinstance(kwargs.get(key, None), dict):
            if table._tablename in kwargs[key]:
                kwargs[key] = kwargs[key][table._tablename]
            else:
                del kwargs[key]
```

The problem is that some of the arguments in the list above are dictionaries themselves (e.g., exportclasses, formargs, etc.), so if they are submitted on their own (i.e., not nested in a dictionary whose keys are table names), they will pass the `isinstance` test and ultimately get deleted in the `else` block.

As an alternative, maybe we can test not only whether a given kwarg is a dictionary, but that _all_ of its keys are table names:

```
    if isinstance(kwargs.get(key, None), dict) and all([k in table._db for k in kwargs[key]]):
```

If all the keys of the dictionary are names of tables in the db, then we can assume it is meant as a dictionary containing a separate argument for each table. Otherwise, we assume the argument itself is supposed to be a dictionary and let it pass through as is.

The above is just a heuristic, though. I suppose it could break down with something like `formargs`, where someone might include just a single form argument in the dictionary that happens to have the same name as one of their database tables. For a more exact approach, I suppose we could identify all the arguments that are expected to be dictionaries, and test whether they are dictionaries of dictionaries before passing them through this block of code.
"
1350,scheduler break when disconnect db,2016-06-06T13:53:26Z,2016-06-06T15:00:20Z,,Error,"Error: (<class 'socket.error'>, error(10053, ''))","scheduler will break when restart db service. i think that scheduler will auto connect to db again.

this is error log:

2016-06-06 21:48:28,260 - web2py.scheduler.whq#6492 - ERROR - Error retrieving s
tatus
Exception in thread Thread-1:
Traceback (most recent call last):
  File ""threading.py"", line 801, in __bootstrap_inner
  File ""C:\Users\root\Desktop\web2py_win\web2py\gluon\scheduler.py"", line 440, i
n run
    self.send_heartbeat(counter)
  File ""C:\Users\root\Desktop\web2py_win\web2py\gluon\scheduler.py"", line 1039,
in send_heartbeat
    db.rollback()
  File ""C:\Users\root\Desktop\web2py_win\web2py\pydal\base.py"", line 956, in rol
lback
    self._adapter.rollback()
  File ""C:\Users\root\Desktop\web2py_win\web2py\pydal\adapters\base.py"", line 13
39, in rollback
    return self.connection.rollback()
  File ""C:\Users\root\Desktop\web2py_win\web2py\gluon\contrib\pymysql\connection
s.py"", line 640, in rollback
    self.errorhandler(None, exc, value)
  File ""C:\Users\root\Desktop\web2py_win\web2py\gluon\contrib\pymysql\connection
s.py"", line 200, in defaulterrorhandler
    raise Error(errorclass, errorvalue)
Error: (<class 'socket.error'>, error(10053, ''))
"
1349, represent none,2016-06-06T10:54:15Z,2016-06-08T01:36:01Z,,,,"Gives a possibility to redefine format of None values in grid.
Default behaviour is: None, ie. exactly as earlier. Developer can set: T(""unknown"") or """" or ....
Applies in grid itselves and in record view.

Reason:
It is not convenient for the user to see ""None"" (especially in non-english applications).
Outside of grid the solution is easy like: <td>{{=employee.company or """"}}</td>
But inside the grid it is not easy for the developer set the format via represent= (especially for foreign keys, date values,..).
"
1348,concatenated string not taken into account when updating language files from admin ,2016-06-05T16:39:51Z,,,,,"Python allows to write something like:

``` #python
 msg = T('This is a very very very long message and as such'
         'it is broken on two lines')
```

But the admin tool to generate the language files erroneously generates only the string:

``` #python
'This is a very very very long message and as such': 'This is a very very very long message and as such',
```
"
1347,"gluon/scheduler.py - ""format""  in  ""db.define_table('scheduler_task',...""",2016-06-04T07:44:12Z,2016-07-01T06:56:38Z,,,,"please replace this line ""format='%(task_name)s')""
with this line ""format='(%(id)s) %(task_name)s')""
"
1346,Labels and text alignment i bootstrap3 view-only forms,2016-06-02T14:35:19Z,,,,,"Labels and data are missaligned in bootstrap3 forms for writable=False fields. Following code may solve the problem. It is in gluon/sqlhtml.py starting with line 1257:

`            if cond:

```
            if field.represent:
                inp = SPAN(represent(field, default, record))
            elif field.type in ['blob']:
                continue
            elif field.type == 'upload':
                inp = UploadWidget.represent(field, default, upload)
            elif field.type == 'boolean':
                inp = self.widgets.boolean.widget(
                    field, default, _disabled=True)
            elif isinstance(field.type, SQLCustomType) and callable(field.type.represent):
                # SQLCustomType has a represent, use it
                inp = SPAN(field.type.represent(default, record))
            else:
                inp = SPAN(field.formatter(default))`
```

SPAN is important change.
"
1345,should turn off the codecov/changes report,2016-05-31T22:51:30Z,2016-06-03T15:02:09Z,,,,
1344,Jwt renew fix,2016-05-31T22:01:54Z,2016-06-03T15:02:41Z,,,,
1343,<type 'exceptions.AttributeError'> 'PowerFormWizard' object has no attribute 'readonly',2016-05-31T19:34:01Z,2016-06-06T21:01:21Z,,,,"Just running the example to see if I want to use the more complex wizard or roll my own from your previous examples.  Got this error.  If you are aware of it great.  Thank you for everything you both do to improve our ability as programmers to deliver.
"
1342,SQLFORM.grid headers{} not working,2016-05-30T22:18:44Z,,,,,"sqlhtml.py 
for key in ('fields', 'field_id', 'left', 'headers', _...not working_
for key in ('fields', 'field_id', 'left', '$$$headers', _...it's working_
"
1341,Ignore internal attributes when checking whether new session was changed,2016-05-28T20:10:06Z,2016-06-03T15:04:00Z,,,,"The simple hash check always fails for new secure sessions because the `_secure` flag is added _after_ calculating the initial `response.session_hash`. Therefore new secure sessions will be stored even when they're effectively empty. This patch makes sure that a new session contains something _other_ than purely internal attributes before it is stored.
"
1340,cache.action() does not cache individual pages for different users,2016-05-27T21:10:26Z,,,,,"This may be more of a documentation problem than an actual bug. Anyway, the documentation of `cache.action` can be wrongly interpreted that server-side cache would take into account whether the user is logged in or not and cache the same page separately for different user accounts:

> .2. User is not considered
> 
>    Your user accesses a page often and you choose to cache it. However, you cached the result of /app/default/index using request.env.path_info as the key, so another user will see a page that was not meant for him

You should either implement some login-aware functionality for server-side cache as well (e.g. optionally ignore the `cache_model` when user is logged in) or at least clarify documentation that the `public` parameter controls only client-side browser cache and has no effect on `cache_model`.
"
1339,few lib2to3 fixes,2016-05-27T13:54:16Z,2016-06-13T01:00:22Z,,,,"A lot of  lib2to3 fixes. 
"
1338,fix wrong reference to request out of current namespace,2016-05-26T22:31:20Z,2016-05-31T22:17:20Z,,,,
1337,Getting error editing files through web when running Web2Py from source,2016-05-25T15:34:10Z,2016-06-18T12:48:16Z,,,,"Steps to reproduce error:

Install a fresh version of Mint 17.3 64-bit (Single, large ext4 '/', and a small swap partition)
Install git

```
$ sudo apt-get install git
```

Clone repo

```
$ git clone --recursive https://github.com/web2py/web2py.git
(Web2Py Commit cbd8c63b, Dal Commit 60e97e7c)
```

Run Web2Py

```
$ python web2py.py
Set password
```

Login

```
Firefox: 127.0.0.1:8000
My Sites --> Enter Password
```

Try to edit a file

```
My Sites --> Examples (Edit) --> Edit button of default.py (Under Controllers)
```

Result: A popup that says ""An error occured, please reload the page""

![web2py - mint 17 3 64-bit-2016-05-25-09-21-00](https://cloud.githubusercontent.com/assets/3195851/15545992/6ed401e2-225b-11e6-97fc-50a34a6dabda.png)

Viewing source code through the web interface works fine for any file. Editing doesn't work on any file (not just default.py).

I also tried this on Mint 17.1 64-bit, and Fedora 23, as well as the chromium browser - all give the same results.

PS. Apparently this is issue 1337 :)
"
1336,fixing dictionary changed size error on SQLFORM using extra_fields,2016-05-23T18:36:32Z,2016-05-24T03:19:29Z,,"""RuntimeError","""RuntimeError: dictionary changed size during iteration"" exception","When uses the extra_fields keyword argument in SQLFORM rises an
""RuntimeError: dictionary changed size during iteration"" exception
because is trying to remove a dictionary element while is iterating the
dict
"
1335,better breadcrumb divider for smartgrid,2016-05-20T17:11:56Z,2016-05-24T03:20:57Z,,,,"What about this minimalistic change?
Provides better divider in smartgrid:

places  >  Paris  >  campaigns  >  Edit 2016-05

instead of

places>Paris>campaigns>Edit 2016-05

160 is &nbsp
On narrow (mobile) display where breadcrumb splits into more lines it looks good too.
"
1334,Python Throws Syntax Error in extract_oracle_models.py,2016-05-20T13:59:55Z,2016-06-28T19:55:42Z,,,,"When trying to run extract_oracle_models.py, a syntax error is thrown on line 272, at the second double quotes character. 

Windows 7 x64
Python 3.5.1
"
1333,Removed unnecessary version checks,2016-05-19T18:04:39Z,2016-05-19T23:49:55Z,,,,"Also fixed 2 memory leaks in restricted.py
"
1332,nginx/uwsgi installation script: consistent services start for systemd with systemctl command,2016-05-19T17:39:25Z,2016-05-20T12:22:32Z,,,,"_I'm sorry for changes/commits from experimental branch, but I have removed form.py later; so all changes in the pull request are in the nginx/uwsgi script file only_

I have this script just tested on clean (new) cloud Debian Jessie machine.
Works well.

Before the testing I made on the machine this and only this (as root of course):

apt update
apt dist-upgrade
apt install sudo
apt install git
git clone https://github.com/web2py/web2py.git
cd web2py/scripts
chmod +x setup-web2py-nginx-uwsgi-ubuntu.sh
./setup-web2py-nginx-uwsgi-ubuntu.sh

After that both services are running and on http://xxx.xxx.xxx.xxx lives the welcome application.

Best regards, Mirek
PS: I use forpsi hosting, virtual machine 20G SSD for 1.50$ / month, and seems it is for web2py excellent.
"
1331,web2py returns 400 bad request when issuing an HTTP PATCH request,2016-05-13T06:19:01Z,2016-07-01T06:56:57Z,,,,"I am trying to run an action using HTTP PATCH request, but instead of executing the controller function, web2py simply returns HTTP error 400.

P.S. Everywhere that I read about web2py, I find only HTTP GET, POST, PUT and DELETE methods only. Are other methods even supported by web2py? If they are not enabled by default, is there any configuration to enable them?
"
1330,Added catalan plural rules,2016-05-12T14:14:45Z,2016-05-14T15:16:39Z,,,,
1329,more tests for languages module,2016-05-12T01:00:51Z,2016-05-14T15:16:21Z,,,,"removed 2.5/2.6 compatibility in test_validators.py
"
1328,added codecov setting file,2016-05-11T19:45:42Z,2016-05-14T15:16:13Z,in progress,,,"this should silence unnecessary messages from codecov. We can then adjust settings going forward
"
1327,Ditch python2.6,2016-05-11T00:08:28Z,2016-05-11T06:35:52Z,,,,"Also ditches having our own simplejson and having our own OrderedDict, in their place I created dummy modules that simply import from json and collections (hopefully we can remove them soon).
"
1326,make allows_jwt a real decorator. Tests included!,2016-05-09T22:57:44Z,2016-05-11T06:35:44Z,,,,"Makes allows_jwt behave as documented.

@niphlod otherwise argument is necessary?
"
1325,Fix #1324,2016-05-09T21:39:43Z,2016-05-11T06:35:31Z,,,,
1324,show_if is not compatible with recent pydal,2016-05-07T09:03:49Z,2016-05-11T06:35:32Z,,,,"With recent pydal refactory introduced by @gi0baro cond.op.**name** is in lower case, while before was in upper case. See https://github.com/web2py/web2py/blob/master/gluon/sqlhtml.py#L109

This breaks any app using show_if since a `RuntimeError(""Not Implemented Error"")` exception is raised.
"
1323,Cannot queue tasks from the web2py shell,2016-05-07T06:04:08Z,2016-05-09T19:22:09Z,,,,"This has been tested on the following two versions of web2py
Version 2.14.5-stable+timestamp.2016.04.14.03.26.16
Version 2.12.3-stable+timestamp.2015.08.19.00.18.03

Below are the contents of my db.py file:

<pre>from gluon.scheduler import Scheduler
db = DAL('mysql://web2py:baadal@10.0.0.111/web2py')
  scheduler = Scheduler(db)                                                          
                                                                                     
def task():
      import time
      with file('/tmp/test', 'w') as f:
          f.writelines(time.asctime())`
</pre>


and from the shell I try to queue the task like so:

<pre>scheduler.queue_task(task, repeats=5, period=30)</pre>


But this doesn't work. Upon inspection I found that the entry for the task was not being
created in the scheduler_task table.

However, making the same call from a controller or a model works fine.

Another thing noticed was that scheduled tasks are not run strictly according to the specified.
Although, I set the task to run every 30 seconds, the gap between two consecutive runs was
anything between 0 seconds to one minute.
"
1322,simplified oneall dname handling,2016-05-06T20:12:19Z,2016-05-09T05:05:06Z,,,,"len(dname.split(' ')) is less clear and efficient than dname.count(' ')
"
1321,fixed timing attack in gluon.utils.compare,2016-05-06T18:43:48Z,2016-05-09T05:04:39Z,,,,"[Timing Attacks](https://en.wikipedia.org/wiki/Timing_attack) are a class of side channel attacks in which information is leaked from systems through differences in timing. gluon.utils.compare is designed to resist timing attacks by forcing constant-time character comparisons on the inputs, but leaks information about the relative length inputs by exiting early when lengths differ.

This patch mitigates the information leak by registering early failure when lengths differ, but still executing over the arguments. Choosing one argument to make the ""max length"" is necessary, but essentially arbitrary for a single set of arguments. Across multiple sets of arguments, it is preferable to use the attacker's value to avoid exposing differences in relative length between defender values. Current code appears to use the second argument for checking user-supplied values, so it was designated the ""attacker"" value and drives the number of comparisons.

```
In [1]: import timeit

In [2]: timeit.timeit('import gluon.utils;gluon.utils.compare(""A""*40,""B""*1)',number=100000)
Out[2]: 0.32759690284729004

In [3]: timeit.timeit('import gluon.utils;gluon.utils.compare(""A""*40,""B""*20)',number=100000)
Out[3]: 0.31953907012939453

In [4]: timeit.timeit('import gluon.utils;gluon.utils.compare(""A""*40,""B""*40)',number=100000)
Out[4]: 0.9935009479522705

In [5]: timeit.timeit('import gluon.utils;gluon.utils.compare_patched(""A""*40,""B""*1)',number=100000)
Out[5]: 0.40862298011779785

In [6]: timeit.timeit('import gluon.utils;gluon.utils.compare_patched(""A""*40,""B""*20)',number=100000)
Out[6]: 0.8014039993286133

In [7]: timeit.timeit('import gluon.utils;gluon.utils.compare_patched(""A""*40,""B""*40)',number=100000)
Out[7]: 1.224052906036377

In [8]: timeit.timeit('import gluon.utils;gluon.utils.compare_patched(""A""*1,""B""*20)',number=100000)
Out[8]: 0.8001160621643066

In [9]: timeit.timeit('import gluon.utils;gluon.utils.compare_patched(""A""*20,""B""*20)',number=100000)
Out[9]: 0.7952229976654053

In [10]: timeit.timeit('import gluon.utils;gluon.utils.compare_patched(""A""*40,""B""*20)',number=100000)
Out[10]: 0.8102340698242188
```
"
1320,sync with main scheduler,2016-05-05T19:57:06Z,2016-05-09T05:03:42Z,,,,
1319,"Invalid Request when passing encoded string like ""%ED%95%9C%EA%B8%80"" as argument",2016-05-05T17:52:40Z,2017-03-18T15:17:32Z,,,,"Hi,

I would like to ticket an issue for passing encoded string as argument.

When I pass encoded string ""%ED%95%9C%EA%B8%80"" as argument, I get ""Invalid request"".

Posted on Web2py GoogleGroup, it can be browsed on https://groups.google.com/forum/#!topic/web2py/1SpFFuepeBQ

Thank you.
"
1318,Check if host is denied before verifying password,2016-05-04T18:04:33Z,2016-05-04T18:30:14Z,,,,
1317,more tests for validators,2016-05-03T01:40:28Z,2016-05-04T14:25:30Z,,,,
1316,Reporting Security Issue,2016-05-02T12:05:18Z,2016-05-04T14:25:31Z,,,,"Hello Web2py Team,

Found a security issue.Can you please guide me where I can report it privately.
"
1315,can now process tasks with huge_results,2016-05-01T20:11:53Z,2016-05-02T15:16:39Z,,,,"Added tests, too. Cleanups leftovers better, so fixes #1304 . 
"
1314,issue#1310,2016-04-30T11:01:07Z,2016-05-02T15:16:03Z,,,,"undo PR#1194
"
1313,security issue#1261: gluon.tools.Expose symlinks,2016-04-30T09:52:59Z,2016-06-11T10:32:35Z,,,,"gluon.tools.Expose will follow symlinks outside of base directory.

By default don't allow to follow symbolic links outside of the exposed
directory, unless follow_symlink_out is set to True in
Expose.**init**(...)
"
1312,security issue#1261: gluon.tools.Expose symlinks,2016-04-30T08:51:32Z,2016-04-30T09:02:11Z,,,,"gluon.tools.Expose will follow symlinks outside of base directory.

By default don't allow to follow symbolic links outside of the exposed
directory, unless follow_symlink_out is set to True in
Expose.**init**(...)
"
1311,Bug fix request,2016-04-28T14:59:38Z,2016-04-28T19:06:44Z,,,,"I am developing a Mac Desktop application using Web2py. My application
worked perfect before compilation. However, after compilation, my
custom views could not be displayed, so the generic ones were used.

I figured out that the names of the compiled views were not consistent
with the ones of the other compiled files. For example:
views_01_conglomerado_index.html.pyc

instead of:
views.01_conglomerado.index.html.pyc

I have not tried in Windows, but maybe the correction should be done as
well, yielding:

filename = ('views/%s.py' % fname).replace('/', '.').replace('\', '.')
"
1310,compiled app's views aren't executed,2016-04-27T19:41:16Z,2016-09-23T18:52:09Z,,,,"This PR https://github.com/web2py/web2py/pull/1194 broke compiled apps. 
Before reverting and releasing, I propose a reassessment of the whole compileapp.py (seems that we can order both code and ""thoughs"" once and for all). I opened a relevant discussion on web2py-developers
"
1309,expire_sessions.py in admin app,2016-04-26T16:14:08Z,2016-09-23T18:51:23Z,,,,"By default admin app in the dist  has nested directory scheme for session files
but current  expire_sessions.py in the cron directory supports the old all-in-one-directory scheme

So it confuses new customers.  
Possible actions:
- remove this example cron task to examples dir
- update it to match nested scheme
- tune admin app for old plain directory session scheme (admin is not for production - has a little sessions)
"
1308,"partial tests for appadmin, testing a bunch of other stuff in the pro‚Ä¶",2016-04-26T03:32:13Z,2016-05-02T15:13:54Z,,,,"‚Ä¶cess
"
1307,script for language files update has new param to update existing tra‚Ä¶,2016-04-25T10:14:48Z,2016-04-26T01:32:24Z,,,,"‚Ä¶nslations

Example for the new -f parameter:

scripts/lang_update_from_langfile.py -t applications/**myoldapplication**/languages/cs.py -s applications/**welcome**/languages/cs.py

If you have existing application and translation files are improved with new web2py version,
then running script without -f parameter (i.e. running old version of script):
- will add new messages from current welcome,
- will translate untranslated messages in myoldapplication with help of current welcome

But with -f parameter additionally
- existing same messages in myoldapplication will be updated from current welcome
"
1306,"improve html.py, new url_encode=True/False test, review/close #1279",2016-04-24T13:49:35Z,2016-04-24T23:44:39Z,,,,
1305,100% coverage for recfile,2016-04-21T19:02:09Z,2016-04-24T23:43:31Z,,,,
1304,Local testing scheduler fails,2016-04-21T12:22:26Z,2016-05-02T15:16:39Z,,AssertionError,AssertionError: task status completed,"# 
## FAIL: testRetryFailed (gluon.tests.test_scheduler.TestsForSchedulerRunner)

Traceback (most recent call last):
  File ""gluon/tests/test_scheduler.py"", line 351, in testRetryFailed
    self.assertEqual(a[1], True, msg=a[0])
AssertionError: task status completed

---

Ran 259 tests in 110.832s

FAILED (failures=1, skipped=1)
"
1303,Local testing soap fail with,2016-04-21T12:21:49Z,2016-04-21T13:48:52Z,,ZeroDivisionError,ZeroDivisionError: float division by zero,"testRegisterAndLogin (gluon.tests.test_web.TestWeb) ... Changed session ID welcome
Changed session ID welcome
Changed session ID welcome
Changed session ID welcome
ok
testSoap (gluon.tests.test_web.TestWeb) ... ERROR:gluon.contrib.pysimplesoap.server:Traceback (most recent call last):
  File ""/home/version_nightly/web2py/gluon/contrib/pysimplesoap/server.py"", line 184, in dispatch
    ret = function(**args)
  File ""/home/version_nightly/web2py/applications/examples/controllers/soap_examples.py"", line 26, in division
    return a / b
ZeroDivisionError: float division by zero

ERROR:gluon.contrib.pysimplesoap.server:Traceback (most recent call last):
  File ""/home/version_nightly/web2py/gluon/contrib/pysimplesoap/server.py"", line 184, in dispatch
    ret = function(**args)
  File ""/home/version_nightly/web2py/applications/examples/controllers/soap_examples.py"", line 26, in division
    return a / b
ZeroDivisionError: float division by zero
"
1302,IPV6 validators tests failing,2016-04-20T17:17:23Z,2016-06-07T14:41:58Z,,AssertionError,"AssertionError: Tuples differ: ('2001::126c:8ffa:fe22:b3af', ... != ('2001::126c:8ffa:fe22:b3af', ...","# 
## FAIL: test_IS_IPADDRESS (test_validators.TestValidators)

Traceback (most recent call last):
  File ""test_validators.py"", line 1055, in test_IS_IPADDRESS
    self.assertEqual(rtn, ('2001::126c:8ffa:fe22:b3af', None))
AssertionError: Tuples differ: ('2001::126c:8ffa:fe22:b3af', ... != ('2001::126c:8ffa:fe22:b3af', ...

First differing element 1:
Enter valid IP address
None
- ('2001::126c:8ffa:fe22:b3af', 'Enter valid IP address')
- ('2001::126c:8ffa:fe22:b3af', None)
# 
## FAIL: test_IS_IPV6 (test_validators.TestValidators)

Traceback (most recent call last):
  File ""test_validators.py"", line 980, in test_IS_IPV6
    self.assertEqual(rtn, ('2001::126c:8ffa:fe22:b3af', None))
AssertionError: Tuples differ: ('2001::126c:8ffa:fe22:b3af', ... != ('2001::126c:8ffa:fe22:b3af', ...

First differing element 1:
Enter valid IPv6 address
None
- ('2001::126c:8ffa:fe22:b3af', 'Enter valid IPv6 address')
- ('2001::126c:8ffa:fe22:b3af', None)

---

Ran 36 tests in 0.056s

FAILED (failures=2)
"
1301,admin disabled because unable to access password file,2016-04-18T15:40:06Z,2016-04-23T12:03:40Z,,,,"I implemeted a web2py upgrade to version 2.14.5 (I skipped 2 upgrades on the getup server), and 'git push' of my app (txp) to the paas getup server.
Problem: 'admin disabled because unable to access password file'
Here is how to reproduce the problem: 
https://web2py-txp.getup.io/welcome, sign in or login, then click on 'my sites' 
I get the same message from the URL https://web2py-txp.getup.io/txp/appadmin/index

Which file contains the password? In which application and in which position in the directory structure? How can I create this file? What should I put in it?

Thanks in advance for any suggestion.
Serge
"
1300,should auth.add_membership() succeed?,2016-04-17T14:29:28Z,2016-08-25T05:12:51Z,,NOTE,NOTE: I had search tools.py for any use of add_membership() like that : ,"Here :
https://github.com/web2py/web2py/blob/master/gluon/tools.py#L2400
And here:
https://github.com/web2py/web2py/blob/master/gluon/tools.py#L2402

We don't enforce required=True, notnull=True and requires=IS_NOT_EMPTY() or even better requires=IS_IN_DB(db, 'auth_user.id')

Why?

And does it makes any sens that auth.add_membership() return an membership id when it actually insert an empty record?

``` python
In [2]: auth.is_logged_in()
Out[2]: True

In [3]: auth.has_membership('user_1')
Out[3]: True

In [4]: auth.has_membership('blabla')
Out[4]: False

In [5]: auth.add_membership('blabla')
Out[5]: 2L

In [6]: db.auth_membership(2)
Out[6]: <Row {'group_id': None, 'user_id': 1L, 'id': 2L}>

In [7]: db(db.auth_group.id > 0).select().first()
Out[7]: <Row {'auth_permission': <Set (auth_permission.group_id = 1)>, 'description': '', 'role': 'user_1', 'auth_membership': <Set (auth_membership.group_id = 1)>, 'id': 1L}>

In [8]: db(db.auth_group.id > 0).select()
Out[8]: <Rows (1)>
```

NOTE: I had search tools.py for any use of add_membership() like that : 

``` python
membership_id = self.auth.add_membership('some_group')
```

And didn't find anythings that could cause a real issue... But I don't think that add_membership() should ""fail"" silently or add useless membership record...

What do you think?
"
1299,New Auth tests,2016-04-16T23:36:29Z,2016-04-18T02:27:35Z,,,,
1298,New test suite for prettydate() + fix wrong number of days for month,2016-04-16T15:49:03Z,2016-04-18T02:27:18Z,,,,"More tests!!
"
1297,Update markdown2.py 2.2.4 -> 2.3.1 (latest release),2016-04-15T16:33:41Z,2016-04-16T03:10:22Z,,,,
1296,Enhancement tools.py PEP8,2016-04-14T14:59:00Z,2016-04-16T03:10:12Z,,,,
1295,"Refactor Auth tests, new test, old implementation commented for now",2016-04-14T05:11:51Z,2016-04-16T03:09:44Z,,,,"Test of login_bare() is failing for now as login_bare() always return false, I think it is broken, see here : 
https://groups.google.com/forum/#!topic/web2py-developers/z1VgPNVgzLA
"
1294,fixes #1274,2016-04-14T02:57:40Z,2016-04-14T03:16:46Z,,,,"Fixes the problem of empty strings being stored in the database as null
"
1293,fixes #1266 and adds tests to make sure it doesn't happen again,2016-04-14T00:03:24Z,2016-04-14T03:15:53Z,,,,
1292,Some more coverage for XML() and DIV(),2016-04-13T15:44:56Z,2016-04-14T03:15:22Z,,,,
1291,Test emails with alternative text and html,2016-04-13T13:02:02Z,2016-04-13T13:27:33Z,,,,
1290,box-sizing best practice,2016-04-12T22:54:10Z,2016-04-13T13:33:29Z,,,,"This code was updated to match new box-sizing best practices. Also prefixes are pretty much dead. (quote from http://www.paulirish.com/2012/box-sizing-border-box-ftw/).

More info on https://css-tricks.com/inheriting-box-sizing-probably-slightly-better-best-practice/
"
1289,<main> semantic element IE fix,2016-04-12T21:10:02Z,2016-04-13T13:30:20Z,,,,"Some versions of Internet Explorer consider the <main> semantic element as ""unknown"". So its initial value is ""inline"".If we want the behavior of the <main> element to be the same as in other browsers, we must set it explicitly as a ""block.""
"
1288,Missing <!DOCTYPE html>,2016-04-12T20:25:19Z,2016-04-12T20:44:19Z,,,,"Of course if there is not any intentional reason to turn on ""quirks mode"" in browsers.

https://developer.mozilla.org/en-US/docs/Web/CSS/Common_CSS_Questions#Why_doesn't_my_CSS_which_is_valid_render_correctly
https://developer.mozilla.org/it/docs/Quirks_Mode_and_Standards_Mode
"
1287,Test week6,2016-04-12T15:01:55Z,2016-04-12T16:14:14Z,,,,"Took the chance to also fix a typo this week.
"
1286,Bug Report: Typo in tools.py,2016-04-12T05:33:50Z,2016-04-12T16:14:15Z,,,,"https://github.com/web2py/web2py/blob/master/gluon/tools.py#L4515

is_ctive should be is_active.  Preventing scheduler tasks from running correctly.
"
1285,Possible upload filenames truncate issue depending of filesystem,2016-04-11T01:21:18Z,2016-06-28T20:04:04Z,,,,"Here it mention about issue possibly occuring depending of the filesystem:

https://github.com/mdipierro/web2py-book/issues/277

I didn't fine any issue related to this possible problem neither for pyDAL, there is no listed issue open or close...

Not sure if it a web2py issue or pyDAL though...
"
1284,More markmin pep8,2016-04-10T13:37:19Z,2016-04-11T18:38:54Z,,,,
1283,closes #1188,2016-04-10T11:24:45Z,2016-04-11T18:38:37Z,,,,
1282,Feature/heading anchor,2016-04-09T04:18:11Z,2016-04-09T23:39:39Z,,,,
1281,Enhance markmin2html.py contrib PEP8,2016-04-09T02:13:22Z,2016-04-09T04:18:29Z,,,,
1280,Enhance gluon/html.py PEP8,2016-04-09T01:12:38Z,2016-04-09T04:37:54Z,,,,
1279,Too few arguments for format string,2016-04-09T00:54:53Z,2016-04-24T15:28:57Z,,,,"Here I found a mystake : 

https://github.com/web2py/web2py/blob/master/gluon/html.py#L387
"
1278,Pep8 welcome,2016-04-09T00:14:46Z,2016-04-09T04:37:32Z,,,,
1277,fix issue#1261: security issue: gluon.tools.Expose will follow symlinks,2016-04-08T18:33:57Z,2016-04-30T08:42:14Z,,,,"By default don't allow to follow symbolic links outside of the exposed directory, unless `follow_symlink_out` is set to `True` in `Expose.__init__(...)`

This should resolve [security issue: gluon.tools.Expose will follow symlinks](https://github.com/web2py/web2py/issues/1261)
"
1276,Improve/web2py com display,2016-04-08T18:20:09Z,2016-04-09T04:35:43Z,,,,
1275,PEP8 Recaptcha/2 docstring,2016-04-07T14:20:51Z,2016-04-09T04:35:10Z,,,,
1274,empty strings stored as NULL in db,2016-04-07T13:34:54Z,2016-04-14T03:16:47Z,,,,"https://groups.google.com/forum/#!topic/web2py/IYzhhd3eKXQ
"
1273,"Wrong <colgroup> in grid, when `selectable` option used.",2016-04-07T09:12:31Z,,,,,"I have used the IDs generated in `<colgroup>` to format grid columns in `SQLFORM.grid`. This works well, when no `selectable` option is used. However, when I use the `selectable` option, the `<colgroup>` generatad does not change while in fact the number of columns in the table changes. This results in wrong styles being applied to wrong columns. Tested in R-2.13.4 and in the latest trunk (pulled just now). 

It seems to be sufficient to add one more value in `<colgroup>` for the new first column, when `selectable` option is used. 

Krzysztof.
"
1272,New logout_bare() for shell logout and refactor test using it,2016-04-07T02:47:48Z,2016-04-07T14:17:19Z,,,,"Not exactly sure it fully correct, but tests pass...
"
1271,delete unused reserved_sql_keywords.py because the DAL uses this one ‚Ä¶,2016-04-06T22:07:30Z,2016-04-07T01:58:05Z,,,,"‚Ä¶pydal/contrib/reserved_sql_keywords.py
"
1270,Test Mail.Attachment sending test_tools.py itself,2016-04-06T19:05:14Z,2016-04-07T01:57:06Z,,,,
1269,Test Mail.Attachment by mailing test_tools.py itself,2016-04-06T16:53:56Z,2016-04-06T18:57:06Z,,,,
1268,Fix #1267 cas_login,2016-04-06T15:08:03Z,2016-04-06T18:49:28Z,,,,"function `select_host` wasn't return the selected host
"
1267,Cas broken,2016-04-06T15:03:50Z,2016-04-06T18:49:29Z,,,,"Reference
https://groups.google.com/forum/#!topic/web2py/yBxRYoQH9kQ

It seems that the security fix that involve Auth(.., host_names=...)  broke cas_login
"
1266,AttributeError: 'DAL' object has no attribute,2016-04-06T12:53:49Z,2016-04-14T03:15:53Z,,AttributeError,AttributeError: 'DAL' object has no attribute 'page',"Hello,

web2py: Version 2.14.3-stable+timestamp.2016.03.26.23.02.02
dal: 16.03

I've just updated to the last version and received the bug:
(previous version worked fine)

Table - page
Field('name', notnull=True),
Field('parent', 'integer', default=0, requires=IS_EMPTY_OR(IS_IN_DB(self.db, 'page.id', '%(name)s')),

AttributeError: 'DAL' object has no attribute 'page'
"
1265,Improve tools tests some more,2016-04-06T03:20:02Z,2016-04-07T01:57:30Z,,,,
1264,Auth.impersonate return statement broken,2016-04-05T17:10:10Z,2016-09-27T19:18:49Z,,,,"The variable user seems to be undefined on some of the possible execution paths see:

https://github.com/web2py/web2py/blob/master/gluon/tools.py#L4154
"
1263,"initial tests for scheduler.py, plus a minor fix for JobGraph",2016-04-04T21:08:25Z,2016-04-05T22:00:00Z,,,,"...and apparently nobody is running the test-suite at home ;-( dal tests required you to have a fully configured travis-like env with mysql AND postgresql available .... fixed that too.

Back on topic, this is a stub. 
Apparently extricating coverage subtleties with subprocess(es) is impossible. Any help to implement it is greatly appreciated (or else nothing called by ""executor"", albeit run, won't be reported as covered).
That being said, unittesting the behaviour of the scheduler is now possible. 
check TestsForSchedulerRunner which can be used as a testbed to implement further tests. 
The format is a decent copy/paste from w2p_scheduler_tests, which is ATM the de-facto suite for the scheduler.
This adds ~90 secs to the duration of the testsuite at each and every testclass. Theoretically we should avoid having multiple ""*Runner"" tests because at each time the env is reset and a new scheduler gets launched.
The scheduler is configured to die after 20 empty loops and albeit the heartbeat has been reduced to 1 sec, it still needs quite some time.

Of course if someone has a better alternative it's greatly appreciated too ^_^

Happy iterations.
"
1262,"initial tests for scheduler.py, plus a minor fix for JobGraph",2016-04-04T20:28:52Z,2016-04-04T20:43:47Z,,,,"of course this is a stub. 
Apparently extricating coverage subtleties with subprocess is impossible. Any help to implement it is greatly appreciated (or else nothing called by ""executor"", albeit run, won't be reported as covered).
That being said, unittesting the behaviour of the scheduler is now possible. 
check TestsForSchedulerRunner which can be used as a testbed to implement further tests. 
The format is a decent copy/paste from w2p_scheduler_tests, which is ATM the de-facto suite for the scheduler.
This adds ~90 secs to the duration of the testsuite at each and every testclass. Theoretically we should avoid having multiple ""*Runner"" tests because at each time the env is reset and a new scheduler gets launched.
The scheduler is configured to die after 10 empty loops and albeit the heartbeat has been reduced to 1 sec, it still needs quite some time.

Of course if someone has a better alternative it's greatly appreciated too ^_^

Happy iterations.
"
1261, security issue: gluon.tools.Expose will follow symlinks,2016-04-03T12:36:35Z,2016-06-13T04:09:59Z,,,,"Consider `controller/default.py` with:

```
def expose_tmp_folder():
    return dict(files=Expose('/tmp'))
```

If a user can gain write access to `/tmp` and can perform `ln -s /etc /tmp/link-to-etc`, expose_tmp_folder will happily follow that link and expose `/etc` as well.

I suggest to examine the symlink and allow it only if the target is also under base.

I attach my solution as a patch. I don't do this as a pull request because I haven't tested it sufficiently.

[web2py-gluon-tools-expose-security.patch.txt](https://github.com/web2py/web2py/files/201318/web2py-gluon-tools-expose-security.patch.txt)
"
1260,SQLFORM() basic check,2016-04-02T20:21:20Z,2016-04-09T04:34:51Z,,,,
1259,let start testing sqlhtml.py,2016-04-02T19:43:40Z,2016-04-02T20:02:02Z,,,,
1258,About OPTGROUP Helper,2016-04-02T00:27:19Z,2016-04-02T03:09:52Z,,,,"From book:

> > > print `SELECT('a', OPTGROUP('b', 'c'))`
> > > 
> > > ```
> > > <select>
> > >   <option value=""a"">a</option>
> > >   <optgroup>
> > >     <option value=""b"">b</option>
> > >     <option value=""c"">c</option>
> > >   </optgroup>
> > > </select>
> > > ```

I hope something similar to (http://www.w3schools.com/tags/tag_optgroup.asp):

```
<select>
  <optgroup label=""Swedish Cars"">
    <option value=""volvo"">Volvo</option>
    <option value=""saab"">Saab</option>
  </optgroup>
  <optgroup label=""German Cars"">
    <option value=""mercedes"">Mercedes</option>
    <option value=""audi"">Audi</option>
  </optgroup>
</select> 
```

I think a syntax that includes the label argument:

> > > print ```
> > > SELECT(  
> > >         OPTGROUP(_label='Swedish Cars', 
> > >             OPTION('Volvo', _value='volvo'),
> > >             OPTION('Saab', _value='saab'),
> > >             ), 
> > >         OPTGROUP(_label='German Cars',
> > >             OPTION('Mercedes', _value='mercedes'),
> > >             OPTION('Audi', _value='audi'),  
> > >             )
> > >         )
> > > 
> > > ```
> > > ```

```
<select>
  <optgroup label=""Swedish Cars"">
    <option value=""volvo"">Volvo</option>
    <option value=""saab"">Saab</option>
  </optgroup>
  <optgroup label=""German Cars"">
    <option value=""mercedes"">Mercedes</option>
    <option value=""audi"">Audi</option>
  </optgroup>
</select> 
```
"
1257,Improve tools tests,2016-03-31T14:16:42Z,2016-04-02T20:00:42Z,,,,
1256,made stuff prettier in examples app,2016-03-30T23:34:43Z,2016-04-02T19:59:48Z,,,,"Slightly prettier (in my opinion), but seriously we could use someone who is a professional designer to make us a new layout/appearance, it's important that a framework's webpage looks nice.

Also added myself to the contributor list :P
"
1255,enable translation for tools.Expose,2016-03-30T08:22:50Z,2016-04-03T07:01:52Z,,,,"Add T(...) for user facing strings: ""Folders"" and ""Files""
"
1254,Seriously increase template.py coverage,2016-03-30T01:36:06Z,2016-04-02T19:53:39Z,,,,"test block extend, super, delimiters, etc.
"
1253,More test coverage for validators.py,2016-03-27T13:24:38Z,2016-04-02T19:52:42Z,,,,"Fixed a bug in IS_EMAIL throwing exceptions when asked to validate anything other than a string which was problematic for ANY_OF
Fixed a bug in ANY_OF.formatter where it was trying to format with a validator that didn't validate
"
1252,Improve test chache,2016-03-26T20:42:46Z,2016-04-02T19:52:26Z,,,,
1251,More coverage and some PEP8 enhencement to html.py,2016-03-26T02:26:58Z,2016-03-26T05:00:44Z,,,,
1250,Nonsense sys.exc_info parameter of traceback.format_exc calls.,2016-03-25T19:57:16Z,2016-03-25T23:07:25Z,,,,"Replacing `traceback.format_exc(sys.exc_info)`  by `traceback.format_exc()` because the argument does not make sense in this context.
"
1249,imageutils.py missing comma bug,2016-03-25T12:45:53Z,2016-03-25T23:06:56Z,,,,"missing comma
"
1248,Oracle driver,2016-03-24T17:45:41Z,2016-03-24T17:45:47Z,,,,
1247,auth.signature doesnt gets filled if its running within a scheduler task,2016-03-24T16:12:19Z,2016-03-24T16:15:23Z,,,,"System Info:
Windows 7 64, Local rocket server, Mysql 5.5.24
Version 2.12.3-stable+timestamp.2015.08.19.00.18.03

Steps to reproduce:
-Create a user and login into your application.
-Create a table with auth.signature
-Create a function that inserts a few records using db.mytable.update_or_insert(query, **insertdata)
-Create a controller with auth.requires_login and run the function as a task using the Scheduler.
-Run the scheduler.
-Visit the controller's url to trigger the task

After the task is done auth.signature is missing created_by and modified_by fields.
"
1246,Improve PEP8 just a bit + more coverage,2016-03-24T14:16:40Z,2016-03-24T17:10:17Z,,,,
1245,Error due to outdated API call in mercurial module,2016-03-24T13:50:14Z,,,TypeError,TypeError: addremove() takes at least 3 arguments (1 given),"I created a new app, changed default controller, then selected ""Versioning"" from the admin menu in the header, entered ""Initial commit"" into the comment field and clicked the ""Commit button"".

I got an ""Internal error"" and the ticket shows this traceback:

```
Traceback (most recent call last):
  File ""/home/chris/src/web2py/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/home/chris/src/web2py/applications/admin/controllers/mercurial.py"", line 87, in <module>
  File ""/home/chris/src/web2py/gluon/globals.py"", line 417, in <lambda>
    self._caller = lambda f: f()
  File ""/home/chris/src/web2py/applications/admin/controllers/mercurial.py"", line 50, in commit
    addremove(repo)
TypeError: addremove() takes at least 3 arguments (1 given)
```

Examining `mercurial.scmutil.addremove()` shows the following signature.

```
addremove(repo, matcher, prefix, opts=None, dry_run=None, similarity=None)
```

So it seems the signature has changed and web2py is using an outdated API.

web2py is latest from Git (Version 2.14.1-beta+timestamp.2016.03.19.17.15.25) and mercurial is 3.7.2 on Arch Linux.
"
1244,Fix missing w2p_ajax_disable_with_message #1234,2016-03-24T10:23:06Z,2016-03-24T17:10:01Z,,,,
1243,Fix/admin enable disable apps,2016-03-24T09:18:06Z,2016-03-24T09:52:15Z,,,,"Fix missing w2p_ajax_disable_with_message in web2py_ajax.html
"
1242,fix some assertRaises leave commented + more coverage,2016-03-24T05:02:02Z,2016-03-24T08:03:24Z,,,,
1241,Updated pyDAL to 16.03,2016-03-23T23:39:53Z,2016-03-24T08:03:03Z,,,,
1240,test_utils inventory and new tests,2016-03-23T19:20:49Z,2016-03-24T08:02:50Z,,,,
1239,rework test_fileutils.py mostly,2016-03-23T19:20:35Z,2016-03-24T08:02:34Z,,,,
1238,"BEAUTIFY, MENU, MARKMIN and ASSIGNJS basic tests and attempt ASSIGNJS‚Ä¶",2016-03-23T02:28:17Z,2016-03-23T16:34:58Z,,,,"‚Ä¶ documentation
"
1237,teradata_like,2016-03-22T07:48:55Z,2016-03-22T08:13:26Z,,,,"Teradata LIKE syntax doesn't support ESCAPE syntax.   Also ILIKE, STARTSWITH, ENDSWITH.  Fix coming .....
"
1236,primarykey in admin form,2016-03-22T07:43:15Z,,,,,"this code works in admin form:

``` py
db.define_table('actstat', Field('actstatid', type='id'), Field('name', length=100))
```

but this - does not works in admin form

``` py
db.define_table('actstat', Field('actstatid', type='integer'), Field('name', length=100), primarykey=['actstatid'])
```

(sqlhtml.py generate invalid url)
this update is solving problem, but not generally:

``` diff
diff sqlhtml.py 
diff --git a/gluon/sqlhtml.py b/gluon/sqlhtml.py
index 58e7b16..ca2d0ba 100644
--- a/gluon/sqlhtml.py
+++ b/gluon/sqlhtml.py
@@ -3301,13 +3301,14 @@ class SQLTABLE(TABLE):
                 elif linkto and hasattr(field._table, '_primarykey')\
                         and fieldname in field._table._primarykey:
                     # have to test this with multi-key tables
-                    key = urllib.urlencode(dict([
+                    vars=dict([
                                 ((tablename in record
                                       and isinstance(record, Row)
                                       and isinstance(record[tablename], Row)) and
                                  (k, record[tablename][k])) or (k, record[k])
-                                    for k in field._table._primarykey]))
-                    r = A(r, _href='%s/%s?%s' % (linkto, tablename, key))
+                                    for k in field._table._primarykey])
+                    href = URL('update', args=['db', tablename], vars=vars)
+                    r = A(r, _href=href)
                 elif isinstance(field.type, str) and field.type.startswith('list:'):
                     r = represent(field, r or [], record)
                 elif field.represent:
```
"
1235,"Avoid issuing a separate sql query for each row in sqlform grid search results, for virtual fields",2016-03-22T05:54:07Z,2016-03-24T17:09:36Z,,,,"When deriving the value for a virtual field in a sqlform grid, this change avoids issuing a separate sql query for each row found in the search results.

Feel free to ignore the PR or simply see it as a bug report if my change doesn't make sense.

Thanks
"
1234,Impossible to disable an app from admin,2016-03-21T21:39:10Z,2016-03-29T13:05:31Z,,,,"It seems that in

`applications/admin/web2py_ajax.html`

this line is missing:

`var w2p_ajax_disable_with_message = ""{{=T('Working...')}}"";`
"
1233,importing modules from modules folder sometimes creates import error without full stack trace,2016-03-21T19:18:06Z,,,,,"# Example

```
# file modules/a.py
1/0

```

```
#file modules/b.py
import a

```

```
#file controllers/default.py
import b

```

On GAE it will give an import error but will not show the DivisionByZero error. It needs to display the full stack trace as usual.
"
1232,a space between grid button icon and text is much more beautiful,2016-03-20T18:08:10Z,2016-03-22T22:15:25Z,,,,
1231,tests for basic Mail functionality,2016-03-20T12:35:52Z,2016-03-22T22:15:06Z,,,,
1230,test_IS_IMAGE and more,2016-03-19T12:56:57Z,2016-03-19T16:29:58Z,,,,"- test for IS_IMAGE validator
- test for IS_IN_SET options
- Removed unused and undocumented IS_IN_SUBSET
- Fixed _options in IS_EMPTY_OR not passing arguments to the other options method
- Some tests for formatters
"
1229,Incorrect translation when requested en language,2016-03-19T12:27:48Z,,,,,"I think I found a bug with translations. Situation: I have language files en.py, lt.py and ru.py in my application and want to get translations in all of these languages using T('_hello_', language=...). Everything is ok except when I request en language, but can't understant why this language is considered to be different. So far I have examined that expected behaviour is get when I comment out lines 674 and 675 in gluon/languages.py (web2py: Version 2.13.4-stable+timestamp.2015.12.26.04.59.39). Sample application is atteched.
[translator.tar.gz](https://github.com/web2py/web2py/files/180805/translator.tar.gz)
"
1228,LDAP auth login method enhancements,2016-03-18T20:55:26Z,2016-03-19T01:33:56Z,,,,"1/
Allow user to pass a group mapping in manage_groups=True mode.
A group mapping is a structure like:

{
  ""ldap_grp1"": [""web2py_grp1"", ""web2py_grp2""],
  ""ldap_grp2"": [""ldap_grp2"", ""web2py_grp3""],
}

After fetching the ldap user's ldap groups, the list entries are
translated, before janitoring the auth_group and auth_membership
tables.

2/
Allow to define a callback to execute if the auth_group or
auth_membership tables are changed.

Typical use-case are cache flushing and app-driven replication.
"
1227,Update feedparser.py 5.1.3 -> 5.2.1,2016-03-18T16:06:20Z,2016-03-19T01:33:24Z,,,,
1226,Delete obsolete comment left behind,2016-03-16T20:58:45Z,2016-03-19T01:32:39Z,,,,"Comment at L111 :
         # COMMENTED BECAUSE FAILS BUT WHY?

Seems left behind and not useful anymore
"
1225,Improve test_web.py PEP8,2016-03-16T20:43:59Z,2016-03-19T01:32:16Z,,,,
1224,Improve PEP8,2016-03-16T13:39:25Z,2016-03-19T01:31:15Z,,,,
1223,Add missing helpers test,2016-03-16T02:13:52Z,2016-03-19T01:25:42Z,,,,"Some more coverage!!
"
1222,Add missing helpers test,2016-03-16T02:09:52Z,2016-03-16T02:13:27Z,,,,"Some more coverage!!
"
1221,Add missing helpers test,2016-03-16T01:59:55Z,2016-03-16T02:09:09Z,,,,"Some more coverage!!
"
1220,Improve PEP8,2016-03-15T20:49:23Z,2016-03-16T13:39:06Z,,,,
1219,Improve PEP8,2016-03-15T20:31:58Z,2016-03-15T20:49:07Z,,,,
1218,"Tests for IS_IN_DB, IS_NOT_IN_DB, IS_URL (also tests IS_HTTP_URL IS_G‚Ä¶",2016-03-15T00:01:20Z,2016-03-15T16:54:25Z,,,,"‚Ä¶ENERIC_URL)
"
1217,fixes just docstrings about usage,2016-03-14T22:33:13Z,2016-03-15T16:53:44Z,,,,
1216,create test_rocket.py with TODO inside about pathoc tests,2016-03-14T19:29:28Z,2016-03-15T16:53:29Z,,,,
1215,Improve helper test,2016-03-14T19:13:02Z,2016-03-15T16:53:11Z,,,,
1214,smartgrid example problem - add record,2016-03-14T17:42:27Z,2016-06-07T19:13:05Z,,,,"This problem is MORE FULLY DOCUMENTED here: https://groups.google.com/d/msg/web2py/IUB8C8ew1Eg/NZidjawNBwAJ

It occurs on web2py version = 2.13.4-stable+timestamp.2015.12.26.04.59.39 on both Windows10 & Linux . 

Jim S says, ""I cut your db.py, default.py and manage_songs.html code and pasted into a new app and it worked fine for me. ... So, I think your sample code is just fine.  My version is Version 2.13.3-stable"".

BOTTOM LINE PROBLEM: The Smart Grid Example Code Add Record Button yields an error when accessed from Firefox & Opera. Here are the messages.

Firefox: ""The page isn't redirecting properly. Firefox has detected that the server is redirecting the request for this address in a way that will never complete.""

Opera: ""The page isn't redirecting properly. Firefox has detected that the server is redirecting the request for this address in a way that will never complete.""

Thanks for a GREAT FRAMEWORK.

Love and peace,
Joe
"
1213,auth bug with non-standard password,2016-03-13T18:48:39Z,2016-03-14T17:27:44Z,,,,"Change password:  auth.settings.password_field='password2'
Then try to use auth.  e.g.  simply type:  auth()

In tools.py at around line 3300
     k = self.settings.register_fields.index(""password"")
password seems to be hard-coded.

Change to:
     k = self.settings.register_fields.index(passfield)

I'm not sure whether there are other instances of password being hard-coded but the above change seems to help. 

Best wishes,  villas
"
1212,Order tests to match validators.py and flag missing tests,2016-03-11T02:58:40Z,2016-03-14T16:54:18Z,,,,
1211,Better test coverage for the validators module,2016-03-10T19:36:54Z,2016-03-14T17:17:38Z,,,,"I didn't test for these lines in date formatters:

```
    if year < 1900:
        year = 2000
```

Because I don't know what the hell they're doing there anyway.
"
1210,nginx/ubuntu deploy script: added uWSGI Emperor configuration,2016-03-10T09:44:43Z,2016-03-14T16:52:49Z,,,,"I send the last (third) thing too,
so you can Accept or Reject.
"
1209,new script to update untranslated messages from other language file,2016-03-10T08:50:49Z,2016-03-14T17:18:05Z,,,,
1208,updated czech translation (in admin and welcome),2016-03-10T08:41:45Z,2016-03-14T16:51:10Z,,,,"so again,
and I hope better/properly now: separate pull requests for
- czech translation
- script for updating the translation

(and nothing for: nginx)
"
1207,"fixes the same bugs reported in #1191 for the ""standard"" scheduler",2016-03-09T23:01:45Z,2016-03-14T16:50:49Z,,,,
1206,Update All Languages does not include Markmin strings,2016-03-09T09:20:45Z,2016-03-19T18:03:04Z,,,,"I've been trying to figure out why some strings in my website aren't showing up in the language files.  After digging around, I found out that the admin panel's ""Update All Languages"" does not include any Markmin `T.M()` strings.  Is there an easy way to tell the function to include Markmin strings, preferably without modifying Gluon?
"
1205,RCE vulnerability in default applications,2016-03-08T18:49:12Z,2016-03-19T07:56:49Z,,,,"There are two vulnerabilities in sample code. A production server contained default applications could cause Remote Code Execution attack. The official site (web2py.com) is also affected.

According to the policy of [Reporting Security Bugs](http://web2py.com/books/default/chapter/29/15/helping-web2py), I can't describe more detail. To those web2py users: REMOVE default applications in production server is the safe way.
"
1204,minor auth.add_membership bug,2016-03-08T14:20:32Z,2016-03-14T17:32:44Z,,,,"When using auth.add_membership with role parameter the user groups are not updated in the session. Easy fix is to always execute
self.update_groups()
"
1203,list:reference IS_IN_DB Validation Error,2016-03-08T12:35:25Z,2016-03-14T17:35:28Z,bug,,,"To replicate,  please do this:
1. Make a new app with latest Web2py source.
2. Paste this at the bottom of models/db.py

db.define_table('tag',
    Field('name'),
    Field('descr',length=50),
    format='%(name)s',
    )

db.define_table('docstore',
    Field('name'),
    Field('tags','list:reference tag'), 
    )   

if not db(db.tag.id>0).count():
    db.tag.insert( name = ""A"",  descr = ""A Descr"" )  
    db.tag.insert( name = ""B"",  descr = ""B Descr"" )  
    db.tag.insert( name = ""C"",  descr = ""C Descr"" ) 
1. Use Appadmin to add a record to docstore table.
"
1202,Site renewal,2016-03-06T17:58:05Z,2016-03-19T07:55:03Z,,,,"The website has an oldish style, as much that it seems almost unmaintained. @mdipierro can we move to your (no offense ;-) ) stupid.css?
"
1201,"Czech translations (admin,welcome) + small script for translations + nginx/uwsgi/ubuntu script",2016-03-04T16:51:38Z,2016-03-14T12:37:28Z,,,,"Hi Massimo and others.
I am sorry, I am not able split the push request into smaller pieces.

So, what is here:
1. newer cs.py in admin and welcome.
2. script to set untranslated messages in translation file from another one (if you want update application file from newer version of welcome file, if you start translation for very similar language, and so on).
3. nginx/uwsgi/ubuntu script for systemd (creates /etc/systemd/system/emperor.uwsgi.service as described here: https://groups.google.com/forum/#!topic/web2py/ZM9IIEjtHSI + uses: service..start/service..stop)
   This worked good for me at forpsi virtual debian 8.
   However I am not good in shell scripting. So some review and testing here would be good. But no idea how to do it.
   Especially mkdir commands: what happens if directories already exist. I think it generates no fatal failure, but warnings.

No problem if something or all is acceptable. It is just first attempt with pull request here.
If later I will sure create separate pieces.
Thank you.
Mirek Zvolsky
"
1200,Updates to store files in standard locations.,2016-03-04T02:16:26Z,2016-03-04T02:26:56Z,,,,"The NGINX and uWSGI automated install are to be updated so that the web2py files are stored in the following:

|  |  |
| --- | --- |
| Web2Py supporting files | /opt/web2py |
| UWSGI config files | /opt/web2py/uwsgi |
| Web2Py web files | /srv/web2py |
| Web2Py applications | /srv/web2py/applications/{application} |
| Web2Py logs | /var/log/web2py/{uwsgi.log |
| Web2Py service pid | /var/run/web2py.pid |
| Web2PY service file | /etc/init/web2py.conf |

Also, uwsgi-emperor will no longer be installed in favor of a local installation of uWSGI in the self-contained python installation that will be installed in /opt/web2py. 
"
1199,Update imageutils.py,2016-03-02T02:29:09Z,2016-03-08T22:37:20Z,,,,"Adding a padding argument into imageutils RESIZE, the goal is to allow a padding transparent/white border on pictures when being resized in different aspect ratio. So if you add a picture that is wide and you want to square it (but not distort it), with padding argument set to true, white/transparent will be added to the top and bottom of the picture so it becomes squared sized (or any other aspect ratio you desire).
"
1198,strange behaviour SQLFORM.factory when edit,2016-02-29T20:27:56Z,2016-03-01T11:27:27Z,,,,"Hi,

I am using SQLFORM.factory to update 2 tables at the same time. The issue is when I am trying to edit the form with the info I have already in the database, for 'list:string' and 'upload' types. SQLFORM.factory does not display these types as SQLFORM do.  For the next example I am using one table, due to it is the same behaviour. 

In model I have the next table:

```
 db.define_table('car',
            Field('name', 'string'),
            Field('picture', 'upload'),
            Field('color', ""list:string"", requires=IS_IN_SET(('red','blue'))),
            Field('tag','list:string'),
            Field('extras', ""list:string"", requires=IS_IN_SET(self._get_extras(), multiple=True)),
```

Now from a controller I do:

```
# Get the ID, and look into the database for the info to display
form = SQLFORM.factory(db.car)
form.vars.name = row.name
form.vars.picture = row.picture
form.vars.color = row.color
form.vars.tag = row.tag
form.vars.extras = row.extras
return dict(form=form)
```

The result is:
- For `name` it works. It appears the input field with the current value in the database.
- For `extras`, it works as expected.
- For `picture`, It does not display the picture, and the form ask you to upload again.
- For `color`, It does not display the current data and it force to select one more time one option.
- For `tag`, It does not display the current data, so even you can not delete the tags you have created before.

Is this the expected behaviour for SQLFORM.factory? is there another way to edit info with SQLFORM.factory or update several tables at the same time?
"
1197,Updating form.vars does not work,2016-02-29T11:03:40Z,2016-03-08T21:26:55Z,,,,"Hello!

I'm trying to save the original name of an uploaded file. I use the code from here:
http://web2py.com/books/default/chapter/29/07/forms-and-validators#SQLFORM-and-uploads

When debugging, it seems that the value in form.vars.org_name gets overwritten with """" when form.process() is called.

For me this is a very critical bug since I need to process the file with its original filename. Any fix or workaround is higly appreciated.

Thank you 

Here my db:

`db.define_table('ck_client',
    Field('description', type='string', requires = [IS_NOT_EMPTY(error_message='cant be empty'), IS_ALPHANUMERIC(error_message='must be alphanumeric')] ),
    Field('ip', unique=True, type='string', requires = [IS_IPV4(error_message='must be ip'), IS_NOT_IN_DB(db, 'ck_client.ip')]),
    Field('mac', unique=True, type='string', requires = [IS_MATCH('^([0-9A-Fa-f]{2}[:]){5}([0-9A-Fa-f]{2})$', error_message='must be mac'), IS_NOT_IN_DB(db, 'ck_client.mac')]),
    Field('uuid', unique=True, type='string', requires = [IS_MATCH('([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}?)', error_message='must be uuid'),IS_NOT_IN_DB(db, 'ck_client.uuid')]),
    Field('enabled', type='boolean', default=True),
    Field('enabled_from', requires = IS_TIME(error_message='must be time!'), default='00:00'),
    Field('enabled_to', requires = IS_TIME(error_message='must be time!'), default='00:00'),
    Field('deleted', type='boolean', default=False),
    Field('org_name', type='string'),
    Field('bootimage', type='upload'),
    format='%(name)s')
`

Here the controller:

`@auth.requires_login()
def client_create():
    db.ck_client_new.default = request.args(0)
    form = SQLFORM(db.ck_client_new, keepvalues=True)
    form.add_button('Cancel', URL('clients'))
    if request.vars.bootimage != None:
        form.vars.org_name = request.vars.bootimage.filename
    if form.process().accepted:
        response.flash = 'form accepted'
    elif form.errors:
        response.flash = 'form has errors'
    return locals()
`
"
1196,Host header vulnerability,2016-02-26T04:19:44Z,2016-03-21T06:22:20Z,,,,"Forget password and user verification code has host header vulnerability.

Attacker can generate user verification and password reset request from the server including his own domain.

file: gluon/tools.py

``` python
    def url(self, f=None, args=None, vars=None, scheme=False):
        if args is None:
            args = []
        if vars is None:
            vars = {}
        return URL(c=self.settings.controller,
                   f=f, args=args, vars=vars, scheme=scheme)
```

here scheme if true uses host header to generate urls that is bad.

possible solution
file: gluon/tools.py

``` python
    def url(self, f=None, args=None, vars=None, scheme=False):
        if args is None:
            args = []
        if vars is None:
            vars = {}
        return URL(c=self.settings.controller,
                   f=f, args=args, vars=vars, scheme=False, host=self.settings.host_name)
```

also add the setting for host_name variable in Auth class

file: gluon/tools.py

``` python
class Auth(object):
    default_settings = dict(
        hideerror=False,
        password_min_length=4,
        cas_maps=None,
        host_name = '',
        reset_password_requires_verification=False,
```

Now this variable can be set in db.py
file: db.py

``` python
auth.settings.host_name = myconf.take('host.hostname')
```

and then host_name can be abstracted in appconfig.ini

file: appconfig.ini

``` shell
[host]
hostname = www.google.com
```
"
1195,fixes #1191,2016-02-23T22:28:04Z,2016-02-25T19:59:14Z,,,,"fix is in lines 828-835 . needed to backport total_seconds for py2.6
(694-701).
everything else is just pep8.
"
1194,invalid view for purely compiled app,2016-02-22T12:44:39Z,2016-03-08T22:38:35Z,,,,"When packing a compiled app, and distributing it without the non-compiled views, run_view_in(...) searches only the old style compiled view file: e.g. views_default_index.html.pyc and not in views.default.index.html.pyc, resulting in ""invalid view (default/index.html)"" 404 Exception.
"
1193,Fixed a bug whereby calling 'delete_record()' on a row object caused ‚Ä¶,2016-02-21T06:23:43Z,2016-03-08T22:39:54Z,,,,"‚Ä¶an AttributeError.

The error is reproducible by creating an SQLFORM and specifying the 'deletable' parameter as a callback.  Upon deletion Web2Py will encounter an AttributeError because there is no such attribute of 'delete_record' for the 'record' object.  I simply copied the behavior of the block  where deletable is NOT callable by overwriting a single line of code.  This could be simplified, but I am not experienced enough with the DAL to do such a thing.
"
1192,Auth.get_or_create_user does not pass the correct object to register_onaccept,2016-02-21T05:47:41Z,2016-03-19T19:21:23Z,,,,"The `register_onaccept` callback expects a form object, which should include a `.vars` attribute containing all of the user fields, including the `id`. Instead, `Auth.get_or_create_user` passes a dictionary of user fields (excluding the `id` field). This means a callback written to work with the standard form-based registration will not work when calling `Auth.register_bare` (which uses `Auth.get_or_create_user`).

A fix would be for `Auth.get_or_create_user` to pass a `Storage` object with a `.vars` attribute containing the `user` Row object (which includes the `id` field).

See http://stackoverflow.com/questions/35504306/web2py-how-to-programmatically-register-users/35518991?noredirect=1#comment58754615_35518991.
"
1191,Scheduler - Prevent Drift and Failed Runs - Next Run Time not progressing.,2016-02-21T04:14:34Z,2016-02-25T19:59:16Z,,,,"Please refer to this thread over on the main web2py usergroup. https://groups.google.com/forum/#!topic/web2py/khykEwJJrmY

I believe that there is a bug in gluon/scheduler.py which is causing tasks that utilize the Prevent Drift option to run repeatedly when a run fails. Prevent Drift utilizes a times_run variable when calculating when the next run should occur, however when tasks do not complete successfully this count does not currently get incremented which means that the next run time doesn't get moved forward and thus the task just gets picked up again almost immediately.  Review of the relevant source code suggests to me that the error is occurring in the section between lines 911 and 932 and that a new line should be inserted between lines 930 & 931 to update the times_run value as is done on line 914 for successful runs.

```
#gluon/scheduler.py starting at line 911
        if task_report.status == COMPLETED:
            d = dict(status=status,
                     next_run_time=task.next_run_time,
                     times_run=task.times_run,
                     times_failed=0
                     )
            db(st.id == task.task_id).update(**d)
            if status == COMPLETED:
                self.update_dependencies(db, task.task_id)
        else:
            st_mapping = {'FAILED': 'FAILED',
                          'TIMEOUT': 'TIMEOUT',
                          'STOPPED': 'FAILED'}[task_report.status]
            status = (task.retry_failed
                      and task.times_failed < task.retry_failed
                      and QUEUED or task.retry_failed == -1
                      and QUEUED or st_mapping)
            db(st.id == task.task_id).update(
                times_failed=db.scheduler_task.times_failed + 1,
                next_run_time=task.next_run_time,
                times_run=task.times_run, #<-- Insert this line to fix
                status=status
            )

```

Please review this suggested bug fix and consider for inclusion.
"
1190,autocomlete widget fix,2016-02-19T04:16:58Z,2016-09-23T18:51:56Z,,,,"``` diff
diff --git a/gluon/sqlhtml.py b/gluon/sqlhtml.py
index 6adc4d1..097c737 100644
--- a/gluon/sqlhtml.py
+++ b/gluon/sqlhtml.py
@@ -736,7 +736,7 @@ class AutocompleteWidget(object):
         if self.is_reference:
             key2 = self.keyword + '_aux'
             key3 = self.keyword + '_auto'
-            attr['_class'] = 'string'
+            attr['_class'] = 'string form-control'
             name = attr['_name']
             if 'requires' in attr:
                 del attr['requires']
```
"
1189,Question: example date genesis,2016-02-18T13:50:43Z,2016-02-18T13:54:33Z,,,,"I came across a validator error while messing with web2py:
Enter date and time as 1963-08-28 14:30

It got me really curious, why did you decide to use this date instead of common 1970-01-01? 
"
1188,[Feature Request] Pass onvalidation dict to smartgrid,2016-02-18T13:41:28Z,2016-04-11T18:38:39Z,,,,"As per [this thread](https://groups.google.com/forum/#!topic/web2py/WG28up_5YCs) on the forums, a smartgrid can be passed a limited set of params as dict to be passed to child grids. However, onvalidation isn't part of the params that can be passed to child grids via a dict. 

This is problematic because then it means a child grid created cannot have any custom validation done, for instance, to enforce multi-column unique constraints. 

I humbly request that onvalidation be part of the smartgrid params that can be passed to child tables via a dict.
"
1187,syntax error in autocomplete,2016-02-17T11:18:47Z,2016-03-14T17:45:10Z,,,,"``` diff
diff --git a/gluon/sqlhtml.py b/gluon/sqlhtml.py
index c7d4530..0285c1a 100644
--- a/gluon/sqlhtml.py
+++ b/gluon/sqlhtml.py
@@ -677,7 +677,7 @@ class AutocompleteWidget(object):
     def callback(self):
         if self.keyword in self.request.vars:
             field = self.fields[0]
-            if type(field) is FieldVirtual:
+            if type(field) is Field.Virtual:
                 records = []
                 table_rows = self.db(self.db[field.tablename]).select(orderby=self.orderby)
                 count = 0
```
"
1186,"Command line option ""-M"" not create databases dir",2016-02-16T23:13:07Z,2016-03-19T18:12:30Z,,IOError,IOError: [Errno 2] No such file or directory: 'applications/pnp/databases/sql.log',"In a clean deploy: 
- Do not load http://127.0.0.1/ (or the corresponding url) on your browser
- Run your script for database population  ( eg python2.7 web2py.py -v -S pnp/ -M -R my_script.py ) 
  The system **does not create databases/ directory, and fails**.  I run with with -M option since I want create the model.

The  exception is:

```
Traceback (most recent call last):
  File ""/home/pnp/pnp/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""applications/pnp/models/db.py"", line 65, in <module>
    auth.define_tables(username=True, signature=False)
  File ""/home/pnp/pnp/gluon/tools.py"", line 2333, in define_tables
    format='%(username)s'))
  File ""/home/pnp/pnp/gluon/packages/dal/pydal/base.py"", line 834, in define_table
    table = self.lazy_define_table(tablename,*fields,**args)
  File ""/home/pnp/pnp/gluon/packages/dal/pydal/base.py"", line 873, in lazy_define_table
    polymodel=polymodel)
  File ""/home/pnp/pnp/gluon/packages/dal/pydal/adapters/base.py"", line 480, in create_table
    query), table)
  File ""/home/pnp/pnp/gluon/packages/dal/pydal/adapters/base.py"", line 212, in log
    logfile = self.file_open(table._loggername, 'ab')
  File ""/home/pnp/pnp/gluon/packages/dal/pydal/adapters/base.py"", line 155, in file_open
    fileobj = portalocker.LockedFile(filename,mode)
  File ""/home/pnp/pnp/gluon/packages/dal/pydal/contrib/portalocker.py"", line 118, in __init__
    self.file = open(filename, mode.replace('w', 'a'))
IOError: [Errno 2] No such file or directory: 'applications/pnp/databases/sql.log'
```

If I create the databases/ directory first than the script ,**the execution runs normally.**
"
1185,Compiled application doesn't handle default controllers well,2016-02-16T05:59:15Z,2016-03-19T18:16:41Z,,,,"If I run 'compile application' from the admin menu, controller files get written out like `controllers.default.version.pyc`. If I visit `/version` in the browser I get a 404, because web2py is looking for a file called `controllers.version.index.pyc`.

`compileapp.py:compile_controllers` should handle the default controllers specially to preserve the URL routing.

(In particular, this is a pain given the [difficulty](http://stackoverflow.com/questions/26434323/remove-default-controller-from-auth) of having the magic Auth/user behaviour happen on a non-default controller.)
"
1184,'Compile application' doesn't compile modules,2016-02-14T23:30:11Z,2016-04-12T20:21:59Z,,,,"Is there a reason or they just haven't been added to  `compile_application` yet?

Thanks.
"
1183,auth.wiki links wiki/ and wiki/index/,2016-02-10T11:24:50Z,,,,,"Navigation to
**wiki/index/index**
**works fine**

However navigation to
**wiki** or **wiki/index**
renders the **links** on the page as **corrupted**:

Instead of wiki/index/something
the links are: wiki/something.

This can be fixed in controller:
def index():
    if not request.args:
        redirect(URL('wiki', 'index', args='index'))
    return auth.wiki()

However it would be better fix this in the code.
"
1182,Update ldap_auth.py,2016-02-04T21:42:59Z,2016-02-07T06:14:31Z,,,,"In regards to comments in:

https://github.com/BuhtigithuB/web2py/commit/0036d9c45bdf476d858fa00dd69e854c4623858b

And: 

https://github.com/web2py/web2py/issues/1178
"
1181,Bug: Empty queries do not trigger common filters when using multitenancy,2016-02-04T17:59:29Z,2016-02-09T09:12:50Z,DAL,,,"db().select(db.table.ALL) will return _all_ records regardless of whether the table records belong to the default tenant or not.

To get around this, you can do this:
db(db.table).select()

This is a minor gripe, but it is very possible to query across tenants unintentionally. 
"
1180,Bug: auth.login() clears response.post_vars,2016-02-04T17:56:27Z,2016-03-19T18:20:28Z,,,,"When using auth.login() in its own action, response.post_vars becomes an empty storage object after the call, so when submitting the login form, the post_vars are not available below the call. 

`def login():`
    `print response.post_vars #prints them fine when submitting the form`
    `form = auth.login()`
    `print response.post_vars # prints Storage({})`
"
1179,Feature Request: Add multi-field authentication using multitenancy,2016-02-04T17:51:19Z,,,,,"I suggest a feature in which auth allows you to have users with the same username/email under different tenants when using multi-tenancy.  Currently, multi-tenancy still enforces unique usernames across the application.  
"
1178,LDAP / AD Login method updating Auth table issue.,2016-02-02T15:45:05Z,2016-02-09T09:13:23Z,,,,"Currently with LDAP / AD when I have user sign in it create two rows in the auth table records.
Users would have to sign in initally and log out and log back in for the application to have group records  and such attached to the appropriate auth record.

Previously worked @ ver. 2.12.3

please see the following for additional details: https://groups.google.com/forum/#!topic/web2py/o2BY16DPVZM 

What I did to resolve was:

ldap_auth.py ~line 425 added "" 'username': username "" to the ""update_or_insert_values"" dictionary 

update_or_insert_values = {'first_name': store_user_firstname,
                                           'last_name': store_user_lastname,
                                           'email': store_user_mail,
                                           'username': username}

ldap_auth.py ~line 429 added "" ,'username' "" to the fields array

fields = ['first_name', 'last_name', 'email','username']

After that only 1 row is created.   And a new single sign in works without the need to log out and back in.

I am not a programming method wizard.  I don't know how this fix affects the other methods besides 'ad' in the LDAP module as what I changed is in the scope of the 'if manage_user:' block ~line 402

Additional info:

How I call LDAP / AD:
# http://www.computerperformance.co.uk/Logon/LDAP_attributes_active_directory.htm
# http://www.web2pyslices.com/slice/show/1468/how-to-set-up-web2py-ldap-with-windows-active-directory
# http://www.web2pyslices.com/slice/show/1715/authentication-and-group-control-with-active-directory-ldap
# ldap authentication and not save password on web2py

from gluon.contrib.login_methods.ldap_auth import ldap_auth
auth.settings.login_methods = [ldap_auth(mode='ad',
   manage_groups= True,
   db = db,
   manage_user = True,
   user_firstname_attrib = 'cn:1',
   user_lastname_attrib = 'sn',
   group_member_attrib = 'member',
   group_filterstr = 'objectClass=Group',
   server='corp.something.com',
   base_dn='DC=corp,DC=something,DC=com')]
"
1177,"Only first referenced Field in ""Row""",2016-02-02T15:26:19Z,2016-02-09T09:14:07Z,DAL,,,"The worst issue title ever.

If a table has multiple references to another , only the first field is shown in Row.

DB example:

```
db.define_table('uploads',
    Field('filename',type='string'),
    Field('upfile', type='upload'....))

db.define_table('articles',
    Field('name',type='string'),
    .....
    Field('image',type='reference uploads'),
    Field('video',type='reference uploads'),
    Field('another_multiupload_field',type='list:reference uploads'))
```

Query example:

```
row = db.uploads[id]
```

""result"" example:

```
<Row {'articles': <Set (articles.image = 19)>, 'caption': 'test', 'filename': 'test.png', 'up_date': datetime.datetime(2016, 2, 2, 12, 5, 59), 'upfile': 'uploads.up_file.85fb76559aef61ec.6d6f727269636f6e652e6d7033.png', 'id': 19L, 'thumbnail': None}>
```

What I'm ""expecting"" from the query:

```
<Row {'articles': [<Set (articles.image = 19)>,<Set (articles.video = 19)>,<Set (articles.another_multiupload_field = 19)>], 'caption': 'test', 'filename': 'test.png', 'up_date': datetime.datetime(2016, 2, 2, 12, 5, 59), 'upfile': 'uploads.upfile.85fb76559aef61ec.6d6f727269636f6e652e6d7033.png', 'id': 19L, 'thumbnail': None}>
```
"
1176,Added virtual field support to autocomplete widget,2016-01-30T15:20:35Z,2016-02-07T06:14:22Z,,,,"Added support to use Virtual Fields in autocomplete widget.

Gotchas:
- Using Virtual Fields is slower than normal fields.
- Virtual Fields must be declared with name and table_name attributes.
"
1175,Merge pull request #1 from web2py/master,2016-01-30T14:49:07Z,2016-01-30T15:17:56Z,,,,"Update from original
"
1174,extend login with extra fields proposal - needs review,2016-01-29T05:10:21Z,,,,,"https://groups.google.com/forum/#!topic/web2py/cQg9bBZwQQY
"
1173,Double-inheritance fail,2016-01-27T05:54:15Z,2016-01-27T08:41:46Z,,,,"These double-inheritance models

``` python
db.define_table('a',
    Field('a_name', notnull=True, length=128),
)
db.define_table('b',
    Field('a', type='reference a', ondelete='NO ACTION', notnull=True, unique=True),
    Field('b_name', notnull=True, length=128),
    primarykey=['a'],
)
db.define_table('c',
    Field('b', type='reference b', ondelete='NO ACTION', notnull=True, unique=True),
    Field('c_name', notnull=True, length=128),
    primarykey=['b'],
)
```

cause exceptions.KeyError 'foreign_key'
"
1172,Fixed error with oneall login when login provider doesn't send user's full name,2016-01-17T21:57:13Z,2016-01-30T04:20:51Z,,,,"Sometimes the login provider (for instance reddit.com) does not send user's full name and all we have is its username. In this case web2py's oneall login module was crashing because it expected name in ""givenname familyname"" format. 
"
1171,Fix #1170 by reverting fix to #1043,2016-01-16T09:05:09Z,2016-01-30T04:20:26Z,,,,"The problem is only a styling issue and not a HTML one.

It was solved  in 864dbe73f251110ea690978d73d510beaeb31364 by adding a `readonly` class to labels which allow for properly vertical align with CSS.

This reverts commit 353db90a64433d384aa27d1f2043536d6d8f76ce which add
specific HTML for some filed types and which breaks display of comments.
"
1170,Correction of #1043 which breaks comments,2016-01-16T08:57:58Z,2016-01-30T04:20:28Z,,,,"#1043 introduce a specific case of HTML for some field types when in readlonly mode, but it loses comments and give inconsistency when forms contains strings and A elements (some have comments and other have not).

The problem is only a styling issue and not a HTML one. 

It was solved later in 864dbe73f251110ea690978d73d510beaeb31364 by adding a `readonly` class to labels which allow for properly vertical align with CSS.

I propose to revert 353db90a64433d384aa27d1f2043536d6d8f76ce.
Tested locally and vertical alignment between field and label is ok, and the help text is preserved among all fields.

I can make a PR if needed.
"
1169,"PEP8 enhancements, improve docstring and some vars rename",2016-01-14T17:30:01Z,2016-01-30T04:18:28Z,,,,"Hope it works now...
"
1168,"PEP8 enhancements, improve docstring and some vars rename",2016-01-14T17:09:39Z,2016-01-14T17:28:58Z,,,,"@niphlod : New PR if you prefer to pull...
"
1167,"PEP8 enhancements, improve docstring and some vars rename",2016-01-14T16:20:34Z,2016-01-14T16:26:38Z,,,,
1166,Make SessionSetDb.get() a generator.,2016-01-11T22:10:30Z,2016-01-30T04:18:18Z,,,,"Make the same change for SessionSetDb that's in SessionSetFiles: Make get() a generator, so that memory doesn't get blown out if there are 18 million sessions there to clean up.
"
1165,Admin flash/alert message not working under 2.13.4,2016-01-08T18:16:27Z,2016-02-09T09:14:28Z,,,,"flash become w2p_flash, but it still flash in admin/views/layout.html
"
1164,flash -> w2p_flash,2016-01-08T18:14:18Z,2016-03-19T01:26:33Z,,,,
1163,Fix bug on Mail.send() when text or input are Unicode,2016-01-07T14:07:23Z,2016-01-30T04:17:07Z,,UnicodeDecodeError,UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: ordinal not in range(128),"On PR #964 @matclab forced the encoding of both subject and
text variables to unicode.

After merging it, matclab realized that when we send Unicode
text to the method it raises an exception and asked if he should
change the commit. Unfortunately this thing was kept untouched.

This problem exists because we previously encode the unicode variables
to utf-8 (for instance here https://github.com/web2py/web2py/blob/master/gluon/tools.py#L478-L481) 
and then convert to unicode again. This piece of code shows the exception being raised:

```
>>> a = u'√°√©√≠'
>>> a
u'\xe1\xe9\xed'
>>> b = a.encode('utf-8')
>>> b
'\xc3\xa1\xc3\xa9\xc3\xad'
>>> unicode(a)
u'\xe1\xe9\xed'
>>> unicode(b)
Traceback (most recent call last):
  File ""<stdin>"", line 1, in <module>
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: ordinal not in range(128)
```

If we force to str, just like @matclab suggested, we solve this issue.
"
1162,Validating SQLFORM unique field raises exception,2016-01-06T18:17:44Z,2016-03-19T18:39:35Z,,Exception,"Exception: Validation error, field:f_UKI_ID <gluon.validators.IS_NOT_IN_DB object at 0x10e6bfa10>","I have a db table, `t_trial`, with the following field:

```
Field( 'f_UKI_ID', 'integer', label=""UKI ID"", unique=True, required=True ),
```

I create an `SQLFORM` for this table:

```
 def request_trial():
    form = SQLFORM(db.t_trial)
    if form.process(dbio=False).accepted:
        session.flash = ""Trial Requested""
        redirect( URL(f=""index"", user_signature=True) )
    return locals()
```

If I leave the field empty when submitting, I get the following exception:

```
Traceback (most recent call last):
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/Users/scott_mbp/Dropbox/web2py_uki/applications/init_bkup/controllers/default.py"", line 494, in <module>
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/globals.py"", line 412, in <lambda>
    self._caller = lambda f: f()
  File ""/Users/scott_mbp/Dropbox/web2py_uki/applications/init_bkup/controllers/default.py"", line 480, in request_trial
    if form.process(dbio=False).accepted:
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 2304, in process
    self.validate(**kwargs)
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 2241, in validate
    if self.accepts(**kwargs):
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/sqlhtml.py"", line 1505, in accepts
    **kwargs
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 2122, in accepts
    status = self._traverse(status, hideerror)
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 888, in _traverse
    newstatus = c._traverse(status, hideerror) and newstatus
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 888, in _traverse
    newstatus = c._traverse(status, hideerror) and newstatus
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 888, in _traverse
    newstatus = c._traverse(status, hideerror) and newstatus
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 888, in _traverse
    newstatus = c._traverse(status, hideerror) and newstatus
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 895, in _traverse
    newstatus = self._validate()
  File ""/Users/scott_mbp/Dropbox/web2py_uki/gluon/html.py"", line 1863, in _validate
    raise Exception(msg)
Exception: Validation error, field:f_UKI_ID <gluon.validators.IS_NOT_IN_DB object at 0x10e6bfa10>
```

If I add a `requires` parameter to the field, to have the form catch when the field is empty, I get the expected error message.  But it doesn't seem like this should raise an exception.
"
1161,AuthJwt date and datetime json parse issue,2016-01-04T16:52:29Z,2016-01-04T22:18:29Z,,TypeError,"TypeError: datetime.datetime(2016, 1, 4, 16, 5, 32) is not JSON serializable","If auth_user table contains any date or datetime field. AuthJWT when tries to parse (generate_token) as JSON fails:

```
TypeError: datetime.datetime(2016, 1, 4, 16, 5, 32) is not JSON serializable
```
"
1160,Changed order of imports,2016-01-04T12:27:49Z,2016-01-04T15:44:20Z,,ImportError,ImportError: DLL load failed: The specified module could not be found.,"I ran into issue with running cron on Windows 10 even after installing pywin32. When I manually tried to find out why `web2py` won't determine LOCK_EX it turned out that order of imports mattered:

```
Python 2.7.9 (default, Dec 10 2014, 12:28:03) [MSC v.1500 64 bit (AMD64)] on win32
Type ""help"", ""copyright"", ""credits"" or ""license"" for more information.
>>> import win32con
>>> import win32file
Traceback (most recent call last):
  File ""<stdin>"", line 1, in <module>
ImportError: DLL load failed: The specified module could not be found.
>>>
```

```
Python 2.7.9 (default, Dec 10 2014, 12:28:03) [MSC v.1500 64 bit (AMD64)] on win32
Type ""help"", ""copyright"", ""credits"" or ""license"" for more information.
>>> import win32con
>>> import pywintypes
>>> import win32file
>>>
```

After this change cron is running happily.

Regards,
Adam
"
1159,Problems with the validator IS_DATE() and appadmin.,2016-01-04T03:55:08Z,2016-03-09T21:30:58Z,,,,"I'm running web2py 2.12.3 and I think I found a bug(or maybe I'm just doing something really wrong)

The error happens when I use the validator IS_DATE(format='%d/%m/%Y') in a table definition. Ex:

```
db.define_table('people',
                Field('people_date', requires=IS_DATE(format='%d/%m/%Y')))
```

Now I insert a new record to the table 'people' through the appadmin(like 10/10/2010). After that when try to go to the page _appadmin/select/db?query=db.people.id>0_, the error happens. 

About the error:

> Traceback (most recent call last):
>   File ""/home/marcelotheodoro/web2py/gluon/restricted.py"", line 227, in restricted
>     exec ccode in environment
>   File ""/home/marcelotheodoro/web2py/applications/teste/views/appadmin.html"", line 175, in <module>
>     {{if ram['bytes'] > 524287:}}
>   File ""/home/marcelotheodoro/web2py/gluon/sqlhtml.py"", line 3283, in __init__
>     r = str(field.formatter(r))
>   File ""/home/marcelotheodoro/web2py/gluon/packages/dal/pydal/objects.py"", line 1615, in formatter
>     value = item.formatter(value)
>   File ""/home/marcelotheodoro/web2py/gluon/validators.py"", line 2200, in formatter
>     year = value.year
> AttributeError: 'str' object has no attribute 'year'
> 
> Function argument list
> (self=<gluon.validators.IS_DATE object>, value='2000-12-11')
"
1158,new redis toolset to use with web2py,2016-01-02T22:15:41Z,2016-01-04T15:43:58Z,,,,"This is a refactor of everything web2py uses with redis.
Specifically:
- a refactored redis_cache.py that fixes #958, allowing a ""fail
  gracefully"" behaviour in case redis is not available
- a refactored redis_session.py that blocks less with with_lock=True
  (although still not optimal)
- a new (and NEEDED) redis_utils.py that serves as the base for
  everything else, allowing an RConn object that you can freely use as a
  redis.StrictRedis connection, and that you can override in case you're
  using a different library (or that web2py will use in case redis-py
  won't be the de-facto standard around)
- a newly - and much anticipated - redis_scheduler.py. It's a slip-in
  replacement for the standard scheduler that uses redis for workers
  coordination. Feel free to dig in the code and improve it.

For redis_cache and redis_session changes are BREAKING. It means that
users will need to change the import locations and tune a bit the code.
Now every module depends on an gluon.contrib.redis_utils.RConn object
(or similar) that in turns is very similar to a redis.StrictRedis one.
The redis instance is EXTERNAL to the modules themselves (no more ""host,
port, db, password"" parameters in RedisCache or RedisSession)
See the relevant docstrings for usage examples
"
1157,fix for STOPPED tasks via stop_task(),2016-01-02T21:50:43Z,2016-01-04T15:43:13Z,,,,"they previously killed the main process
"
1156,jwt implementation doesn't calculate utc epoch correctly,2015-12-31T18:08:39Z,2016-01-04T15:39:41Z,,,,"a mistypo.

now = time.mktime(datetime.datetime.utcnow().timetuple())

should be

a. now = time.mktime(datetime.datetime.now().timetuple())
OR
b. calendar.timegm(datetime.datetime.utcnow().timetuple())

calendar though would be a new import to put in tools.py . Does anyone have a reccomendation for one or the other form ?
"
1155,tests for modules NEED to be in a separate unittest,2015-12-30T20:33:45Z,2016-01-04T15:42:23Z,,,,
1154,fixes #1044,2015-12-30T15:39:07Z,2016-01-04T15:41:58Z,,,,"This shouldn't have took that much to solve. Really sorry for the delay
"
1153,fixes #1100,2015-12-30T15:24:12Z,2016-01-04T15:41:43Z,,,,"now elements with data-w2p_disable (any value on it) are not disabled

i.e. (for the specific case)

```
TAG.button('Next',_type=""submit"", data=dict(w2p_disable='a')
```

but also works on any input,textarea, etc (max flexibility!)

in addition, for non-ajax forms, disabled submit buttons are reenabled
after 5 seconds

plus reindented, refactored AND JSLINTED (yes. please. keep it clean.)
"
1152,fixes #1143,2015-12-30T11:07:55Z,2016-01-04T15:40:35Z,,,,"don't even get me started about the current messy status of admin
"
1151,better test_utils and reorg to compileapp,2015-12-30T10:46:43Z,2016-01-04T15:39:59Z,,,,
1150,better test_utils and reorg to compileapp,2015-12-30T10:36:15Z,2015-12-30T10:43:48Z,,,,
1149,bultin constant time checking,2015-12-30T09:38:59Z,2016-01-04T15:39:38Z,,,,"- if hmac.compare_digest is there, we should use it instead of our own
  fallback.
- jwt handler has been updated to use utils.compare (reported in
  #web2py-users)
- includes the same mods as https://github.com/web2py/web2py/pull/1146
"
1148,Web2py stable version,2015-12-29T12:53:11Z,2016-03-19T08:21:37Z,,,,"The last stable version is 2.13.4, but [VERSION](https://github.com/web2py/web2py/blob/R-2.13.4/VERSION) file is already 2.13.3.
"
1147,_before_* callbacks ignores file deletion,2015-12-28T20:47:24Z,2015-12-29T10:49:55Z,,,,"When the model has defined  `autodelete=True,` and the callback retirns `True` the register in the dal will not be deleted, but the files in `uploads/` desapears.

**Model**

``` python
# -*- coding: utf-8 -*-


def pprint(*args): print args
def bkp_delete( s ):
#    pprint(s) #.select()[0]
    return True    

db.define_table('img',
    Field('image',
        'upload',
        required=True,
        notnull=True,
        autodelete=True,
        uploadseparate=True),
    Field('mdate', 'datetime', notnull=True),
    Field('landmark', 'boolean'))

db.img._before_delete.append( lambda s: bkp_delete(s) ) 
```

**Controller**

``` python
# -*- coding: utf-8 -*-


def index(): 
    return dict(message=""hello from img.py"")

def add():
    form = SQLFORM(db.img).process()
    return dict(f=form)

def grid():
    grid=SQLFORM.grid(db.img, user_signature=False)
    return dict(grid=grid)

# add at least 2 registers
# delete 1
# go to de grid, you will see the 2registers.
# try to see the attachment
```
"
1146,Jwt mcl,2015-12-28T17:22:51Z,2015-12-30T09:44:30Z,,,,"Some improvement to jwt in web2py:
- Allows to encode date and datetime with json (needed when extra_fields of type date or datetime used for auth_user table)
- Allows jwt token to be produced with the logged in user ‚Ä¶

This allows for jwt authentication without transmitting user and
password in clear. A use case is:
- user first logs in,
- he gets the token online over https,
- he then issues API requests with the token as a HTTP header.
"
1145,fixes #1142,2015-12-28T14:06:24Z,2015-12-29T18:07:40Z,,,,
1144,better support for -f,2015-12-28T13:49:14Z,2015-12-29T18:06:54Z,,,,"as exposed in
https://groups.google.com/d/msg/web2py-developers/uJoQeUlCABw/-MCXocwGAgAJ
"
1143,Strange styling in applications and broken flash in admin app-Version 2.13.4- ,2015-12-27T20:21:25Z,2016-01-04T15:40:37Z,,,,"Since las updates of web2py the styling changes to something that seem like a bootstrap inconsistency bug (attached picture). I replicated this running web2py in windows ,centos, and mac both updating from web2py and installing recent stable sources.

Is the style change on purpose or am I missing something?
![sin titulo-2](https://cloud.githubusercontent.com/assets/16327260/12011833/eb54fb7c-aca4-11e5-942e-46945064f3a2.png)
![sin titulo-3](https://cloud.githubusercontent.com/assets/16327260/12011832/eb535786-aca4-11e5-99f2-99b285da794b.jpg)
"
1142,service does not start,2015-12-25T08:28:35Z,2015-12-29T18:07:43Z,,,,"because thereis syntax error in file scripts/service/service.py on line 95:

``` python
        if 'log_filename' in config.key():
```

but must

``` python
        if 'log_filename' in config.keys():
```

and on line 77:

``` python
                interfaces.append('%s:%s:%s:%s' % (ip, port, cert, key))
```

but must

``` python
                interfaces.append('%s:%s:%s:%s' % (ip, port, key, cert)
```
"
1141,Tracking latest pyDAL changes,2015-12-24T14:22:34Z,2015-12-24T14:30:31Z,,,,
1140,Post-validation string field form.vars are being overwritten,2015-12-23T15:53:44Z,2016-03-19T07:59:02Z,,,,"Commit https://github.com/web2py/web2py/commit/2a245d36f4e4d43d7b2251d73811497239b21a51 introduced a bug. Prior to this commit, it was possible to change the values in form.vars within the onvalidation callback. However, for string/text fields, this commit reverts to the values from the original request.post_vars (in order to preserve unicode text), overwriting any changes made during onvalidation.

We will need an alternative fix for the unicode problem that does not interfere with changes made to form.vars.
"
1139,no more deprecated .has_key(...),2015-12-22T20:40:01Z,2015-12-24T05:12:05Z,,,,
1138,ldap_auth.py: syntax error with 2.13.2-stable+timestamp.2015.12.18.11.00.46,2015-12-22T07:59:49Z,2015-12-24T15:15:33Z,,SyntaxError,SyntaxError: invalid syntax,"Hi, 

very easy to reproduce (Python 2.6.6 on RHEL6):

``` python
myserver:/tmp/web2py/gluon/contrib/login_methods>python ldap_auth.py
  File ""ldap_auth.py"", line 435
    update_or_insert_values = {f: update_or_insert_values[f] for f in fields}
                                                               ^
SyntaxError: invalid syntax
```

I changed the corresponding line to:

``` python
update_or_insert_values = {f: [update_or_insert_values[f] for f in fields]}
```

I seems to work for now, but I am not sure if this breaks anything else. It definitely needs further testing.

I am somewhat surprised that a syntax error can make it into a released version.
"
1137,fixing logging old behaviour,2015-12-21T14:13:02Z,2015-12-24T05:08:17Z,,,,"Fixing logging behaviour, possibly broken after changes in web2py file structure.
"
1136,update files removing 2.5 things,2015-12-21T13:57:12Z,2015-12-24T05:07:54Z,,,,"- Remove old python 2.5 things
"
1135,Track latest pyDAL GAE fix by @mdipierro,2015-12-18T11:51:52Z,2015-12-19T00:08:53Z,,,,
1134,Web2py and Couchbase,2015-12-17T14:51:29Z,2015-12-29T10:48:37Z,,,,"Hi,

I want to expose an couchbase bucket where I save some XML files generated in my web2py controller. I know I could maybe use MongoDB but I had a requirement for using Couchbase.

Is there an official connector for Couchbase? I couldn't find it in the DAL documentation. 

I am trying this working around:

```
from couchbase import Couchbase
cb = Couchbase.connect(bucket='mybucket', host='localhost', port=8091)
#this works but we got a message saying it is depreciated
# DeprecationWarning: Couchbase.connect() is deprecated. Use Bucket() instead
```

But I got a message saying it is depreciated and I should use this instead:

```
cb = Bucket(bucket='mybucket', host='localhost', port=8091)
```

But then I got an error:

```
<type 'exceptions.NameError'> name 'Bucket' is not defined
```

Any other suggestion , workarounds on Web2Py connecting to couchbase, specially for being exposed by an API? Thanks!
"
1133,Unexpected behavior using less than (<) in XML,2015-12-17T02:02:22Z,2015-12-24T15:17:03Z,,,,"Here's a simple test case:

```
{{=XML(""You see me <hiyou"", sanitize=True)}}
```

The above results in `You see me`and not `You see me <hiyou` as expected.

Tested on `2.10.3-stable+timestamp.2015.04.02.21.42.07` and on `2.12.3-stable+timestamp.2015.08.19.00.18.03`
"
1132,Tracking pyDAL v15.12,2015-12-16T20:57:19Z,2015-12-18T03:08:30Z,,,,
1131,Manual upload fails when db.table.field.store returns unicode,2015-12-15T23:52:37Z,2015-12-31T09:40:02Z,,,,"When I tried manual upload [as described in the book](http://web2py.com/books/default/chapter/29/06/the-database-abstraction-layer#More-on-uploads), there was an error although the file was copied to the application `uploads` folder. I noticed that for some reason `db.table.field.store` was returning a `unicode` string on my system instead of `str` as the new filename. So I believe [this part of the codebase](https://github.com/web2py/pydal/blob/3131f834ef0e4176a54944516269da3683243713/pydal/objects.py#L689-L693) will be corrected like:

``` python
    def _attempt_upload(self, fields):
        for field in self:
            if field.type == 'upload' and field.name in fields:
                value = fields[field.name]
                # if not (value is None or isinstance(value, str)):
                if not (value is None or isinstance(value, str) or isinstance(value, unicode)):
```
"
1130,XML allowed_attributes is not respected,2015-12-15T22:12:43Z,2016-03-19T08:09:57Z,,,,"2.10.3-stable+timestamp.2015.04.02.21.42.07
(Running on Rocket 1.2.6, Python 2.7.10) 

Simple script to reproduce:

``` python
print XML('It\'s time to do the demo<script>alert(""xss"");</script> <a href=""http://localhost:8000/page?id=7"" class=""at-mention"">link</a>',
                               sanitize=True,
                               permitted_tags=['a'],
                               allowed_attributes={'a': ['href', 'class']})
```

**Expected:**
`It's time to do the demo&lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt; <a class=""at-mention"" href=""http://localhost:8000/page?id=7"">link</a>`

**Actual:**
`It's time to do the demo&lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt; <a class=""at-mention"">link</a>`

As you can see the `href` attribute gets removed even though I added it to the allowed_attributes dictionary, it does however, retain the `class` attribute. Is this a bug or expected behavior? Thanks!
"
1129,select(distinct=...) may produce faulty sql for sqlite,2015-12-15T21:48:02Z,2015-12-29T10:50:52Z,,OperationalError,"OperationalError: near ""ON"": syntax error","This one works:

``` python
In [45]: db().select(db.player.country, distinct = True)
Out[45]: <Rows (40)>

In [46]: db._lastsql
Out[46]: 'SELECT DISTINCT player.country FROM player;'
```

But the other option given [in the book](http://web2py.com/books/default/chapter/29/06/the-database-abstraction-layer#orderby--groupby--limitby--distinct--having-orderby_on_limitby-left-cache) does not:

``` python
In [47]: db().select(db.player.country, distinct = db.player.country)
OperationalError: near ""ON"": syntax error

In [48]: db._lastsql
Out[48]: 'SELECT DISTINCT ON (player.country) player.country FROM player;'

```

I didn't test it with other DB engines since I don't currently have one installed.
"
1128,compute field not working when default value is set,2015-12-15T17:02:41Z,2016-01-01T10:45:26Z,,,,"db.define_table('trip',
    Field('driving_time_before', 'integer', notnull=True, default=0),
    Field('driving_time_after', 'integer', notnull=True, default=0),
    Field('driving_time', 'integer', compute=lambda r: r['driving_time_before']+r['driving_time_after'], notnull=True, default=0))

db.trip.insert(driving_time_after=10, driving_time_before=10)

does not compute the driving_time. This worked fine with web2py 2.9. but after upgrading to 2.12.3 it fails. The problem is in dal/pydal/objects.py line 708:
fields = self._defaults(fields)

because driving_time does have a default value, self._defaults returns the field and thus it does not get computed further on.

the default value for driving_time does not really make sense here (I added it out of habit) but it definitely should not stop it from getting computed.

Alex
"
1127,Avoid to run pyDAL adapters tests on appveyor,2015-12-13T11:35:21Z,2015-12-14T21:31:23Z,,,,
1126,"Parse GET vars from rewritten query string, not the original. Fixes #730",2015-12-12T23:06:34Z,2015-12-14T21:31:10Z,,,,"From what I can tell, request.env.QUERY_STRING contains the original query string before URL rewrite while request.env.query_string contains the new query string after rewrite. Both Apache (2.4.17) and the built-in Rocket server keep both query strings on my Linux machine. This little patch just switches query string parsing to the rewritten one, which is the expected behavior.
"
1125,Form DOM: search selected option's text-value,2015-12-11T17:56:31Z,,,,,"Right matching expression for searching selected option's  text-value (not key-value ) must be like:

`selected_opt_text = form.element('[name=my_select_field_name]  option[ selected = selected ]')[0]`

just **'... option[selected]'** matches **any** option  in web2py, but work properly in JQuery.

**Expected:**
'... option[selected]' should match selected  option only
"
1124,Convert attachments to a list if necessary.,2015-12-09T13:47:56Z,2015-12-14T21:32:07Z,,,,"Also corrects a typo that was apparently silenced by the bug.
This closes issue #1123
"
1123,"Single attachment produces ""'Int' object has no attribute lower"" error",2015-12-09T13:41:08Z,2015-12-14T21:56:23Z,,,,"As reported in 
https://groups.google.com/d/msg/web2py/kGuBn9iZByY/CJGFQYLWZ8oJ

Seen on GAE when sending a mail with

```
attachments = Mail.Attachment(‚Ä¶)
```

The error comes from gluon.py doing `enumerate(attachments)` on an object which is not iterable.

Pull request to come.
"
1122,SQLFORM.grid (smart_query) search None/empty values,2015-12-09T12:48:47Z,,,,,"Web2Py version,etc :

```
2.12.3-stable+timestamp.2015.08.19.00.18.03
(Running on nginx/1.4.6, Python 2.7.6)
Db: psql 9.3
```

On SQLFORM.grid search widget (smart_query) when i try to search for None/empty values seems that 0 records meets the query.

Examples of ""queries"" affected by this issue:

```
table.name is None
table.age = None
```
"
1121,"Wiki: ""extra"" parameter does not work if resolve=False",2015-12-08T16:16:22Z,2016-03-19T08:11:26Z,,,,"About the built-in wiki:

If there is the line

```
  auth.wiki(resolve=False)
```

in db.py, it is not possible to use the extra-Parameter in `auth.wiki(extra=...)` - it  does not work.

I think in gluon/tools.py (def wiki(..)) one line is missing.
`self._wiki.settings.extra=extra or {}`
 I have added it:

```
    if not hasattr(self, '_wiki'):
        self._wiki = Wiki(self, render=render,
                          manage_permissions=manage_permissions,
                          force_prefix=force_prefix,
                          restrict_search=restrict_search,
                          env=env, extra=extra or {},
                          menu_groups=menu_groups,
                          templates=templates,
                          migrate=migrate,
                          controller=controller,
                          function=function,
                          groups=groups)
    else:

        self._wiki.env.update(env or {})
        self._wiki.settings.extra=extra or {}
```

I have tried it and it works as expected. Maybe there are side effects?
"
1120,Fix oauth2 renew token,2015-12-07T10:19:07Z,2015-12-08T01:58:24Z,,,,"When getting an oauth token, we must use code or refresh_token but not twice.
"
1119,Softcron failing systematically...,2015-12-07T09:00:11Z,2015-12-24T15:17:43Z,,,,"I have been trying to enable `softcron` recently, and got an error every time the cron should run for any application:

```
2015-12-06 12:50:36,644 - web2py.cron - WARNING - WEB2PY CRON Call returned code 1:
invalid placeholder/--set value
```

Does not seem to be a problem with the application, though, as the `extcron` works fine.

I am using stable version of web2py (2.12.3) on FreeBSD 10.1 with uwsgi. I enabled the `softcron` in `wsgihangler.py`. I tried debugging a bit, but it does not seem to be related to the things that were in the action that was supposed to run. Simply nothing happened except the error above in the web2py log.

At the same time - as mentioned above - the same cron for the same applications works fine, if `extcron` is used. 
"
1118,Add readonly class to labels of readonly fields and set padding to 0,2015-12-04T14:34:14Z,2015-12-04T16:43:17Z,,,,"This allow for readonly fields content to be vertical aligned with their label.

Without this patch, labels for editable fields are certically aligned with the input filed text, but labels for readonly fields are shifted to the bottom.
"
1117,expected routes.py location changes when using -f (specify apps directory) option,2015-12-04T11:12:39Z,2015-12-04T17:10:29Z,,,,"`routes.py` is generally expected to be in the web2py root directory.  

However, if the -f startup option is used to specify a different location for the `applications` directory, then web2py loads the root file, but afterwards looks for the `routes.py` file in that new location instead of the usual root location.  When it does not find the file in the new location, it falls back to out-of-the-box routing defaults (e.g. goes to welcome app) and  ignores the settings in the `routes.py` file that exists in the web2py root directory.

Another observation is that web2py places the `httpserver.pid` and `parameters_NNNN.py` files in this new directory, whereas those files (should?) normally be in the web2py root directory as well.

Observe the 2 rewrite messages below on server startup and which `routes.py` it is using (1st one is root path, 2nd is applications path as passed with -f option):

```
2015-12-04 10:42:51,732 - DEBUG - [rewrite.py, line116, pid5394, MainThread] - URL rewrite is on. configuration in /home/jose/python-environments/crm/lib/web2py/routes.py
web2py Web Framework
Created by Massimo Di Pierro, Copyright 2007-2015
Version 2.12.3-stable+timestamp.2015.08.19.00.18.03
Database drivers available: sqlite3, psycopg2, pg8000, pymysql, imaplib
please visit:
    http://192.168.1.21:8020/
use ""kill -SIGTERM 5394"" to shutdown the web2py server

2015-12-04 10:42:51,773 - DEBUG - [rewrite.py, line116, pid5394, MainThread] - URL rewrite is on. configuration in /home/jose/projects/crm/routes.py
```

**Workaround**
Copy the web2py root directory `routes.py` file to the new `applications` directory.  Or create a symlink in the new directory to the file in the root directory.
"
1116,Fix IS_NOT_IN_DB to work with custom primarykey,2015-12-03T15:14:47Z,2015-12-04T16:42:25Z,,,,"Validator currently selects custom id properly, but then explicitly checks .id
"
1115,ldap_auth don't support self-signed certificate,2015-12-02T19:39:33Z,2015-12-04T17:10:48Z,,,,"#1114
"
1114,Improve/ldap contrib self signed certificate,2015-12-02T19:21:40Z,2015-12-04T16:42:05Z,,,,"Some PEP8 improvement, replace deprecated .has_key() by ""in"" and add support for self-signed certificate LDAP""S""
"
1113,Fix grid count when using groupby on MSSQL,2015-11-30T16:10:41Z,2015-12-04T16:41:37Z,,,,"Addresses issue #1112

Any query like SELECT COUNT(_) from (SELECT COUNT(_) FROM ...) will fail with 'No column name was specified for column 1 of '_tmp'', so I'm providing an alias for the subquery's field
"
1112,Sqlform grid record count says 'Query unsupported' when using groupby on MSSQL,2015-11-30T15:51:39Z,2015-12-04T17:11:05Z,,,,"def fetch_count() tries to count a subquery, resulting in the SQL error:
No column name was specified for column 1 of '_tmp'
"
1111,Validator IS_IPV4: options is_private=False not working,2015-11-29T18:07:26Z,2015-12-04T17:12:49Z,,,,"**number[0] <= number <= number[1] for number** :)
FIX line 3369

``` python
- (sum([number[0] <= number <= number[1] for number in self.private]) > 0)):
+ (sum([private_number[0] <= number <= private_number[1] for private_number in self.private]) > 0)):
```
"
1110,gluon.template render unable to handle unicode characters,2015-11-29T18:03:52Z,2015-12-04T17:16:22Z,,,,"I tried to use the templating system of web2py for parsing dynamically generated views. Theoretically, it should work - render from gluon.template accepts streams and strings as well. However, it seems that due to the fact it uses cStringIO instead of StringIO, it is unable to process unicode characters:

http://stackoverflow.com/questions/4677512/can-i-use-cstringio-the-same-as-stringio

So if my dynamically generated view contains any unicode characters, the rendering breaks with the error:

<type 'exceptions.UnicodeEncodeError'> 'ascii' codec can't encode character 

It seems that it would be sufficient to change cStringIO to StringIO in gluon.template
"
1109,Updated Auth.login() to remember input values after login attempt.,2015-11-27T22:23:18Z,2015-12-04T16:39:55Z,,,,"Updated Auth.login() to remember input values after failed login attempt wherre user is not found. This change does not remember passfield value for security reasons. Issue #728 
"
1108,Send client_secret when get oauth2 refresh_token,2015-11-23T09:10:39Z,2015-12-04T16:38:04Z,,,,"With some oauth2 providers, the oauth client_secret is required when getting a refresh_token.
"
1107,Formatting not working on db reference (SELECT) ,2015-11-19T15:30:01Z,2015-11-24T08:18:52Z,,,,"Web2Py Version, etc:
2.11.2-stable+timestamp.2015.05.30.16.33.24
(Running on nginx/1.4.6, Python 2.7.6)
db: postgres

I've defined 2 tables (authors & store_items), and referenced the store_items.author_id to authors table.

When I tried to create a new element in db from w2p appadmin format='%(name)s' the dropdown was loaded correctly, but in appadmin SQLFORM.grid or when I fetch data via a *.select() , format option seems to be ignored and return the ID of referenced authors row.

Example:

```
db.define_table('authors',
            Field('name','string'),
            Field('description','string'),
            Field('bio','string'),
            format='%(name)s')

db.define_table('store_items',
            Field('name','string'),
            Field('description','string'),
            Field('author_id', db.authors,
                        widget=SQLFORM.widgets.options.widget),
            Field('store_file','string'),
            format='%(store_file)s',
            )
```
"
1106,Added XML to retrieve pickled XML data #1067,2015-11-19T09:32:55Z,2015-12-04T16:37:50Z,,,,
1105,Exceptions in validators are masked in gluon.html,2015-11-17T20:46:41Z,2015-12-04T17:17:46Z,,,,"Came across an issue recently where I was passing the wrong arguments to `IS_IN_DB()` and it was throwing an exception. The problem is, in [gluon/html.py](https://github.com/web2py/web2py/blob/master/gluon/html.py#L1860), any exceptions from validators are being caught, and then a new exception, containing no details of the actual problem, is being raised.

Not only is this detrimental to bug-hunting ‚Äì it took me a long time to realise that I was passing the wrong arguments to the validator ‚Äì but it's also not clear to someone using validators for the first time that this isn't just ""what happens"" when a validator rejects input. My first thought was simply that the exception should be caught, and then manual form error processing should be done.

In my opinion, exceptions raised lower down in the framework should not be masked higher up, unless the new exception contains the original information plus _more details_.
"
1104,databases folder missing running in a shell a fresh web2py,2015-11-14T13:56:31Z,2015-12-04T17:20:53Z,,IOError,IOError: [Errno 2] No such file or directory: 'applications/welcome/databases/sql.log',"On a fresh web2py environment, running `python web2py.py -S welcome -R test.py` fails raising the following:

```
web2py Web Framework
Created by Massimo Di Pierro, Copyright 2007-2015
Version 2.12.3-stable+timestamp.2015.08.18.19.14.07
Database drivers available: psycopg2, pymysql, imaplib, sqlite3, pg8000, pyodbc
Traceback (most recent call last):
  File ""/tmp/web2py/gluon/shell.py"", line 263, in run
    execfile(startfile, _env)
  File ""test.py"", line 7, in <module>
    db.define_table('unicode_test', Field('test', 'string'))
  File ""/tmp/web2py/gluon/packages/dal/pydal/base.py"", line 834, in define_table
    table = self.lazy_define_table(tablename,*fields,**args)
  File ""/tmp/web2py/gluon/packages/dal/pydal/base.py"", line 873, in lazy_define_table
    polymodel=polymodel)
  File ""/tmp/web2py/gluon/packages/dal/pydal/adapters/base.py"", line 480, in create_table
    query), table)
  File ""/tmp/web2py/gluon/packages/dal/pydal/adapters/base.py"", line 212, in log
    logfile = self.file_open(table._loggername, 'ab')
  File ""/tmp/web2py/gluon/packages/dal/pydal/adapters/base.py"", line 155, in file_open
    fileobj = portalocker.LockedFile(filename,mode)
  File ""/tmp/web2py/gluon/packages/dal/pydal/contrib/portalocker.py"", line 118, in __init__
    self.file = open(filename, mode.replace('w', 'a'))
IOError: [Errno 2] No such file or directory: 'applications/welcome/databases/sql.log'
```

Creating the `applications/welcome/databases` folder fixed it
"
1103,added w2p_target attribute in form to control the output destination,2015-11-14T11:11:26Z,2015-12-04T16:37:14Z,,,,"The use case is that, the load of a bootstrap modal is fired by a button. The modal contains a form, without such proposal, when the form is submitted the whole modal is replaced by the result of the submission. The idea is to replace only a specific target (i.e., the content of the form).
The same result could be obtained using a LOAD inside the modal, but this would create a second request to the server.
"
1102,Reference to http://..../[app]/default/user/manage_users in welcome's default controller,2015-11-11T23:36:33Z,2015-12-04T17:24:08Z,,,,"The file [default.py](/web2py/web2py/blob/master/applications/welcome/controllers/default.py) in te welcome application indicates the possibility of 
`http://..../[app]/default/user/manage_users` invocation.
AFAIU this action is not possible.
"
1101,compute field not work when using after insert callback,2015-11-11T21:29:18Z,2015-11-11T23:51:08Z,,,,"e.g. 
def __after_insert_delivery_order(f, id):
    db(db.customer.id == f.customer).update(last_delivery_order_net = f.gross - f.tarra) # work
    #db(db.customer.id == f.customer).update(last_delivery_order_net = f.net) # not work

def on_define_delivery_order(table): 
    table._after_insert.append(__after_insert_delivery_order)
    table.net.compute = lambda r: r['gross'] - r['tarra']

db.define_table('delivery_order', 
    Field('delivery_order_no'), 
    Field('customer', 'reference customer'), 
    Field('tarra', 'integer'),
    Field('gross', 'integer'),
    Field('net', 'integer'),
    on_define = on_define_delivery_order, 
    format = '%(delivery_order_no)s')

https://groups.google.com/forum/#!topic/web2py/I1acweQhAEY
"
1100,Make disabling of form submit buttons optional,2015-11-07T15:50:48Z,2016-01-04T15:41:44Z,,,,"Whenever a form is submitted, code in web2py.js causes the submit button to be disabled. For Ajax submissions, the button is re-enabled after completion of the Ajax request. However, for non-Ajax requests, the button is never re-enabled. This is generally not a problem, as in most cases, the pages is immediately replaced with a new page from the server. However, if the form submission instead triggers the return of a file attachment, the original page is not replaced, and the button remains disabled. (See further details https://groups.google.com/d/msg/web2py/VH6H0OlyYd0/BDOmqkWQCQAJ.)

We should add an option to prevent the automatic disabling of submit buttons (e.g., by adding a special class or data attribute flag). Additionally, for non-Ajax requests, we could add a timer, re-enabling the button automatically after a couple seconds.
"
1099,VirtualHost on ubuntu?,2015-11-07T15:13:18Z,2015-11-08T00:49:21Z,,,,"Hello, that awesome framework. so now how can i config it with virtualhost like apache on ubuntu.
thank
"
1098,Provide optional per-column SQLFORM.grid CSS class,2015-11-05T22:23:33Z,2015-11-07T17:59:42Z,,,,"I wanted to control the CSS in the TD elements for one column in a SQLFORM.grid. I've added columnclasses={} to the grid() parameters, which is a dictionary of 'tablename.fieldname':'classname' e.g. {'t_mytable.f_myfield' : 'myclass'}. If you accept this pull request, I'll update the book pages (if you want: let me know).
"
1097,Error when validator label is a function,2015-11-04T16:11:58Z,2015-11-13T00:26:46Z,,,,"A while ago I defined a validator like that

```
IS_IN_DB(db, 'table.id', function)
```

function takes the row as first argument and returns a string. It used to work with former web2py (2.10.x) but latest master.
Reverting https://github.com/web2py/web2py/commit/65c87386c12513bbcf32674861ead171260c95ed introduced by @nklever fixed it. 
"
1096,issue #1095. Added two-factor authentication methods and onvalidation‚Ä¶,2015-10-29T17:56:19Z,2015-10-31T04:10:42Z,,,,"When enable two-factor by group, the last attempt to retry to introduce the login does not have effect.  The reason is because the form.accepts is performed after to check the number of attempts left. 

The code as well has some modification to make two-factor more flexible, for more details:
https://github.com/web2py/web2py/issues/1095

If you are interested let me know and I can help to update the book with some example, as for example to integrate OTP with two-factor.
"
1095,Two-factor authentication improvement and bug fixed,2015-10-29T17:12:29Z,2015-12-04T17:29:42Z,,,,"Working in the next patch:

When two-factor authentication is enables it looks that the last retry (last attempt to introduce the code) does not have effect. It did not have effect because the redirect and clean sessions is performed before to form.accepts. In the patch have been fixed.

I have done a few modification in tools.py to have two-factor more flexible, from models it is possible to do:

Enable two factor as global settings. It is compatible:

```
auth.setting.auth_two_factor_enabled = False
```

Set your custom attempts to login:

```
auth.setting.auth_two_factor_tries_left = 3
```

Message to return in case the code is incorrect:

```
auth.messages..invalid_two_factor_code = 'Incorrect code. {0} more attempt(s) remaining.'
```

To customize the email template:

```
auth.messages.retrieve_two_factor_code='Your temporary login code is {0}'
auth.messages.retrieve_two_factor_code_subject='Your temporary login code is {0}'
```

To customize two factor form:

```
auth.messages.label_two_factor = 'Authentication code'
auth.messages.two_factor_comment = 'This code was emailed to you and is required for login.'
```

It can be used to customize how to send the two factor code, or even to create your own factor code:

```
auth.settings.two_factor_methods = []
```

Once the two factor code is submit, you can use:

```
auth.settings.two_factor_onvalidation = []
```

By default if  `auth.settings.two_factor_authentication_group` is used or `auth.setting.auth_two_factor_enabled` is enable the code is generated as before and it is sent by email. The next examples are compatible with  two_factor_authentication_group or  `auth_two_factor_enabled`. The only difference is that  auth_two_factor_enabled enable two-factor for the entire app, instead to use groups.

Example 1: We want to send the code by SMS, in our models:

```
def _sendsms(user, auth_two_factor):
    # we write the code to send the auth_two_factor by SMS
    return  auth_two_factor

auth.settings.auth_two_factor_tries_left = 2
auth.settings.auth_two_factor_enabled = True
auth.messages.two_factor_comment = ""Your code have been sent by SMS""
auth.settings.two_factor_methods = [lambda user, auth_two_factor: _sendsms(user, auth_two_factor)]
```

Example 2: We want to send the code by SMS and create or own code:

```
def _sendsms(user, auth_two_factor):
    auth_two_factor = # we write the code to generate the code
    # we write the code to send the auth_two_factor by SMS
    return  auth_two_factor

auth.settings.auth_two_factor_tries_left = 2
auth.settings.auth_two_factor_enabled = True
auth.messages.two_factor_comment = ""Your code have been sent by SMS""
auth.settings.two_factor_methods = [lambda user, auth_two_factor: _sendsms(user, auth_two_factor)]
```

Example 3: The code is generated by a external client. For example OTP Client:

```
#Before define tables, we add some extra field to auth_user
auth.settings.extra_fields['auth_user'] = [
    Field('motp_secret', 'password', length=512, default='', label='MOTP Secret'),
    Field('motp_pin', 'string', length=128, default='', label='MOTP PIN')]

OFFSET = 60 #Be sure is the same in your OTP Client

#Set session.auth_two_factor to None. Because the code is generated by external app. 
# This will avoid to use the default setting and send a code by email.
def _set_two_factor(user, auth_two_factor):
    return None

def verify_otp(user, otp):
  import time
  from hashlib import md5
  epoch_time = int(time.time())
  time_start = int(str(epoch_time - OFFSET)[:-1])
  time_end = int(str(epoch_time + OFFSET)[:-1])
  for t in range(time_start - 1, time_end + 1):
     to_hash = str(t) + user.motp_secret + user.motp_pin
     hash = md5(to_hash).hexdigest()[:6]
     if otp == hash:
       return hash

auth.settings.auth_two_factor_enabled = True
auth.messages.two_factor_comment = ""Verify your OTP Client for the code.""
auth.settings.two_factor_methods = [lambda user, auth_two_factor: _set_two_factor(user, auth_two_factor)]
auth.settings.two_factor_onvalidation = [lambda user, otp: verify_otp(user, otp)]
```
"
1094,IS_DATETIME with timezone info & record versioning causes TypeError: can't compare offset-naive and offset-aware datetimes,2015-10-27T15:12:55Z,2015-12-04T17:32:21Z,,,,"Web2py Version 2.12.2-stable+timestamp.2015.08.09.14.29.44

The IS_DATETIME validator creates an offset-aware datetime in https://github.com/web2py/web2py/blob/master/gluon/validators.py#L2190

``` python
value = self.timezone.localize(value).astimezone(utc)
```

which causes the TypeError in:
dal\pydal\helpers\methods.py, line 95, in archive_record
https://github.com/web2py/pydal/blob/600c8dc0acc7552a9a7570aeae70b2eed8321f52/pydal/helpers/methods.py#L95

``` python
if fields[k] != v:
```

This happens when you have a writable datetime field and edit it with a SQLFORM. The validator is called, leading to an offset-aware datetime in the row object causing the TypeError exception.

Possible fix is to normalize the offset-aware datetime back to a naive datetime object:

``` python
value = self.timezone.localize(value).astimezone(utc).replace(tzinfo=None)
```
"
1093,Default AppConfig.ini vs application AppConfig.ini,2015-10-26T14:07:25Z,2015-12-04T17:32:58Z,,,,"Can we have a default AppConfig that could be in web2py tree (not in the app folder) and an application AppConfig.ini which is in the app folder?

This may resolve this kind of issue : https://groups.google.com/d/msg/web2py/EKCgmsd5klQ/ExQM1MidBQAJ

I remember having issue with AppConfig when I first used it.

Also, the way it is remember me the issue we have with static/\* content required by web2py...

Thanks for consider this proposition
"
1092,fixes #1090,2015-10-26T08:52:50Z,2015-10-31T04:08:47Z,,,,"removed timezone for IS_DATE\* validators
"
1091,Add renew token by using refresh_token,2015-10-25T19:50:19Z,2015-10-31T04:08:37Z,,,,"Handle the refresh_token mechanism to renew the access_token when expire.
"
1090,Remove timezone option from IS_DATE,2015-10-25T17:27:19Z,2015-10-31T04:08:48Z,,,,"Briefly, (1) the current implementation is broken, and (2) there is no clear way to implement timezone transformations with dates (as opposed to datetimes). For further discussion, see https://groups.google.com/forum/#!topic/web2py-developers/-gVGhnTejsU.
"
1089,encode issue on globals.py - json ,2015-10-24T01:07:30Z,2015-11-17T19:54:19Z,,,,"Hi guys,

I have create some threads on web2py groups without answer.

I found a bug on globals.py. When i send a application/json with encode iso-8859-1 i got no post_vars.... always came empty.

as following images, when I send a json without special chars it works, however when i send with ""√ß"", bring me nothing.

![](https://lh3.googleusercontent.com/-r8GjAiTok5M/VimiJvEYNRI/AAAAAAAACW8/PTjxELAaWfM/s1600/2015_10_23_00_11_54_SoapUI_5.2.1.png)

![](https://lh3.googleusercontent.com/-rA7DHfSXQvE/Vimh6wzWrwI/AAAAAAAACWk/Xrs-cgv8Dc4/s1600/2015-10-23%2B00_14_44-Editing%2BAddUpdateAddress.png)

![](https://lh3.googleusercontent.com/-FxF8JOqBBes/Vimh7ddrGtI/AAAAAAAACWs/a_Vb4dKM3ZA/s1600/2015-10-23%2B00_05_56-SoapUI%2B5.2.1.png)

This is my fix:

post_vars = self._post_vars = Storage()
        body = self.body
        #import copy
        #body2 = copy.copy(self.body) #self.body
        # if content-type is application/json, we must read the body
        is_json = env.get('content_type', '')[:16] == 'application/json'
        #body2 = body.read()
        #body.seek(0)
        if is_json:
            try:
                json_vars = sj.load(body)
                #print json_vars
            except Exception, e:
                #print str(e)
                body.seek(0)
                body2 = body.read()

```
            try:
                print chardet.detect(body2)['encoding']
                body_encoded = body2.decode(chardet.detect(body2)['encoding']).encode('utf-8')
                json_vars = sj.loads(body_encoded)
            except Exception, e:
                print str(e)
                json_vars = {}
            # incoherent request bodies can still be parsed ""ad-hoc""
            #json_vars = {""oloko"":str(e)}
            pass
        # update vars and get_vars with what was posted as json
        if isinstance(json_vars, dict):
            post_vars.update(json_vars)
```

![image](https://cloud.githubusercontent.com/assets/3118165/10708014/a9f5f616-79d9-11e5-8bd8-79f19caf8e13.png)

I do not know if this solution is the better, but solve my problem.
Sorry about my english, i am not native.

U guys can take a look on this issue for the next release?

Grateful for attention

Gustavo M Freitas
"
1088,fixes #1083,2015-10-19T19:51:33Z,2015-10-31T04:07:58Z,,,,
1087,"add_membership, del_membership, add_membership = IntegrityError (when auth.enable_record_versioning)",2015-10-19T17:57:46Z,2015-12-04T17:42:13Z,,,,"when auth.enable_record_versioning is enabled add_membership produces an IntegrityError if the membership was added and deleted before.
add_membership does not check if an archived record for this membership exists and tries to insert the membership again which results in an IntegrityError.

my workaround at the moment is this wrapper:

```
def add_membership(auth, gid, uid):
    archived_record = db((db.auth_membership.user_id == uid) & (db.auth_membership.group_id == gid), ignore_common_filters=True).select().first()
    if archived_record:
        archived_record.update_record(is_active='T')
        return archived_record.id
    else:
        return auth.add_membership(gid, uid)
```
"
1086,Run pydal's tests inside web2py using contrib adapters,2015-10-16T12:46:59Z,2015-10-31T04:07:37Z,,,,"Closes #759 
"
1085,OFV latest install missing CSS and git integration doesn't work as well,2015-10-13T03:08:45Z,2015-10-26T14:48:13Z,,,,"Just installed the latest OFV image and didn't do any special additions to the box. The entire page is just pure 404 for CSS and images, functionality still works but everything is in error.

Then following your instructions for git integration have failed. No matter what I try all I always get is ""requires gitpython module"". Installed that so many times pure your web instructions it's gotten old already. Everything shows its successfully installed but web2py just doesn't wish to work with it at all.
"
1084,Cookie parsing stopped after first invalid cookie,2015-10-11T22:22:06Z,2015-12-04T17:45:00Z,,,,"If there is one invalid cookie in a request header then cookie processing is stopped.  This means if a user happens to have an invalid cookie in the header before the web2py `session_id_xxx` cookie, then an exception is thrown and the session cookie will be ignored and a new session issued.

In `main.py` (line 429) I have replaced this block:

```
try:
    request.cookies.load(env.http_cookie)
except Cookie.CookieError, e:
    pass  # invalid cookies
```

With this block:

```
for single_cookie in env.http_cookie.split('; '):
    try:
        request.cookies.load(single_cookie)
    except Cookie.CookieError:
        pass  # single invalid cookie ignore
```

And it fixes the issue, only the invalid cookies are ignored.
"
1083,"Automatically adding the ""btn-default"" class to all buttons can cause styling conflicts",2015-10-11T16:11:29Z,2015-10-31T04:07:58Z,,,,"[Here](https://github.com/web2py/web2py/blob/R-2.12.3/applications/welcome/static/js/web2py-bootstrap3.js#L9) in web2py-bootstrap3.js, the ""btn-default"" class is automatically added to all buttons:

```
 $('button', target).addClass('btn btn-default');
```

However, this causes conflicts with other styles, such as ""btn-primary"".

In general, we should probably avoid automatic changes to generic elements that are not namespaced with ""web2py"" or ""w2p"". So, we might also consider an alternative to adding the ""btn"" class to all buttons [here](https://github.com/web2py/web2py/blob/R-2.12.3/applications/welcome/static/js/web2py.js#L78) in web2py.js.
"
1082,pydal - cx_Oracle installed Auto Ticket on opening index,2015-10-08T01:11:50Z,2015-12-29T16:05:30Z,DAL,RuntimeError,"RuntimeError: Failure to connect, tried 5 times:","When point DAL to oracle://un/pw@server:port/sid it pumps out a ticket when trying to navigate to any page.

 I installed the following:

sudo rpm -Uvh .....

oracle-instantclient11.2-basic-11.2.0.4.0-1.x86_64.rpm
oracle-instantclient11.2-devel-11.2.0.4.0-1.x86_64.rpm
oracle-instantclient11.2-jdbc-11.2.0.4.0-1.x86_64.rpm
oracle-instantclient11.2-odbc-11.2.0.4.0-1.x86_64.rpm
oracle-instantclient11.2-sqlplus-11.2.0.4.0-1.x86_64.rpm
oracle-instantclient11.2-tools-11.2.0.4.0-1.x86_64.rpm

then 

cx_Oracle-5.1.2-11g-py27-1.x86_64.rpm

---

Opening up web2py from CLI i get the following:
'''
$ python web2py.py
web2py Web Framework
Created by Massimo Di Pierro, Copyright 2007-2015
Version 2.12.3-stable+timestamp.2015.08.19.00.18.03
Database drivers available: cx_Oracle, pymysql, imaplib, sqlite3, pg8000, pyodbc
'''
-So it web2py is seeing the Oracle driver.

---

Opening up the page after I point the DAL to oracle://..... i get the following when trying to goto index:
'''
Traceback (most recent call last):
  File ""/opt/www-data/web2py/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/opt/www-data/web2py/applications/test/models/db.py"", line 20, in <module>

db = DAL(myconf.take('db.uri'), pool_size=myconf.take('db.pool_size', cast=int), check_reserved=['all'])
  File ""/opt/www-data/web2py/gluon/packages/dal/pydal/base.py"", line 174, in **call**
    obj = super(MetaDAL, cls).**call**(_args, *_kwargs)
  File ""/opt/www-data/web2py/gluon/packages/dal/pydal/base.py"", line 459, in **init**
    raise RuntimeError(""Failure to connect, tried %d times:\n%s"" % (attempts, tb))
RuntimeError: Failure to connect, tried 5 times:
Traceback (most recent call last):
  File ""/opt/www-data/web2py/gluon/packages/dal/pydal/base.py"", line 437, in **init**
    self._adapter = ADAPTERS[self._dbname](**kwargs)
  File ""/opt/www-data/web2py/gluon/packages/dal/pydal/adapters/base.py"", line 57, in __call__
    obj = super(AdapterMeta, cls).**call**(_args, *_kwargs)
  File ""/opt/www-data/web2py/gluon/packages/dal/pydal/adapters/oracle.py"", line 105, in **init**
    if do_connect: self.find_driver(adapter_args,uri)
  File ""/opt/www-data/web2py/gluon/packages/dal/pydal/adapters/base.py"", line 188, in find_driver
    raise RuntimeError(""no driver available %s"" % str(self.drivers))
RuntimeError: no driver available ('cx_Oracle',)
'''
-So here from the user side I get this ticket generated

---

Additional system info:

2.12.3-stable+timestamp.2015.08.19.00.18.03
(Running on Apache/2.4.16 (Fedora 22 Workstation) OpenSSL/1.0.1k-fips mod_wsgi/4.4.8 Python/2.7.10, Python 2.7.10)

Google Groups Topic:
https://groups.google.com/forum/#!topic/web2py/4Y1Yx86wzl4
"
1081,auth.settings.register_onaccept is not firing when signing up through third-party,2015-10-06T21:02:58Z,2015-12-04T18:15:12Z,,,,"register_onaccept is not firing when user is signing up through rpx_account or OneallAccount. 
"
1080,Make ldap_auth a bit more DRY,2015-10-06T18:33:28Z,2015-10-07T18:12:30Z,,,,"Hello,

I make this part a little more DRY for further change that coming.

Thanks...
"
1079,IS_IN_DB validator introduced bug in master when formating lambda labels,2015-10-03T09:13:48Z,2015-11-13T09:40:13Z,,,,"In branch master pulled today
In gluon/validators.py
Line 583
It reads
self.labels = [self.label(r) for r in records.render]
But should be (I think)
self.labels = [self.label(r) for r in records]

Otherwise you get an ""'instancemethod' object is not iterable"" error when using this kind of format
format=lambda r: '%s (%s)' % (r.nom, r.granja.nom)

for models defined like
db.define_table(""granja"",
                Field('nom', 'string', length=1024, required=True, unique=True),
                Field('descripcio', 'text')
                , format='%(nom)s')

db.define_table(""sitja"",
                Field('nom', 'string', length=1024, required=True, unique=True),
                Field('granja', 'reference granja', required=True)
                , format=lambda r: '%s (%s)' % (r.nom, r.granja.nom))

db.define_table(""corral"",
                Field('nom', 'string', length=1024, required=True, unique=True),
                Field('sitja', 'reference sitja', required=True),
                Field('tipus', 'string', required=True)
                , format='%(nom)s')

# This IS_IN_DB fails with error ""'instancemethod' object is not iterable""
db.corral.sitja.requires=IS_IN_DB(db, db.sitja.id, db.sitja._format, zero=T('choose one'))
"
1078,refactor setup scripts,2015-09-29T19:19:57Z,,,,,"todo list:
- linux
  - support fedora and ubuntu only
  - a single setup script for each distro, with a parameter for additionally installing and setting up postgresql. Provide nginx + uwsgi setup, http + https sites holding web2py apps as content served through the root
- windows
  - support WS2012R2, setup http site holding web2py apps as content server through the root
- refactor the online book to promote nginx + uwsgi over apache
- change all password requests with getpass to mask the admin password
- move all unmaintained scripts to scripts/old/ (or better, scripts/deploy/old)
"
1077,Fixes #721,2015-09-28T23:21:51Z,2015-10-07T18:08:16Z,,,,"Also fixes a bug where auth.wiki was not respecting the extra keyword argument
"
1076,Tracking pydal 15.09,2015-09-28T13:51:07Z,2015-10-07T18:07:54Z,,,,
1075,Allow partial compilation of an app if some views fail to compile,2015-09-27T23:52:13Z,2015-12-04T18:07:15Z,,,,"Currently, if a single view fails to compile, the compilation of the entire app fails. This means that if you want to use a condition {{extend}} in a single view, you cannot compile the app at all. Instead, we should allow the rest of the app to compile, with just the failed views remaining uncompiled.

I submitted a patch for this a long time ago (see https://groups.google.com/d/msg/web2py-developers/GhvqakUaujA/iTj0_uP76XcJ), but it was never applied. At this point, it may need to be tweaked, but since we now allow Python expressions in the {{extend}} statement, it makes sense to allow this.
"
1074,DIV.elements fails when searching for an attribute with an integer value,2015-09-22T18:05:47Z,2015-12-04T18:21:40Z,,,,"Given:

```
mydiv = DIV('hello', _id=1)
```

All of the following will fail to return a result:

```
mydiv.elements('#1')
mydiv.elements(_id=1)
mydiv.elements(_id='1')
```

However, the following will work:

```
mydiv.elements(_id=re.compile('1'))
```

This is because at [this line](https://github.com/web2py/web2py/blob/6ecc147d8c32448ab5e4999f20968fa122be37bd/gluon/html.py#L1138):

```
                if self[key] != str(value):
```

the `str` function is applied to the argument passed to `.elements`, but that string representation is then compared to the original attribute value (which is an integer in this case).

A fix would be to change the above line to:

```
                if str(self[key]) != str(value):
```

Alternatively, if for some reason we want to preserve the distinction between int and string values of the original attributes, then the line could be changed to:

```
                if self[key] != value:
```

I think the first approach (i.e., converting everything to string representations) is probably preferable, particularly since it is consistent with the approach taken when the argument to `.elements` is a regular expression, which can be seen at [this line](https://github.com/web2py/web2py/blob/6ecc147d8c32448ab5e4999f20968fa122be37bd/gluon/html.py#L1141):

```
                if not value.search(str(self[key])):
```

In this case, the original attribute value is first converted to its string representation.

Note, this issue arose in the context of the web2py grid, which uses integer id's in each row of the HTML table. Hence, something like `grid.element('#1')` would fail to return the `TR` of the first record. For some discussion, see https://groups.google.com/forum/#!topic/web2py/WJ3PW3voQFU.
"
1073,"fixes #1043 , thanks @bobstjon",2015-09-21T20:25:32Z,2015-09-27T19:40:27Z,,,,
1072,fixes #1039,2015-09-21T20:10:01Z,2015-09-27T19:40:14Z,,,,"It was a REEEAALLY good catch :-)
"
1071,fixes #1068,2015-09-21T19:41:00Z,2015-09-27T19:39:58Z,,,,"threw in also a better list:string widget repr for bs3

Updated also the bootswatch theme because something was wrong
"
1070,auth functionality broken when using session.secure(),2015-09-20T22:31:19Z,2015-09-21T19:47:47Z,,,,"Authentication doesn't work when using sessions.secure() on trunk.
Interactions such as logging in with correct or incorrect passwords fail silently.

This can be replicated in the welcome app by doing: 

```

if not request.env.web2py_runtime_gae:
    ## if NOT running on Google App Engine use SQLite or other DB
    db = DAL(myconf.take('db.uri'), pool_size=myconf.take('db.pool_size', cast=int), check_reserved=['all'])
    session.secure()
```

reproducible for me on sqlite or postgres, regardless of where sessions are stored (database or file)
"
1069,Autocomplete widget should have a option to preserve request.vars,2015-09-20T13:07:28Z,2016-09-27T21:36:03Z,,,,"See [this thread](https://groups.google.com/forum/#!topic/web2py/FMWjbGJjseg) in Google Groups
"
1068,"Add ""w2p"" namespace to CSS classes used in web2py.js",2015-09-17T21:56:57Z,2015-09-27T19:39:58Z,,,,"In order to avoid conflicts with other front-end frameworks, change the ""hidden"" and ""flash"" CSS classes used in web2py.js (and elsewhere in the framework and welcome app) to ""w2p_hidden"" and ""w2p_flash"".

For reference, see https://groups.google.com/forum/#!topic/web2py-developers/6dK1BVbdglI.
"
1067,Unable to store XML in session.flash,2015-09-17T11:34:37Z,2015-12-04T18:27:20Z,,,,"In Welcome app's default controller replace `response.flash = T(""Hello World"")` with

```
session.flash = XML('Hello <b>World</b>')
redirect(URL('user', args='login'))
```

The result is flash with ""Hello <b>World</b>"".

If you comment out the following part of code in html.py everything works OK. The flash shows ""Hello **World**"".

```
670 def XML_unpickle(data):
671     return marshal.loads(data)
672
673
674 def XML_pickle(data):
675     return XML_unpickle, (marshal.dumps(str(data)),)
676     copy_reg.pickle(XML, XML_pickle, XML_unpickle)
```
"
1066,fix unindented lines,2015-09-16T15:16:01Z,2015-09-18T05:41:34Z,,IndentationError,"IndentationError: unindent does not match any outer indentation level (websocket_messaging.py, line 152)","IndentationError: unindent does not match any outer indentation level (websocket_messaging.py, line 152)
"
1065,PythonAnywhere integration,2015-09-15T16:27:50Z,2015-09-18T05:41:20Z,,,,"Allows you to deploy your applications to PythonAnywhere directly from the admin.
"
1064,Error in class _repr_ref_list,2015-09-15T10:52:28Z,2015-12-04T18:28:12Z,DAL,AttributeError,AttributeError: 'int' object has no attribute 'id',"I have a `Field('orgs', 'list: reference org')` and I got the message

```
AttributeError: 'int' object has no attribute 'id'
```

This is the traceback:

```
Version web2py‚Ñ¢    Version 2.12.3-stable+timestamp.2015.08.19.00.18.03
Traceback

Traceback (most recent call last):
  File ""c:\web2py\gluon\restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""c:/web2py/applications/secure/controllers/personenaendern.py"", line 499, in <module>
  File ""c:\web2py\gluon\globals.py"", line 412, in <lambda>
    self._caller = lambda f: f()
  File ""c:\web2py\gluon\tools.py"", line 3774, in f
    return action(*a, **b)
  File ""c:/web2py/applications/secure/controllers/personenaendern.py"", line 402, in person1
    form=SQLFORM(db.auth_user, person_id, submit_button=submit_msg, showid=showid)
  File ""c:\web2py\gluon\sqlhtml.py"", line 1226, in __init__
    inp = represent(field, default, record)
  File ""c:\web2py\gluon\sqlhtml.py"", line 68, in represent
    return f(value)
  File ""c:\web2py\gluon\packages\dal\pydal\helpers\methods.py"", line 283, in __call__
    _fieldformat(self.ref, x.id) for x in value) or ''
  File ""c:\web2py\gluon\packages\dal\pydal\helpers\methods.py"", line 283, in <genexpr>
    _fieldformat(self.ref, x.id) for x in value) or ''
AttributeError: 'int' object has no attribute 'id'
```

The error comes from gluon/packages/dal/pydal/helpers/methods.py

```
class _repr_ref_list(_repr_ref):
    def __call__(self, value, row=None):
        if not value:
            return None
        refs = None
        db, id = self.ref._db, self.ref._id
        if db._adapter.dbengine == 'google:datastore':
            def count(values):
                return db(id.belongs(values)).select(id)
            rx = range(0, len(value), 30)
            refs = reduce(lambda a, b: a & b, [count(value[i:i+30])
                          for i in rx])
        else:
            refs = db(id.belongs(value)).select(id)
        return refs and ', '.join(
            _fieldformat(self.ref, x.id) for x in value) or '' 
```

It seems that x is already the id of the record. I changed

```
        return refs and ', '.join(
            _fieldformat(self.ref, x.id) for x in value) or ''
```

to

```
        return refs and ', '.join(           
            _fieldformat(self.ref, x) for x in value) or ''
```

‚Äãand everything works as expected. Sorry, I had not enough time to analyze the whole code - maybe there are side effects which I did not find.
"
1063,"form.add_button('Back', URL('other_page'))",2015-09-07T18:57:19Z,2015-10-26T14:50:41Z,,,,"When I add 
form.add_button('Back', URL('other_page'))
to a controller 'show_post()', it automatically redirects to 'other_page' without showing the view 'show_post.html'
"
1062,Remove requirement to rename the Spatialite DLL on windows,2015-09-07T14:03:19Z,2015-12-04T18:28:40Z,DAL,,,"According to the [original announcement](https://groups.google.com/d/msg/web2py/hIs2qtuS4Ls/FE3ZN6qJmDMJ), the libspatialite-2.dll file must be renamed to libspatialite.dll on Windows. The reason given was to avoid needing to do an OS check. However, the code ended up needing to do [an OS check](https://github.com/web2py/pydal/blob/master/pydal/adapters/sqlite.py#L175) anyway, so there doesn't appear to be any reason to require the name change.

I suggest changing:

```
SPATIALLIBS = {
    'Windows':'libspatialite',
    'Linux':'libspatialite.so',
    'Darwin':'libspatialite.dylib'
    }
```

to:

```
SPATIALLIBS = {
    'Windows':'libspatialite-2',
    'Linux':'libspatialite.so',
    'Darwin':'libspatialite.dylib'
    }
```

(or maybe it needs the "".dll"" extension as well -- not sure about that).

For backward compatibility, we may need a check for ""libspatialite.dll"" as well.
"
1061,"small changes in sqlhtml.py, validator.py, contrib/spreadsheet.py",2015-09-06T10:39:27Z,2015-09-27T19:39:47Z,,,,"1) **sqlhtml.py**: If in any of the form fields get unicode strings entered as input, the unicode characters in these strings are lost in self.vars. This if-condition sets it back to the original input. Might be, that this should be done at another place, but it works.
2) **validators.py**:  Labels should get their information from the render function of the records.
3) **contrib/spreadsheets.py**:  Added Column- and Row-Headers to be more flexible with the headers of the spreadsheet. Added also a boolean ""select"" parameter for the sheet.cell function which
allows to use a HTML select tag instead of an input tag for this cell.
"
1060,Closes #1059: get `response.view` from the environment,2015-09-03T23:45:54Z,2015-09-18T05:40:04Z,,,,"Make `run_view_in()` use `response.view` from the environment, instead of `current.response`.
"
1059,`response.render()` uses the original `response.view`,2015-09-03T23:38:07Z,2015-09-18T05:40:05Z,,,,"## The problem

When using `response.render()`, Web2py works fine for the first request. But it uses wrong view name in subsequent requests.

My same code worked in v2.9.11.
## The scenario

I use views to render parts of my page in this way:

```
def my_action():
    my_div = response.render('div_layout.html')
    # more code...
    return dict(my_div=my_div, other_vars=...)
```

Web2py must use these views:
1. `div_layout.html` in the explicit `response.render()` call;
2. `my_action.html` to show the result of this action, after returning to the caller.
## What is happening

The right scenario (the first time I call the URL):

| `response.view` contents | when |
| --- | --- |
| my_controller/my_view.html | `my_action` starts |
| div_layout.html | in `response.render` |
| my_controller/my_view.html | in `compileapp.run_view_in()`, after `my_action` |

The wrong scenario (in subsequent requests. Pay attention to the second line in table below):

| `response.view` contents | when |
| --- | --- |
| my_controller/my_view.html | `my_action` starts |
| my_controller/my_view.html | in `response.render` |
| my_controller/my_view.html | in `compileapp.run_view_in()`, after `my_action` |
"
1058,fixes issue #735,2015-09-03T16:34:22Z,2015-09-18T05:39:09Z,,,,
1057,fixes #823,2015-09-03T16:09:06Z,2015-09-18T05:38:56Z,,,,
1056,fixes typo in wiki. ,2015-09-03T15:57:24Z,2015-09-18T05:38:38Z,,,,"As usual, lack of unittests made this possible.
We should really make each developer ""adopt"" a piece of web2py to test
and care if we don't want to write unittests.
"
1055,drop down menus disappear if response.static_version contains alphabets.,2015-09-01T07:15:10Z,2015-09-02T07:44:16Z,,,,"I do not understand the purpose of static_version however below line in models/db.py causes all the drop down menus to disappear in the welcome app.

response.static_version = '0.0.0 beta'
"
1054,Improve PEP8 gluon/tools.py,2015-08-20T21:17:32Z,2015-08-21T05:07:06Z,,,,
1053,No credentials request if logged in and URL contains user/login?_next=,2015-08-19T18:50:45Z,2015-08-30T05:58:27Z,,,,"fixe #1052
"
1052,Avoid asking for credentials when user is logged in and user/login?_next present in URL,2015-08-19T18:49:31Z,2015-09-21T19:52:42Z,,,,"I will send a PR
"
1051,added HttpOnly cookies (default),2015-08-19T15:26:50Z,2015-08-31T01:41:23Z,,,,"added unit tests for cookie layout, secure cookies, and HttpOnly cookies
Session.httponly_cookies=False to revert HttpOnly cookies
"
1050,Update simplejsonrpc.py - move default to method signature,2015-08-19T10:59:58Z,2015-08-21T05:03:24Z,,,,"Default best placed in method signature, 
Thanks to cassiobotaro for pointing it out
"
1049,Update sqlhtml.py - fix failed validation removing styling,2015-08-19T10:45:26Z,2015-08-21T05:02:33Z,,,,"Addresses https://github.com/web2py/web2py/issues/1048, and works in my application.

However, I don't know what the purpose of the existing code is: why does it override widgets, and why only those which are explicitly set?  Isn't this just replicating work done in **init**()?  What could this break?
"
1048,SQLFORM formstyle overridden when validation fails,2015-08-19T10:40:53Z,,,,,"A portion of SQLFORM.accepts() overrides widgets that have been explicitly set in the DAL and styled with a formstyle, when the form has failed validation.  I do not understand what the point of the for-loop that does this is, and I've commented it out in my source with no problems (so far), which fixes the styling issue.

```
    elif (not ret) and (not auch):
        # auch is true when user tries to delete a record
        # that does not pass validation, yet it should be deleted
        for fieldname in self.fields:

            field = (self.table[fieldname]
                     if fieldname in self.table.fields
                     else self.extra_fields[fieldname])
            # this is a workaround! widgets should always have default not None!
            if not field.widget and field.type.startswith('list:') and \
                    not OptionsWidget.has_options(field):
                field.widget = self.widgets.list.widget
            if field.widget and fieldname in request_vars:
                if fieldname in self.request_vars:
                    value = self.request_vars[fieldname]
                elif self.record:
                    value = self.record[fieldname]
                else:
                    value = field.default
                row_id = '%s_%s%s' % (
                    self.table, fieldname, SQLFORM.ID_ROW_SUFFIX)
                widget = field.widget(field, value)
                parent = self.field_parent[row_id]
                if parent:
                    parent.components = [widget]
                    if self.errors.get(fieldname):
                        parent._traverse(False, hideerror)
                self.custom.widget[fieldname] = widget
        self.accepted = ret
        return ret
```

In my case:
Field('string1') keeps its bootstrap styling
Field('string2', widget=SQLFORM.widgets.string.widget) loses its bootstrap styling (as does any field with widget=...)

It breaks the styling because formstyle is run during FORM.**init**(), which always occurs before FORM.accepts()
"
1047,"Revert ""added default HttpOnly cookies""",2015-08-18T18:58:56Z,2015-08-18T18:59:07Z,,,,"Reverts web2py/web2py#1046
"
1046,added default HttpOnly cookies,2015-08-18T14:28:46Z,2015-08-18T16:53:54Z,,,,"https://www.owasp.org/index.php/HTTPOnly#What_is_HttpOnly.3F

supports ""session._js_cookies = True"" to restore old behavior
"
1045,Browser auto-fill can corrupt data while using admin database interface,2015-08-16T00:29:57Z,2015-12-30T20:47:20Z,,,,"When viewing/editing a record using the admin panel, browser auto-fill can sometimes populate fields without you realizing it.  I think auto-fill should be disabled for all fields when using the database management interface.  Something like this could do:

```
$(document).ready(function() {
    $("":input"").attr(""autocomplete"",""off"");
});
```
"
1044,#968 seems not fixed yet.,2015-08-15T21:41:19Z,2016-01-04T15:42:00Z,,UnicodeEncodeError,UnicodeEncodeError: 'ascii' codec can't encode character u'\xff' in position 0: ordinal not in range(128),"`IS_MATCH('hello')(u'\xff')`

Traceback (most recent call last):
...
  File "".../web2py/gluon/validators.py"", line 209, in **call**
    match = self.regex.search(str(value))
UnicodeEncodeError: 'ascii' codec can't encode character u'\xff' in position 0: ordinal not in range(128)
"
1043,alignment of readonly fields in forms,2015-08-14T22:54:27Z,2015-09-27T19:40:27Z,,,,"https://groups.google.com/forum/#!topic/web2py/6Qbcr8nuey8
"
1042,Allow change quality when RESIZE,2015-08-13T05:13:44Z,2015-08-18T16:52:52Z,,,,"And fix some pep8 too.
"
1041,Possible bug in 2.12.2 when including a .css file in a HTML email template,2015-08-12T08:49:21Z,2015-12-04T18:35:00Z,,,,"Hi,

I've just updated my project to Web2py 2.12.2 and found a little issue that wasn't there in my previouse versie 2.10.something...

I render a HTML template for the 'reset password' email like this:

```
auth.messages.reset_password = response.render('templates/email/reset_password.html',
                                               base_url='http://' + request.env.http_host,
                                               portal_name=site_settings.portal_name,
                                               password_url=URL(r=request, c='default', f='choose_new_password') + '?key=%(key)s')
```

The template itself looks like this:

```
<html>
    <head>
       {{include 'templates/email/includes/css.html'}}
   </head>

    {{include 'templates/email/includes/body_top.html'}}
        <p>
            Click on the URL
            <a href=""{{=base_url}}{{=password_url}}"">{{=base_url}}{{=password_url}}</a>
        </p>
    {{include 'templates/email/includes/body_bottom.html'}}
</html>
```

After disabling the includes and partial css format in the css.html I've discovered that the following lines in css.html:

```
<style type=""text/css"">
    table {
        width: 100%;
        border-collapse: collapse;
    }
</style>
```

Is causing this error:

```
unsupported format character ';' (0x3b) at index 397
```

When I change ""100%;"" into, for example, ""100px;"" the error is gone... downside it that the layout of the email is also 'gone' ;)

It this a bug? Or do I need to do things differently and did is work by accident in previous versions of Web2Py? 
"
1040,Feature request: explicit BEAUTIFY truncate length,2015-08-11T21:26:35Z,2015-10-26T14:52:21Z,,,,"Right now, calling `BEAUTIFY` truncates strings to some default value. It would be great if `BEAUTIFY` could receive a `truncate` parameter just like `SQLTABLE`, which could also be set to `None`.
"
1039,request.is_shell and request.is_scheduler are not set properly,2015-08-10T18:32:11Z,2015-09-27T19:40:14Z,,,,"When the shell or scheduler are being run, these two request attributes are set, but not to the correct value (which should be False rather than None). And when the shell or scheduler are being run, these two attributes are not set at all (which results in None being returned). So, as it stands, request.is_shell and request.is_scheduler always return None.

The problem is that these attributes are set in gluon.main.wsgibase, which is only called for HTTP requests, but not when the shell or a scheduler task are being run.

Fix:

In gluon.main.wsgibase at https://github.com/web2py/web2py/blob/master/gluon/main.py#L373:

```
                is_shell = True if cmd_opts and cmd_opts.shell else False,
                is_sheduler = True if cmd_opts and cmd_opts.scheduler else False,
```

Actually, in wsgibase, I think these would always be False, so maybe just set each to False.

In gluon.shell.env at https://github.com/web2py/web2py/blob/master/gluon/shell.py#L131, add:

```
request.is_shell = global_settings.cmd_options.shell is not None
request.is_scheduler = global_settings.cmd_options.scheduler is not None
```
"
1038,IS_NOT_EMPTY returns stripped value,2015-08-06T12:41:48Z,2015-08-06T15:14:46Z,,,,"IS_NOT_EMPTY validator strips the value
**UPDATE**: and returns the stripped value.

Web2py version: v2.5.1

(Caused a PITA issue at customer. The subsequent validator got a stripped value, and accepted it, however it would not accept the unstripped value, a dirty hacky workaround would be to swap the two validator.)
"
1037,description,2015-08-05T20:24:23Z,2015-09-03T15:35:19Z,,,,"You certainly need a new one. I propose one from this list:

http://cbsg.sf.net/
"
1036,prettydate doesn't do UTC,2015-08-03T23:46:31Z,2015-08-07T07:04:16Z,,,,"This one does: 

``` python
    def prettydate(d, T=lambda x: x, utc=False):
        now = datetime.datetime.utcnow() if utc else datetime.datetime.now()
        if isinstance(d, datetime.datetime):
            dt = now - d
        elif isinstance(d, datetime.date):
            dt = now.date() - d
        elif not d:
            return ''
        else:
            return '[invalid date]'
        if dt.days < 0:
            suffix = ' from now'
            dt = -dt
        else:
            suffix = ' ago'
        if dt.days >= 2 * 365:
            return T('%d years' + suffix) % int(dt.days / 365)
        elif dt.days >= 365:
            return T('1 year' + suffix)
        elif dt.days >= 60:
            return T('%d months' + suffix) % int(dt.days / 30)
        elif dt.days > 21:
            return T('1 month' + suffix)
        elif dt.days >= 14:
            return T('%d weeks' + suffix) % int(dt.days / 7)
        elif dt.days >= 7:
            return T('1 week' + suffix)
        elif dt.days > 1:
            return T('%d days' + suffix) % dt.days
        elif dt.days == 1:
            return T('1 day' + suffix)
        elif dt.seconds >= 2 * 60 * 60:
            return T('%d hours' + suffix) % int(dt.seconds / 3600)
        elif dt.seconds >= 60 * 60:
            return T('1 hour' + suffix)
        elif dt.seconds >= 2 * 60:
            return T('%d minutes' + suffix) % int(dt.seconds / 60)
        elif dt.seconds >= 60:
            return T('1 minute' + suffix)
        elif dt.seconds > 1:
            return T('%d seconds' + suffix) % dt.seconds
        elif dt.seconds == 1:
            return T('1 second' + suffix)
        else:
            return T('now')
```

Want a pull request?
"
1035,Issue with add_group when auth_user doesnt have records,2015-08-03T15:56:57Z,2015-08-04T19:49:57Z,,,,"Hello!

I've notices an issue with the add_group function, in my models i have a configuration file that creates groups every time the database is created, something like this:

if not db(db.auth_group).count():
    auth.add_group('manager', 'manage user stuff')

and when in try to run my app without tables (the app creating the tables for first time) i get this error:

<class 'gluon.contrib.pymysql.err.IntegrityError'> (1452, u'Cannot add or update a child row: a foreign key constraint fails (`database`.`auth_event`, CONSTRAINT `auth_event_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `auth_user` (`id`) ON DELETE CASCADE)')

i've been testing and this error happens because when the application creates a new group via add_group, tries to create a event inside the auth_event table, but one of the field of the auth_event table points to auth_user, and auth_user at table creation is empty, so doesnt exist any foreign key that the app cant set to that field

I'm using MySQL 5.5 and web2py 2.11.2 on a linux mint 16 environment.
"
1034,Error in DB2 for system i Adapter when inserting record into table defined in specific library,2015-08-03T10:52:21Z,2015-12-04T18:36:34Z,DAL,,,"Hi everybody.
I have a table in a IBM system i database. The table is located in a specific library, so I defined it in web2py this way:
`
db.define_table(
    'table', rname='LIBRARY.TABLE',
    fields = {
        ... field list...
    },
    migrate=False
)
`
The library name in the rname attribute is necessary because the ODBC driver configuration has no default libraries, and different tables are located in different libraries.

Querying and updating the table works as it should, but when I attempted to insert a record into the table, i got this error:

**<class 'pyodbc.ProgrammingError'> ('42S02', '[42S02] [IBM][System i Access ODBC Driver][DB2 for i5/OS]SQL0204 - TABLE in LIBRARY2 di tipo *FILE non trovato. (-204) (SQLExecDirectW)')**

The source of the error is **""gluon/packages/dal/pydal/adapters/db2.py"", line 101, in lastrowid,** where the case of existing rname attribute was not taken in consideration. The solution, in my opinion, is to change said line from:
`self.execute('SELECT DISTINCT IDENTITY_VAL_LOCAL() FROM %s;' % table)`
to
`self.execute('SELECT DISTINCT IDENTITY_VAL_LOCAL() FROM %s;' % table.sqlsafe)`

Thank you and best regards.
Maurizio
"
1033,sqlhtml.py Formwidget issue and solution,2015-08-03T06:14:56Z,2015-09-03T15:31:17Z,,,,"In sqlhtml.py line 119 I added form-control to _class = 'generic-widget' to solve an issue when a form contains errors. In that case the options widget is rendered with class = 'generic-widget' instead of
class =  'generic-widget form-control'
"
1032,Allow to specify a function for requires_login at auth decoration.,2015-08-02T11:22:01Z,2015-08-18T16:03:37Z,,,,"auth.requires_login: Allow functions for parameter requires_login.
This allows to postpone the decision whether or not a login is required.

Use case:
    def is_local_ip():
        ....

```
def requires_local_ip_or_user():
   auth.requires(lambda: is_local_ip(), requires_login: lambda: not local_ip())
```

That way we can get login prompts for non-local ip addresses only.
"
1031,"Repair cache status page in appadmin for welcome, admin and examples ‚Ä¶",2015-07-31T22:35:43Z,2015-08-18T16:02:14Z,,,,"‚Ä¶apps.

This fixes how values are read. For cache.disk, we need to use the second value in the dict.
For cache.ram everything is already there in the object, no need trying to get the stats (which are not there) in the loop.
Also small fix for buttons that did not open the detailed statistics when clicked (class hidden has !important in bootstrap3).
"
1030,"fixed issue #1028, saml2 bug",2015-07-27T11:14:13Z,2015-08-18T16:01:46Z,,,,"fixed issue #1028, saml2 bug and updated with a sp_conf.py example.
"
1029,simplejsonrpc: Fix TypeError when data is None,2015-07-27T11:10:18Z,2015-08-18T16:01:19Z,,,,"'\n'.join(data) breaks on data = None, which it often is.
Seems as if web2py's ticket errors became less verbose in a recent update?
"
1028,saml2_auth.py probrably bug and solution,2015-07-23T08:38:18Z,2015-12-04T18:37:35Z,,AttributeError,AttributeError: 'dict' object has no attribute 'assertion',"Creating a SAML2 SP with web2py I stuck in this error:

```
 File ""/home/jose/Documents/DESARROLLO/web2py-sp/web2py/gluon/contrib/login_methods/saml2_auth.py"", line 113, in login_url attributes = d['response'].assertion.attribute_statement[0].attribute
AttributeError: 'dict' object has no attribute 'assertion'
```

This error is raised when the IDP  issues a <Response> message to be delivered by the user agent
to the web2py service provider. As I could read in OASIS documentation, in this step the binding can be a HTTP POST, or HTTP Artifact to transfer the message. In web2py saml2_auth.py it looks that still using HTTP REDIRECT.

Does anyone has the same error?

A probable solution could be by modifying: **./gloun/contrib/login_methods/saml2_auth.py**:
1. Add on the top: `from saml2 import BINDING_HTTP_POST`
2. line 62: replace: bindings = [BINDING_HTTP_REDIRECT] to `bindings = [BINDING_HTTP_REDIRECT, BINDING_HTTP_POST]`
3. line 74 (after else) add: ``binding = BINDING_HTTP_POST`
"
1027,Orderby: Sorting records according to multiple fields,2015-07-22T17:59:46Z,2015-07-24T19:01:11Z,,,,"orderby can accept _multiple_ fields by concatenating them with a ""|"". See the [official web2py docs](http://www.web2py.com/books/default/chapter/29/06/the-database-abstraction-layer#orderby--groupby--limitby--distinct--having-orderby_on_limitby-left-cache):

However when I used this code:

```
db(db.my_table.id == user_id).select(orderby=~db.my_table.isCurrent | db.my_table.endYear | db.my_table.endMonth)
```

The return sorted the records based on isCurrent column only. The rest of the fields were ignored.

This code worked though:

```
db(db.my_table.id == user_id).select(orderby=""my_table.isCurrent DESC, my_table.endYear DESC, my_table.endMonth DESC"")
```
"
1026,fpdf not determining between PIL and Pillow,2015-07-22T11:23:25Z,2015-09-03T15:37:55Z,,except,except:,"If you upgrade to Pillow from PIL, you need to alter the code in fpdf in order for it to work correctly. In order to have it to try to import the Pillow method after it attempts PIL, add this:

```
try:
    if Image == None:
        from PIL import Image
except:
    Image = None
```

Below this:

```
try:
    # Check if PIL is available, necessary for JPEG support.
    import Image
except ImportError:
    Image = None
```
"
1025,Invalid reset password,2015-07-18T07:38:12Z,2015-09-22T06:43:43Z,,,,"I think the cause of the problem is customizing the auth_user table.
I had the following code to customize it:

db.define_table(
    auth.settings.table_user_name,
    Field('title', length=8, default='de heer', requires=IS_IN_SET(['de heer', 'mevrouw'], error_message='Selecteer een aanhef'), widget=bs3radiowidget, label='Aanhef \* '),
    Field('first_name', length=32, requires=IS_LENGTH(32, error_message='Lengte overschreidt 32 tekens'), label='Voornaam'),
    Field('familyNamePreposition', length=16, requires=IS_LENGTH(16, error_message='Lengte overschreidt 16 tekens'), label='Tussenvoegsel'),
    Field('last_name', length=64, default='', requires=[IS_LENGTH(64, error_message='Lengte overschreidt 64 tekens'), IS_NOT_EMPTY(error_message='Vul achternaam in')], notnull=True, label='Achternaam \* '),
    Field('shortName', length=128, requires=IS_EMPTY_OR(IS_NOT_IN_DB(db, 'auth_user.shortName', error_message='Short name al in database'), IS_LENGTH(128, error_message='Lengte overschreidt 128 tekens')), unique=True, writable=False, readable=False),
    Field('phone', length=16, requires=IS_LENGTH(16, error_message='Lengte overschreidt 16 tekens'), label='Telefoon'),
    Field('email', length=128, default='', requires=[IS_LENGTH(128, error_message='Lengte overschreidt 128 tekens'), IS_EMAIL(error_message='Ongeldig e-mailadres'), IS_NOT_IN_DB(db, 'auth_user.email', error_message='E-mailadres al in database')], notnull=True, unique=True, label='E-mail \* '),
    Field('username', length=32, default='', requires=[IS_LENGTH(32, error_message='Lengte overschreidt 32 tekens'), IS_NOT_EMPTY(error_message='Vul gebruikersnaam in'), IS_NOT_IN_DB(db, 'auth_user.username', error_message='Gebruikersnaam al in database')], notnull=True, unique=True, label='Gebruikersnaam \* ', writable=False, readable=False),
    Field('password', type='password', length=512, requires=[IS_STRONG(),CRYPT()], label='Wachtwoord \* ', writable=False, readable=False),
    Field('nodeID', 'reference nd_node', requires=[IS_EMPTY_OR(IS_IN_DB(db, 'nd_node.id', '%(id)s', zero='Selecteer een node'))], ondelete='CASCADE', label='NodeID \* ', writable=False, readable=False),
    Field('registration_key', length=512, default='', writable=False, readable=False),
    Field('reset_password_key', length=512, default='', writable=False, readable=False),
    Field('registration_id', length=512, default='', writable=False, readable=False),
    Field('createdOn', *_attributes),
    Field('modifiedOn', update=request.now, *_attributes))
## get the custom_auth_table

custom_auth_table = db[auth.settings.table_user_name]
## tell auth to use custom_auth_table

auth.settings.table_user = custom_auth_table
## create all tables needed by auth if not custom tables

auth.define_tables(migrate=False, username=True, signature=False)

While cleaning up my application, and making my code come as close
to what's in the book, I replaced the code above with:

auth.settings.extra_fields['auth_user']= [
  Field('title', length=8, default='de heer', requires=IS_IN_SET(['de heer', 'mevrouw'], error_message='Selecteer een aanhef'), widget=bs3radiowidget, label=''),
  Field('username', length=32, default='', requires=[IS_LENGTH(32, error_message='Lengte overschreidt 32 tekens'), IS_NOT_EMPTY(error_message='Vul gebruikersnaam in'), IS_NOT_IN_DB(db, 'auth_user.username', error_message='Gebruikersnaam al in database')], notnull=True, unique=True, label='Gebruikersnaam \* ', writable=False, readable=False),
  Field('vertexID', 'reference vtx_vertex', requires=[IS_EMPTY_OR(IS_IN_DB(db, 'vtx_vertex.id', '%(id)s', zero='Selecteer een vertex'))], ondelete='CASCADE', label='VertexID \* ', writable=False, readable=False)]
## create all tables needed by auth if not custom tables

auth.define_tables(migrate=False, username=True, signature=False)

After that the reset_password link no longer worked.  So I guess the issue is related to the way
you customize the auth_user table.
"
1024,"Caching recursive selects for references can lead to incorrect ""represent"" values",2015-07-17T20:36:06Z,2015-07-20T08:52:39Z,,,,"Commit https://github.com/web2py/web2py/commit/d1ec005924b10e0c738040586acaaa200db9d244 introduced caching of ""represent"" values for reference fields in SQLTABLE, SQLFORM.grid, and the grid ExportClass:

Unfortunately, this approach assumes all reference fields have the default ""represent"" function generated automatically by the DAL, which depends only on the ID value stored in the reference field and not on any other fields in the record. As a result, the cache key used to identify common ""represent"" values is based only on the reference field value itself. This approach fails if the user has defined a custom ""represent"" function that depends on other fields in the record.

For example, suppose we have:

```
db.mytable.myref.represent = lambda v, r: A(v.some_field, _href=URL('edit_record', r.id))
```

If the first record of mytable has values {id: 1, myref: 5}, then the value A(..., _href=URL('edit_record', 1)) will be stored in repr_cache['myref'][5] .

Now if a subsequent record has values {id: 10, myref: 5}, then the value stored in repr_cache['myref'][5] will be retrieved (because the value 5 of the represent field matches the cache key from the earlier record), but it will be incorrect, because the correct value should be A(..., _href=URL('edit_record', 10)).

The problem is that the key (5 in this case) does not uniquely identify the returned value of the represent function, which depends not only on the value 5, but also on the value of r.id.

This feature should either be reverted or fixed to accommodate custom ""represent"" functions.
"
1023,Script to install web2py with nginx and uwsgi on centos 7,2015-07-16T11:40:26Z,2015-07-19T16:35:31Z,,,,"Tested on centos 7 minimal install and on DigitalOcean's centos 7 image
"
1022,web2py.js web2py_websocket onclose bug,2015-07-16T00:34:20Z,2016-02-02T20:45:52Z,,,,"After specifying all 4 parameters of the web2py_websocket function in web2py.js, only the url, onmessage and onopen parameters seem to work. onclose doesn't execute when client disconnects/socket closes.

More information in this thread https://groups.google.com/forum/#!topic/web2py/l-03-Ymauy4
"
1021,Ability to send a custom HTTP header with web2py responses,2015-07-15T09:32:19Z,,enhancement,,," I would like to a custom http header ""X-APP-VERSION"" alongwith all the web2py responses.

For 200 OK I do it using code below in the models file:

response.headers[""X-APP-VERSION""] = config.version

However, for error cases  like 500 internal error there doesn't seem to be anyway today.
"
1020,DAL selecting fields and table that is not on query,2015-07-14T14:17:16Z,2015-07-15T09:33:51Z,,,,"I don't know if this could be a risk or if it is the expected behaviour in those cases. 
Someone else can reproduce this?

If i do this on my table:

> > > db(db.IE_pessoa.id>0).select(db.auth_user.first_name)
> > > <Rows (1)>
> > > it returns the data on auth_user, even when not explicit in the table on query. And the table has not any relation with auth_user.

Tested too on the version for testers(2.11.2-stable+timestamp.2015.05.30.16.33.24) on the site:
Create a test application;
create a simple table:
db.define_table('test',
                Field('test_name')
                )
register a user;
populate the table(if the query is empty it not returns the table on the select):

> > > a = db(db.test.id>0).select(db.auth_user.first_name)
> > > print a
> > > auth_user.first_name
> > > db.test.insert(test_name='test')
> > > 1L
> > > print db(db.test.id>0).select(db.auth_user.first_name)
> > > auth_user.first_name
> > > leonardo
"
1019,Updated to pydal 15.07,2015-07-13T12:26:21Z,2015-07-16T08:57:13Z,,,,
1018,fix validations IS_IPV6 and IS_IPADDRESS,2015-07-10T04:14:29Z,2015-07-16T08:57:06Z,,"AttributeError, AssertionError","AttributeError: 'module' object has no attribute 'IPAddress', AssertionError: Tuples differ: ('fe80::126c:8ffa:fe22:b3af', ... != ('fe80::126c:8ffa:fe22:b3af', ...","IS_IPV6 and IS_IPADDRESS can raise error if you already have ipaddress library(via pip)

ERROR: test_IS_IPADDRESS (gluon.tests.test_validators.TestValidators)

Traceback (most recent call last):
  File ""gluon/tests/test_validators.py"", line 455, in test_IS_IPADDRESS
    rtn = IS_IPADDRESS()('192.168.1.5')
  File ""gluon/validators.py"", line 3711, in **call**
    ip = ipaddress.IPAddress(value)
AttributeError: 'module' object has no attribute 'IPAddress'

FAIL: test_IS_IPV6 (gluon.tests.test_validators.TestValidators)

Traceback (most recent call last):
  File ""gluon/tests/test_validators.py"", line 426, in test_IS_IPV6
    self.assertEqual(rtn, ('fe80::126c:8ffa:fe22:b3af', None))
AssertionError: Tuples differ: ('fe80::126c:8ffa:fe22:b3af', ... != ('fe80::126c:8ffa:fe22:b3af', ...

First differing element 1:
Enter valid IPv6 address
None
- ('fe80::126c:8ffa:fe22:b3af', 'Enter valid IPv6 address')
- ('fe80::126c:8ffa:fe22:b3af', None)

This version now working with ipaddress and contrib ipaddr.
"
1017,Small typo,2015-07-06T21:09:50Z,2015-07-07T08:55:17Z,,,,"Sorry! Can't resist when you see typo on the terminal !
"
1016,fix Field.Virtual use in multi-table queries,2015-07-06T12:37:05Z,2015-07-06T12:44:49Z,,,,
1015,SQLFORM.factory uses fieldname instead of  rname in form.vars,2015-07-03T13:47:31Z,2015-07-03T14:22:56Z,,,,"I specified a table definition and  a form like this:
db.define_table('tiatpi',Field('MyFieldName', rname='twistedFunnyRecordName'))
form = SQLFORM.factory(db.tiatpi)

Then I entered a value into the field and upon successful form.process().accepted i did:
logging.warn(gluon.contrib.simplejson.dumps(form.vars))

The output looked like:
WARNING:root:{""MyFieldName"": ""foo"", ""id"": 1}

The expected output would have been:
WARNING:root:{""twistedFunnyRecordName"": ""foo"", ""id"": 1}

I'm not sure, if this is an issue with DAL or web2py.
produced with web2py_version: 2.11.2-stable+timestamp.2015.05.30.16.33.24
"
1014,stuck at create new app,2015-07-03T09:02:07Z,2015-07-06T01:30:46Z,,ValueError,ValueError: INSERT INTO appcreate(name) VALUES ('one');,"Hi, i'm new to web2py, i've stuck creating new app for a while, and i did some google, yet not solved...
Here is it.
### first try

When i hit the create button use the name 'one' in 'site' page, which give me this:

``` python
  File ""/Users/gavin/code/open_source/web2py/gluon/packages/dal/pydal/adapters/base.py"", line 737, in insert
    raise e
ValueError: INSERT INTO appcreate(name) VALUES ('one');
```

I have no idea what's wrong , but i thought there could be a folder created by web2py, but i was wrong. Then let's debug it.
### try again

I put a 'import pdb;pdb.set_trace()'  under the function site() in applications/admin/controllers/default.py  , which gave me this:

``` bash
(Pdb) Tcl_WaitForEvent: Notifier not initialized
```

Then i relized that Tkinter is running and pdb will not function.And i have no experience using TKinter, so i give up.
### third try

I find a command-line option ""-S APPNAME, --shell=APPNAME"" will create the app if not exist , looks great , which turn out drive me crazy......
The program is not working when i hit ENTER, it shows in the terminal like this:

``` bash
web2py Web Framework
Created by Massimo Di Pierro, Copyright 2007-2015
Version 2.11.2-stable+timestamp.2015.05.30.11.29.46
Database drivers available: sqlite3, imaplib, pyodbc, pymysql, pg8000
application one does not exist, create (y/n)?y^M^M^M
```

what???
I don't know if that was my shell's wrong configation or what?
### another try?

I'm going insane...
The only way i can thought now is try a NON-GUI start up and put pdb in the code like my second try, which is a way to go and what i'm doing now...
The command is 

``` bash
 python web2py.py --nogui -a '111111'
```

-a set the admin password

I'm just not comfortable with a vary start like this, and NOT EASY for me...
So, please anybody can tell me what is the problem? 
And if there is a debug mode for easy develop?
And what if i dont't want the admin way to develop my application?
"
1013,scheduler.queue_task() is broken by validation,2015-07-02T20:25:24Z,2015-07-15T13:08:46Z,,,,"This used to work, but now even the example in the book doesn't work.

```
>>> scheduler.queue_task('demo1', [1,2])
<Row {'errors': {'status': 'Value not allowed', 'start_time': 'Enter date and time as 1963-08-28 14:30:59', 'period': 'Enter an integer greater than or equal to 0', 'sync_output': 'Enter an integer greater than or equal to 0
', 'timeout': 'Enter an integer greater than or equal to 1', 'application_name': 'Enter a value', 'retry_failed': 'Enter an integer greater than or equal to -1', 'repeats': 'Enter an integer greater than or equal to 0'}, 'id
': None, 'uuid': None}>

```
"
1012,"Security fix: Validate for open redirect everywhere, not just in login()",2015-07-01T22:45:23Z,2015-07-02T11:40:12Z,,,,"Discussed in private email with Massimo. Current version of web2py is only checking for open redirects in the login() function, not in the logout (or other similar) functions.
Reference: https://groups.google.com/forum/#!topic/web2py-developers/OLMKVyUoNHM
"
1011,Ignorecase on search grid whe starts with,2015-07-01T21:01:47Z,2015-07-05T06:05:57Z,,,,"With the version Version 2.11.2-stable, the application don't enforce ignore case on search that ""startswith"".

I think that this wouldn't be the expected behaviour
"
1010,sqlform.factory issue,2015-07-01T16:43:43Z,2015-07-06T15:29:25Z,,,,"Please see https://github.com/web2py/pydal/issues/243
"
1009,Fix compatibility with Tornado 4,2015-07-01T10:08:59Z,2015-07-02T11:38:35Z,,,,"http://stackoverflow.com/questions/24851207/tornado-403-get-warning-when-opening-websocket

as discussed here:

https://groups.google.com/forum/#!searchin/web2py/serbitar/web2py/BiNZTSL9mtA/4w7_EJQcfoYJ
"
1008,Moved pack as exe functionality to the pack_custom.html form,2015-06-30T18:22:17Z,2015-07-01T14:01:50Z,,,,
1007,Allow packing an application with the windows executable,2015-06-30T16:54:11Z,2015-06-30T17:32:05Z,,,,
1006,Workaround http://bugs.python.org/issue9405 on OS X.,2015-06-30T14:59:48Z,2015-07-02T11:38:18Z,,,,"I'd like to get this in since it's still an issue under OS X. 
See https://groups.google.com/forum/#!topic/web2py/WSjhhDet1UM
for context.
"
1005,change misspelling,2015-06-18T08:13:45Z,2015-06-18T11:31:51Z,,,,
1004,simplified conditions,2015-06-18T08:06:14Z,2015-06-18T11:31:22Z,,,,
1003,remove duplicated execution,2015-06-18T07:55:23Z,2015-06-18T11:31:08Z,,,,"is that really duplicated or missing something to add for difference?
"
1002,change initialization,2015-06-18T07:41:17Z,2015-06-18T11:30:30Z,,,,"ok must be True or False. 
set False is better for initialization
"
1001,Update appadmin.py,2015-06-18T07:32:31Z,2015-06-18T11:29:57Z,,,,
1000,after appveyor hooks have been defined...,2015-06-17T19:24:04Z,2015-06-18T11:28:39Z,,,,"...pull this in
"
999,gluon.sanitiizer.sanitze omits lots of valid data due to a bug with self.in_disallowed,2015-06-16T14:09:17Z,2015-06-25T09:19:15Z,,,,"Trying to print out some (beautifully crafted) table, only some lines of my html made it into the pdf. After some debugging, it became clear, that the implementation of gluon/sanitizer.py for sanitze() method lacks some stacking mechanism to determine, wether the current tag is disallowed for output or not.

I created a patch, but I'm not sure, if I understood the semantics of self.in_disallowed entirely, so someone should take a careful look at my patch. Furthermore my testing was very incomplete, I just wanted to get it going.

The patch basically transforms self.in_disallowed into a list (stack):

```
--- old/gluon/sanitizer.py  2015-06-16 14:17:33.306511483 +0200
+++ new/gluon/sanitizer.py  2015-06-16 15:49:51.886349544 +0200
@@ -66,14 +66,15 @@

         #to strip or escape disallowed tags?
         self.strip_disallowed = strip_disallowed
-        self.in_disallowed = False
+        # there might be data after final closing tag, that is to be ignored
+        self.in_disallowed = [True]

     def handle_data(self, data):
-        if data and not self.in_disallowed:
+        if data and not self.in_disallowed[-1]:
             self.result += xssescape(data)

     def handle_charref(self, ref):
-        if self.in_disallowed:
+        if self.in_disallowed[-1]:
             return
         elif len(ref) < 7 and (ref.isdigit() or ref == 'x27'): # x27 is a special case for apostrophe
             self.result += '&#%s;' % ref
@@ -81,7 +82,7 @@
             self.result += xssescape('&#%s' % ref)

     def handle_entityref(self, ref):
-        if self.in_disallowed:
+        if self.in_disallowed[-1]:
             return
         elif ref in entitydefs:
             self.result += '&%s;' % ref
@@ -89,7 +90,7 @@
             self.result += xssescape('&%s' % ref)

     def handle_comment(self, comment):
-        if self.in_disallowed:
+        if self.in_disallowed[-1]:
             return
         elif comment:
             self.result += xssescape('<!--%s-->' % comment)
@@ -100,11 +101,11 @@
         attrs
     ):
         if tag not in self.permitted_tags:
-            if self.strip_disallowed:
-                self.in_disallowed = True
-            else:
+            self.in_disallowed.append(True)
+            if (not self.strip_disallowed):
                 self.result += xssescape('<%s>' % tag)
         else:
+            self.in_disallowed.append(False)
             bt = '<' + tag
             if tag in self.allowed_attributes:
                 attrs = dict(attrs)
@@ -129,10 +130,9 @@

     def handle_endtag(self, tag):
         bracketed = '</%s>' % tag
+        self.in_disallowed.pop()
         if tag not in self.permitted_tags:
-            if self.strip_disallowed:
-                self.in_disallowed = False
-            else:
+            if (not self.strip_disallowed):
                 self.result += xssescape(bracketed)
         elif tag in self.open_tags:
             self.result += bracketed
```
"
998,move to codecov and enable appveyor too,2015-06-14T19:20:00Z,2015-06-17T07:00:48Z,,,,
997,fix display of checkboxes in search form of grid,2015-06-11T19:54:48Z,2015-06-17T07:00:34Z,,,,
996,"Fixed appadmin action of cleaning an application of errors, sessions, and cahce",2015-06-09T15:55:00Z,2015-06-09T18:35:29Z,,,,"The current web2py action for cleaning a project from the app admin interface has an error when trying to run ""clean"" due to adding an extra ""cache"" folder to the path when trying to clear the on-disk cache. 
"
995,fixes #994,2015-06-05T20:11:19Z,2015-06-08T02:47:28Z,,,,"we were overriding default classes for specific widgets
"
994,grid search forms are not tied to specific widgets,2015-06-05T20:06:15Z,2015-06-08T02:47:28Z,,,,"see https://groups.google.com/forum/#!topic/web2py/bNM02rUqkbM for references
"
993,GAE list integer fields don't store zeros on versions above 2.9.x,2015-06-02T20:24:18Z,2015-06-07T11:52:55Z,DAL,,,"On web2py 2.10.x and 2.11.x the Google App Engine list integer type does not correctly store a list of integers supplied to it - a list of strings does get correctly stored.

Example model file:
db.define_table('example',Field('mylistint','list:integer'))

Controller file
import time

def index():
    mylistints = [1,0,3,0,5]
    mylist2 = ['2','0','4','0','6']
    db.example.insert(mylistint=mylistints)
    db.example.insert(mylistint=mylist2)
    time.sleep(2)
    rows = db(db.example.id>0).select()
    return dict(rows=rows)

view file:
{{for row in rows:}}

<p>Length: {{=len(row.mylistint)}} Value: {{=row.mylistint}}</p>

{{pass}}

Result
Length: 3 Value: [1, 3, 5]
Length: 5 Value: [2, 0, 4, 0, 6]
"
992,Fixed authentication using different login methods.,2015-06-02T16:30:32Z,2015-06-08T02:47:08Z,,,,"There is a bug when attempting to use basic authentication with the auth plugins like LDAP. 

The bug was that after authentication was successful, a user name was returned rather than a user object. 

I just replaced username with user for the two lines appropriate in the login_bare() method. 

This should allow others to still use AD/LDAP/etc authentication but use web2py as a REST API. 
"
991,Update appadmin.py,2015-06-01T16:29:10Z,2015-06-08T02:44:44Z,,,,
990,remove invalid initialize,2015-06-01T16:00:32Z,2015-06-08T02:44:19Z,,,,
989,how can i read this code?,2015-06-01T02:45:42Z,2015-06-12T21:06:47Z,,,,"how can i read this code?
"
988,Track pyDAL 15.05.29,2015-05-29T18:46:30Z,2015-05-30T16:29:09Z,,,,
987,web admin shell should let us use arrow keys to navigate command history,2015-05-29T14:36:20Z,2015-07-05T06:06:45Z,,,,"Just like in bash terminal. It is very common to mistype a long command, and currently after pressing enter you need to either rewrite the entire command by hand or to painstakingly go to an output window, mark the correct command, paste it to the input window and then modify it.
"
986,web2py-2.11.1 linked to a broken PyDAL (UnicodeEncodeError with postgres/psychopg2),2015-05-29T09:17:36Z,2015-06-12T21:11:11Z,,,,"web2py-2.11.1 is linked to a broken PyDAL version.

The particular issue is that the postgres adapter with psychopg2 returns a unicode for expressions, which then breaks BaseAdapter.expand for all WHERE expressions containing non-ASCII characters:

In adapters/postgres.py:

```
def adapt(self, obj):
    if self.driver_name == 'psycopg2':
        rv = psycopg2_adapt(obj).getquoted()
        if isinstance(rv, bytes):
            return rv.decode(""utf8"") # <= here, returns a unicode
        return rv
    elif self.driver_name == 'pg8000':
        return ""'%s'"" % obj.replace(""%"", ""%%"").replace(""'"", ""''"")
    else:
        return ""'%s'"" % obj.replace(""'"", ""''"")
```

In adapters/base.py:

```
    return str(rv) # <= breaks for unicode with non-ASCII characters
```

Obviously, this is a bit of a blocker for PostgreSQL-based deployments with psychopg2 (99% of all our deployments).

A patch for Python 2.x could be this:

In adapters/postgres.py:

```
def adapt(self, obj):
    if self.driver_name == 'psycopg2':
        rv = psycopg2_adapt(obj).getquoted()
        if isinstance(rv, unicode):
            return rv.encode(self.db_codec) # <= make sure it always returns an encoded str
        return rv
    elif self.driver_name == 'pg8000':
        return ""'%s'"" % obj.replace(""%"", ""%%"").replace(""'"", ""''"")
    else:
        return ""'%s'"" % obj.replace(""'"", ""''"")
```

I've tried to report the issue to PyDAL, but there doesn't seem to be any priority for fixing this, so I was told that it will take weeks before a fix becomes available in web2py :/

Hence, question: should 2.11.1 be downgraded to the previous PyDAL release?
"
985,Invite user,2015-05-29T03:24:05Z,2015-06-28T14:09:04Z,,,,"Invite by email another user to access your application. Note, my
initial version was built on Auth.register_bare which doesn't seem to be
in this repository???
"
984,lazy request.uuid,2015-05-28T16:26:12Z,2015-05-29T04:17:21Z,,,,
983,fix cPickle not defined error,2015-05-28T11:30:33Z,2015-05-29T04:16:33Z,,,,
982,"grid loaded with LOAD(..., ajax=False) raise a TypeError: sequence item 0: expected string, long found",2015-05-26T13:35:33Z,2015-06-25T09:24:08Z,,TypeError,"TypeError: sequence item 0: expected string, long found","Web2py `2.10.4-stable+timestamp.2015.04.26.15.11.54`

For example:

```
db.define_table('parent',Field('nome','string'))
db.define_table('childs',Field('idparent','integer'),Field('nome','string'))
```

if in my view I do something like that:

```
{{for p in parent:}}
{{=LOAD(c='default', f='childs', extension='load', args=[p.id], ajax=True)}}
{{pass}}
```

all is ok, BUT if I set **ajax=False**:

```
{{for p in parent:}}
{{=LOAD(c='default', f='childs', extension='load', args=[p.id], ajax=False)}}
{{pass}}
```

I get an exception in `sqlhtml.py` around line 2110:

```
    if user_signature:
        if not (
            '/'.join(str(a) for a in args) == '/'.join(request.args)

TypeError: sequence item 0: expected string, long found
```
"
981,Track pyDAL 15.05.26,2015-05-26T12:36:23Z,2015-05-29T04:16:02Z,,,,
980,Admin application: can't access directories with space in directory name,2015-05-25T20:35:55Z,2015-06-25T09:30:19Z,,Note2,Note2: I am using a 3rd-party library in my web2py application that expects a certain directory name containing a space character so using a different name is not an option unfortunately.,"This bug concerns the default admin application (web2py administrative interface).

If there is a directory on the host within the application's directory whose name contains a space character (eg. ""/home/user/web2py/applications/example/private/a b/"") then when editing the application using the admin application in a browser (eg. https://hostname.com/admin/default/design/example), I cannot access the contents of the directory ""private/a b/"". 

In the admin application I can see under section ""Private Files"" that there is a folder named ""a b/"". However, clicking on the folder name ""a b/"" will not open up its contents, as opposed to when there's no space in the directory name.

Note: inspecting the HTML source of https://hostname.com/admin/default/design/example I can see that the contents of folder ""a b/"" are already included (""a b/test.txt""):

``` html
<li class=""folder"">
            <a href=""javascript:collapse('private__a b');"" class=""file"">a b/</a>
            <ul id=""private__a b"" style=""display: none;"" class=""sublist"">
        <li>
            <span class=""filetools controls"">
                <a class=""button editbutton btn btn-mini"" href=""/admin/default/edit/examples/private/a%20b/test.txt?id=private""><span>Edit</span></a> <a class=""icon delete"" data-original-title=""Delete this file (you will be asked to confirm deletion)"" data-placement=""right"" href=""/admin/default/delete/examples/private/a%20b/test.txt?id=private&amp;id2=private&amp;sender=design%2Fexamples"" rel=""tooltip""><img src=""/admin/static/_2.10.4/images/delete_icon.png"" /><span>Delete this file (you will be asked to confirm deletion)</span></a>
            </span>
            <span class=""file"">
                <a href=""/admin/default/peek/examples/private/a%20b/test.txt?id=private"">a b/utc8_test.txt</a>
            </span>
        </li>
            </ul>
        </li>
```

So it seems there's a Javascript error opening that `<ul>` in the browser.

Note2: I am using a 3rd-party library in my web2py application that expects a certain directory name containing a space character so using a different name is not an option unfortunately.

web2py version: 2.10.4-stable+timestamp.2015.04.26.15.11.54
host OS's tested: MAC OS X, Ubuntu Linux

thanks
"
979,smartgrid fails when selecting multiple items in a 'list:reference' field using multiple=True,2015-05-25T10:56:26Z,2015-05-29T12:15:21Z,,TypeError,"TypeError: int() argument must be a string or a number, not 'list'","Given model: 

``` python
repr_query_list = lambda field_name: lambda value, row: ','.join(x.name for x in row[field_name])

db.define_table('source_query',
                Field('name', required=True),
)

db.define_table('signal_def',
                Field('name', required=True),
                Field('exclusions', 'list:reference source_query',
                      requires=IS_EMPTY_OR(IS_IN_DB(db, 'source_query.id', '%(name)s', multiple=True)),
                      represent=repr_query_list('exclusions'),
                      ),
                )
```

I have a database with multiple `source_query` entries, which show up perfectly in the grid, and are selectable by name in the dropdown when editing through a `SQLFORM.smartgrid`. 

When selecting a single item in the drop down list all is well, but when selecting multiple an error pops up: 

`<type 'exceptions.TypeError'> int() argument must be a string or a number, not 'list'`

Partial traceback: 

```
  File ""C:/Users/remco/Desktop/web2py/applications/vsv/controllers/default.py"", line 28, in index
    return dict(grid=SQLFORM.smartgrid(db.signal_def), sample_signals=collector_sink.signals)
  File ""C:\Users\remco\Desktop\web2py\gluon\sqlhtml.py"", line 3028, in smartgrid
    user_signature=user_signature, **kwargs)
  File ""C:\Users\remco\Desktop\web2py\gluon\sqlhtml.py"", line 2280, in grid
    next=referrer)
  File ""C:\Users\remco\Desktop\web2py\gluon\html.py"", line 2301, in process
    self.validate(**kwargs)
  File ""C:\Users\remco\Desktop\web2py\gluon\html.py"", line 2238, in validate
    if self.accepts(**kwargs):
  File ""C:\Users\remco\Desktop\web2py\gluon\sqlhtml.py"", line 1644, in accepts
    fields[fieldname] = safe_int(value)
  File ""C:\Users\remco\Desktop\web2py\gluon\sqlhtml.py"", line 77, in safe_int
    return int(x)
TypeError: int() argument must be a string or a number, not 'list'
```

Using: running: `Version 2.11.0-alpha+timestamp.2015.05.24.19.14.16` - but i've had this error in previous versions as well. 
"
978,Autotypes and unicode strings,2015-05-25T06:59:19Z,2015-06-25T09:31:49Z,,,,"Couldn't find anything on this on the list. But found that the `SQLFORM.dictform()` doesn't function properly when providing a `dict(key=u""some unicode"")` since the unicode type isn't recognized in the `SQLFORM.AUTOTYPES` dictionary and therefor will drop the key,value pair. 

Here's a patch to solve it: 

``` diff
--- gluon/sqlhtml.py    (revision 1e66fa3a93560aa5d32c27a6b1b7251e0dd8a428)
+++ gluon/sqlhtml.py    (revision )
@@ -1691,6 +1691,7 @@

     AUTOTYPES = {
         type(''): ('string', None),
+        type(u''): ('string',None),
         type(True): ('boolean', None),
         type(1): ('integer', IS_INT_IN_RANGE(-1e12, +1e12)),
         type(1.0): ('double', IS_FLOAT_IN_RANGE()),
```
"
977,"Changed ""Import about this GIT repo"" Line 16, typo",2015-05-24T23:13:14Z,2015-05-24T23:58:22Z,,,,"My proposal is to change it to ""Important reminder about this GIT Repo"", as I think the ""Import"" part in the current one is a typo.
"
976,thanks  @wmunguiam for spotting,2015-05-24T19:26:07Z,2015-05-24T23:57:51Z,,,,
975,Track pyDAL 15.05,2015-05-23T14:38:24Z,2015-05-24T23:57:36Z,,,,
974,redis multi-app. Thanks Lisandro for spotting it,2015-05-21T20:26:45Z,2015-05-24T23:57:26Z,,,,"redis_cache didn't play well with multiple apps for a silly mistake.
Glad that Lisadro pointed out
"
973,Update dal.py,2015-05-20T05:12:45Z,2015-05-20T13:27:41Z,,ImportError,ImportError: cannot import name Set,"I was running my application and got this error

{
<type 'exceptions.ImportError'> cannot import name Set

Version
web2py‚Ñ¢   Version 2.10.4-stable+timestamp.2015.04.26.15.11.54
Python  Python 2.7.3: /usr/bin/python (prefix: /usr)
Traceback
1.
2.
3.
4.
5.
6.
7.
8.
9.
10.
11.
12.
13.
14.
15.
16.
Traceback (most recent call last):
  File ""/home/www-data/web2py/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/home/www-data/web2py/applications/omniavx_cxn/controllers/valuecache.py"", line 6897, in <module>
  File ""/home/www-data/web2py/gluon/globals.py"", line 393, in <lambda>
    self._caller = lambda f: f()
  File ""/home/www-data/web2py/applications/omniavx_cxn/controllers/valuecache.py"", line 6584, in browse_bacct_callback
    from plugin_PowerGrid.CallBack import CallBack
  File ""/home/www-data/web2py/gluon/custom_import.py"", line 95, in custom_importer
    return base_importer(pname, globals, locals, fromlist, level)
  File ""/home/www-data/web2py/gluon/custom_import.py"", line 134, in __call__
    result = NATIVE_IMPORTER(name, globals, locals, fromlist, level)
  File ""applications/omniavx_cxn/modules/plugin_PowerGrid/CallBack.py"", line 41, in <module>
    from gluon.dal import Table ,Query, Set, Rows, Row
ImportError: cannot import name Set
}

same code produced no error in earlier version of web2py

line 15 of web2py/gluon/dal.py is 
{
from pydal.objects import Row, Rows, Table, Query, Expression
}

replacing that with 
{
from pydal.objects import Row, Rows, Table, Query, Set, Expression

}

solves the problem
"
972,Text that follows a double-quote inside of current.T() is chopped when used as textarea placeholder,2015-05-18T17:23:54Z,,,,,"There are cases in which text that contains double-quotes, after being passed to LazyT, is chopped, following the first double quote . The issue is described in detail in this thread: https://groups.google.com/forum/#!topic/web2py/V1ichclAkaY

This is Anthony's explanation:

The problem is that there is an inconsistency with the escaping of regular strings vs. LazyT objects when serializing HTML helpers. When helpers are serialized, all attribute values are passed to gluon.html.xmlescape. In xmlescape, regular strings are ultimately passed to cgi.escape with the ""quote"" argument set to True. However, LazyT objects are not passed to cgi.escape but instead have their .xml() method called, and that method calls cgi.escape with the ""quote"" argument set to False. As a result, double quotes are not converted to ""&quot;"". This creates a problem because when helpers are serialized, all attributes are wrapped with double quotes, so you cannot have double quotes within the attribute unless they are HTML encoded. This should probably be considered a bug. Perhaps xmlescape should check for LazyT objects and instead of calling the .xml() method, treat it as a string object.
"
971,with_alias(),2015-05-17T15:50:41Z,2015-05-18T16:31:15Z,,,,"https://github.com/web2py/pydal/issues/143
https://github.com/web2py/web2py/issues/932
Closed non-fixed issue.

Version 2.10.4-stable+timestamp.2015.04.26.09.05.21
The issue is still open. 
"
970,Fixing https://github.com/web2py/web2py/issues/969,2015-05-13T22:24:16Z,2015-05-14T14:16:52Z,,,,"Running readline.parse_and_bind(""bind ^I rl_complete"") makes the letter ""b"" stop working on the console. This patch solves the issue and correctly enables tab completition on OSX.
"
969,"Can't type lowercase ""b"" in the interactive console on OSX",2015-05-13T22:19:45Z,2015-06-25T16:02:38Z,,,,"I just tried running the interactive console for the first time by doing

```
‚ûú ./web2py.py -S welcome -M
...
>>>
```

The first thing I tried typing was ""db"", but as soon as I hit ""b"" I just got an alert. Uppercase B works fine. [This seems to be a common issue with python](https://superuser.com/questions/297527/cant-type-the-b-letter-in-python-shell-in-os-x), but so far I've been unable to fix it, as it only occurs withn web2py.
"
968,IS_MATCH validator bug with unicode,2015-05-13T10:10:04Z,2015-06-25T09:36:27Z,,,,"there is a bug when the IS_MATCH validator is used with is_unicode=True
If the input contains non-ascii characters and is already unicode an UnicodeEncodeError occurs:

```
def __call__(self, value):
    if self.is_unicode and not isinstance(value,unicode):
        match = self.regex.search(str(value).decode('utf8'))
    else:
        match = self.regex.search(str(value))
```

this happens because the else branch is executed. A possible fix:

```
def __call__(self, value):
    if self.is_unicode:
        if not isinstance(value,unicode):
            match = self.regex.search(str(value).decode('utf8'))
        else:
            match = self.regex.search(value)
    else:
        match = self.regex.search(str(value))
```
"
967,fixes #966 - deadlock in cache.disk,2015-05-13T01:42:29Z,2015-05-14T14:16:31Z,,,,
966,Deadlock in cache.py/CacheOnDisk in R 2.10.4,2015-05-13T01:10:47Z,2015-05-14T14:16:32Z,,,,"found a blocking issue in our app with some image download after upgrading from 2.9.12 to 2.10.4
deadlock in CacheOnDisk class in case of exception in our cache callback function, normally handled in our app
without any issue until now.

the new file_locks introduced in 2.10.1, (3e46e985bf15) acquired before the cache app callback ( value = f() )
with self.storage.acquire(CacheAbstract.cache_stats_name) 
Is never released in case of exception in f()
then next call to the CacheOnDisk during same request will block the thread indefinitely.

(CacheInRam should not have the same issue as self.locker.release() is released before f())
- proposed fix to follow

Bernard Letourmy
"
965,fixes #962,2015-05-11T19:25:18Z,2015-05-14T14:16:10Z,,,,
964,#963 : Convert subject and body to unicode before sending mail,2015-05-09T16:31:39Z,2015-05-14T14:17:04Z,,TypeError,"TypeError: <class 'gluon.languages.lazyT'> has type <class 'gluon.languages.lazyT'>, but expected one of: str, unicode","Patch for issue #963.

Not doing this was raising an exception :

Traceback (most recent call last):
  File /base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/restricted.py, line 227, in restricted
    exec ccode in environment
  File /base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/applications/foundit/controllers/default.py, line 127, in <module>
  File /base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/globals.py, line 393, in <lambda>
    self._caller = lambda f: f()
  File /base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/applications/foundit/controllers/default.py, line 34, in user
    return dict(form=auth())
  File /base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/tools.py, line 1595, in __call__
    return getattr(self, args[0])()
  File /base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/tools.py, line 3272, in request_reset_password
    if self.email_reset_password(user):
  File /base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/tools.py, line 3296, in email_reset_password
    message=self.messages.reset_password % d):
  File /base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/tools.py, line 798, in send
    subject=subject, body=text, **xcc)
  File /base/data/home/runtimes/python27/python27_lib/versions/1/google/appengine/api/mail.py, line 402, in send_mail
    message.send(make_sync_call=make_sync_call)
  File /base/data/home/runtimes/python27/python27_lib/versions/1/google/appengine/api/mail.py, line 1108, in send
    message = self.ToProto()
  File /base/data/home/runtimes/python27/python27_lib/versions/1/google/appengine/api/mail.py, line 1350, in ToProto
    message = super(EmailMessage, self).ToProto()
  File /base/data/home/runtimes/python27/python27_lib/versions/1/google/appengine/api/mail.py, line 1046, in ToProto
    message.set_subject(_to_str(self.subject))
  File cpp_message.pyx, line 124, in cpp_message.SetScalarAccessors.Setter (third_party/apphosting/python/protobuf/proto1/cpp_message.cc:2229)
TypeError: <class 'gluon.languages.lazyT'> has type <class 'gluon.languages.lazyT'>, but expected one of: str, unicode
"
963,TypeError exception (get Lazy instead of str or unicode) when sending mail on GAE,2015-05-09T16:08:02Z,2015-07-15T09:45:14Z,,TypeError,"TypeError: <class 'gluon.languages.lazyT'> has type <class 'gluon.languages.lazyT'>, but expected one of: str, unicode","Sending a mail with body containing translated strings resulted in the following exception : 

```
Traceback (most recent call last):
  File ""/base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/applications/foundit/controllers/default.py"", line 127, in <module>
  File ""/base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/globals.py"", line 393, in <lambda>
    self._caller = lambda f: f()
  File ""/base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/applications/foundit/controllers/default.py"", line 34, in user
    return dict(form=auth())
  File ""/base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/tools.py"", line 1595, in __call__
    return getattr(self, args[0])()
  File ""/base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/tools.py"", line 3272, in request_reset_password
    if self.email_reset_password(user):
  File ""/base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/tools.py"", line 3296, in email_reset_password
    message=self.messages.reset_password % d):
  File ""/base/data/home/apps/e~sacred-bonus-88417/1.384178859090314065/gluon/tools.py"", line 798, in send
    subject=subject, body=text, **xcc)
  File ""/base/data/home/runtimes/python27/python27_lib/versions/1/google/appengine/api/mail.py"", line 402, in send_mail
    message.send(make_sync_call=make_sync_call)
  File ""/base/data/home/runtimes/python27/python27_lib/versions/1/google/appengine/api/mail.py"", line 1108, in send
    message = self.ToProto()
  File ""/base/data/home/runtimes/python27/python27_lib/versions/1/google/appengine/api/mail.py"", line 1350, in ToProto
    message = super(EmailMessage, self).ToProto()
  File ""/base/data/home/runtimes/python27/python27_lib/versions/1/google/appengine/api/mail.py"", line 1046, in ToProto
    message.set_subject(_to_str(self.subject))
  File ""cpp_message.pyx"", line 124, in cpp_message.SetScalarAccessors.Setter (third_party/apphosting/python/protobuf/proto1/cpp_message.cc:2229)
TypeError: <class 'gluon.languages.lazyT'> has type <class 'gluon.languages.lazyT'>, but expected one of: str, unicode
```
"
962,'exposes' and 'edit views' order in editor,2015-05-09T10:17:59Z,2015-05-14T14:16:11Z,,,,"I suggest to change 'exposes' and 'edit views' order in editor to alphabetic.

web2py user google group thread:
https://groups.google.com/forum/#!msg/web2py/eY7g2apCK7w/Bj2_L9gm_HEJ
"
961,fixes #628,2015-05-08T19:55:13Z,2015-05-14T14:14:06Z,,,,"response.include_files is now cleaner and easier to maintain

You can specify a tuple of (type, url) to include external assets
without extension (such as the usecase described in #628)

Added tests for include_files, that was never included in CI tests
"
960,custom delimiters not working when w2p package is compiled,2015-05-07T14:07:45Z,2015-06-25T09:37:23Z,,,,"When application isn't compiled all is working fine, but when compiled custom delimiters aren't parsed correctly.

Controller:
`def index():
   response.delimiters = ['{%','%}']
   return dict(message=""hello from test.py"")`

View:
`<h1>Questo √® il template index.html</h1>
{%=BEAUTIFY(response._vars)%}`

Tested on (the result was the same):
2.10.4-stable+timestamp.2015.04.26.15.11.54
(Running on Rocket 1.2.6, Python 2.7.3)
&
2.9.12-stable+timestamp.2015.01.17.06.11.03
(Running on nginx/1.4.6, Python 2.7.6)
"
959,catch psutils error,2015-05-07T12:02:43Z,2015-05-11T07:09:12Z,,IOError,IOError: [Errno 2] No such file or directory: '/proc/meminfo',"Even if psutils is present, there is no guarantee that it'll work, it depends on specific information on the host as /proc/meminfo not always available (for example on pythonanywhere).

```
>>> import psutil
>>> psutil.virtual_memory().percent
Traceback (most recent call last):
  File ""<stdin>"", line 1, in <module>
  File ""/usr/local/lib/python2.7/dist-packages/psutil/__init__.py"", line 1413, in virtual_memory
    return _psplatform.virtual_memory()
  File ""/usr/local/lib/python2.7/dist-packages/psutil/_pslinux.py"", line 172, in virtual_memory
    f = open('/proc/meminfo', 'r')
IOError: [Errno 2] No such file or directory: '/proc/meminfo'
```
"
958,Overhaul of cache.redis connection algorithm / 'fail-gracefully-if-server-unavailable' flag.,2015-05-07T07:15:42Z,2016-01-04T15:43:58Z,,,,"Original issue reported as cache.redis fails with a traceback when the server is unavailable.  Expected behaviour was to have it fail gracefully and respond with the ""key doesn't exist"" behaviour and continue processing.

Niphlod pointed out use case for it to fail with traceback but also agrees that a flag can be added to allow user choice of failure mode on establishing the Redis connection.  For example, a new flag `fail_gracefully=True` would not cause a traceback and would respond as if key didn't exist if the redis server is unavailable.  If set to False then the traceback would occur.

There was also an issue pointed out in the connection delay on unavailable being 30 seconds before action taken, which, for the fail gracefully option should be a lot shorter (5 seconds, say).

Niphlod then pointed out that he would like to overhaul the whole Redis connection algorithm at which point the flag could be added and requested an issue be opened here.

Original conversation thread on Google Groups:  
https://groups.google.com/forum/?fromgroups#!topic/web2py/3lvoUmzuo3o
"
957,RecordUpdater in gluon/packages/dal/pydal/helpers/classes.py does not trigger _before_update and _after_update,2015-05-04T18:06:17Z,2015-05-04T20:44:41Z,,,,"the RecordUpdater.**call** method in gluon/packages/dal/pydal/helpers/classes.py does not call the functions in _before_update and _after_update, like Set.update does, for instance.

I think it would be more consistent to call those functions.

The same applies to RecordDeleter.
"
956,More changes in List (request.args),2015-05-04T15:50:38Z,2015-05-20T13:27:16Z,,,,"- Better documented List
- Otherwise not binded with cast
- new tests to verify old behaviour 
- test otherwise without cast and defaut
- verify if behave like a list 
- more test with call function
  Related to #955 
"
955,gluon.storage.List does not support reverse slicing (i.e. with negative step),2015-05-04T06:48:54Z,2015-05-22T13:23:53Z,,,,"Unlike normal lists, gluon.storage.List instances do not support slicing with negative step like [::-1]:

Normal list:

```
>>> x = [1,2,3]
>>> print x[::-1]
[3, 2, 1]
```

gluon.storage.List:

```
>>> x = List([1,2,3])
>>> print x[::-1]
None
```

This breaks our code, unfortunately :/
"
954,Mantain backward compatibility,2015-05-03T16:38:19Z,2015-05-03T21:42:12Z,,,,"Mantain backward compability, this pull request is related to #950 .
"
953,fixes issue #691,2015-05-03T14:06:40Z,2015-05-03T15:31:32Z,,,,"merely a wording issue, but nonetheless an issue.
"
952,fixes #734,2015-05-03T13:51:36Z,2015-05-03T15:31:21Z,,,,
951,"more tests, general cleanup",2015-05-03T13:33:59Z,2015-05-03T15:31:08Z,,,,
950,Fix List behaviour and added new feature,2015-05-02T23:27:45Z,2015-05-03T15:23:08Z,,,,"Now List has the behavior equal your comments(look at **getitem**) and we can do:
test = request.args(0 , otherwise=URL('default', 'index')) and i will be redirected if args is not found.
Otherwise parameter is not binded with cast.
"
949,when ajax_trap=True then component is only partially initialised,2015-04-28T20:02:24Z,2015-05-03T12:51:13Z,,,,"For components:

When ajax=True then w2p-data_remote is set to the url. Also you can call component.reload().

When ajax_trap=True then w2p-data_remote is not set and reload does not work.
"
948,load with ajax=false ignored if url parameter set,2015-04-28T19:58:39Z,2015-09-08T06:59:29Z,,,,"{{=LOAD(c='referee', f='grid.load', ajax=False, ajax_trap=True, vars=dict(customer=id), target='referee')}}
{{=LOAD(url=URL(c='referee2', f='grid.load', vars=dict(customer=id)), ajax=False, ajax_trap=True, target='referee2')}}

referee2 is requested with ajax=True despite the parameter ajax=False.
"
947,reset_password changed: adapt documentation,2015-04-28T09:28:45Z,2015-05-03T15:18:46Z,,,,"Hi all,
we recently ran into an issue not so easy to identify: on our service site we made the link for the reset password function according to the book on http://web2py.com/books/default/chapter/29/09/access-control#Mail-and-Auth like this: 
`auth.messages.reset_password = 'Click on the link http://' +     request.env.http_host +     URL(r=request,c='default',f='user',args=['reset_password']) +     '/%(key)s to reset your password'`
This worked for the last couple of years until our update from 2.9.12 to 2.10.4. As we finally found, the line in tools.py being responsible for getting the reset key changed: 

```
    diff <new version >old version
    ....
    3015a3014,3015
    >             if not key and len(request.args)>1:
    >                 key = request.args[-1]
    3022c3022
    <             key = request.vars.key
    ---
    >             key = request.vars.key or getarg(-1)
```

So obviously the above passage in the book (and of course in every users installation ...) has to be changed into
`auth.messages.reset_password = 'Click on the link http://' +     request.env.http_host +     URL(r=request,c='default',f='user',args=['reset_password']) +     '?key=%(key)s to reset your password'` 

Please note the change from
    _'/%(key)s ...'_
to
    **_'?key=%(key)s ...'**_

By the way: where's the benefit in this change anyway?

Greets, D
"
946,Record Archives error on 2.10.4,2015-04-27T11:51:12Z,2015-05-04T22:58:28Z,,TypeError,"TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types","**Error snapshot**
<type 'exceptions.TypeError'>(isinstance() arg 2 must be a class, type, or tuple of classes and types)

**Traceback**
Traceback (most recent call last):
  File ""/home/franciscocosta/www/web2py/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/home/franciscocosta/www/web2py/applications/emprega/views/historico.html"", line 438, in <module>
  File ""/home/franciscocosta/www/web2py/gluon/sqlhtml.py"", line 3253, in **init**
    r = represent(field, r or [], record)
  File ""/home/franciscocosta/www/web2py/gluon/sqlhtml.py"", line 68, in represent
    return f(value)
  File ""/home/franciscocosta/www/web2py/gluon/packages/dal/pydal/helpers/methods.py"", line 268, in **call**
    if isinstance(db._adapter, GoogleDatastoreAdapter):
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types

**Code listing**

```
        if not value:
            return None
        from ..adapters import GoogleDatastoreAdapter
        refs = None
        db, id = self.ref._db, self.ref._id
        if isinstance(db._adapter, GoogleDatastoreAdapter):

            def count(values):
                return db(id.belongs(values)).select(id)
            rx = range(0, len(value), 30)
            refs = reduce(lambda a, b: a & b, [count(value[i:i+30])
```

This was working fine on 2.10.3
My database is MongoDB

In the controller:

```
archives = db(db.jobs_archive.current_record == job.id).select(orderby=~db.jobs_archive.modified_on)
```

In the view:

```
{{=SQLTABLE(archives, linkto, upload, orderby=True, _class='table table-bordered table-striped sortable')}}
```
"
945,"show_if raise RuntimeError(""Not Implemented Error"")",2015-04-26T03:11:52Z,2015-06-25T09:44:42Z,enhancement,,,"Using web2py 2.10.4-beta and Python 2.7.9
 a show if raise that exception.
More details on http://pastebin.com/eyP2Jcj0
"
944,Fix ldap_auth for NoSQL databases,2015-04-24T18:05:13Z,2015-04-26T13:29:26Z,,,,"Unroll query with join to two queries when working with DB's which don't
support joins.  This relies on https://github.com/web2py/pydal/pull/146
"
943,"Mercurial not found, when it is installed",2015-04-24T07:30:39Z,2016-03-19T08:18:11Z,enhancement,,,"When I press versioning in the web2py it says ""Sorry, could not find mercurial"". Mercurial is installed on my system. I am using 
2.10.3-stable+timestamp.2015.04.02.21.42.07
(Running on Rocket 1.2.6, Python 2.7.8)
"
942,ldap_auth not working with NoSql databases,2015-04-23T17:16:27Z,2015-05-02T01:50:25Z,,,,"ldap_auth has a query which contains a join, which will not work on NoSql databases.

Suggested patch, add:

``` python
from pydal.adapters.base import NoSQLAdapter
```

change:

``` python
db_group_search = db((db.auth_membership.user_id == db_user_id) &
                     (db.auth_user.id == db.auth_membership.user_id) &
                     (db.auth_group.id == db.auth_membership.group_id))
```

to:

``` python
if isinstance(db._adapter, NoSQLAdapter):
    # no joins on NoSQL databases, perform two queries
    db_group_search = db(db.auth_membership.user_id == db_user_id)
    group_ids = [x.group_id for x in db_group_search.select(
        db.auth_membership.group_id, distinct=True)]
    db_group_search = db(db.auth_group.id == group_ids)
else:
    db_group_search = db(
        (db.auth_membership.user_id == db_user_id) &
        (db.auth_user.id == db.auth_membership.user_id) &
        (db.auth_group.id == db.auth_membership.group_id))
```
"
941,Basic Authentication,2015-04-23T15:56:01Z,2015-04-24T14:19:02Z,,,,"It seems that the feature described [here](http://web2py.com/books/default/chapter/29/09/access-control?search=auth#Access-Control-and-Basic-Authentication) in the book doesn't work.

I tried both methods 

```
auth.settings.allow_basic_login = True
```

and

```
auth.basic()
```

 without results.

I tried on the standalone web2py rocket on osx 10.10.3 and on nginx + uwsgi on debian wheezy.
"
940,Multiple autocomplete widgets in one form store only in one field,2015-04-23T12:42:36Z,2016-03-19T17:46:21Z,,,,"When a table has more than one field, represented using autocomplete widget, **referencing the same other table**, the generated wigets get confused in which field they have to store the result. 
When you autocomplete the second field, the result is written in the first.

Example:
`db.define_table('point',Field('name','string'))
db.define_table('route',Field('route_name','string'),
               Field('start_point','reference point',widget=SQLFORM.widgets.autocomplete( request, db.point.name, id_field=db.point.id,
    limitby=(0,10),min_length=2)),
                Field('end_point','reference point',widget=SQLFORM.widgets.autocomplete( request, db.point.name, id_field=db.point.id,
    limitby=(0,10),min_length=2))
               )`
Add a few points in db.point using the admin interface then try to add a route in db.route
using the same admin interface or in a controller
`def index():
    grid=SQLFORM.smartgrid(db.route,create=True,editable=True, details=True)
    return dict(grid=grid)`

The javascript magic in SQLHTML.py for the fix should also contain the destination field name,  in my opinion.
"
939,add support for reporting web2py errors via slack.com,2015-04-23T00:40:52Z,2015-04-26T13:29:00Z,,,,"Add a script to enable periodic pushing of new error tickets to Slack.com via the use of incoming web-hooks (incoming _into_ slack).

Proper use depends on having created a web-hook through Slack, and having set that value in the app's model files as the value of `global_settings.slack_hook`.

Details on creating web-hooks can be found at https://slack.com/integrations.

Requires the Requests module for posting to slack, other requirements are standard libs or provided by web2py.

Usage (on Unices), replace myapp with the name of your application and run:
  `nohup python web2py.py -S myapp -M -R scripts/tickets2slack.py &`
"
938,Bootstrap 3 cascading menus,2015-04-22T10:23:05Z,2015-04-22T12:39:27Z,,,,"Since web2py's upgrade to bootstrap 3, the cascading menus became invisible (submenu not implemented in bootstrap 3). I found the following tweak 
< style>
      .dropdown-submenu{position:relative;}
.dropdown-submenu>.dropdown-menu{top:0;left:100%;margin-top:-6px;margin-left:-1px;-webkit-border-radius:0 6px 6px 6px;-moz-border-radius:0 6px 6px 6px;border-radius:0 6px 6px 6px;}
.dropdown-submenu:hover>.dropdown-menu{display:block;}
.dropdown-submenu>a:after{display:block;content:"" "";float:right;width:0;height:0;border-color:transparent;border-style:solid;border-width:5px 0 5px 5px;border-left-color:#cccccc;margin-top:5px;margin-right:-10px;}
.dropdown-submenu:hover>a:after{border-left-color:#ffffff;}
.dropdown-submenu.pull-left{float:none;}.dropdown-submenu.pull-left>.dropdown-menu{left:-100%;margin-left:10px;-webkit-border-radius:6px 0 6px 6px;-moz-border-radius:6px 0 6px 6px;border-radius:6px 0 6px 6px;}
< /style>
to be implemented in web2py.css or layout.html i order to fix the issue.
HTH
"
937,Wsgi does not parse request.vars,2015-04-22T07:06:51Z,2015-04-23T12:25:30Z,,,,"I was using FreeBSD9.3/lighttpd/fastcgi/web2py 2.4.5. When I updated my server to Web2py 2.10.3, any variable passed in url after ? was nowhere to be found in request.vars. Including in a new created app.
I tracked down the problem in  having both query_string and QUERY_STRING in the environment displayed by response.toolbar() env.
The one being parsed is 'QUERY_STRING', which is empty,  and 'query_string' which holds the neccesary variables. Seems to be a lower/upper case mixup. 
I managed to fix the problem by adding 2 lines after

```
             ...                
            fixup_missing_path_info(environ)
            env['QUERY_STRING']=environ['QUERY_STRING']             #my fix
            env['PATH_INFO']=environ['PATH_INFO']                   #my fix
```

in gluon/main.py at line 323. 
Please check the implications of the code I added or find another proper fix.
"
936,added newer Recaptcha2 class to deal with v2.0. Fixes #919,2015-04-21T22:11:09Z,2015-05-03T04:07:36Z,,,,"Improvements over the ""old"" v1.0
- behaves well also without javascript
- use_ssl is redundant, v2.0 works only in https mode
- ajax is not useful anymore as the newer API is a lot easier

Adjusted also the addrow() method that was missing newer formstyles.
"
935,extend underline for proper sphinx formatting,2015-04-21T21:59:43Z,2015-04-26T13:27:48Z,,,,
934,fixes #931 . Thanks @butsyk for spotting the bug,2015-04-21T20:00:30Z,2015-04-26T13:27:35Z,,,,
933,Error Ticket issued using inbuilt wiki,2015-04-21T14:43:32Z,2015-09-03T15:50:50Z,,AttributeError,AttributeError: 'Row' object has no attribute 'can_edit',"Here are the steps
1. Create new application
2. in default.py :
def index():
    return auth.wiki()
3. go to /my-app/default
    page says ‚ÄúCreate page ‚Äúindex‚Äù
4. go to db.py and insert at the end of file:
auth.wiki(manage_permissions=True,resolve=False)
5. While still logged as Admin, sign up a user X
6. create a page ‚ÄúQ‚Äù as X and put ‚Äúuser_1‚Äù in the windows ‚Äúcan edit‚Äù and ‚Äúcan read‚Äù. Add a tag to page ‚ÄúQ‚Äù
7. logout user X
8. in db.py change to
auth.settings.registration_requires_approval = True
9. logout as Admin
10. sign up a new user Y
11. login as Admin and go to db admin page and delete ‚Äúpending‚Äù from user Y profile
12. logout Admin
13. login as user Y
14. go to search page from dropdown menu and click on the tag of page ‚ÄúQ‚Äù
15 Error Ticket is generated. Login as Admin to see error ticket:
<type 'exceptions.AttributeError'> 'Row' object has no attribute 'can_edit'

Version
web2py‚Ñ¢   Version 2.10.3-stable+timestamp.2015.04.02.21.42.07
Python  Python 2.7.6: /usr/bin/python (prefix: /usr)
Traceback
Traceback (most recent call last):
  File ""/home/www-data/web2py/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/home/www-data/web2py/applications/ae/controllers/default.py"", line 59, in <module>
  File ""/home/www-data/web2py/gluon/globals.py"", line 393, in <lambda>
    self._caller = lambda f: f()
  File ""/home/www-data/web2py/applications/ae/controllers/default.py"", line 17, in index
    return auth.wiki()
  File ""/home/www-data/web2py/gluon/tools.py"", line 3872, in wiki
    wiki = self._wiki()
  File ""/home/www-data/web2py/gluon/tools.py"", line 5715, in __call__
    return self.search()
  File ""/home/www-data/web2py/gluon/tools.py"", line 6081, in search
    for p in pages]
  File ""/home/www-data/web2py/gluon/tools.py"", line 5731, in first_paragraph
    if not self.can_read(page):
  File ""/home/www-data/web2py/gluon/tools.py"", line 5649, in can_read
    set(groups).intersection(set(page.can_read + page.can_edit)) or
  File ""/home/www-data/web2py/gluon/packages/dal/pydal/objects.py"", line 84, in **getitem**
    raise ae
AttributeError: 'Row' object has no attribute 'can_edit'
"
932,with_alias(),2015-04-21T12:53:15Z,2015-04-27T09:10:49Z,DAL,,,"Version 2.10.3-stable+timestamp.2015.04.02.21.42.07

I want to join same table multiple times
so have to make an alias like (as per doc
web2py.com/books/default/chapter/29/06/the-database-abstraction-layer#Inner-joins)
c1 = db.category.with_alias('c1')
...
it hangs on copy.copy(table) at:
pydal/adapters/base.py
def alias(self, table, alias):
  other = copy.copy(table)   # this point 

 Traceback (most recent call last):
"
931,Expose typing,2015-04-21T12:42:26Z,2015-04-26T13:27:36Z,,,,"Version 2.10.4-beta+timestamp.2015.04.20.18.00.31

gluon/tools.py
class Expose(object):
line 5365:
self.args = [arg for arg in current.request.args if args] 

needs to be:
self.args = [arg for arg in current.request.args if arg]
"
930,pydal -> track 15.03-maintenance (20/04/15),2015-04-20T15:31:11Z,2015-04-20T15:39:29Z,,,,"This implements correct serialization for pydal objects.
This is needed on current master (which is broken) 'cause I erroneously proposed this https://github.com/web2py/web2py/pull/925 without implementing the new serialization on the maintenance branch of pydal.
"
929,Locale files for calendar.js,2015-04-19T17:52:21Z,2015-04-26T13:30:31Z,,,,"I think that this is the best aproach. As using T would not be able to change the weekends.

The problem that might be here is this:
response.files.insert(3,URL('static','js/calendar/%s.js' % T.accepted_language or 'en'))
response.files.insert(4,URL('static','js/web2py.js'))

if a new language be created, it will not be replicated to /js/calendar/lang.js.
"
928,small typo. Fixes #920,2015-04-19T17:49:44Z,2015-04-19T20:32:28Z,,,,
927,Calendar locale,2015-04-19T15:12:53Z,2015-04-19T18:48:36Z,,,,"Auto-add locale of the calendar according to the accepted_language
"
926,added web.config to deploy web2py on IIS,2015-04-19T13:51:44Z,2015-04-19T20:32:11Z,,,,
925,pydal -> track 15.03-maintenance (19/04/15),2015-04-19T12:46:08Z,2015-04-19T20:31:41Z,,,,"due to #912 
"
924,Cannot toggle IDE breakpoints on mac OSX Yosemite ,2015-04-19T06:26:20Z,,,,,"I'm using web2py mac version v2.10.3 on OSX Yosemite 10.10.3
Wherever I try to toggle a breakpoint in the IDE I got the ""... line..does not exist"" error. Even if I go to the debug form and manually add a breakpoint I got the same error. 
See attached sample screens.

It's exactly the same as described in this old post:
https://groups.google.com/forum/#!msg/web2py/Mejn75Z4SF4/RGhRvs9drT4J

I got the error in any application, even the ones prodided with the environment. Seems something related to the filesystem??? I tried to move the web2py folder to different location in my mac from the application folder to the desktop to other places. I also tries to give full permission access to the involved files.... but the error doesn't change.

Greg

![w2p error1](https://cloud.githubusercontent.com/assets/7744938/7218406/9959053c-e66d-11e4-82ba-e11e555a0711.jpg)
![w2p error2](https://cloud.githubusercontent.com/assets/7744938/7218407/a24c5298-e66d-11e4-84c2-690f2e183308.jpg)
![w2p error3](https://cloud.githubusercontent.com/assets/7744938/7218409/a8ed17fe-e66d-11e4-80b6-8497558ab6d1.jpg)
"
923,Fix serializers injection over new pydal,2015-04-18T13:04:38Z,2015-04-18T20:17:06Z,,,,
922,Fix crash with list:reference field,2015-04-18T00:16:54Z,2015-04-18T20:16:25Z,,,,"When using validate_and_update() or validate_and_insert() on a table with a list:reference field, the request crashes after timeout with:

```
File ""web2py/gluon/globals.py"", line 270, in body
raise HTTP(400, ""Bad Request - HTTP body is incomplete"")
```

The request crashes because there is an hidden exception with the isinstance function:
`isinstance() arg 2 must be a class, type, or tuple of classes and types`

When no using GAE, the GoogleDatastoreAdapter variable is None, so isinstance crash.
See the last line of pydal/adapters/**init**.py

This is a regression intruduced after the v2.9.12.
"
921,Define unique=True for username and/or email in auth_user table by default,2015-04-17T17:57:34Z,2016-03-19T08:21:06Z,,,,"Otherwise there would be a slim (sometimes noticeable) chances of duplicated records go into database.

This proposal could bring a rare (0.01%?) chance of a user-scary 500 error ticket when duplication happens, but it ensures 100% guarantee of no duplication in the very important auth_user table.

PS: There was a lengthy conversation [here](https://groups.google.com/forum/#!topic/web2py/tsRK_e_TRZU).
"
920,Typo in models/db.py for mail server,2015-04-17T11:48:41Z,2015-04-19T20:32:31Z,,,,"Hi, 

I found a small typo, which prohibits sending mails in models/db.py line 65:
mail.settings.server = 'logging' if request.is_local else myconf.take('smtp.sender')

should be (smtp.server instead of smtp.sender):
mail.settings.server = 'logging' if request.is_local else myconf.take('smtp.server') 

thanks
"
919,Support the new reCaptchas,2015-04-16T20:42:17Z,2015-05-03T04:07:37Z,enhancement,,,"Are there any plans to support the new ""I'm not a robot"" reCaptchas out of the box? I know the old styled recaptchas are currently supported, but it would be better to use the newest.

https://developers.google.com/recaptcha/
"
918,added waitress to anyserver,2015-04-15T21:56:07Z,2015-04-18T20:15:02Z,,,,
917,"bootstrap3 formstyle too wide, with popup",2015-04-15T19:24:48Z,2015-04-19T16:19:54Z,,,,"Using version:
2.10.3-stable+timestamp.2015.04.02.21.42.07
(Running on Rocket 1.2.6, Python 2.7.5) 

With this code:
    xadb = DAL('sqlite:memory:')
    xadb.define_table('regiontable', Field('region', length=20,label='Region'))

```
for r in session.regions:
    print r
    xadb.regiontable.insert(region=r.name)

form = SQLFORM.factory(SQLField('Region', label='Select a region', length=20,
    requires=IS_IN_DB(xadb,'regiontable.region',orderby=xadb.regiontable.region))
   ,formstyle='bootstrap3_inline'
)
```

Both the table and form specify length=20

But the render looks like this:

![wide](https://cloud.githubusercontent.com/assets/2019656/7167457/f93ba13a-e3ac-11e4-8547-d020441e0070.png)

Same with all forms using bootstrap 3, everything looks very wide, (in firefox and chromium)

Looks okay, actually, on a mobile phone and tablet, but on the desktop, not so much.
"
916,Fixes #904,2015-04-14T13:25:56Z,2015-04-15T18:01:19Z,,,,"Tracking pyDAL 15.03-maintenance
"
915,Update gluon/contrib/pypyodbc.py 1.3.0 -> 1.3.3,2015-04-13T22:45:03Z,2015-04-15T18:01:01Z,,,,
914,Update/gluon contrib pypyodbc,2015-04-13T22:27:08Z,2015-04-13T22:28:32Z,,,,
913,Update/gluon contrib pypyodbc,2015-04-13T22:12:05Z,2015-04-13T22:22:38Z,,,,
912,extend sqlcustomform to support widget/represent,2015-04-12T19:19:45Z,2015-04-15T18:01:50Z,,,,"This PR is the 'web2py' part of https://github.com/web2py/pydal/pull/128
Mind that this PR demands the latest pydal. Given that before merging you should wait that a more recent pydal is introduced in web2py.
"
911,wiki documentation suggestion,2015-04-12T01:08:58Z,2015-09-03T15:50:03Z,docs,,,"I don't know how to submit or implement tickets.  Can someone please do the follow up for this or delete if not a good suggestion?  Thanks, Alex

SUGGESTION: Add information to wiki documentation stating that migration should be set to ""True"" when first building wiki so tables can be auto created.

LOCATION: http://web2py.com/books/default/chapter/29/03/overview#The-built-in-web2py-wiki

OLD PHRASING: Here we assume we are starting from scratch from a simple clone of the ""welcome"" application called ""wikidemo"". Edit the controller and replace the ""index"" action with

RECOMMENDED NEW PHRASING: Here we assume we are starting from scratch from a simple clone of the ""welcome"" application called ""wikidemo"". FIRST, MAKE SURE IN DB.PY, THE MIGRATION STATEMENT STATES ""MIGRATION=True"", NOT MIGRATION=""FALSE"". Edit the controller and replace the ""index"" action with... 

AFTER THE WIKI IS UP, YOU CAN RESET MIGRATION = False"" in db.py

%%%%%%%%%%%%%%%%%%%%

OTHER POSSIBLE ISSUES WITH WIKI

Can't get search to work.  Result is always ""no records found""

Seems that any logged on user automatically has edit and manager rights to all pages without being added to auth_groups: ""wiki_editor"" and ""wiki_author"".  If I create a new fake user and they are not given admin rights, and they access the wiki page, somehow they automatically get added with ""wiki_editor"" role in auth_membership.  Could this be something weird that I've done in auth groups or something?

Am using 2.9.11-stable+timestamp.2014.09.15.23.35.11 on windows

thanks!

Alex Glaros
"
910,encoding error writing unicode string to postgre,2015-04-11T15:11:10Z,2015-06-17T07:02:40Z,DAL,UnicodeDecodeError,UnicodeDecodeError: 'ascii' codec can't decode byte 0xe1 in position 105: ordinal not in range(128),"**web2py version**: 2.10.3-stable release
**host environment**: rocket server running on Ubuntu 14.10

I'm running into an error with when I try to write unicode text (outside the Latin ranges) to a regular string field in a postgre database. Since my app is a greek language-learning application this error breaks things completely for me. 
## Unwanted behaviour

When I try, for example, to insert the string '·ºÄŒ≥ŒøœÅŒ±Œ∂Œµ' I get the following error, triggered at pydal/adapters/base.py:

``` python
Traceback (most recent call last):

  File ""applications/paideia/modules/paideia.py"", line 168, in start
    pre_bug_step_id=pre_bug_step_id)
  File ""applications/paideia/modules/paideia.py"", line 384, in reply
    response_string)
  File ""applications/paideia/modules/paideia.py"", line 655, in _record_step
    log_record_id = db.attempt_log.insert(**log_args)
  File ""/home/ian/web/web2py/gluon/packages/dal/pydal/objects.py"", line 745, in insert
    ret =  self._db._adapter.insert(self, self._listify(fields))
  File ""/home/ian/web/web2py/gluon/packages/dal/pydal/adapters/base.py"", line 729, in insert
    raise e
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe1 in position 105: ordinal not in range(128)
```
## How to reproducing the error

I've created a simple app that duplicates the error and attached the packed app here: [web2py.app.unicode_bug_test.w2p](https://files.zenhub.io/5529368e1d1f0c3550ec51c9). After installing the sample app and setting up a postgre db for it:
1. navigate to appadmin
2. attempt to create a new record in the 'lemmas' table 
3. enter non-Latin unicode text in the 'lemma' field (something like 'Œ≤ŒªŒ±')
## Version where problem appeared

I'm not certain. The error isn't raised on my production server which is still running 2.9.11
## Setup for minimal sample app ""unicode_bug_test""

Since the error doesn't happen with sqlite, I've set up db to connect with a postgre database with the following connection details:

username = 'postgres'
postgre host = 'localhost'
postgre db_name = 'unicode_bug_test'

I've left the db password field empty in the db.py file for obvious reasons (i.e., my local password wouldn't do anyone any good anyway).

[web2py.app.unicode_bug_test.w2p | uploaded via ZenHub](https://files.zenhub.io/5529368e1d1f0c3550ec51c9)
## Debugging attempts so far
#### The error isn't raised when using a sqlite3 database

So it seems to be postgre specific. Maybe it's actually a problem in the pg8000 adapter?
#### The raw SQL sent by pyDAL to the adapter is fine

The SQL being sent by adapters.base.insert() to the postgre adapter was this:

``` sql
INSERT INTO attempt_log(name,user_response,step,score,modified_on,dt_attempted,in_path,uuid) VALUES (19,'·ºÄŒ≥ŒøœÅŒ±Œ∂Œµ',773,1.0,'2015-04-10 12:33:25','2015-04-10 16:33:26',657,'5918a65a-6d6f-42c6-9af2-f5d0e313701e') RETURNING id;
```

When I copy that SQL command into pgAdmin execute it the new row is created fine. No errors are raised.
"
909,Enable Record Versioning,2015-04-09T23:02:18Z,2016-06-28T20:10:07Z,DAL,,,"When enable_record_versioning is enabled records that are referenced by another tables are deleted (is_active=False) without delete the referenced records as expected.

db.define_table('table1',
    Field('field1'),
    auth.signature,
    format = ""%(field1)s""
)

db.define_table('table2',
    Field('field1','reference table1'),
    auth.signature
)

auth.enable_record_versioning(db)

t1 = db.table1.insert(field1=1)
t2 = db.table1.insert(field1=t1)

db(db.table1.field1==1).delete()
"
908,Access to web2py plugins,2015-04-09T16:21:33Z,2015-09-21T18:30:49Z,,,,"Seems web2pyslices are unmaintained, without published sources, and generally not working as plugins repository: It is not clear, how to
- access plugin registration (hard),
- what and how fill in in plugin registration (hard),
- how to repair a mistake (not possible?)
  From that reason many existing plugins are not registered and most items in plugin list are mistakes.

Could we redirect admin/default/plugins to something which is easier and can be maintained?
Or solve the problem with updating sources of web2pyslices?
"
907,"Appadmin html formatting, adding bootstrap 3 classes, other minor visual improvements",2015-04-08T22:12:31Z,2015-12-16T18:41:59Z,,,,"Updates the Welcome app
"
906,file is already open at this point... fixes #895,2015-04-08T19:50:40Z,2015-04-09T04:24:17Z,,,,
905,Dropping reference field of mysql table,2015-04-07T10:44:53Z,2016-03-19T18:47:30Z,DAL,,,"# Suppose this model has been migrated

db.define_table('tbl',
        Field( 'name' ),
        Field( 'ref', 'reference tbl' ),
    format='%(name)s',
)
# Now I delete the reference field

db.define_table('tbl',
        Field( 'name' ),
    format='%(name)s',
)
# I end up with this error

<class 'gluon.contrib.pymysql.err.InternalError'> (1025, u""Error on rename of './db/#sql-1227_25' to './db/tbl' (errno: 150)"")
# Which is the same error as this mysql query generates

ALTER TABLE `tbl` DROP `ref`
# This is the necessary step to drop ref

1.
Do this in mysql
    SHOW CREATE TABLE tbl

```
Result:
CREATE TABLE `tbl` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `name` varchar(512) DEFAULT NULL,
    ...
    CONSTRAINT `tbl_ibfk_1` FOREIGN KEY (`ref`) REFERENCES `tbl`...
```

2.
Do this in mysql:
    ALTER TABLE tbl DROP FOREIGN KEY tbl_ibfk_1

3.
Now just visit the site and web2py can drop the ref field by itself.
"
904,field format show an id instead of proper format in grid on 2.10.3 version,2015-04-07T03:13:51Z,2015-04-15T18:01:21Z,DAL,,,"https://groups.google.com/forum/#!topic/web2py/Tog4tdUl400
"
903,form buttons forcing btn-default,2015-04-07T01:49:40Z,2015-09-21T18:31:33Z,,,,"some times you want to define different btn-something to your button... but does not matter if you manual creates the button in form it gets override to btn-default.

so in the js file:

web2py-bootstrap3.js line 9 should be something like:

```
if(!$('button', target).hasClass('btn')) {
    $('button', target).addClass('btn btn-default');
}
```
"
902,dal issue on gae,2015-04-06T08:48:28Z,2016-04-25T18:57:05Z,DAL,TypeError,TypeError: ConjunctionNode() expects Node instances as arguments; received a non-Node instance None,"System: Linux keops 3.19.2-1-ARCH #1 SMP PREEMPT Wed Mar 18 16:21:02 CET 2015 x86_64 GNU/Linux
Web2py: Version 2.10.3-stable+timestamp.2015.04.02.21.42.07
GAE: release: ""1.9.18""

The line that triggers the exception in my code is: 
form = crud.create(Facturi, next=URL('index'))

where Facturi:

Facturi = db.define_table('factura',
                Field('numar', notnull=True),
                ...

Traceback (most recent call last):
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/home/rif/Documents/webframeworks/firmoasa/applications/firmoasa/controllers/facturi.py"", line 132, in <module>
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/globals.py"", line 393, in <lambda>
    self._caller = lambda f: f()
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/tools.py"", line 3440, in f
    return action(_a, *_b)
  File ""/home/rif/Documents/webframeworks/firmoasa/applications/firmoasa/controllers/facturi.py"", line 13, in index
    form = crud.create(Facturi, next=URL('index'))
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/tools.py"", line 4138, in create
    *_attributes
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/tools.py"", line 4057, in update
    *_attributes  # contains hidden
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/sqlhtml.py"", line 1232, in __init__
    inp = self.widgets.options.widget(field, default)
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/sqlhtml.py"", line 290, in widget
    options = requires[0].options()
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/validators.py"", line 583, in options
    self.build_set()
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/validators.py"", line 569, in build_set
    records = self.dbset(table).select(_fields, *_dd)
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/packages/dal/pydal/objects.py"", line 2093, in select
    return adapter.select(self.query,fields,attributes)
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/packages/dal/pydal/adapters/google_adapters.py"", line 487, in select
    (items, tablename, fields) = self.select_raw(query,fields,attributes)
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/packages/dal/pydal/adapters/google_adapters.py"", line 379, in select_raw
    filters = self.expand(query)
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/packages/dal/pydal/adapters/google_adapters.py"", line 240, in expand
    return expression.op(expression.first, expression.second)
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/packages/dal/pydal/adapters/google_adapters.py"", line 256, in AND
    first = self.expand(first)
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/packages/dal/pydal/adapters/google_adapters.py"", line 240, in expand
    return expression.op(expression.first, expression.second)
  File ""/home/rif/Documents/webframeworks/firmoasa/gluon/packages/dal/pydal/adapters/google_adapters.py"", line 260, in AND
    return ndb.AND(first, second)
  File ""/home/rif/SDKs/google_appengine/google/appengine/ext/ndb/query.py"", line 558, in **new**
    ' received a non-Node instance %r' % node)
TypeError: ConjunctionNode() expects Node instances as arguments; received a non-Node instance None
"
901,Field constructor - required is broken,2015-04-05T19:23:46Z,2015-04-08T20:11:45Z,DAL,,,"So, it is simple.

db.define_table('table', Field('field', required=True))

This option required=True is totally ignored on 2.10.
You can successfully add records having empty values via forms or via appadmin/insert/db with no errors.

This is highly critical.
"
900,added basic .gitignore for web2py applications,2015-04-04T10:53:02Z,2015-04-08T07:09:18Z,,,,
899,2.10.3 / Linux/ cache inconsistent,2015-04-03T06:18:43Z,2015-04-03T17:25:32Z,,,,"Downloaded the latest source from http://www.web2py.com/examples/static/web2py_src.zip (2.10.3 source)
Tried the following script, to see if the cache works fine - basically insert records, and see if it is reflected in the cache, when the query is executed repeatedly. I didn't check to see if the contents match, just the number of elements in the cache reflect the number in the table.

```
$ python web2py.py -S test_cache

db = DAL('sqlite://cache_test.db', pool_size=0)
db.define_table('t1', Field('name',type='string'))
db.t1.insert(name='A1')
cache_settings = dict(cache=(cache.disk, 30), cacheable=True)
rows = db(db.t1.id > 0).select(**cache_settings)
rows
db.t1.insert(name='A2')
rows = db(db.t1.id > 0).select(**cache_settings)
rows
db.t1.insert(name='A3')
rows = db(db.t1.id > 0).select(**cache_settings)
rows
```

I noticed that the number of records returned in the `rows` is not consistent. Take a look at the screenshot, and notice the number of records returned after query execution.
![cache_test_linux](https://cloud.githubusercontent.com/assets/11280/6978795/4b6a23e2-d9f7-11e4-8b5d-6a399a4027df.png)
"
898,"fix web2py/web2py#896, avoid to select blob fields in sqlform.grid",2015-04-02T19:43:56Z,2015-04-02T21:24:26Z,,,,"Blob files can be still be shown by explicitly selecting them
"
897,Update gluon/contrib/feedparser.py from 5.1.2 -> 5.1.3,2015-04-02T17:59:40Z,2015-04-02T21:23:34Z,,,,
896,High Memory usage due to uploads_in_blob,2015-04-02T16:41:57Z,2015-04-02T21:24:26Z,,,,"This issue resulted from the mailing list. @ilvalle asked me to open an issue here.
https://groups.google.com/d/msg/web2py/7K4hAcOiEfg/E_h0aVfk9k8J
## 

An application uses uploads_in_blob feature as follows :

```
db._adapter.uploads_in_blob = True
```

This creates an additional column of BYTEA type at the DB Level (I am using postgres, if it matters)

Each time a DB query is run (and results returned to web2py), the size of each row returned also includes the size of the uploaded document.
e.g. If each row has a document of say 5MB, then 20 rows that are returned by default pagination, consumes 100MB
(I am not sure when this memory is released/GC'ed) So after going thru say 5 such queries, memory consumed is 500MB

User may not always ""download"" the file, user may be just looking at the records' metadata, so access to the BLOB isn't needed till user clicks the download link (denoted by ""file"" URL)
When NOT using uploads_in_blob, the uploads folder only contains a filename, and the file actually resides on the disk. IMO the filesystem is accessed only when needed.

BLOB field should be used in a similar fashion (Access only when needed)
"
895,2.10.1-3 / Windows / cache errors,2015-04-02T04:30:58Z,2015-04-09T04:24:20Z,,,,"Following the discussion here: https://groups.google.com/d/msg/web2py/Ukk5FTy17is/RQVx6sv8jkoJ
I put together a small script to recreate the ""issues while using the cache""

```
$ python web2py.py -S test

>>> db = DAL('sqlite://cache_test.db', pool_size=0)
>>> db.define_table('t1', Field('name',type='string'))
>>> db.t1.insert(name='A1')
>>> cache_settings = dict(cache=(cache.disk, 30), cacheable=True)
>>> rows = db(db.t1.id > 0).select(**cache_settings)
>>> rows = db(db.t1.id > 0).select(**cache_settings)
```

The screenshot illustrates the result
![cache_test](https://cloud.githubusercontent.com/assets/11280/6957754/46739d48-d91e-11e4-90e7-f09d06de56a9.png)
"
894,fix windows build,2015-04-01T19:48:31Z,2015-04-02T21:22:49Z,,,,
893,not needed anymore module,2015-04-01T19:06:09Z,2015-04-02T21:20:39Z,,,,"it's only used in pydal's test, and pydal's repo has it already.
"
892,2.10.1 upgrade problem,2015-04-01T17:50:04Z,2015-12-04T18:46:04Z,,SyntaxError,SyntaxError: define_table argument is not a Field or Table: <no table>.is_active,"Traceback (most recent call last):
  File ""/home/rif/Downloads/web2py-R-2.9.12/gluon/restricted.py"", line 227, in restricted
    exec ccode in environment
  File ""/home/rif/Downloads/web2py-R-2.9.12/applications/welcome/models/db.py"", line 56, in <module>
    auth = Auth(db)
  File ""/home/rif/Downloads/web2py-R-2.9.12/gluon/tools.py"", line 1383, in **init**
    self.define_signature()
  File ""/home/rif/Downloads/web2py-R-2.9.12/gluon/tools.py"", line 1769, in define_signature
    label=T('Modified By'),  ondelete=ondelete))
  File ""/home/rif/Downloads/web2py-R-2.9.12/gluon/packages/dal/pydal/objects.py"", line 330, in **init**
    'define_table argument is not a Field or Table: %s' % field)
SyntaxError: define_table argument is not a Field or Table: <no table>.is_active

How to reproduce:
1. Download https://github.com/web2py/web2py/archive/R-2.9.12.zip 
2. Start it and go to admin
3. Perform a upgrade from the admin
4. Restart
5. Go to welcome app
"
891,Fixes issue with locked files during cleanup,2015-04-01T17:28:56Z,2015-04-01T17:41:52Z,,,,
890,Version confusion,2015-04-01T16:39:21Z,2015-05-03T15:09:27Z,,,,"- [x] http://web2py.com/ still link version 2.10.1 
- [x] http://web2py.com/init/default/download still with python 2.5 referencies
"
889,web2py installation on Ubuntu (Trusty) is painful,2015-04-01T04:00:50Z,2015-04-08T21:03:06Z,,RuntimeError,"RuntimeError: web2py depends on pydal, which apparently you have not installed.","Can you please fix this with a straight forward installation?

Traceback (most recent call last):
  File ""<string>"", line 1, in <module>
  File ""gluon/**init**.py"", line 29, in <module>
    ""You can also download a complete copy from http://www.web2py.com.""
RuntimeError: web2py depends on pydal, which apparently you have not installed.
Probably you cloned the repository using git without '--recursive'
To fix this, please run (from inside your web2py folder):

```
 git submodule update --init --recursive
```

You can also download a complete copy from http://www.web2py.com.
Traceback (most recent call last):
  File ""<string>"", line 1, in <module>
  File ""gluon/**init**.py"", line 29, in <module>
    ""You can also download a complete copy from http://www.web2py.com.""
RuntimeError: web2py depends on pydal, which apparently you have not installed.
Probably you cloned the repository using git without '--recursive'
To fix this, please run (from inside your web2py folder):

```
 git submodule update --init --recursive
```

You can also download a complete copy from http://www.web2py.com.
done!

I tried to download the copy from web2py.com, then tried from github with recursive, and using setup-web2py-ubuntu.sh. All throughs same error message. 
"
888,Improve PEP8 gluon/utils.py,2015-03-31T18:06:03Z,2015-03-31T19:45:48Z,,,,
887,Improve PEP8 gluon/validators.py,2015-03-31T18:04:14Z,2015-03-31T19:45:38Z,,,,
886,Improve PEP8 gluon/widget.py,2015-03-31T18:02:01Z,2015-03-31T19:45:31Z,,,,
885,Improve PEP8 gluon/tools.py,2015-03-31T17:59:31Z,2015-03-31T19:45:23Z,,,,
884,Improve PEP8 gluon/tools.py,2015-03-30T13:44:40Z,2015-03-30T14:17:48Z,,,,
883,Improve PEP8 gluon/storage.py,2015-03-30T01:25:50Z,2015-03-30T06:26:06Z,,,,
882,Finely grained lock disk,2015-03-30T00:39:16Z,2015-03-30T06:25:55Z,,,,"Thanks Simone Niphlod for thoroughly reviewing it.
"
881,datetime <-> json conversion fails,2015-03-29T18:41:10Z,2015-04-08T21:18:54Z,,TypeError,"TypeError: datetime.date(2015, 3, 30) is not JSON serializable","let the output speak for itself:
silvan@typhon:~/local/web2py$ ./web2py.py -S welcome
In [1]: import datetime
In [2]: test_data = { 'somedate': datetime.date(2015, 3, 30) }
In [3]: import gluon.contrib.simplejson
## In [4]: gluon.contrib.simplejson.dumps(test_data)

TypeError                                 Traceback (most recent call last)
<ipython-input-4-f2aa1271c765> in <module>()
----> 1 gluon.contrib.simplejson.dumps(test_data)

/home/silvan/local/web2py/gluon/contrib/simplejson/**init**.pyc in dumps(obj, skipkeys, ensure_ascii, check_circular, allow_nan, cls, indent, separators, encoding, default, use_decimal, **kw)
    261         encoding == 'utf-8' and default is None and not use_decimal
    262         and not kw):
--> 263         return _default_encoder.encode(obj)
    264     if cls is None:
    265         cls = JSONEncoder

/home/silvan/local/web2py/gluon/contrib/simplejson/encoder.pyc in encode(self, o)
    215         chunks = self.iterencode(o, _one_shot=True)
    216         if not isinstance(chunks, (list, tuple)):
--> 217             chunks = list(chunks)
    218         if self.ensure_ascii:
    219             return ''.join(chunks)

/home/silvan/local/web2py/gluon/contrib/simplejson/encoder.pyc in _iterencode(o, _current_indent_level)
    484                 yield chunk
    485         elif isinstance(o, dict):
--> 486             for chunk in _iterencode_dict(o, _current_indent_level):
    487                 yield chunk
    488         elif _use_decimal and isinstance(o, Decimal):

/home/silvan/local/web2py/gluon/contrib/simplejson/encoder.pyc in _iterencode_dict(dct, _current_indent_level)
    458                 else:
    459                     chunks = _iterencode(value, _current_indent_level)
--> 460                 for chunk in chunks:
    461                     yield chunk
    462         if newline_indent is not None:

/home/silvan/local/web2py/gluon/contrib/simplejson/encoder.pyc in _iterencode(o, _current_indent_level)
    494                     raise ValueError(""Circular reference detected"")
    495                 markers[markerid] = o
--> 496             o = _default(o)
    497             for chunk in _iterencode(o, _current_indent_level):
    498                 yield chunk

/home/silvan/local/web2py/gluon/contrib/simplejson/encoder.pyc in default(self, o)
    189 
    190         """"""
--> 191         raise TypeError(repr(o) + "" is not JSON serializable"")
    192 
    193     def encode(self, o):

TypeError: datetime.date(2015, 3, 30) is not JSON serializable
"
880,check cmd_options existence before using it in restricted.py,2015-03-29T17:26:47Z,2015-03-29T23:06:23Z,,,,"Accessing global_settings.cmd_options.print_errors in restricted.py causing NoneType error in GAE
"
879,updated welcome menu with the 'Helping web2py' book chapter,2015-03-29T09:13:25Z,2015-03-29T23:05:34Z,,,,
878,request with wrong Content-Length to web2py cause 500 reply from apache,2015-03-26T23:28:23Z,2017-06-21T05:58:25Z,bug,,,"A request with wrong Content-Length will cause a 500 reply from apache.

I use the following script to generate the request:

``` Python
#! /usr/bin/env python

import socket

sock = socket.socket()
sock.connect((""localhost"", 8001))
sock.send(""GET /welcome/default/index HTTP/1.1\r\n"")
sock.send(""Host: localhost\r\n"")
sock.send(""Content-Length: 10000\r\n"")
sock.send(""\r\n\r\n"")
sock.shutdown(socket.SHUT_WR)

print sock.recv(1024)
sock.close()
```

This show up in apache error log:

> [Thu Mar 26 15:59:18 2015] [error] [client 127.0.0.1](70014)End of file found: mod_wsgi (pid=13239): Unable to get bucket brigade for request.
> [Thu Mar 26 15:59:18 2015] [error] [client 127.0.0.1] mod_wsgi (pid=13235): Exception occurred processing WSGI script '/opt/web-apps/web2py/wsgihandler.py'.
> [Thu Mar 26 15:59:18 2015] [error] [client 127.0.0.1] Traceback (most recent call last):
> [Thu Mar 26 15:59:18 2015] [error] [client 127.0.0.1]   File ""/opt/web-apps/web2py/gluon/main.py"", line 532, in wsgibase
> [Thu Mar 26 15:59:18 2015] [error] [client 127.0.0.1]     if request.body:
> [Thu Mar 26 15:59:18 2015] [error] [client 127.0.0.1]   File ""/opt/web-apps/web2py/gluon/globals.py"", line 270, in body
> [Thu Mar 26 15:59:18 2015] [error] [client 127.0.0.1]     raise HTTP(400, ""Bad Request - HTTP body is incomplete"")
> [Thu Mar 26 15:59:18 2015] [error] [client 127.0.0.1] HTTP: 400 BAD REQUEST

it appear that HTTP exception handler in gluon/main.py:448 is not handling the exception raise in gluon/globals.py:270 correctly. The same property getter keep getting call by multiple exception handlers and the exception eventually fall into mod_wsgi which cause the 500 response.
"
877,make unique_key unique also for the database table definition,2015-03-26T12:01:21Z,2015-03-26T23:09:48Z,,,,"This should be a big speed improvement.  I wonder why it was not unique before.
"
876,Added CF deployment script,2015-03-26T06:42:55Z,2015-03-29T23:05:19Z,,,,"This script will deploy a Web2Py app to CloudFoundry using CF tools.  A user only needs to prepare a requirements.txt file with necessary import modules before running the script.
"
875,Made buttons and table look styled in appadmin,2015-03-26T00:41:15Z,2015-03-29T23:05:02Z,,,,"Bootstrap 3 requires ‚Äòtable‚Äô and ‚Äòbtn-*‚Äô as classes to make the
respective elements look styled
"
874,bootstrap 3.3.4 is out...,2015-03-25T20:26:09Z,2015-03-29T23:04:35Z,,,,
873,Update ajax_examples.py so it does what it says.,2015-03-24T17:53:41Z,2015-03-29T23:04:17Z,,,,"Fixed the example so it actually does what it says. It said ""The last 10 entries will appear sorted in a table below."". What it did was if the number of entries was 10, it would truncate the entries and start over again. So, in order for this to show the last 10 entries, it has to delete the oldest entry after 10. The best way to do that is to not sort the list, except when displaying and then delete the first entry in the list before inserting the 11th entry.
"
872,Improve PEP8 gluon/sqlhtml.py,2015-03-24T17:05:56Z,2015-03-29T23:03:34Z,,,,
871,Track pyDAL 15.03,2015-03-24T10:46:00Z,2015-03-24T16:39:42Z,,,,
870,Improve PEP8 gluon/shell.py,2015-03-23T16:03:03Z,2015-03-24T16:40:13Z,,,,
869,Improve PEP8 gluon/settings.py,2015-03-23T01:03:17Z,2015-03-23T15:47:25Z,,,,
868,Arabic Translation Added,2015-03-22T22:57:16Z,2015-03-23T15:47:13Z,,,,"Initial Translation
"
867,Improve PEP8 gluon/scheduler.py,2015-03-22T19:23:18Z,2015-03-23T00:13:17Z,,,,
866,Improve PEP8 gluon/rocket.py,2015-03-22T15:26:54Z,2015-03-22T17:59:34Z,,,,
865,Arabic Translatrion,2015-03-21T22:45:26Z,2015-03-23T22:43:49Z,,,,"I've manged add Arabic translation in languages folder
https://github.com/Kalmuraee/web2py/blob/84b8be34ec6613d1fb39c70d49165c6cfb0d7b4b/applications/welcome/languages/ar.py
"
864,fixes issue with deleting sessions,2015-03-21T21:20:53Z,2015-03-22T05:36:47Z,,,,
863,Improve PEP8 gluon/rewrite.py,2015-03-21T01:43:01Z,2015-03-22T05:37:04Z,,,,
862,fixes #679,2015-03-20T22:30:59Z,2015-03-21T01:33:25Z,,,,
861,Improve PEP8 gluon/recfile.py,2015-03-20T18:43:42Z,2015-03-21T01:33:01Z,,,,
860,Improve PEP8 gluon/newcron.py,2015-03-20T17:07:10Z,2015-03-20T18:23:09Z,,,,
859,Improve PEP8 gluon/myregex.py,2015-03-20T14:02:42Z,2015-03-20T15:47:50Z,,,,
858,Cache: PicklingError: Can't pickle <type 'function'>: attribute lookup,2015-03-20T05:53:49Z,2015-03-20T17:38:21Z,,PicklingError,PicklingError: Can't pickle <type 'function'>: attribute lookup ,"Discussion thread: https://groups.google.com/d/msg/web2py/sRp7b1d3sAQ/_xMLq1xbM7AJ

```
web2py‚Ñ¢     Version 2.9.12-stable+timestamp.2015.03.19.06.51.11
Python     Python 2.7.9: C:\Users\subbaraman\Downloads\web2py_win_002\web2py\web2py.exe (prefix: D:\programs\open\python27)
Traceback


Traceback (most recent call last):
  File ""C:\Users\subbaraman\Downloads\web2py_win_002\web2py\gluon\restricted.py"", line 226, in restricted
    exec ccode in environment
  File ""C:/Users/subbaraman/Downloads/web2py_win_002/web2py/applications/my_app/controllers/default.py"", line 1107, in <module>
  File ""C:\Users\subbaraman\Downloads\web2py_win_002\web2py\gluon\globals.py"", line 393, in <lambda>
    self._caller = lambda f: f()
  File ""C:\Users\subbaraman\Downloads\web2py_win_002\web2py\gluon\tools.py"", line 3455, in f
    return action(*a, **b)
  File ""C:/Users/subbaraman/Downloads/web2py_win_002/web2py/applications/my_app/controllers/default.py"", line 304, in index
    orderby=_construct_orderby(), limitby=limitby, **cache_settings)
  File ""C:\Users\subbaraman\Downloads\web2py_win_002\web2py\gluon\packages\dal\pydal\objects.py"", line 2085, in select
    return adapter.select(self.query,fields,attributes)
  File ""C:\Users\subbaraman\Downloads\web2py_win_002\web2py\gluon\packages\dal\pydal\adapters\base.py"", line 1228, in select
    time_expire)
  File ""C:\Users\subbaraman\Downloads\web2py_win_002\web2py\gluon\cache.py"", line 428, in __call__
    self.storage[key] = (now, value)
  File ""C:\Users\subbaraman\Downloads\web2py_win_002\web2py\gluon\cache.py"", line 328, in __setitem__
    pickle.dump((time.time(), value), tmp, pickle.HIGHEST_PROTOCOL)
PicklingError: Can't pickle <type 'function'>: attribute lookup 
```
"
857,Removed representation utils from `_default_validators` method,2015-03-20T00:47:19Z,2015-03-20T03:21:26Z,,,,"This should solve the `cacheable` error inside web2py.
**WARNING**: please merge this only after the merge of https://github.com/web2py/pydal/pull/92 and tracking the updated pydal repo inside web2py.
"
856,Improve PEP8 gluon/main.py,2015-03-19T17:51:50Z,2015-03-20T03:20:35Z,,,,
855,fix app packaging,2015-03-18T23:04:52Z,2015-03-18T23:10:53Z,,,,
854,first iteration on bs3 cleanup,2015-03-18T22:18:20Z,2015-03-18T23:13:22Z,,,,
853,Improve PEP8 gluon/languages.py,2015-03-16T20:25:26Z,2015-03-19T16:56:06Z,,,,
852,unittest for gluon/utils.py  compare(),2015-03-16T00:23:09Z,2015-03-16T05:56:08Z,,,,
851,Pep8 http py,2015-03-15T16:21:41Z,2015-03-16T05:55:27Z,,,,
850,DAL queries in appadmin,2015-03-13T15:59:30Z,2015-09-21T20:28:10Z,,,,"in appadmin it could be possible to query the database using DAL queries.
It will have big advantages.

1 allows me to select only the columns that i want to see.
If i have 40 columns its dificult to go to the last column to check its value.Gets more dificult if i have 800 records as i can only see 100 at a time.

2 it would be a great place to try the dal syntax.

3 its a new feature in appadmin. dont let it die... 

...

Regards
"
849,Reverting 9dba971 reference change on pydal,2015-03-13T15:48:46Z,2015-03-13T15:59:24Z,,,,
848,group controllers by folders,2015-03-13T07:59:00Z,2016-09-23T21:47:31Z,,,,"I have dozens of controllers in a web2py project, also include views, modules, models. 
But they can split by several functions, is there any solution for grouping controllers by folders.

**e.g.**
I have 6 files in controllers: 
- func1_main.py
- func1_user.py
- func1_show.py
- func2_print.py
- func2_user.py
- func2_show.py

and the expected path as the following:
- _func1\func1_main.py_
- _func1\func1_user.py_
- _func1\func1_show.py_
- _func2\func2_print.py_
- _func2\func2_user.py_
- _func2\func2_show.py_

I also have some similar requirements:
- one controller can have views multiple folders
- third-part modules can have their own folders in the path _modules_
"
847,PEP8 for gluon/tools.py,2015-03-12T06:23:30Z,2015-03-12T06:23:44Z,,,,
846,caches recursive selects for references,2015-03-10T23:52:35Z,2015-03-11T23:31:30Z,,,,"Why didn't we think before ? References are lazy, but when asked 
for representation why should we fetch the same referenced record
over and over ?

NB: the code caches only represent() fetching records from tables, that
are the only idempotent represent() calls out there. We could cache
every representation only asking for every represent() call to be 
idempotent. As I feel there will be someone returning random values,
I left it out.

I'll make a PR soon for pyDAL to fix the same behaviour.
"
845,row.some_bool == True # when the boolean is False,2015-03-10T20:26:01Z,2015-03-13T07:43:54Z,,,,"# When doing the condition

if row.some_bool:
    # this code runs even if the bool is false, however set to 'F', at least in mysql
# this is a workaround, but confusing

if row.some_bool == 'T':
    ...
"
844,crud.search does not return any results when searching using a reference field,2015-03-10T14:25:22Z,2015-10-13T20:44:32Z,,,,"Other users have reported this same problem in the past:-
. https://groups.google.com/forum/#!searchin/web2py/crud$20search$20no$20results$20reference$20/web2py/6Q-pBbqxtwE/BP-FcflbgSMJ

Running  2.9.11-stable+timestamp.2014.09.15.23.35.11 on windows, python 2.6.7

This used to work on older versions of web2py and was broken in an upgrade

The bug is in tools.py, class Crud, function get_format

the code calls format = rtable.get('_format', None)

there is no such .get method on a table object (looks like this must have worked on older versions of DAL !?), this causes get_query() to fail, this exception is caught and returns None to crud.Search, the exception is caught and as the comment says '# hmmm, we should do better here', and returns None as the result.

original code:

```
def get_format(self, field):
    rtable = field._db[field.type[10:]]
    format = rtable.get('_format', None)
    if format and isinstance(format, str):
        return format[2:-2]
    return field.name
```

 a fix would be:-

```
def get_format(self, field):
    rtable = field._db[field.type[10:]]
    format = rtable._format or None
    if format and isinstance(format, str):
        return format[2:-2]
    return field.name
```
"
843,Changes made to fix interaction with JASIG CAS 2.0,2015-03-10T07:17:35Z,2015-03-11T23:30:18Z,,,,"Modified ""guessing"" of First-name to not expect an email address in gluon/tools.py
Modified the CAS Auth to handle CAS 2.0 attributes in casauth.py
"
842,Auth.change_password allow users to change to blank password,2015-03-09T17:25:37Z,2015-09-21T20:30:03Z,,,,"https://github.com/web2py/web2py/commit/cef72027817ab7718ef3b79d08ae29e2e4a6acba#commitcomment-10104618

Why was that line necessary?
"
841,Issue 794: sep = separator or current.response.form_label_separator,2015-03-08T17:19:09Z,2015-03-11T23:28:56Z,,,,"closes issues#794
"
840,Improve PEP8 globals.py,2015-03-07T23:01:35Z,2015-03-11T23:28:40Z,,,,
839,PEP8 fileutils py,2015-03-07T02:43:33Z,2015-03-07T18:34:19Z,,,,
838,Fix single double quote for triple double quote docstring,2015-03-07T01:43:06Z,2015-03-07T08:51:19Z,,,,
837,Test 2,2015-03-06T22:22:51Z,2015-03-06T22:38:50Z,,,,"I try to make PR to see if merge have been done correctly... Hope this one pass Travis...
"
836,Test 1,2015-03-06T20:56:07Z,2015-03-06T21:04:14Z,,,,"I try to make PR to see if merge have been done correctly...
"
835,"improve PEP8 mainly search ,(?=\S) replace ,whitespace not touching js",2015-03-06T16:27:06Z,2015-03-06T20:48:00Z,,,,"I also add some whitespace around == in if and add some new line before def and class
"
834,"web2py crashes on 'session_pickled = pickle.dumps(self, pickle.HIGHEST_PROTOCOL)' with 2 instances",2015-03-05T08:59:14Z,,,TypeError,TypeError: 'NoneType' object is not callable,"I am running two instances of web2py (2.9.12-stable+timestamp.2015.01.17.06.11.03) under apache and only first started instance works, the second instance crashes with error <type 'exceptions.TypeError'>('NoneType' object is not callable)

Traceback (most recent call last):
  File ""/opt/web-apps/web2py_sr/gluon/main.py"", line 435, in wsgibase
    session.connect(request, response)
  File ""/opt/web-apps/web2py_sr/gluon/globals.py"", line 934, in connect
    session_pickled = pickle.dumps(self, pickle.HIGHEST_PROTOCOL)
TypeError: 'NoneType' object is not callable

I have another server with web2py version 2.4.5 and it works there.
"
833,standalone scheduler,2015-03-04T12:42:16Z,,enhancement,,,"I think can be really valued the use of web2py scheduler with pydal, outside web2py.
At a first sight, the current scheduler implementation requires:
- pydal: the imports have to be revised a bit
- web2py_uuid: I guess we can replace it with something from standard library
- Storage: although really useful, I guess we could try to avoid it
"
832,portalocker issue,2015-03-04T07:21:58Z,2015-03-11T17:58:31Z,,AttributeError,AttributeError: 'module' object has no attribute 'LockedFile',"The pip version of portalocker (0.5.4 on windows) raises an issue on welcome app:

```
AttributeError: 'module' object has no attribute 'LockedFile'
```
"
831,fix docs at the top to honor correctly expiration when used in models,2015-03-03T19:31:06Z,2015-03-05T22:26:45Z,,,,"Thanks @KabluBR  for spotting it
"
830,Fix click popagation to both new and actual tab when CTRL+Click,2015-03-03T15:16:51Z,2015-03-05T22:26:36Z,,,,"This solved the issue #829
"
829,CTRL+Click over navbar menu redirect both new tab and actual tab over link address,2015-03-03T15:16:14Z,2015-03-06T15:05:24Z,,,,"Hello,

When CTRL+Click over navbar menu entries, instead of just open a new tab that will be redirected over the link of the menu entry, both actual tab and the new tab get redirected over the link address.

My actual investigation point me into web2py_bootstrap.js and this line specifically :

jQuery('ul.nav li.dropdown a').click(function(){window.location=jQuery(this).attr('href');});

Commenting it solve the wrong click()...

This PR #830 solved the issue.
"
828,fixes #656,2015-03-02T22:02:22Z,2015-03-05T22:26:03Z,,,,"almost 2 years later. Better late than never
"
827,"fix sessions2trash bug, auth not exist in single_loop",2015-03-02T18:27:43Z,2015-03-03T19:27:07Z,,,,
826,TypeError in modules/dal.py line 85: because GoogleDatastoreAdapter is None,2015-03-02T16:39:49Z,2015-03-20T15:51:36Z,,TypeError,"TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types","I have tried both, usage of the release version for Windows http://www.web2py.com/examples/static/web2py_win.zip as well as the latest git checkout 

> > > > Revision: befb5b286af50bce325a4075999826e5065690ea
> > > > Author: mdipierro massimo.dipierro@gmail.com
> > > > Date: 01.03.2015 18:04:53
> > > > Message:
> > > > Merge branch 'master' of github.com:web2py/web2py
> > > > 
> > > > Modified: applications/admin/controllers/default.py
> > > > Modified: applications/welcome/static/js/web2py.js
> > > > Modified: gluon/scheduler.py
> > > > Modified: gluon/tests/test_is_url.py
> > > > Modified: gluon/tests/test_validators.py
> > > > Modified: gluon/validators.py
> > > > Added: scripts/parse_top_level_domains.py
> > > > Modified: gluon/packages/dal
> > > > Modified: gluon/tools.py

I started web2py as a local server on 127.0.0.1:8000 on Win7 (using Python 2.7.9 in the case of the checked-out files). An initial application using the wizzard was created (using the release version web2py_win.zip). After that I want to enter some initial datasets into the tables that were just created. I tried to log in on the application front end. I could load the index page, but when trying to access http://127.0.0.1:8000/ProductionDB/default/components_manage (where ProductionDB is the application name and components is a table created via the wizzard), a ticket was created stating:

Traceback (most recent call last):
  File ""<web2py_base_folder>\gluon\restricted.py"", line 224, in restricted
    exec ccode in environment
  File ""<web2py_base_folder>\applications\ProductionDB\controllers/default.py"", line 88, in <module>
  File ""<web2py_base_folder>\gluon\globals.py"", line 393, in <lambda>
    self._caller = lambda f: f()
  File ""<web2py_base_folder>\gluon\tools.py"", line 3449, in f
    return action(_a, *_b)
  File ""<web2py_base_folder>\applications\ProductionDB\controllers/default.py"", line 65, in urls_manage
    form = SQLFORM.smartgrid(db.t_urls,onupdate=auth.archive)
  File ""<web2py_base_folder>\gluon\sqlhtml.py"", line 2968, in smartgrid
    user_signature=user_signature, **kwargs)
  File ""<web2py_base_folder>\gluon\sqlhtml.py"", line 2643, in grid
    value = field.represent(value, row)
  File ""<web2py_base_folder>\gluon\dal.py"", line 85, in list_ref_repr
    if isinstance(db._adapter, GoogleDatastoreAdapter):
TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types

Variables
builtinisinstance   <built-in function isinstance>
db._adapter     <pydal.adapters.sqlite.SQLiteAdapter object>
db  <DAL uri=""sqlite://storage.sqlite"">
GoogleDatastoreAdapter  None

After the first test failed using the release version for Windows http://www.web2py.com/examples/static/web2py_win.zip I switched over to the latest GitHub check-out, but got the identical error message. (I recycled the application folder <web2py_base_folder>\applications\ProductionDB from the windows distribution to the GitHub checkout).

In the source code <web2py_base_folder>\gluon\packages\dal\pydal\adapters__init__.py, line 87 the GoogleDatastoreAdapter is set to None if not on a Google AppEngine server (which I am certainly not).

So I guess that there is an issue with the <web2py_base_folder>\gluon\dal.py code that IMHO should not test with isinstance() when there is the possibility to get a TypeError due to an uninitialized second argument.
"
825,Linkedin login integration,2015-03-01T16:25:34Z,2017-06-15T09:30:21Z,,AttributeError,AttributeError: 'module' object has no attribute 'LinkedIn',"Testing the linked intgeration explained in the book: 
http://www.web2py.com/books/default/chapter/29/09/access-control?search=LinkedInAccount

I could not make it works. It use python-linkedin lib and it looks this lib has change some methods or class names. I am using  python-linkedin (4.1). Here is what I get:

```
  File ""/var/www/web2py/gluon/contrib/login_methods/linkedin_account.py"", line 33, in __init__
    self.api = linkedin.LinkedIn(key, secret, return_url)
AttributeError: 'module' object has no attribute 'LinkedIn'
```

Based in facebook oauht2 doc I have created this post:
http://www.web2pyslices.com/slice/show/2011/integrating-linkedin-with-web2py

I hope it helps...
"
824,Cas redirect loop,2015-03-01T09:23:07Z,2015-06-12T21:14:13Z,,,,"After adding these 2 lines in a model file (0.py), I entered a CAS loop each time I required @auth.requires_login():
# from datetime import datetime as dt
# request.now = dt.utcnow()
"
823,The Ubuntu Apache 2.4 install script makes the server https only,2015-02-28T04:24:42Z,2015-09-18T05:38:56Z,,,,"I'm not sure if this is intentional but the earlier Apache 2.2 script and the install scripts for Ngnix and Fedora do not do force https, it is not mentioned in the documentation and it took me ages to figure why the issue came up when I upgraded Ubuntu. It's the lines: 

<VirtualHost *:80>

  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]

in the http://web2py.googlecode.com/hg/scripts/setup-web2py-ubuntu.sh script that do it. 

There is discussion here https://www.mail-archive.com/web2py@googlegroups.com/msg138827.html

I managed to get a workaround that I posted on http://stackoverflow.com/questions/28116754/how-can-i-make-part-of-the-website-not-use-https-in-web2py/28435772#28435772

but I think that uses the old Apache 2.2 code and could be done better if anyone is up on Apache 2.4?
"
822,Tracking pyDAL v15.02.27,2015-02-27T11:33:15Z,2015-03-05T22:25:43Z,,,,
821,Fixed issue 819,2015-02-25T13:27:00Z,2015-02-25T17:45:06Z,,,,"The problem was that it was only checking for button to use html instead of val, what you need is to only use val if it it's an input and use html for everything else.
"
820,cache.disk sometimes stores mysql password in filesystem path,2015-02-25T07:28:36Z,2015-02-26T14:43:40Z,,,,"I noticed that one query creates a file system path (in linux) that contains the mysql password, such as myapp/cache/mysql:/user:pass@localhost/app/SELECT...

I'm quoting Leonel C√¢mara about the issue:

""This is definitely a bug in the DAL. Probably a very old one that was made evident by the new lockless cache implementation. Passwords should never have been saved in the cache in raw format as the cache is not supposed to be safe for that.  

BaseAdapter does this in the select

```
        (cache_model, time_expire) = cache
        key = self.uri + '/' + sql
        if len(key)>200: key = hashlib_md5(key).hexdigest()
        args = (sql,fields,attributes)
```

Basically it should always, always, use the hash, not just if the key's len is >200. Please submit an issue this must be fixed ASAP.""
"
819,A() helper callback behavior,2015-02-25T00:01:37Z,2015-03-01T17:43:12Z,,,," when clicked more than 1 times the link button show : working
when clicked one time the link button is shrunk

ref:
https://groups.google.com/forum/#!topic/web2py/p6-yimwQK1c
"
818,Fix - Scheduler - Convert task args back to utf-8,2015-02-24T23:13:44Z,2015-02-25T17:44:46Z,,,,"See this thread for more details:
https://groups.google.com/forum/#!topic/web2py-developers/0OPEm9WELoM
"
817,fixes issue #773,2015-02-24T22:36:45Z,2015-02-25T17:44:30Z,,,,"- Removed redundant tests in test_validators.py since there's test_isurl.py
- Added allowed_tlds argument 
- Updated official_top_level_domains from 
  http://data.iana.org/TLD/tlds-alpha-by-domain.txt
- Added script to easily update the official_top_level_domains for the future
"
816,"fix issue 799, removed new lines from response header",2015-02-24T18:48:05Z,2015-02-25T17:44:12Z,,,,"fixed issue https://github.com/web2py/web2py/issues/799
"
815,"request.args returns double underscore instead of unicode character (.url, .vars behave ok)",2015-02-24T12:38:21Z,2015-03-20T15:53:12Z,,,,"Example:
http://www.utf8-chartable.de/unicode-utf8-table.pl?start=256&unicodeinhtml=hex&htmlent=1
U+010C == %c4%8c == ƒå

If I enter: a/c/f/ABC%c4%8cD
as URL into browser, browser will properly show: a/c/f/ABCƒåD
request.args[0] ABC__D --failure - double underscore instead of the unicode character
request.url a/c/f/ABCƒåD --ok
request.vars --ok

So the problem is just in request.args

Version 2.9.12-stable+timestamp.2015.01.17.06.11.03
Lubuntu, Firefox/Chromium/urllib2/.. --or-- Debian, Chrome ....
"
814,report-bug link from web2py download page is broken,2015-02-24T12:34:11Z,2015-03-20T16:01:01Z,,,,"web2py.com, download, report a bug - href:
http://code.google.com/p/web2py/issues/list
leads to:
https://code.google.com/hosting/moved?project=web2py
"
813,request.arg unquoting,2015-02-23T22:39:43Z,2015-12-04T18:44:41Z,,,,"request.arg should be unquoted  by default

for a discussion of the problem see:
https://groups.google.com/d/msg/web2py-developers/NP9qh7YsGlQ/NnD88mvjUY4J
"
812,fixes issue #635,2015-02-23T22:04:20Z,2015-02-24T15:26:40Z,,,,"since there is no more a proper place to put the new regex, it's on top
of the module for speedup. The patch leaves open a few corner-cases,
but since we have ""headers"" to alter the headers in SQLTABLE, any
corner case can be fixed passing properly filled ""headers"" parameter.
This just makes the simple case described on the issue work fine, that
should accomodate the 99% of the usecases for with_alias() needs
at the field level.
"
811,updated ipaddr to the latest version,2015-02-23T20:50:49Z,2015-02-24T15:26:21Z,,,,"The API changed just a little bit, so a small refactor of validators.py 
was needed
"
810,fixes issue #742,2015-02-23T20:36:46Z,2015-02-24T15:26:03Z,,,,
809,fixes #806,2015-02-22T17:05:23Z,2015-02-24T15:25:44Z,,,,
808,codemirror 4.13,2015-02-21T14:43:57Z,2015-02-24T15:25:29Z,,,,"fix https://groups.google.com/d/topic/web2py/YdKFOuteDn8/discussion
"
807,Make extract_sqlite_models.py work with SQLite 3.8.6,2015-02-20T20:45:39Z,2015-02-24T15:25:09Z,,,,"I tried to run the extract_sqlite_models.py against my existing sqlite3 database but there where no types returned. I don't know if the problems ("""" instead of [] surroundings and upper case type names) are SQLite version specific or if they are just came from the adaption of the MySQL script (as the file header says).
"
806,feature request: ,2015-02-20T12:16:40Z,2015-02-24T15:25:46Z,,,,"Append 

```
touch-reload=/home/www-data/web2py/routes.py
```

to `/etc/uwsgi/web2py.ini` in the `setup-web2py-ubuntu.sh`

Even if the file doesn't exist uwsgi will not break on it, but if the files exists it saves quite a lot of time having to restart the uwsgi server over and over on testing and changing the routes.py
"
805,parametetric routing fails when BASE['domains'] refers to nonexisting app ,2015-02-20T12:10:41Z,,,,,"``` python
routers = dict(
    BASE=dict(
        domains = {
                'app.domain.com' : 'app',
                'app2.domain.com' : 'app2'
        }
    ),
)
```

Above works. 
When introducing 

``` python
               'app3.domain.com' : 'app3',
```

into the mix the server will respond on any domain with ""`Internal Server Error`"" (no ticket, no errors or lines in uwsgi or nginx logging). 

The `app3` application doesn't exist (and comma's are correctly set, no syntax errors in the routes)

It feels to me that when an application is removed but referenced in `routes.py` should not break the server.
"
804,fixed sessions2trash.py not removing empty dirs,2015-02-19T21:57:48Z,2015-02-20T14:38:27Z,,,,
803,C-b not working in Vim editor,2015-02-18T19:33:21Z,2015-09-23T19:43:46Z,enhancement,,,"C-b (ctrl+b) shortcut to go up by one page in vim does not work.

This is working on Codemirror sample page in vim mode, and this is not part of the reference short-cuts on the page.
So I suspect the key stroke is first catched by the emmet plugin. (even if non html editing).
If my assumptions are correct, we just need to remap the C-b key to an other one, and by the way document the short cut(s) on the bottom of the editor.
"
802,Issue/801 - Fix the :write not saving problem in codemirror vim mode,2015-02-18T18:27:48Z,2015-02-20T14:37:55Z,,,,
801,[admin/editor] Save does not work in vim mode (:write),2015-02-18T18:21:34Z,2015-03-20T15:55:54Z,,,,
800,Added the 2 missing files. This is probably consequences of codemirror,2015-02-18T17:42:34Z,2015-02-19T22:50:20Z,,,,"Bug fix.
The first file was requested when Creating a new file.
The second is a css used by codemirror in non vim mode.

Regards,
"
799,Crash when we create a new file from the left hiding pane of the admin app.,2015-02-18T17:37:03Z,2015-02-27T14:21:27Z,,,,"When we create a new file from the left pane with the ""Create"" Button, this generates the following error:

[Wed Feb 18 18:30:22 2015] [error] [client 10.242.0.10] mod_wsgi (pid=29130): Exception occurred processing WSGI script '/home/www-data/web2py/wsgihandler.py'.
[Wed Feb 18 18:30:22 2015] [error] [client 10.242.0.10] ValueError: embedded newline in response header with name 'web2py-component-command' and value '
[Wed Feb 18 18:30:22 2015] [error] [client 10.242.0.10]             $.web2py.invalidate('#files_menu');
[Wed Feb 18 18:30:22 2015] [error] [client 10.242.0.10]             load_file('/admin/default/edit/init/models/test.py');
[Wed Feb 18 18:30:22 2015] [error] [client 10.242.0.10]             $.web2py.enableElement($('#form form').find($.web2py.formInputClickSelector));
[Wed Feb 18 18:30:22 2015] [error] [client 10.242.0.10]         '

And on the web page, we can read:
Internal Server Error
The server encountered an internal error or misconfiguration and was unable to complete your request.
....

The problem is only if created from the left hiding pane in edit mode, and despite the error message, the file is correctly created. We just need to reload the full page to see it appearing in the left hiding pane.

The problem does not occur if the file is created directly from the ""Edit"" application page.
"
798,Drop python 2.5,2015-02-18T09:05:07Z,2015-03-20T15:56:30Z,,,,"The last security bug fix release (source only) of python 2.5 has been publish in 2011.
https://www.python.org/download/releases/2.5.6/
There are no tests on travis-ci for python 2.5.
"
797,Fixed issue;sanitizer closing no close tags,2015-02-16T16:43:37Z,2015-02-20T14:37:35Z,,,,
796,adjusted docs to newer structure,2015-02-15T22:15:17Z,2015-02-15T22:43:03Z,,,,
795,removed unsed codemirror files,2015-02-14T16:16:26Z,2015-02-15T22:42:58Z,,,,"It should be fine to remove those files
"
794,Issue 747: sep = separator or current.response.form_label_separator,2015-02-14T13:59:14Z,2015-02-15T02:19:02Z,,,,"web2py/issues/747
"
793,web2py links sqldesigner but the latter does not work,2015-02-14T02:05:45Z,2015-03-20T15:58:13Z,,,,
792,fixes #735. Review CAREFULLY before merging,2015-02-13T21:56:19Z,2015-02-15T22:44:09Z,,,,
791,ImportError: No module named gluon.main with Python 2.7.9,2015-02-13T15:08:57Z,2015-02-14T19:24:44Z,,Error,Error: ,"Win 7
Python 2.7.9 32 Bit
Apache HTTP Server, version 2.2, 32 bit
Downloaded the latest web2py
mod_wsgi from mod_wsgi-4.4.8+ap22vc9-cp27-none-win32.whl

Error: 

[Fri Feb 13 20:27:23 2015] [warn] mod_wsgi: Compiled for Python/2.7.9+.
[Fri Feb 13 20:27:23 2015] [warn] mod_wsgi: Runtime using Python/2.7.9.
[Fri Feb 13 20:27:23 2015] [notice] Child 5780: Child process is running
[Fri Feb 13 20:27:23 2015] [notice] Child 5780: Acquired the start mutex.
[Fri Feb 13 20:27:23 2015] [notice] Child 5780: Starting 64 worker threads.
[Fri Feb 13 20:27:23 2015] [notice] Child 5780: Starting thread to listen on port 443.
[Fri Feb 13 20:27:23 2015] [notice] Child 5780: Starting thread to listen on port 80.
[Fri Feb 13 20:27:38 2015] [error] [client 127.0.0.1] mod_wsgi (pid=5780): Target WSGI script 'C:/web2py/wsgihandler.py' cannot be loaded as Python module.
[Fri Feb 13 20:27:38 2015] [error] [client 127.0.0.1] mod_wsgi (pid=5780): Exception occurred processing WSGI script 'C:/web2py/wsgihandler.py'.
[Fri Feb 13 20:27:38 2015] [error] [client 127.0.0.1] Traceback (most recent call last):
[Fri Feb 13 20:27:38 2015] [error] [client 127.0.0.1]   File ""C:/web2py/wsgihandler.py"", line 37, in <module>
[Fri Feb 13 20:27:38 2015] [error] [client 127.0.0.1]     import gluon.main
[Fri Feb 13 20:27:38 2015] [error] [client 127.0.0.1] ImportError: No module named gluon.main
"
790,admin app fails with TypeError: can't pickle function objects,2015-02-11T15:12:23Z,2015-03-20T15:59:14Z,,,,"Old thread: https://code.google.com/p/web2py/issues/detail?id=1655
"
789,need to add signature to url after login,2015-02-09T19:43:57Z,2015-03-20T16:05:37Z,,,,"I have a URL that I want to direct to after login. Something like `_next_url = URL(c, f, v, signature=True)`.

The problem is this. The signature is computed before login. After login, the signature isn't valid.

We need a way to recompute the signature for a URL after the fact ... after the URL is already computed. Something like `_next_url = URL(c, f, v)` ... then after login, `_next_url_updated = add_signature_to(_next_url)`?
"
788,Fix appadmin code inspection for db hooks,2015-02-09T18:40:13Z,2015-02-09T22:56:30Z,,,,"This PR fix issue https://github.com/web2py/web2py/issues/779
There are circumstances such as compiled app, windows build, in which either inspect.getsourcefile or inspect.getsourcelines fails
"
787,Double scrollback in web editor because does not properly calculate display height,2015-02-08T19:43:47Z,2015-02-13T20:15:39Z,"bug, imported, Priority-Medium",,,"_From [francois..._at_gmail.com](https://code.google.com/u/103398054893183874790/) on February 07, 2015 13:20:01_

What steps will reproduce the problem? 1. Log in to the admin interface
2. Edit a file. In the screenshot I used: http://localhost:8000/admin/default/edit/examples/models/feeds_reader.py?id=models__feeds_reader__py
3. A second scroll bar appears for the page, regardless of the initial size, the page has always the same extra length forcing a page scrollbar, in addition of the editor scrollbar. What is the expected output? What do you see instead? We expect to only have the editor scrollbar. What version of the product are you using? On what operating system? I tested on the stable (2.9.12) and git version.
The behavior is the same with Firefox and Chromium. Please provide any additional information below. The problem seems caused by a new ""toolbar"" or footbar that would have been added without adapting the calculation of the height of the page to prevent the scrollbar from appearing. Not sure of the solution, but it might be just a CSS change as well.

Regards,

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2046_
"
786,DAL > MSSQLAdapter & MSSQL2Adapter > ILIKE fails for text and ntext columns,2015-02-08T19:43:44Z,2015-02-08T19:51:33Z,"bug, imported, Priority-Medium",,,"_From [score2..._at_gmx.net](https://code.google.com/u/100357035028011448959/) on February 05, 2015 11:38:16_

The LOWER() sql statement in ILIKE() does not support text and ntext columns.

Bugfix: use the old LIKE for MSSQLAdapter & MSSQL2Adapter
     def LIKE(self, first, second):
        """"""Case sensitive like operator""""""
        return '(&#37;s LIKE &#37;s)' &#37; (self.expand(first),
                                 self.expand(second, 'string')) What version of the product are you using? On what operating system? 2.9.12

Maybe invalidates issue #2044

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2045_
"
785,DAL > MSSQL2Adapter > ILIKE invalid syntax,2015-02-08T19:43:42Z,2015-08-06T14:17:22Z,"bug, DAL, imported, Priority-Medium",,,"_From [score2..._at_gmx.net](https://code.google.com/u/100357035028011448959/) on February 05, 2015 11:36:30_
1. MSSQL2Adapter.represent(value) returns N'value' for input type 'string', 'text', 'json'
2. MSSQL2Adapter.ILIKE(first, second) expands the second argument and then lowers it, leading to n'value' which is invalid syntax for mssql

Possible fix:
    def ILIKE(self, first, second):
        """"""Case insensitive like operator""""""
        return '(LOWER(&#37;s) LIKE &#37;s)' &#37; (self.expand(first),
                                 self.expand(second.lower(), 'string')) What version of the product are you using? On what operating system? 2.9.12

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2044_
"
784,db.blog_post(row_id) returns NONE,2015-02-08T19:43:40Z,2015-02-24T21:37:38Z,"bug, imported, Priority-Medium",,,"_From [Lezginoh..._at_gmail.com](https://code.google.com/u/111105538789540405417/) on February 03, 2015 14:21:48_

What steps will reproduce the problem? 1.  defin new table blog_post.
2. added several records.  
3. ""db.blog_post(1)"" returns NONE. tried all numbers for present records. What is the expected output? What do you see instead? I started learn web2py. in this video http://vimeo.com/104822115 (lesson 05)
expected object record in blog_post table on indicated position. What version of the product are you using? On what operating system? tried on source code:
2.9.11-stable+timestamp.2014.09.15.23.35.11
 (Running on Rocket 1.2.6, Python 2.7.8)
and windows version Please provide any additional information below. database sqllite

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2043_
"
783,pg8000 has support for json now,2015-02-08T19:43:39Z,2015-02-09T21:11:02Z,"bug, imported, Priority-Medium",,,"_From [remco.boerma](https://code.google.com/u/remco.boerma/) on January 30, 2015 01:16:01_

See: https://github.com/mfenniak/pg8000/commit/6d2d87c4c09873e3057a5c5152b6870933700efc and maybe https://github.com/mfenniak/pg8000/issues/68 Currently gluon/contrib/dal/adapters/postgres.py **at** line 174: 
    def try_json(self):
        # check JSON data type support
        # (to be added to after_connection)

```
    \# until pg8000 supports json, leave this commented
    \#if self.driver_name == ""pg8000"":
    \#    supports_json = self.connection.server_version >= ""9.2.0""
```

please enable pg8000 and upgrade the one in contrib

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2042_
"
782,"dal, column names should be in `quotes`",2015-02-08T19:43:36Z,2015-02-10T07:26:16Z,"bug, imported, Priority-Medium",,,"_From [sin..._at_gmail.com](https://code.google.com/u/106405431073557545113/) on January 28, 2015 14:07:56_

due to outside restrictions i have tables with column names such as `from` `to` `subject` and so forth,

using restricted words for column names isn't ideal, but it does work when the column name is in `quotes` or the full column name is used db.table.col

the DAL either restricts certain names i.e from.
generates broken SQL statements 

UPDATE templates 
SET 
to = 'abc'
WHERE
    (templates.id = 1);

i am using 

Version 2.7.4-stable+timestamp.2013.11.02.10.08.01

this issue can be easily be fixed, by genrating the quoted version of this statement

i.e

UPDATE `templates` 
SET 
`to` = 'abc'
WHERE
    (`templates`.`id` = 1);

thanks.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2041_
"
781,Update/codemirror 4.12,2015-02-07T17:47:24Z,2015-02-09T22:56:09Z,,,,"Hi, 

This is just a codemirror udpate to 4.12. It includes the Fix for the issue 2046 as well.
I removed most of the unused languages to keep it as small as possible.

Fran√ßois Delpierre
"
780,Fixed issue/2046:,2015-02-07T16:35:12Z,2015-02-09T22:55:03Z,,,,"Double scrollback in web editor because does not properly calculate display height
"
779,Web editor footer toolbar creates a trouble ticket each minute (2.9.12),2015-02-07T00:25:45Z,2015-02-12T21:17:20Z,,,,"The web editor toolbar in web2py 2.9.12 (2.9.12-stable+timestamp.2015.01.17.06.11.03) has a new ""Hooks"" tabs which just crashes and generates a trouble ticket each minute.

**Steps to reproduce the problem**
- Install web2py 2.9.12 (2.9.12-stable+timestamp.2015.01.17.06.11.03)
- Start the web editor on any source
- The web editor notification should read ""An error occurred, please reload the page""
- The Errors page shows new instances of **""IOError: could not get source code""** each minute.

**Workaround**
- Ignore the repeating notifications and tickets.
"
778,Web Editor save hangs if web2py path is not ANSI,2015-02-07T00:00:45Z,2016-03-19T09:08:40Z,,,,"If web2py's parent folder contains special characters, the web editor never completes a save with syntax errors. The file is saved, but the ""saving..."" message never disappears, and retrying the save triggers a file merge.

**Steps to replicate the error**
- Install web2py from web2py.com/examples/static/web2py_win.zip
- Unzip to **c:\c√≥digo\web2py**
- Edit the welcome application, make a syntax error and save

**Workaround**
- Rename **c:\c√≥digo\web2py** to **c:\codigo\web2py** or any ANSI name
"
777,this somehow got merged wrongly (came from #762),2015-02-06T20:29:24Z,2015-02-09T22:54:51Z,,,,
776,Added CAPTION to gluon/html.py as it is often used with tables. ,2015-02-05T21:06:13Z,2016-07-29T13:38:13Z,,,,"Also included test for new tag in gluon/tests/test_html.py
"
775,Fix enable element,2015-02-05T09:37:47Z,2015-02-09T22:52:57Z,,,,"enableElement was doing this:

```
var method = el.is('button') ? 'val' : 'html';
```

instead of:

```
var method = el.is('button') ? 'html' : 'val';
```
"
774,fixes #769,2015-02-04T21:23:38Z,2015-02-06T00:09:50Z,,,,"- fixed response.include_files() to behave correctly with 
  response.static_version_urls
- added response.static_version_urls to admin
- refactored admin URL() usage passing always and correctly 'static'
  as the controller
"
773,Update official_top_level_domains list in validators.py,2015-02-04T11:56:16Z,2015-02-27T14:20:09Z,,,,"As noted here: https://groups.google.com/forum/#!topic/web2py/C52iIdEr_hQ the .ninja tld is not recognized in the IS_URL() validator.
"
772,{{include}} vs {{block}} unexpected behavior,2015-02-04T11:28:01Z,2016-04-12T20:20:57Z,"bug, Priority-High",,,"Kudos to Paolo Dente (AKA @pgcd) for finding what follows
## How to reproduce:
- create a new app
- views: a.txt, b.txt, c.txt
## a.txt

```
{{block content}}
this block content in a
{{end}}
in a before extend
{{extend}}
in a after extend
```
## b.txt

```
in b before extend extend 'default/a.txt'
{{extend 'default/a.txt'}}
in b after extend extend 'default/a.txt'
{{block content}}
this block content in b before super
{{super}}
this block content in b after super
{{end}}

```
## c.txt

```
this is c before include
{{block content}}
{{super}}
this is block content in c
{{end}}
{{include 'default/b.txt'}}
this is c after include
```

Start the shell:

``` bash
$ python web2py.py -M -S <app name>
```

``` python
>>> print response.render('default/c.txt', {})
```

Result:

```
this is c before include


this is block content in c

in b before extend extend 'default/a.txt'


this is block content in c

in a before extend

in a after extend

this is c after include


```

The {{block}} from the including file (c.txt) is read but duplicated.
{{super}} in c is completely ignored.
N.B. {{super}} in b is completely ignored if {{block}} is not present in c.txt
## Expected result:

{{block}} in c.txt not duplicated
{{super}} in c.txt taken from {{block}} defined in a.txt
"
771,Fix for map_hyphen breaking codemirror editor,2015-02-03T20:49:00Z,2015-02-04T20:49:19Z,,,,"Fixes #769
"
770,Add SQLCustomType to SQLFORM.grid,2015-02-03T20:24:26Z,,enhancement,,,"It gives this error: Query Not Supported: 'str' object has no attribute 'utctimetuple'

How to reproduce: filter the following grid with: event.day_and_time = ""2000-01-01 00:00:00""

Note: adding explicit validator doesn't help. Tested with v2.9.12 at Ubuntu 14.04.

---

def custom_grid():
    from gluon.dal import SQLCustomType
    from datetime import datetime
    from calendar import timegm

```
ut_dt = SQLCustomType(
    type    = 'datetime',
    native  = 'integer',
    encoder = (lambda dt: timegm(dt.utctimetuple())),
    decoder = (lambda ut: datetime.utcfromtimestamp(ut)),
)

db = DAL('sqlite:memory:')
db.define_table('event',
    Field('day_and_time', type=ut_dt),
)

db.event.insert(day_and_time=datetime(2000, 1, 1, 0, 0, 0))

return dict(html=SQLFORM.grid(db.event))
```
"
769,Setting map_hyphen=True in routes.py breaks codemirror editor,2015-02-03T01:37:28Z,2015-02-06T00:09:51Z,,,,"The codemirror breaks once I set the `map_hypen` to `True`.

In my `routes.py` I have:

``` python
routers = dict(
    BASE=dict(
        default_application='mycoolapp',
        map_hyphen=True,
    )
)
```

When I try to use the web-based web2py editor it fails to load. 

Looking at the console I see the following 404's:

![screen shot 2015-02-02 at 5 35 16 pm](https://cloud.githubusercontent.com/assets/179356/6012847/ee4b6c12-ab01-11e4-8618-5ddbfbdedb81.png)

The path goes from being an _2.9.5 to -2.9.5 which is expected behavior for the URLS, however because the directory starts with a _ and gets changed to - it causes problem. For example http://localhost:8000/admin/static/**-2.9.5**/js/typeahead.min.js 
"
768,pep8ized a taddle bit sqlhtml.py,2015-01-28T21:40:08Z,2015-02-06T00:09:34Z,,,,
767,gluon/contrib/webclient.py doesn't work anymore,2015-01-28T18:15:25Z,2015-02-13T20:15:26Z,,,,"This useful tool doesn't work when the app uses the @auth.requires_login() decorator. 
This is due to the way the login form sends its data. 
    # login
    data = dict(email='homer@web2py.com',
                password='test',
                _formname='login')

_formname ='login' does not exist, and _formkey is not filled with webclient.
"
766,Translate Controllers names and Functions names,2015-01-28T11:08:10Z,,"enhancement, Priority-Low",,,"Maybe there should be a way for web2py support translation in Controllers names and Functions names, as usability wise it's a nice feature and have a huge impact in SEO.

Check this thread for more https://groups.google.com/forum/#!topic/web2py/zBN0JXDK5zc
"
765,exploiting new travis-ci environment,2015-01-27T21:15:21Z,2015-02-06T00:09:24Z,,,,"docker based infrastructure is faster. Re-added coverage report to coveralls.io
"
764,exploiting new travis-ci environment,2015-01-27T21:05:49Z,2015-01-27T21:12:18Z,,,,"docker-container environments assure more perfomances
"
763,fixed issue report link,2015-01-27T20:26:59Z,2015-02-06T00:09:07Z,,,,
762,updated Pg8000,2015-01-27T13:12:46Z,2015-02-06T00:08:50Z,,,,
761,Updated missing pydal warning message,2015-01-27T01:40:47Z,2015-02-05T23:58:04Z,,,,
760,Upgrade pg8000 contrib driver,2015-01-27T01:23:47Z,2015-02-12T20:35:16Z,DAL,,,
759,Contrib adapters integration test,2015-01-27T01:22:53Z,2015-10-31T04:07:37Z,tests,,,
758,"we should always avoid importing ""optionals"" without a try:except.",2015-01-26T23:14:23Z,2015-02-05T23:57:45Z,,,,"one clear case of ""should never happen""... that happened.
in this case docs were failing builds on readthedocs because of 
pypyodbc not being able to load any odbc library.
"
757,Rss feed,2015-01-26T21:46:48Z,2015-03-20T16:36:52Z,"bug, imported, Priority-Medium",,,"_From [dam..._at_gmail.com](https://code.google.com/u/101094302681590029076/) on January 25, 2015 19:51:23_

M. Di Pierro say: Please open a ticket and we will fix it soon. What steps will reproduce the problem? What string type pass for this work?

file: gluon/serializers.py (from 25 Sep 2014)
line: 182

```
def safestr(obj, key, default=''):
    return str(obj[key]).encode('utf-8', 'replace') if key in obj else default
```

This code fail for me if have special characters.

Example:

if:
obj[key] = u""√≥""  #unicode
fail

if:
obj[key] = ""√≥""  #string
fail

if change encode for decode in this line work if obj[key] is a unicode.
        return str(obj[key]).decode('utf-8', 'replace') if key in obj else default

Is this a possible bug?

Controlle example:

def rss():

```
import gluon.contrib.feedparser as feedparser
d = feedparser.parse(' http://rss.slashdot.org/Slashdot/slashdot/to' )  # this work

d[""entries""].insert(0, {""link"": """", 
        ""title"": ""title"", ""description"": u""example description""})  # with this line work

d[""entries""].insert(0, {""link"": """", 
        ""title"": ""titl√©"", ""description"": u""example description""})  # with this line not work (√©)
from gluon.serializers import rss   
test = rss(d)
response.headers['Content-Type']='application/rss+xml'

return test What version of the product are you using? On what operating system? 2.9.12 and before
```

from 25 Sep 2014 Please provide any additional information below. Very thanks.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2040_
"
756,json trouble in version 2.9.12 ,2015-01-26T21:46:45Z,2015-01-26T22:52:57Z,"bug, imported, Priority-Medium",,,"_From [gate..._at_gmail.com](https://code.google.com/u/113758810784977900114/) on January 24, 2015 17:19:18_

In a javascript section in a html file view I use an json instruction;

var mex_1_alert={{=XML(response.json(mex_1))}} 

where mex_1 is value part of key mex_1 in returned dictionary (I need json because without it the string for alert javascript window is badly showed. In 2.9.11 version it worked perfectly. 

Now, after upgrade to 2.9.12 version, .json presence generate a serious trouble: the web browser doesn't show the contents page but only the html code. I tried (to test it) to use .json in web2py simple_example3.html:--> 

{{extend 'layout.html'}}
<h1>{{=message}}</h1>
<script type=""text/javascript"">
var mex_1_alert={{=XML(response.json(message))}}
alert (mex_1_alert)
</script>

The result it's the same. The browser shows html code instead the correct view. (The html contents of layout.html is showed too) 

Thank for your time and help. 

G.A

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2039_
"
755,Sanitizer is closing <br> and <img> tags too.,2015-01-26T21:46:43Z,2015-02-27T15:14:38Z,"bug, imported, Priority-Medium",,,"_From [c..._at_cemeren.com](https://code.google.com/u/102223031108363556982/) on January 23, 2015 06:47:19_

What steps will reproduce the problem? 1. Sanitize any html content with these tags with permitted_tags defined as no close <br/> What is the expected output? What do you see instead? Since it is closing basically all tags, you can notice the output is not what you have designed specially if there are br tags causing doubling the spaces. What version of the product are you using? On what operating system? 2.9.12-stable+timestamp.2015.01.17.06.11.03
(Running on Apache/2.4.9 (Unix) mod_wsgi/4.3.0 Python/2.7.3, Python 2.7.3) Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2038_
"
754,SQLTABLE ignores truncate if headers also specified,2015-01-26T21:46:27Z,2015-01-27T15:32:20Z,"bug, imported, Priority-Medium",,,"_From [psebby1..._at_gmail.com](https://code.google.com/u/107274190071983881964/) on January 22, 2015 23:45:10_

What steps will reproduce the problem? 1. In my controller, I get a set of rows via select() and put them in the returned dictionary.
2. In my view, I want to show the rows as a table, using the field labels in the table header and truncating long string values in the table cells:
{{=SQLTABLE(myRows, headers='labels', truncate=40)}} What is the expected output? What do you see instead? I expect to see the rows in a table with truncated cell values; instead the long string values are displayed in the cells without any truncation.  If I remove the ""headers"" parameter to SQLTABLE then cell truncation works as expected, so somehow the headers value causes the truncate value to be ignored. What version of the product are you using? On what operating system? Web2py 2.9.11 with Python 2.7 on Mac OSX.

Thanks - Web2py is a great framework!

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2037_
"
753,latest Version 2.9.12 doesn't work with Apache using wsgi  ,2015-01-26T21:46:25Z,2015-09-03T16:29:47Z,"bug, imported, Priority-Medium",,,"_From [omi..._at_gmail.com](https://code.google.com/u/117551687292950814124/) on January 22, 2015 20:11:46_

Error ticket ""'NoneType' object is no callable in gluon/globals.py"" What steps will reproduce the problem? 1. Download the latest souce and run under apache
2. Running with Rocket server works fine What version of the product are you using? On what operating system? 2.9.12 Windows 2012 Please provide any additional information below. See forum post https://groups.google.com/forum/#!topic/web2py/yBM8Ybl_xGA

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2036_
"
752,2.9.12 / cache / Windows Error3: The system cannot find the path specified,2015-01-26T21:46:16Z,2015-01-26T22:50:10Z,"bug, imported, Priority-Medium",,,"_From [subbaram..._at_gmail.com](https://code.google.com/u/116822970470025815642/) on January 20, 2015 19:35:43_

What steps will reproduce the problem? 1. Details of the discussion are here: https://groups.google.com/forum/#!topic/web2py/YMpbAlMLln8 What is the expected output? What do you see instead? Disk cache should work on Windows, and other platforms What version of the product are you using? On what operating system? 2.9.12, from source. On Windows 8.1

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2035_
"
751,"2.9.12 for Windows / cache / ""Cannot import name wintypes""",2015-01-26T21:46:07Z,2015-01-26T22:49:31Z,"bug, imported, Priority-Medium",,,"_From [subbaram..._at_gmail.com](https://code.google.com/u/116822970470025815642/) on January 20, 2015 15:59:47_

What steps will reproduce the problem? 1. Reported here: https://groups.google.com/forum/#!topic/web2py/jqrOz0yd7jc What version of the product are you using? On what operating system? 2.9.12 windows executable, Windows

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2034_
"
750,grid bug with multiple selectable values only using ajax,2015-01-26T21:46:05Z,2015-01-28T21:07:08Z,"bug, imported, Priority-Medium",,,"_From [manuele...._at_gmail.com](https://code.google.com/u/103187076317995702211/) on January 13, 2015 16:04:37_

## What steps will reproduce the problem?
1. Consider the subsequent code:
- In a model source (i.e. models/test.py)

``` python
\# -*- coding: utf-8 -*-
from gluon.contrib.populate import populate

db.define_table('generic',
    Field('first_name')
)

if db(db.generic.id>0).count()==0:
    populate(db.generic,100)

def _foo(ids):
    print ids
```
- In a controller file (i.e. controllers/test.py)

``` python
\# -*- coding: utf-8 -*-
\# prova qualcosa come
def _index():
    grid = SQLFORM.grid(
        db.generic.id>0,
        selectable = [('foo', _foo)]
        \# selectable = _foo
    )
    return locals()

def index():
    grid = LOAD('test', '_index.load', ajax=True)
    return locals()
```
1. Make a try with the two values for the selectable parameter (the second one is commented out).

## What is the expected output? What do you see instead?

using the first value (i.e when the parameter takes a list) and _only using ajax_ the callback called _foo is never called.
Everything works perfectly when only the function is passed to the selectable parameter What version of the product are you using? On what operating system? \* Framework version: web2py 2.10.0-beta+timestamp.2014.10.16.15.58.50 (Running on Rocket 1.2.6, Python 2.7.5+)
- S.O. version: Linux 3.11-2-amd64 `#1` SMP Debian 3.11.8-1 (2013-11-13) x86_64 GNU/Linux Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2033_
"
749,Mobile menu item always active,2015-01-26T21:45:55Z,,"bug, imported, Priority-Medium",,,"_From [richardd..._at_gmail.com](https://code.google.com/u/113667587830913376677/) on January 09, 2015 10:58:06_

What steps will reproduce the problem? 1. Login on a mobile device
2. Select anonther menu item than the first
3. Try to select the first menu item again What is the expected output? What do you see instead? Expected output is the first view referred to by the first menu item What version of the product are you using? On what operating system? It appears on iPad1 (Safari and Chrome) and iPad2, iPhone and Samsung Nore 2014. Please provide any additional information below. The consequence of this issue is that all menu items can be used except the first item.

I have defined this menu in menu.py

response.menu = [
    (T('Interviews'), False, URL('default', 'index'), []),
    (T('Voeg interview toe'), False, URL('default', 'voegtoe'), []),
    (T('Statistieken'), False, URL('default', 'statistieken'), []),
    (T('Presentatie'), False,  ' https://prezi.com/..../' , [])
]

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2031_
"
748,Bug with forking/multiprocessing -- launch directory,2015-01-26T21:45:40Z,2015-09-21T20:32:39Z,"bug, imported, Priority-Medium",,,"_From [rmathews_at_gmail.com](https://code.google.com/u/rmathews_at_gmail.com/) on December 20, 2014 08:06:57_

I have a weird bug that seems to be triggered when using the multiprocessing module, if web2py is launched from another directory.

I've tried to isolate the issue.  To reproduce the issue, take a clean web2py source tarball, and make the following changes:
1. to the end of applications/welcome/controllers/default.py add the lines:
   import alpha
   def bravo():
       return alpha.charlie()
2. create a new file applications\welcome\modules\alpha.py with the following content
   from multiprocessing import Process, Manager
   
   def delta(output):
       output.append('Hello, world!')
   
   def charlie():
       output = Manager().list()
       p = Process(target=delta, args=(output,))
       p.start()
       p.join()
       return output[0]
3. run it normally, 
       d:\code\temp\web2py>python web2py.py
   ... hit http://127.0.0.1:8000/welcome/default/bravo ... everything works
4. change the current working directory, and relaunch
   d:\code\temp\web2py>cd ..
   d:\code\temp>python web2py\web2py.py
   and you get an error.  An unhelpful ticket, but the console has the following traceback:
   Traceback (most recent call last):
     File ""<string>"", line 1, in <module>
     File ""D:\Python27\lib\multiprocessing\forking.py"", line 380, in main
       prepare(preparation_data)
     File ""D:\Python27\lib\multiprocessing\forking.py"", line 489, in prepare
       file, path_name, etc = imp.find_module(main_name, dirs)
   ImportError: No module named web2py

If it helps, I put a print statement before File ""D:\Python27\lib\multiprocessing\forking.py"", line 489, and it printed out:
        ['d:\code\temp\web2py\web2py']

Something is causing the path to add the directory web2py twice!

If I run the code from one directory above that:
    d:\code\temp>cd ..
    d:\code>python temp\web2py\web2py.py
then the following is printed:
        ['d:\code\temp\web2py\temp\web2py']

Again the path is repeated twice.

Can anyone help me understand what is causing this issue?  What is a potential fix?

If it helps, the real bug got triggered when running web2py behind Apache on Windows (modwsgi), since the wsgi script was launched from some random Apache directory.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2030_
"
747,sep = separator or current.response.form_label_separator,2015-01-26T21:45:38Z,2015-03-20T07:44:23Z,"bug, imported, Priority-Medium",,,"_From [AnneVe..._at_googlemail.com](https://code.google.com/u/108003144278457342529/) on December 19, 2014 18:14:27_

I have the following code:

form = SQLFORM(db.nd_node_tag, record, deletable=True, showid=False,
                       formstyle=bootstrap3, separator='', hidden=dict(nodeID=nodeID))

separator='' no longer removes the separator from the label, separator=False neither.

I am using web2py 2.9.11 has separator='' been replaced? Please provide any additional information below. Anthony posted yhe following reply:

Looks like a backward incompatible change was made in SQLFORM.**init**. This:

sep = separator or ''

was changed to:

sep = separator or current.response.form_label_separator

That line should instead be:

sep = current.response.form_label_separator if separator is None else separator

Please submit an issue about this. In the meantime, you can do:

response.form_label_separator = ''

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2028_
"
746,Online book not updated to correct 2 factor auth code,2015-01-26T21:45:36Z,2015-01-26T22:43:27Z,"bug, imported, Priority-Medium",,,"_From [pallav.n..._at_gmail.com](https://code.google.com/u/100593590228148497825/) on December 09, 2014 21:20:59_

The patch for 2-factor authentication was modified before merging into main web2py but the documentation patch was not updated to reflect the changes. The following patch (already merged into the github book repository) fixes this issue, but is not released on the website. This caused confusion for at least one user on the web2p-users group. Can we release the udpated version of the book that corrects the procedure to enable two-factor auth? https://github.com/mdipierro/web2py-book/commit/36e678ff3f3ace96e6bb334695bfc1b3cb4f1ab9

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2026_
"
745,2.9.11 / cache / WindowsError [Error 123],2015-01-26T21:45:34Z,2015-01-26T22:42:33Z,"bug, imported, Priority-Medium",,,"_From [subbaram..._at_gmail.com](https://code.google.com/u/116822970470025815642/) on December 09, 2014 05:02:33_

What steps will reproduce the problem? 1. Please refer to this thread for details: https://groups.google.com/forum/#!topic/web2py/wKf7k7TGam0 2. Basically, the cache code is trying to create a file with ':' in its name, which is not allowed atleast on the Windows platform 3. What is the expected output? What do you see instead? What version of the product are you using? On what operating system? 2.9.11, Windows 8.1 Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2025_
"
744,Web2py broken language files,2015-01-26T21:45:26Z,2015-09-21T20:33:45Z,"bug, imported, Priority-Medium",,,"_From [jjachuf_at_gmail.com](https://code.google.com/u/jjachuf_at_gmail.com/) on December 05, 2014 16:38:57_

Web2py:
2.9.11-stable+timestamp.2014.09.15.23.35.11

SO: FreeBSD 10.1-RELEASE

Message from the console:

ERROR:root:Syntax error in /usr/home/jose/web2py/applications/admin/languages/es.py (invalid syntax (<unknown>, line 473))
ERROR:root:Syntax error in /usr/home/jose/web2py/applications/joyas/languages/es.py (invalid syntax (<unknown>, line 435))
ERROR:Rocket.Errors.Thread-8:Unhandled Error when serving connection:
Traceback (most recent call last): What steps will reproduce the problem? 1. I copy in my app/languages es.py from welcome
2. I run my application
3. Is broken the file es.py

The file has this structure:
# -_\- coding: utf-8 -_-
{
'!langcode!': 'es',
...
}

After running the application the initial structure is repeated twice

# -_\- coding: utf-8 -_-
{
'!langcode!': 'es',
...
}
# -_\- coding: utf-8 -_-
{
'!langcode!': 'es',
...
}
# -_\- coding: utf-8 -_-
{
'!langcode!': 'es',
...
}

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2023_
"
743,request.env.request_uri is populated differently if router is in use,2015-01-26T21:45:17Z,,"bug, imported, Priority-Medium",,,"_From [ato.st..._at_gmail.com](https://code.google.com/u/117176497741954485102/) on December 05, 2014 15:53:52_

What steps will reproduce the problem? 1. all of the details are in the post here: https://groups.google.com/forum/#!topic/web2py/aXKT7lA1SYg To sum it up, request.evn.request_uri should be equal to request._var.requested_uri in the routes_onerror handler.  They are equal if running on the rocket web server.  But, if a router is in place (apache/mod-wsgi, nginx/uwsgi) it contains a different value (the value of the error handler page with the error page as a passed variable).

Not sure how this should be handled, but at least there should be consistent behavior regardless of whether or not a router is in use.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2022_
"
742,Odd IS_LIST_OF behaviour,2015-01-26T21:45:16Z,2015-03-08T22:49:18Z,"bug, imported, Priority-Medium",,,"_From [manuele...._at_gmail.com](https://code.google.com/u/103187076317995702211/) on November 20, 2014 11:15:03_

What steps will reproduce the problem? 1. In [6]: IS_LIST_OF(IS_NOT_EMPTY())(None)
    Out[6]: ([None], 'Enter a value')
1. In [7]: IS_NOT_EMPTY()('')
   Out[7]: ('', 'Enter a value')
2. In [5]: IS_LIST_OF(IS_NOT_EMPTY())('')
   Out[5]: ([], None)
- What is the expected output? What do you see instead?

I expect:

IS_LIST_OF(IS_NOT_EMPTY())('')
([''], 'Enter a value')

but I obtain:

IS_LIST_OF(IS_NOT_EMPTY())('')
([], None)
- Please provide any additional information below.

The problem is that every time you don't insert any value in the field using a form a null string is validated (i.e. """").
As I can see from code[1] it seams to me the validator expects any kind of value and if it's not a list/tuple it insert into a list and validate it.
Another problem is that if the result of the operation str(item).strip()[2] is evaluated as False no validation is applied... so there's no way to oblige the user not to pass a null value (i.e. to insert any value).

Could it be a solution to remove the mentioned test[2]? Or maybe there's another reason I cannot see not why it is there?

Thank you very mutch
Best regards

```
Manuele
```

[1] https://github.com/web2py/web2py/blob/master/gluon/validators.py#L2508 [2] https://github.com/web2py/web2py/blob/master/gluon/validators.py#L2520

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2019_
"
741,"Suggestion: Add link to edit controller in web IDE next to ""Exposes:"" ",2015-01-26T21:45:14Z,2016-09-23T21:48:56Z,"enhancement, imported, Priority-Medium",,,"_From [ramstei..._at_gmail.com](https://code.google.com/u/106807652641341582815/) on November 02, 2014 23:08:55_

For example in my default.py  
It would be nice and fast if the web IDE have a direct link to each controller.

As coding lines goes up , having to scroll up or down a lot of lines is ""disturbing"". A lot of times i dont know if i have to go up or down.

If there is above the code the ""Exposes"" line to preview each of the controllers, it would also be nice if there was a link to go directly to the line of the controller we want to change.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2012_
"
740,Common filter not applied if query table implicit,2015-01-26T21:45:05Z,2016-06-28T20:17:03Z,"bug, DAL, imported, Priority-Medium",,,"_From [mca..._at_gmail.com](https://code.google.com/u/109910092030153265550/) on October 31, 2014 21:08:18_
- What steps will reproduce the problem?
  
  db.define_table('blog_post',
      Field('subject'),
      Field('post_text', 'text'),
      Field('is_public', 'boolean'),
      common_filter = lambda query: db.blog_post.is_public==True
  )
  
  db.blog_post.insert(subject='one', post_text=str(request.utcnow), is_public=True)
  db.blog_post.insert(subject='two', post_text=str(request.utcnow), is_public=False)
  
  return dict(message=db().select(db.blog_post.ALL, limitby=(0,5)))
- What is the expected output?

1 record.
- What do you see instead?

2 records.
- What version of the product are you using? On what operating system?

web2py v2.9.5 and v2.9.11 at Ubuntu 14.04. Sqlite and Mysql backends tested.
- Please provide any additional information below.

I think this a security bug because user could access whole table.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2010_
"
739,"DAL(""imap..."") does not work with GMail",2015-01-26T21:45:04Z,2015-09-23T12:39:43Z,"DAL, enhancement, imported, Priority-Medium",,,"_From [mweis..._at_gmail.com](https://code.google.com/u/110665799752208780239/) on October 26, 2014 08:57:26_

What steps will reproduce the problem? imapdb = DAL(""imap://the.name__at__gmail.com:the.password__at__imap.googlemail.com:993"", pool_size=1)
imapdb.define_tables()

What is the expected output? 
A connection to the GMail server

What do you see instead?
Failure to connect, tried 5 times What version of the product are you using? On what operating system? 2.9.11  Windows, from source Please provide any additional information below. Leonel C√¢mara wrote:

It's google blocking it. Go here and activate less secure apps access. https://www.google.com/settings/security/lesssecureapps That said, we may need to change how the login is done so this isn't necessary.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2008_
"
738,Submit button is disabled (until page is reloaded) when server returns a file to client.,2015-01-26T21:44:54Z,2015-03-20T21:00:59Z,"bug, imported, Priority-Medium",,,"_From [lgilb..._at_petvacclinic.com](https://code.google.com/u/109711834274266933693/) on October 23, 2014 09:14:20_

What steps will reproduce the problem? 1. Ensure Javascript is enabled.
2. Create a HTML form.
3. Click the 'submit' button. The text of the 'submit' button will change to 'Working...'
4. Have the server return a PDF file (or any other type of file) to the client.
5. Save (or Open) the PDF file.
6. The 'submit' button of the HTML form is now disabled (and will remain disabled until the page is re-loaded). Clicking it again will not re-submit the form. What is the expected output? What do you see instead? I expect the 'submit' button to be able to re-submit the HTML form. What version of the product are you using? On what operating system? I am running web2py v2.9.5 on Debian Linux 2.6 Please provide any additional information below. This is a very low-priority request.

This is a minor issue and I have figured out a work-around and I doubt many people are affected by this. This 'bug' report is mostly just an FYI.

My use-case is this: I have a HTML form containing some fields. The user may edit the form fields. When the user submits the form, a PDF is generated by the server based on the field values and is returned to the client. The generated PDF may not be correct and the user may wish to change the values of the form. However, the 'submit' button is now disabled. The only way to re-enable it is to re-load the page. Reloading the page wipes out the user's changes.

My work-around was to add a class named 'never-disable' to the 'submit' button of the HTML form and to modify web2py.js.

In web2py.js, I changed this:

```
disableElement: function (el) {
  el.addClass('disabled');
  var method = el.prop('type') == 'submit' ? 'val' : 'html';
```

to this:

```
disableElement: function (el) {
  if ( el.hasClass('never-disable')) { /* added */
    return true;                       /* added */
  }                                    /* added */
  el.addClass('disabled');
  var method = el.prop('type') == 'submit' ? 'val' : 'html';
```

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2004_
"
737,using groups (allow_group) with active directory (server 2012) and web2py,2015-01-26T21:11:38Z,,"bug, imported, Priority-Medium",,,"_From [guyd_at_ddc.co.il](https://code.google.com/u/guyd_at_ddc.co.il/) on October 21, 2014 10:07:30_

What steps will reproduce the problem? Trying to login using Active directory with allowed_groups, I've got error as discribed here: https://code.google.com/p/web2py/issues/detail?id=1414&can=1&q=allowed_groups I had patched the ldap_auth with the patch attached to the same group, error fixed.  but - 
The user can login to even if he isn't belong to any of the groups in the list.

I've devfined:
            allowed_groups = ['ca1'],
made sure my user isn't belong to this group, then tried to login.  user logged in.  Trying to log in with user that isn't belong to this group, user logged in,  define non-exist group, Yet again - user logged in. What is the expected output? What do you see instead? Users that not belong to the group, or if non-exist group - user will not log in. What version of the product are you using? On what operating system? Version 2.2.1 (2012-10-28 12:01:03) stable
Windows XP, Windows 7, Windows 8.1 (for the web host), and server 2012R1 for the active-directory host machine. Please provide any additional information below. I'be looked on tables auth_group, auth_event, auth_cas, auth_membership, auth_permission (in the DB), tables exists but empty.  Table auth_user get the user ans hash of it's password.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2002_
"
736,auth.settings.extra_fields not available,2015-01-26T21:11:36Z,,"bug, imported, Priority-Medium",,,"_From [mcbo..._at_gmail.com](https://code.google.com/u/100411895927358784444/) on October 18, 2014 01:08:06_

What steps will reproduce the problem? 1. auth.settings.extra_fields['auth_user'] = [Field('age', compute=lambda r: 45)]
2. pass auth_user=auth.user to the view
3. in view {{=auth_user.age}} What is the expected output? What do you see instead? Should see ""45"" in form What version of the product are you using? On what operating system? Ubuntu 14.04
2.9.11-stable+timestamp.2014.09.15.23.35.11 (Running on Rocket 1.2.6, Python 2.7.6) Please provide any additional information below. ## create all tables needed by auth if not custom tables
Gender = ['Male', 'Female', 'Other']

def age(born):
    tdelta = 999
    try:
        tdelta = int((datetime.now() - born).days / 365.25)
    except Exception, e:
        pass
    #print('Age: ', tdelta)
    return tdelta

day, month, year = [int(x) for x in ""10/8/1969"".split(""/"")]
born = datetime(year, month, day)
print('00_db -> Age: ', age(born))
t = (datetime.now() - born)
print(type(t), t.total_seconds() / (24_3600_365.25))
print(type(t), t.days / 365.25)
#print('00_db -> Age: ', (datetime.now() - born)).total_seconds()

auth.settings.extra_fields['auth_user'] = [
    Field('birth', 'date'),
    #Field('age', compute=lambda r: age(r['birth'])),
    #Field('age', compute=lambda r:int((datetime.now() - r['birth']).days / 365.25)),

```
Field('age', compute=lambda r: 45),
Field('test1', compute=lambda r: int(2*2)),
Field('test2', compute=lambda row: row.email),

Field('gender', requires=IS_IN_SET(Gender)),
Field('address', 'text'),
Field('zip'),
Field('city'),
Field('country'),
Field('phone'),
Field('picture', 'upload', default='')
```

]
auth.define_tables(username=False, signature=True)

# --------------------------------------------------
In controller: return dict(form=form, membership_panel=membership_panel, user=user, auth_user=auth.user)

Both user and auth_user shows the computed fields as None in the view

_Original issue: http://code.google.com/p/web2py/issues/detail?id=2000_
"
735,session.renew() should delete the file/DB record,2015-01-26T21:11:35Z,2015-09-22T19:25:35Z,"bug, imported, Priority-Medium",,,"_From [mandarv..._at_gmail.com](https://code.google.com/u/108507264684706694414/) on October 17, 2014 20:10:01_

https://groups.google.com/d/msg/web2py/j-GwnDc0G6g/MZAyrmn4BVcJ As part of this discussion - Anthony asked to open an issue. What is the expected output? What do you see instead? session.renew() just ""clears"" the underlying Storage() object.
but the files/DB record remains.
This could lead to session hijacking security issue - since such ""renewed"" session can be used by attacker - and since the file/DB record remains, it is used as a ""valid"" session (Then what is the use of renew() ?) What version of the product are you using? On what operating system? 2.9.5 + linux
But this isn't likely OS specific Please provide any additional information below. gluon/global.py : Session.clear() should have code to delete the file/db record after the Storage.clear() is called.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1999_
"
734,script web2py.ubuntu.sh does not create PID file,2015-01-26T21:11:33Z,2015-05-03T15:31:22Z,"bug, imported, Priority-Medium",,,"_From [pepel..._at_gmail.com](https://code.google.com/u/115223667897529680039/) on October 17, 2014 16:29:05_

What steps will reproduce the problem? 1. Just copy the web2py.ubuntu.sh to /etc/init.d/
2. start web2py with sudo service web2py start
3. There is no file inside /var/run/web2py/ What is the expected output? What do you see instead? I expected to find the .pid file inside /var/run/web2py What version of the product are you using? On what operating system? Please provide any additional information below. It can be solved by adding --make-pidfile in the start function. start-stop-daemon --start .... --make-pidfile.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1997_
"
733,web2py DAL bug: OperationalError - MySQL server has gone away while closing a connection in pool,2015-01-26T21:11:31Z,2015-03-03T19:31:28Z,"bug, DAL, imported, Priority-Medium",except,except:,"_From [Babu.Ann..._at_gmail.com](https://code.google.com/u/117901553787749562675/) on October 10, 2014 06:54:02_

Environment: Ubuntu 12.04; Web2py 2.9.11-stable

Let me describe the problem as below:
- We use 2 DAL instance talking to 2 different databases, each with a connection pool of 10
- We make many frequent DAL calls using both the DAL connections which results in many objects in the connection pool
- At some point, web2py starts throwing an OperationalError with MySQL server has gone away when closing a connection. The stack trace is as below:

S'Traceback (most recent call last):\n  File ‚Äú.../app/gluon/main.py"", line 543, in wsgibase\n    BaseAdapter.close_all_instances(\'rollback\')\n  File ‚Äú.../app/gluon/dal.py"", line 611, in close_all_instances\n    db._adapter.close(action)\n  File ‚Äú.../app/gluon/dal.py"", line 591, in close\n    getattr(self, action)()\n  File ‚Äú‚Ä¶/app/gluon/dal.py"", line 1922, in rollback\n    return self.connection.rollback()\nOperationalError: (2006, \'MySQL server has gone away\')\n'

This made the whole app very unstable with error tickets occurring almost for every action. 

We had tried wrapping all our DAL calls with exception handlers for this error but we were unable to get this sorted. Eventually, the only way I could fix this is to put an exception handler around the code block which is throwing the error as below:

# added this to line 611 in dal.py
try:
    db._adapter.close(action)
except:
    pass

Note that, this error is reproducible in older versions of web2py as well.

I would like to bring this forward to the group for further action on the same.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1995_
"
732,rss / safestr in 2.9.11 gluon/serializers.py produces UnicodeEncodeError,2015-01-26T21:11:16Z,2015-04-13T21:32:49Z,"bug, imported, Priority-Medium",UnicodeEncodeError,UnicodeEncodeError: 'ascii' codec can't encode character u'\xe4' in position 50: ordinal not in range(128),"_From [t..._at_xxall.net](https://code.google.com/u/112301108323513389878/) on October 08, 2014 17:56:46_

after upgrading to 2.9.11 (from 2.9.5)
the rss handler throws:

File ""/home/www-data/web2py/gluon/serializers.py"", line 167, in safestr
    link=str(feed.get('link', None).encode('utf-8', 'replace')),
UnicodeEncodeError: 'ascii' codec can't encode character u'\xe4' in position 50: ordinal not in range(128)

when the rss dict contents contain strings like this:

entries.append(dict(
title = str( entry.title ).decode('utf-8'),...)

the 2.9.5 gluon/serializers.py rss function still works.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1994_
"
731,Open Redirection Vulnerability,2015-01-26T21:11:01Z,2015-08-07T07:01:58Z,"bug, imported, Priority-Medium",,,"_From [bhati.fe..._at_gmail.com](https://code.google.com/u/108896182498744010339/) on October 01, 2014 06:46:01_

Issue - Open Redirection TO Any Domain 
Dependency - For Successful Redirection We Need Administration Password 
Only Unauthenticated Users Are Affected , If an user is already authenticated on web2py then he will not get redirec , Apart from this , Users who are non authenticated like ""End Users"" Will get redirection successfully""

Severity - Medium ( According To Me ) =D Correct me if i am wrong
Tested On - Web2py Tester Version From Official Site
Reported By  - Narendra Bhati
# 

Here i have tested this issue on Tested version provided by Web2py Official Site What steps will reproduce the problem? 1. http://127.0.0.1:8000/admin/default/index?password=sumasoft123&send=http&#37;3A&#37;2F&#37;2Fgoogle.com
( successful redirection tested on ""Tester"" Version Of Web2py Latest Version)
2. Replace the password parameter value to your administration password 
3. After replacing the valid password enter any domain and you will ger redirected What is the expected output? What do you see instead? What version of the product are you using? On what operating system? Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1992_
"
730,request.vars not set by routes_in query string.,2015-01-26T21:10:59Z,2015-12-14T21:31:11Z,"bug, imported, Priority-Medium",,,"_From [iiijjj..._at_gmail.com](https://code.google.com/u/103627055288160163786/) on September 26, 2014 16:59:57_

What steps will reproduce the problem? 1. Define a route in routes_in that sets a query string.
2. Access a page that will be routed.
3. Check the value of request.vars. It is not set.

Here is sample code:

routes.py
    routes_in = (
        (BASE + '/$anything', '/welcome/default/index?aaa=111&bbb=222'),
        ...
        )

Then in applications/welcome/views/default/index.html

```
\<div>
    vars: {{=request.vars}}
    \<br>
    env: {{=request.env.query_string}}
\</div>
```

Then visit the welcome app, request.vars displays empty but request.env.query_string is set to 'aaa=111&bbb=222' What is the expected output? What do you see instead? request.vars should be set to 'aaa=111&bbb=222' What version of the product are you using? On what operating system? Tested with: Version 2.9.11-stable+timestamp.2014.09.15.23.35.11

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1990_
"
729,limitby not work with projection on gae,2015-01-26T21:10:58Z,2015-03-21T21:28:23Z,"bug, imported, Priority-Medium",,,"_From [ibraheem..._at_gmail.com](https://code.google.com/u/110637967762575972337/) on September 22, 2014 07:06:17_

lI have web2py version 2.9.11 but limitby not work with projection on gae, also ticketing system & admin not work correctly.

please kindly give advice about them.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1989_
"
728,Failed login does not retain email/username field values (if form passes validation),2015-01-26T21:10:56Z,,"bug, imported, Priority-Medium",,,"_From [markruol..._at_gmail.com](https://code.google.com/u/114619454780239522399/) on September 18, 2014 20:11:42_

What steps will reproduce the problem? 1. Login with auth.login(), with bad login info (but valid format to pass validation)
2. Login page will be redisplayed after login failure
3. Email/username field is empty What is the expected output? What do you see instead? The username/email field should retain its values after a failed login. Clearing the input forces the user to guess what they had previously typed upon login error, which is unnecessarily frustrating for the user. What version of the product are you using? On what operating system? Web2py 2.9.10 Please provide any additional information below. When auth.login() passes validation, but there is a login error, it redirects to it's own URL, where the username/email value is lost. https://groups.google.com/forum/#!topic/web2py/gXBfCGki9ns

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1987_
"
727,data-w2p_remote attribute not being updated,2015-01-26T21:10:54Z,2015-09-21T20:44:22Z,"bug, imported, Priority-Medium",,,"_From [ideaflow..._at_gmail.com](https://code.google.com/u/107606252764651106510/) on September 17, 2014 22:58:16_

What steps will reproduce the problem? 1. Use {{=A('linked page',_href='http://example.com',cid=request.cid) to load content into a component element.
2. Check data-w2p_remote attribute on the relevant component element
3. This will still match the url of previous content loaded into the element What is the expected output? What do you see instead? I would expect the data-w2p_remote attribute to be updated to match the href in the A link when the element #cid gets loaded. What version of the product are you using? On what operating system? 2.9.9 and trunk (2.9.11) on FreeBSD 10 Please provide any additional information below. I tried to find the relevant bit of code in web2py.js where this should happen but couldn't find it.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1986_
"
726,Allow auth.login() to return a specific error message,2015-01-26T21:10:53Z,,"bug, imported, Priority-Medium",,,"_From [markruol..._at_gmail.com](https://code.google.com/u/114619454780239522399/) on September 17, 2014 19:29:40_

Currently, auth.login() only returns a generic ""invalid error"" upon login error. 

However, the generic error message is no more secure than an error message detailing whether the password or username/email was incorrect, because the registration page already reveals whether or not a username/email is taken.

Returning a more specific error message upon login error would be a big usability improvement at no cost to security:
1. Is the username/email in the database?
2. Is the password correct for that username/email?

I understand that this is done to be compliant with OWASP, but as discussed here: https://groups.google.com/forum/#!topic/web2py/0zCjs2G9ucE , it seems it's possible to implement this feature without breaking OWASP compliance.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1984_
"
725,GAE with datastore won't store tickets,2015-01-26T21:10:51Z,,"bug, imported, Priority-Medium",,,"_From [spame..._at_gmail.com](https://code.google.com/u/101593372917288717692/) on September 14, 2014 17:15:06_

What steps will reproduce the problem? 1. run a web2py instance in gae sdk development server
2. create a controller that throws a ticket
3. go to the ticket url What is the expected output? What do you see instead? The exception detail. A missing ticket message Please use labels and text to provide additional information. sdk version: 1.9.10
web2py version: 2.9.9-stable+timestamp.2014.09.13.18.54.57

The exceptioin is raised because when storing the ticket in db, the inherited adapter represent method (NoSQLAdapter.represent) fails to decode the string as utf8 (in NoSQLAdapter.to_unicode), and then the ticket insertion is rolled back (it only logs the error).

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1981_
"
724,Belongs errors for a list of items on an id field when using GAE datastore+ndb,2015-01-26T21:10:49Z,2015-03-22T17:59:11Z,"bug, imported, Priority-Medium",,,"_From [newglobalstrategy](https://code.google.com/u/newglobalstrategy/) on September 02, 2014 01:06:32_

What steps will reproduce the problem? 1. Google App Engine Datastore + NDB
2. Use a query with belongs and a list on an id field
ie quests = db(db.question.level.belongs([1])).select()  is valid  however

   quests = db(db.question.id.belongs([1])).select() generates an error along the lines of 

What is the expected output? What do you see instead

```
\<type 'exceptions.AttributeError'> type object 'question' has no attribute '__key__' What version of the product are you using? On what operating system? using latest trunk on windows and python 2.8 with gae dev server 1.98 or so but also happens on main data store issue is with this code:

GAE_FILTER_OPTIONS = {
    '=': lambda q, t, p, v: q.filter(getattr(t,p) == v),
    '>': lambda q, t, p, v: q.filter(getattr(t,p) > v),
    '<': lambda q, t, p, v: q.filter(getattr(t,p) \< v),
    '<=': lambda q, t, p, v: q.filter(getattr(t,p) \<= v),
    '>=': lambda q, t, p, v: q.filter(getattr(t,p) >= v),
    '!=': lambda q, t, p, v: q.filter(getattr(t,p) != v),
    'in': lambda q, t, p, v: q.filter(getattr(t,p).IN(v)),
    }

def filter(self, query, tableobj, prop, op, value):
    return self.GAE_FILTER_OPTIONS[op](query, tableobj, prop, value) Please provide any additional information below. discussion link is here: https://groups.google.com/forum/#!topic/web2py/_Od_UkKW05w Workarounds are either to not use Ndb or iterate through the list and retrieve one at a time
```

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1976_
"
723,"ajax login, wrong password redirects to wrong page",2015-01-26T21:10:48Z,2016-10-02T18:01:45Z,"bug, imported, Priority-Medium",,,"_From [maciej.s..._at_gmail.com](https://code.google.com/u/106937218463159858252/) on September 01, 2014 16:39:36_

What steps will reproduce the problem? 1. Create login controller:
def login_form():
    loginForm = auth.login()
    return loginForm
2. Create view which loads login form dynamically:
      <div class=""loginFormLayout"">
            {{=LOAD('default', 'login_form', ajax=True)}}
        </div>
3. Set login redirect:
auth.settings.login_next = URL('main')
auth.settings.logout_next = URL('index')
1. Try to login with proper user name and wrong password. What is the expected output? What do you see instead? I expect to keep index page without browser refresh. Wrong password message should be displayed. Instead page is redirect to https://127.0.0.1:8000/myapp/default/login_form What version of the product are you using? On what operating system? Version 2.9.5-stable+timestamp.2014.03.16.02.35.39
   Fedora Linux 19 Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1975_
"
722,incorrect colgroup render on SQLFORM.grid,2015-01-26T21:10:46Z,,"bug, imported, Priority-Medium",,,"_From [k..._at_zombiehost.net](https://code.google.com/u/115060955495967422298/) on August 30, 2014 13:43:36_

on controller:

db.table.field1.readable = False
db.table.field2.represent = ...here is some any representation lambda function with field1 and field2
form = SQLFORM.grid(..., fields=(db.table.field1, db.table.field2, db.table.field3)...)
return dict (form=form) 

In the output I see:
...
<colgroup><col data-column=""1"" id=""table-field1"" /><col data-column=""2"" id=""table-field2"" /><col data-column=""3"" id=""table-field3"" /></colgroup>
...

but <col data-column=""1"" id=""table-field1"" /> is not supposed to be here! This field is disabled, and <th> and <td> in the table are not rendered. Incorrect colgroup breaks the layout.

I'm using web2py 2.9.5 on linux, python 2.7

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1972_
"
721,"Auth.login() sets the minimum password length to 0, but does not restore it. No password validation for auth.register() if defined after auth.login()",2015-01-26T21:10:44Z,2015-10-07T18:08:18Z,"bug, imported, Priority-Medium",,,"_From [markruol..._at_gmail.com](https://code.google.com/u/114619454780239522399/) on August 29, 2014 18:27:44_

What steps will reproduce the problem? 1. Have both auth.register() and auth.login() in the same controller function (define auth.login() first)
2. Submit the register form with errors--there is no password validation
3. This is because auth.login() will set the minimum password length to 0, but won't restore it) https://groups.google.com/forum/#!topic/web2py/13gozLyE3Eo What is the expected output? What do you see instead? Password validation should occur, but it does not.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1971_
"
720,cache.action broken on GAE,2015-01-26T21:10:36Z,2016-07-11T09:10:12Z,"bug, imported, Priority-Medium",TypeError,TypeError: _decorated() takes exactly 1 argument (0 given),"_From [richar..._at_gmail.com](https://code.google.com/u/112985171729633859941/) on August 28, 2014 09:21:35_

I used this to cache a controller method:
__at__cache.action(time_expire=300, cache_model=cache.ram, session=False, vars=False, public=True)

Works fine on standard web2py but under GAE:

Traceback (most recent call last):
  File ""/home/hoju/web2py/gluon/restricted.py"", line 220, in restricted
    exec ccode in environment
  File ""/home/hoju/web2py/applications/places/controllers/default.py"", line 103, in <module>
  File ""/home/hoju/web2py/gluon/globals.py"", line 385, in <lambda>
    self._caller = lambda f: f()
  File ""/home/hoju/web2py/gluon/cache.py"", line 510, in wrapped_f
    rtn = cache_model(cache_key, lambda : func(), time_expire=time_expire)
  File ""/home/hoju/web2py/gluon/contrib/gae_memcache.py"", line 40, in __call__
    self.client.set(key, (time.time(), value), time=time_expire)
  File ""/home/hoju/google_appengine/google/appengine/api/memcache/**init**.py"", line 763, in set
    namespace=namespace)
  File ""/home/hoju/google_appengine/google/appengine/api/memcache/**init**.py"", line 868, in _set_with_policy
    time, '', namespace)
  File ""/home/hoju/google_appengine/google/appengine/api/memcache/__init__.py"", line 947, in _set_multi_async_with_policy
    stored_value, flags = _validate_encode_value(value, self._do_pickle)
  File ""/home/hoju/google_appengine/google/appengine/api/memcache/__init__.py"", line 227, in _validate_encode_value
    stored_value = do_pickle(value)
  File ""/home/hoju/google_appengine/google/appengine/api/memcache/__init__.py"", line 392, in _do_pickle
    pickler.dump(value)
TypeError: _decorated() takes exactly 1 argument (0 given)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1969_
"
719,SQLFORM.grid wrong listing when a model has a field reference to the same table with the same name,2015-01-26T21:10:34Z,2016-10-02T18:02:11Z,"bug, imported, Priority-Medium",,,"_From [mik..._at_gmail.com](https://code.google.com/u/114761474655578882131/) on August 22, 2014 09:52:35_

What steps will reproduce the problem? 1. Create a model with a self-referencing field with the same name as the table:

db.define_table(""node"",
                Field('name', 'string'),
                Field('node', 'reference node')
                , format='&#37;(name)s')

db.node.node.requires=IS_EMPTY_OR(IS_IN_DB(db, db.node.id, db.node._format, zero=T('choose one')))

node1 = db.node.insert(name='Node 1')
node2 = db.node.insert(name='Node 2')
node3 = db.node.insert(name='Node 3', node=node2)

2.- Use SQLFORM.grid in Controller:

grid = SQLFORM.grid(db.node) What is the expected output? What do you see instead? Expected output:
Id   Name    Node
1    Node 1   None
2    Node 2   None
3    Node 3   Node 2
(or raise an error if it's a limitation and I've defined a model like this)

Instead I see:
Id   Name    Node
1    Node 1   None  -- action buttons points to id 1
2    Node 2   None  -- action buttons points to id 2
2    Node 2   None  -- but action buttons correctly points to id 3
(no errors but bad listing) What version of the product are you using? On what operating system? Versions: R-2.9.5 and trunk
OS: Ubuntu 14.04.1 LTS
Python 2.7.6 Please provide any additional information below. This doesn't happen if I set a different name for the Field reference

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1968_
"
718,Avoid inserting duplicate archive records with record versioning,2015-01-26T21:10:33Z,2015-03-08T22:48:57Z,"bug, imported, Priority-Medium",,,"_From [kjkuan_at_gmail.com](https://code.google.com/u/kjkuan_at_gmail.com/) on August 13, 2014 17:54:52_

Given a table with record versioning enabled, for every successful update operation a row will be inserted in the archive table. It would make sense to only insert an archive row when there's a difference between the old row and the new row.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1966_
"
717,Suggestion: text/string field length propagates to widget's maxlength,2015-01-26T21:10:31Z,,"enhancement, imported, Priority-Medium",,,"_From [tim.nyb..._at_conted.ox.ac.uk](https://code.google.com/u/105151955720706136463/) on August 13, 2014 13:39:19_

It would be very useful if the length defined in a field:
Field('personname', 'string', length=32, label='First name', requires=[IS_LENGTH(32), IS_NOT_EMPTY()]),

Would or could populate the widget's maxlength attribute, like so:
<input class=""string"" id=""table_personname"" name=""personname"" value="""" maxlength=""32"" type=""text""></input>

(Re. https://groups.google.com/forum/#!searchin/web2py/maxlength/web2py/uP1xkwEWk1c/SMnqRAHXL1oJ )

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1965_
"
716,Work with MSSQL with codepage other than latin1 or unicode,2015-01-26T21:10:15Z,2015-09-03T16:35:26Z,"bug, DAL, imported, Priority-Medium",,,"_From [aleksey...._at_gmail.com](https://code.google.com/u/106784686348199015381/) on August 11, 2014 02:59:47_

What steps will reproduce the problem? 1. In models
dbsol = DAL('mssql2://user:password__at__w2ptkts/SacuraOnline', db_codec = 'cp1251', migrate_enabled = False)
auth = Auth(dbsol)

In default.py
def sol_users():
    grid = SQLFORM.grid(dbsol.auth_users)
    return locals()

In default/sol_users.html
{{extend 'layout.html'}}
<h1>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ SOL</h1>
{{=grid}} What is the expected output? What do you see instead? Grid work as expected, show and save data with cyrillic letters.

But when try to save profile data from (right top corner) got an error
<type 'exceptions.UnicodeEncodeError'> 'charmap' codec can't encode characters in position 0-5: character maps to <undefined> What version of the product are you using? On what operating system? Windows 7
2.9.5-trunk+timestamp.2014.03.29.21.54.41
(Running on Rocket 1.2.6, Python 2.7.6) Please provide any additional information below. Why it may be happened ? The data in grid and profile is same. Profile data showing correctly. 
May be procedure saving data from grid and saving data from profile are different ?

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1964_
"
715,web2py not working on Heroku (filesystem table),2015-01-26T21:10:14Z,,"bug, imported, Priority-Medium",,,"_From [moo..._at_msn.com](https://code.google.com/u/107886096020948600914/) on August 08, 2014 10:40:41_

What steps will reproduce the problem? 1. Install web2py on heroku using the shell script
2. Go to the welcome page What is the expected output? What do you see instead? There is an error raise and a ticket ""InternalError: current transaction is aborted..."". What version of the product are you using? On what operating system? 2.9.5-stable+timestamp.2014.03.16.02.35.39 (MacOSX / Heroku) Please provide any additional information below. As far as I can tell, there is an issue with the ""UseDatabaseStoredFile"" class inherited by the ""HerokuPostgresAdapter"".

In dal.py, the sql code supposed to create the web2py_filesystem table is created but not executed.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1963_
"
714,Grid buttons (add/edit/delete) overlap with first/last/both columns,2015-01-26T21:10:12Z,2015-04-01T18:37:58Z,"bug, imported, Priority-Medium",,,"_From [ejmv.ros..._at_gmail.com](https://code.google.com/u/102812329586059276481/) on July 28, 2014 21:15:32_

What steps will reproduce the problem? 1. Create SQLFORM.gris (or smartgrid)
2. Allow add/edit/delete/buttons What is the expected output? What do you see instead? I would expect the buttons not to overlap with data in the column next to them. What version of the product are you using? On what operating system? 2.9.5-stable+timestamp.2014.03.16.02.35.39
(Running on Rocket 1.2.6, Python 2.7.5+) Please provide any additional information below. This occurs no matter the value i use for ""buttons_placement="" (unset, left, right, both)
The buttons appear on the left (when buttons_placement is left or both), using its own TD, and overlap with data in first data column.
or... The buttons appear on the right (when buttons_placement is not set, or left or both), using its own TD, and overlap with data in last data column.
If I change wrap=""nowrap"" style for the column, the buttons extend vertically, as I would expect for a fixed width column, but the buttons column doesn't use an explicit value for width.
I verified this behaviour for Chrome/Firefox/MSIE under Win/Lin.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1958_
"
713,Group of Groups and setting auth.requires_ on the app itself,2015-01-26T21:10:04Z,,"enhancement, imported, Priority-Medium",,,"_From [ramstei..._at_gmail.com](https://code.google.com/u/106807652641341582815/) on July 22, 2014 10:56:56_

In a small organization (+- 100 users) it can be dificult to manage ACLs without being able to add group to group membership.

consider my company

we have this groups in the maintenance department

MMC (20 users)
ME ( 15 users)
MI ( 10 users)

MD (maintenance department)
(all users above)

so this group MD is composed of MMC,ME, MI and we dont repeat adding all users to MD, we just add group MMC,ME,MI to MD

When we delete a person from ME, the MD group automaticaly reflects the change.

Also in web2py if i want to block user A to access most of the app, i would need to decorate every function to block user A.

If i could decorate the app itself i would only do it once and would not need to repeat myself for every function that should block user A.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1953_
"
712,Unicode request.args,2015-01-26T21:09:55Z,,"bug, imported, Priority-Medium",,,"_From [info&#37;sof..._at_gtempaccount.com](https://code.google.com/u/115148391991162624848/) on July 21, 2014 09:20:40_

What steps will reproduce the problem? 1. Add to welcome app default controller show function:
 def show():
    return locals()
2. Open show function with test unicode data
/welcome/show/&#37;D1&#37;82&#37;D0&#37;B5&#37;D1&#37;81&#37;D1&#37;82

What is the expected output? 
template without error

What do you see instead?
Received 400 BAD Request

What version of the product are you using? 
Version 2.9.5-trunk+timestamp.2014.07.03.12.21.52

On what operating system?
MINGW32_NT-6.1 WSBAM 1.0.12(0.46/3/2) 2011-07-20 17:52 i686 unknown Please provide any additional information below. URLs like 
  /product/unicode_name
  /category/unicode_name
any others are good for SEO, non-latin internet users, etc

Possible fix:
gluon/rewrite.py
 def validate_args(self):

line:   if not self.router._args_match.match(arg):

change to:  if not self.router._args_match.match(unicode(arg), re.UNICODE):

Thanks for the great framework.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1952_
"
711,Python Crashes When Trying To Get The Scheduler To Run Alongside The Web Server.,2015-01-26T21:08:52Z,,"bug, imported, Priority-Medium",,,"_From [gheit..._at_gmail.com](https://code.google.com/u/110741554702776491750/) on June 19, 2014 22:52:40_

What steps will reproduce the problem? 1. nohup python web2py.py -K asdf12 -X --nogui -p 21000 -i 127.0.0.1 -a '' & What is the expected output? What do you see instead? What is expected is to have my web server and queued scheduled task to run.  The web server runs, but my queued scheduled task never get's assigned a worker. What version of the product are you using? On what operating system? Web2py 2.9.5-stable+timestamp.2014.03.16.02.35.39
Mac OS X 10.9.3 (Mavericks)
Python Version 2.7.5 Please provide any additional information below. I'm trying to get the scheduler to run alongside the web server.  The OS alerts me that that Python quit unexpectedly and dumps the details to the screen.  The web server will run none-the-less just fine.  It's the worker that never gets started.  I'm not sure what the -X is doing, but I think it has something to do with it.  Main thing that stands out in the OS dump is the following below:
**\* multi-threaded process forked ***
crashed on child side of fork pre-exec
Thread 0 Crashed

Everything works fine if I startup the web server and scheduler separately though.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1945_
"
710,ExtendedLoginForm not working,2015-01-26T21:08:23Z,2015-10-13T20:24:24Z,"bug, imported, Priority-Medium",,,"_From [rohitdra..._at_gmail.com](https://code.google.com/u/111012076866171514053/) on June 19, 2014 19:40:00_

What steps will reproduce the problem? 1. Using ExtendedLoginForm to append two login forms What is the expected output? What do you see instead? A ticket is issued saying ""login_form()"" method does not exist (even when it clearly does) What version of the product are you using? On what operating system? 2.9.5 on Ubuntu 14.04

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1944_
"
709,Auth forms and custom formstyles,2015-01-26T21:08:22Z,2016-10-02T18:02:33Z,"bug, imported, Priority-Medium",,,"_From [AnneVe..._at_googlemail.com](https://code.google.com/u/108003144278457342529/) on June 02, 2014 08:52:36_

What steps will reproduce the problem? The issue is described in this post in the workgroup: https://groups.google.com/forum/?fromgroups=#!topic/web2py/3J_IVQGm3GI Basically Auth forms should work with custom formstyles. Please provide any additional information below. Paolo Carruccio is working on a Bootstrap 3 package for Web2py. I do not know whether his package solves this issue, it probably does for no one reported it as an issue to Paolo in the workgroup. https://groups.google.com/forum/?fromgroups=#!topic/web2py/oSABtjmnYM0

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1939_
"
708,T.is_writable cannot be disabled,2015-01-26T21:08:06Z,2015-05-05T13:59:08Z,"bug, imported, Priority-Medium",,,"_From [mca..._at_gmail.com](https://code.google.com/u/109910092030153265550/) on May 20, 2014 21:48:48_
- What steps will reproduce the problem?
  
  -Test this in a controller:

T.is_writable = False
def index():
    db = DAL('sqlite:memory:')
    db.define_table('event',
        Field('date_time', 'datetime')
        )
    return dict(html=SQLFORM.grid(db.event, user_signature=False))
- What is the expected output? What do you see instead?
  
  -Expect no changes at language file, but this entry is automatically added:
  
    'Date Time': 'Date Time',
- What version of the product are you using? On what operating system?
  
  -Ubuntu 10.04 Version 2.9.5-trunk+timestamp.2014.05.09.15.41.38
- Please provide any additional information below.
  
  -Related discussion: https://groups.google.com/forum/#!topic/web2py/xlLmnw8cBvg

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1936_
"
707,adapter_args={'uploads_in_blob': True} doesn't work (At least Postgres),2015-01-26T21:07:36Z,2015-02-27T14:26:18Z,"enhancement, imported, Priority-Medium",,,"_From [mandarv..._at_gmail.com](https://code.google.com/u/108507264684706694414/) on May 20, 2014 07:17:28_

What steps will reproduce the problem? 1. define DAL as follows :

db = DAL('postgres://user:pass__at__localhost/mydb', pool_size=5, check_reserved=['all'], adapter_args={'uploads_in_blob': True})

(Other args like pool_size, check_reserved should not matter, but since that is how I used it, I've listed it here)
1. define a table w/ upload field.
2. Upload a document (use SQLFORM.grid to quickly create an interface)

What is the expected output? 

Documents are stored in DB

What do you see instead?

Documents are stored on the filesystem in uploads folder What version of the product are you using? On what operating system? Version 2.9.5-stable+timestamp.2014.03.16.02.35.39
Database drivers available: SQLite(sqlite3), MySQL(pymysql), PostgreSQL(psycopg2), PostgreSQL(pg8000), MongoDB(pymongo), IMAP(imaplib)

on Ubuntu 14.04 64-bit Please provide any additional information below. Work around suggested by Anthony on the mailing list (Not yet tested by me) is as follows :

db._adapter.uploads_in_blob = True

Then, when you do:

db.define_table('mytable', Field('myfile', 'upload', uploadfield=True))

you should get a blob field called db.mytable.myfile_blob with the readable and writable attributes set to False.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1935_
"
706,Issue with dash commented triple double quote and docstring,2015-01-26T21:07:28Z,,"bug, imported, Priority-Medium",,,"_From [ml.richa..._at_gmail.com](https://code.google.com/u/106468342756969422079/) on April 15, 2014 15:38:54_

What steps will reproduce the problem? 1. Code not execute below a commented triple double quote with dash when there is docstring in the later functions in the controller file What version of the product are you using? On what operating system? web2py 2.9.5 Please provide any additional information below. To reproduce the issue use this code, copy/paste it in any controller file and try to execute the ""this_func_not_execute"" :

# Controllers
# Begin
def this_func_execute():
    return dict(a='Works!')

# Commented block
# Code with the triple double quotes """"""

def this_func_not_execute():
    """"""This docstring is required for the issue to kickin!!""""""
    return dict(a=""I don't execute"")
# End

Remove the triple double quotes, issue is gone, put them back, it's back, remove the docstring of ""this_func_not_execute"", it's gone...

Ref : https://groups.google.com/d/msg/web2py/XM6DnqUENts/Cn0WqbvSNzcJ

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1923_
"
705,Session_id not usable when using GAE Memcache,2015-01-26T21:07:06Z,,"bug, imported, Priority-Medium",,,"_From [sebast..._at_cambeo.com](https://code.google.com/u/102227535237843894774/) on April 14, 2014 18:44:52_

What steps will reproduce the problem? 1. use latest trunk
2. uncomment the lines for session in memcache
3. add this line into db.py: login_form = auth.login() What is the expected output? What do you see instead? The response.session_id must remain the same. Instead it changes on every request. What version of the product are you using? On what operating system? latest trunk with latest GAE on windows Please provide any additional information below. Note: This only happens when not being logged in.
Storing session in db instead of memcache shows correct behaviour. 

Minimal example:
from gluon.contrib.memdb import MEMDB
from google.appengine.api.memcache import Client
session.connect(request, response, db = MEMDB(Client()))
login_form = auth.login()

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1922_
"
704,Delete in SQLFORM.grid does not update number of records,2015-01-26T21:07:04Z,2015-03-08T22:47:37Z,"bug, imported, Priority-Medium",,,"_From [horrido...._at_gmail.com](https://code.google.com/u/107056081781696376324/) on April 06, 2014 18:50:31_

What steps will reproduce the problem? 1. Setup a table with several records.
2. Use a SQLFORM.grid on this table with deletable=True.
3. Delete a record. What is the expected output? What do you see instead? I expect the number of records to be updated. Instead, it remains unchanged. What version of the product are you using? On what operating system? Web2py 2.9.4 on Ubuntu Server 12.04. Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1917_
"
703,smartgrid - issue with orderby with reference to parent table ,2015-01-26T21:07:02Z,2016-09-23T21:51:20Z,"bug, imported, Priority-Medium",,,"_From [info.abi..._at_gmail.com](https://code.google.com/u/104714598883458643016/) on March 27, 2014 10:19:38_

Maybe I miss use orderby ? What steps will reproduce the problem? 1. create a table t_member with a field t_member.f_user refering to auth_user
2. create a smartgrid on t_member with orderby = dict( t_member = db.auth_user[str(db.t_member.f_user)].last_name |t_member = db.auth_user[str(db.t_member.f_user)].first_name)
3. => erreor message : <type 'exceptions.AttributeError'> 'Table' object has no attribute 't_member.f_user' What is the expected output? What do you see instead? smartgrid ordering t_member records based on auth_user.last_name | auth_user.first_name What version of the product are you using? On what operating system? version 9.2.5 on Ubuntu 12.04 LTS (on localhost) with Python 2.7.3 Please provide any additional information below. Here under is a cut and paste of the defect as displayed by the web2py administrative interface

Function argument list

(self=<Table auth_user (id,first_name,last_name,email,...stration_key,reset_password_key,registration_id)>, key='t_txp_employee.f_employee')
Code listing

8907.
8908.
8909.
8910.
8911.
8912.

8913.
8914.
8915.
8916.

```
        query = self._build_query(key)
        return self._db(query).select(limitby=(0, 1), orderby_on_limitby=False).first()
    elif str(key).isdigit() or 'google' in DRIVERS and isinstance(key, Key):
        return self._db(self._id == key).select(limitby=(0, 1), orderby_on_limitby=False).first()
    elif key:
```

return ogetattr(self, str(key))

```
def __call__(self, key=DEFAULT, **kwargs):
    for_update = kwargs.get('_for_update', False)
    if '_for_update' in kwargs:
```

Variables
builtinstr  <type 'str'>
self    <Table auth_user (id,first_name,last_name,email,...stration_key,reset_password_key,registration_id)>
global ogetattr     <slot wrapper '**getattribute**' of 'object' objects>
key     't_txp_employee.f_employee'

In fact, I have more than 2 tables. The t_txp_employee.f_employee table refers to auth_user, and another table (t_txp_project_member) refers to t_txp_employee

Here under is my orderby code : 

orderby = dict(t_txp_company = db.t_txp_company.f_company, t_txp_client = db.t_txp_client.f_client, t_txp_project = db.t_txp_project.f_acronym, t_txp_employee = [db.auth_user[str(db.t_txp_employee.f_employee)].last_name, db.auth_user[str(db.t_txp_employee.f_employee)].first_name], t_txp_project_member =[(db.auth_user[str(db.t_txp_employee[str(db.t_txp_project_member.f_member)].f_employee)].last_name , db.auth_user[str(db.t_txp_employee[str(db.t_txp_project_member.f_member)].f_employee)].first_name)], t_txp_cost_type = db.t_txp_cost_type.f_cost_type),

  File ""/home/sbourgeois/web2py/gluon/dal.py"", line 8912, in **getitem**
I also tried using a lambda function in this orderby...

Maybe I should create a virtual field and order on it ?

Thanks a lot for any advise !!!

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1911_
"
702,Import/Export CSV Broken On Complex Queries (Admin - Database Admin - Table - Query),2015-01-26T21:07:01Z,2015-05-03T13:54:42Z,"bug, imported, Priority-Medium",,,"_From [grant.tr..._at_gmail.com](https://code.google.com/u/112191023930957557807/) on March 22, 2014 23:40:41_
1. Login to admin interface
2. Select ""Edit Application""
3. Select ""Database Administration""
4. Select a table to inspect
5. Default query has an ""Import/Export"" section for importing / exporting CSV - GOOD
6. The existing query looks like 'db.auth_user.id>0' - OK
7. Now put parenthesis around the query '(db.auth_user.id>0)' - BAD
8. ""export as csv"" no longer works - BAD
9. Import is missing entirely - BAD

This also happens for more complex queries.

Version information reported by web2py:

2.9.5-stable+timestamp.2014.03.16.02.35.39
(Running on Apache/2.2.22 (Ubuntu), Python 2.7.3)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1907_
"
701,ValueError when executing queries,2015-01-26T21:06:59Z,2015-03-08T22:45:29Z,"bug, imported, Priority-Medium",ValueError,ValueError:,"_From [buzypi](https://code.google.com/u/buzypi/) on March 20, 2014 17:15:23_

Here is how my various files look:

models/db.py:

from gluon import current
db = DAL('&#37;s://&#37;s:&#37;s__at__&#37;s/&#37;s' &#37; (...))
current.db = db

modules/modelmanager.py:
class ModelManager:
    def **init**(self):  
        self.db = current.db

```
def get_something_from_db(self, **kwargs):
    return self.db(...).select(...)
```

# In the end of this module I have a singleton instance of this class
# which I intend to use in a bunch of places
mmanager = ModelManager()

controllers/mycontroller.py
from modelmanager import mmanager
def foo():
    db_data = mmanager.get_something_from_db(...)

Every once in a while I see this error:
File ""/var/deploy/jnaapti/web2py/gluon/dal.py"", line 1956, in log_execute
    if not self.connection: raise ValueError(a[0])
ValueError:

My questions are:
1. Is this way of using models via modules wrong? I read in many places that this is ok.
2. What could be the cause of this error and how do I fix this? This is extremely frustrating and I have already spent more than 2 days trying to fix this issue. What version of the product are you using? On what operating system? Ubuntu 12.04 32-bit Server
Linux dev 3.2.0-58-generic-pae `#88`-Ubuntu SMP Tue Dec 3 18:00:02 UTC 2013 i686 i686 i386 GNU/Linux

Version 2.9.5-stable+timestamp.2014.03.16.02.35.39 Please provide any additional information below. What is the right way of moving common model code to a separate module?

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1905_
"
700,Google Appengine Memcache not working for database entities,2015-01-26T21:06:31Z,,"bug, imported, Priority-Medium",,,"_From [sebast..._at_cambeo.com](https://code.google.com/u/102227535237843894774/) on March 16, 2014 00:15:34_

What steps will reproduce the problem? 1. use the following minimal use case for example in welcome/models/db.py:

from google.appengine.api import memcache
from google.appengine.ext import ndb

class TestModel(ndb.model):
   pass

memcache.set(""a"", TestModel()) What is the expected output? What do you see instead? A database entity should be stored in memcache. This is very important for implementing own caching scenarios. Instead a pickling error is rendererd:
Can't pickle TestModel [...] >: import of module **restricted** failed What version of the product are you using? On what operating system? web2py 2.9.4, windows 8.1

Please provide any additional information below:
It appears that the web2py environment is not correctly injected into the pickle/unpickle calls of google appengine.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1899_
"
699,Can't define referenced table after it's referencing from web2py v2.9.3,2015-01-26T21:06:02Z,2015-09-03T16:40:06Z,"bug, DAL, imported, Priority-Medium",KeyError,KeyError: 'Cannot resolve reference subject in contract definition',"_From [d.bu..._at_gmail.com](https://code.google.com/u/106126117366631760005/) on March 08, 2014 12:14:54_

What steps will reproduce the problem? 1. Define referenced table after it's referencing
2. Set lazy_tables=False (means don't activate lazy_tables)
3. Call any app url What is the expected output? What do you see instead? In web2py v2.8.2 everything is fine - you see the controller's result. From version 2.9.3 (including 2.9.4) you see only ""KeyError: 'Cannot resolve reference ... in ... definition'"" What version of the product are you using? On what operating system? Ubuntu server 12.04 / Ubuntu desktop 13.10; web2py v2.9.4 Please provide any additional information below. Sample error log:
Traceback (most recent call last):
  File ""/home/donatas/web2py/gluon/restricted.py"", line 217, in restricted
    exec ccode in environment
  File ""/home/donatas/web2py/applications/welcome/models/db.py"", line 87, in <module>
    Field('subject_id', 'reference subject')
  File ""/home/donatas/web2py/gluon/dal.py"", line 8223, in define_table
    table = self.lazy_define_table(tablename,_fields,_*args)
  File ""/home/donatas/web2py/gluon/dal.py"", line 8260, in lazy_define_table
    polymodel=polymodel)
  File ""/home/donatas/web2py/gluon/dal.py"", line 925, in create_table
    raise KeyError('Cannot resolve reference &#37;s in &#37;s definition' &#37; (referenced, table._tablename))
KeyError: 'Cannot resolve reference subject in contract definition'

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1896_
"
698,Cleanup web2py_htmltable styling,2015-01-26T21:06:01Z,2016-06-28T20:21:18Z,"bug, imported, Priority-Medium",,,"_From [subbaram..._at_gmail.com](https://code.google.com/u/116822970470025815642/) on March 08, 2014 07:02:22_

What steps will reproduce the problem? 1. Please refer to this discussion: https://groups.google.com/forum/#!topic/web2py/tV3NB99_Z58 2. 3. What is the expected output? What do you see instead? https://groups.google.com/forum/#!topic/web2py/tV3NB99_Z58 What version of the product are you using? On what operating system? All Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1892_
"
697,'ascii' codec can't encode character error on list:string DAL,2015-01-26T21:05:52Z,2015-05-03T14:01:00Z,"bug, DAL, imported, Priority-Medium",UnicodeEncodeError,UnicodeEncodeError: 'ascii' codec can't encode character u'\xeb' in position 30: ordinal not in range(128),"_From [firstcla..._at_gmail.com](https://code.google.com/u/114641566817690199919/) on March 07, 2014 05:47:17_

What steps will reproduce the problem? 1. Saving strings containing special latin characters to list:string will give an error.
[u'Higher School Justiniani i Par\xeb', u'Higher School Justiniani i Par\xeb'] What is the expected output? What do you see instead? Throws Error ticket.
<type 'exceptions.UnicodeEncodeError'> 'ascii' codec can't encode character u'\xeb' in position 30: ordinal not in range(128) What version of the product are you using? On what operating system? 2.8.2-stable+timestamp.2013.11.28.13.54.07
(Running on Apache/2.2.22 (Ubuntu), Python 2.7.3) Please provide any additional information below. 1. 2. 3. 4.
5.
6.
7.
8.
9.
10.
11.
12.
13.
14.
15.
Traceback (most recent call last):
  File ""/home/www-data/web2py/gluon/restricted.py"", line 217, in restricted
    exec ccode in environment
  File ""/home/www-data/web2py/applications/welcome/views/appadmin.html"", line 189, in <module>
    </p>
  File ""/home/www-data/web2py/gluon/sqlhtml.py"", line 3012, in **init**
    r = represent(field, r or [], record)
  File ""/home/www-data/web2py/gluon/sqlhtml.py"", line 56, in represent
    return f(value)
  File ""/home/www-data/web2py/gluon/dal.py"", line 9655, in list_represent
    return ', '.join(str(y) for y in x or [])
  File ""/home/www-data/web2py/gluon/dal.py"", line 9655, in <genexpr>
    return ', '.join(str(y) for y in x or [])
UnicodeEncodeError: 'ascii' codec can't encode character u'\xeb' in position 30: ordinal not in range(128)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1890_
"
696,Update on Table.with_alias uses alias instead of tablename,2015-01-26T21:05:38Z,2016-09-23T21:52:52Z,"bug, DAL, imported, Priority-Critical",,,"_From [dominic...._at_googlemail.com](https://code.google.com/u/101361032820412007524/) on March 05, 2014 15:06:06_

What steps will reproduce the problem? 1. define a Table.with_alias
2. use db(...a query for this table...).update(...something...) What is the expected output? What do you see instead? Expected: the SQL generated for the UPDATE transaction uses the _original_ tablename
Actual: the SQL generated for the UPDATE transaction uses the _alias_, and thus runs into an SQL error (relation <alias> does not exist) What version of the product are you using? On what operating system? latest trunk Please provide any additional information below. This uses Query.tables() to determine which table to update, which in turn retrieves the tablenames from the Fields in the query. But when you define a Table.with_alias(), all Fields receive the alias as tablename.

This behavior is absolutely correct for the SELECT case (where it _must_ use the alias), but totally wrong for the UPDATE case (where it _must not_ use the alias).

Of course, it seems nonsense to create a Table.with_alias for an update operation, but the point is that we want to re-use the same Query that we used for a SELECT for a subsequent UPDATE - and that is not at all an edge-case.

Best regards,
Many thanks in advance for fixing this :S

Dominic

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1889_
"
695,track_changes no longer working,2015-01-26T21:05:08Z,,"bug, imported, Priority-Medium",,,"_From [ABasta..._at_gmail.com](https://code.google.com/u/103720714265511973715/) on March 04, 2014 17:16:12_

A number of users have reported that the following is no longer working in recent versions of web2py:

from gluon.custom_import import track_changes; track_changes(True)

Apparently even with the above code in a model file, changes in modules are not tracked, so the server must be restarted when changes are made.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1886_
"
694,gluon/contrib should be in path,2015-01-26T21:05:06Z,2015-03-08T22:43:46Z,"bug, imported, Priority-Medium",,,"_From [massimo...._at_gmail.com](https://code.google.com/u/111721297562664670951/) on March 03, 2014 01:26:17_

https://groups.google.com/forum/#!topic/web2py/BfSIbUSPk38

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1884_
"
693,"mongodb <type 'exceptions.RuntimeError'> you must specify a Field(...,uploadfolder",2015-01-26T21:05:05Z,2015-03-20T15:48:10Z,"bug, DAL, imported, Priority-Medium",,,"_From [mrjones0..._at_gmail.com](https://code.google.com/u/117394988106998904793/) on February 25, 2014 00:06:59_

When using upload fields with mongodb and SQLFORM (not factory forms) I get the runtime error ""<type 'exceptions.RuntimeError'> you must specify a Field(...,uploadfolder=...)"" the same code but switching to sqlite works correctly. Adding db.table.field.uploadfolder = os.path.join(request.folder,'uploads')  to the controller before processing the form resolves the issue. I believe this might be a bug in the mongodb adapter. 

tested on web2py Version 2.8.2-stable

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1880_
"
692,SQLFORM Insert Fails with SQLCustomType,2015-01-26T21:05:03Z,2016-03-19T19:00:50Z,"bug, DAL, imported, Priority-Medium",,,"_From [mca..._at_gmail.com](https://code.google.com/u/109910092030153265550/) on February 24, 2014 18:22:37_

I've got this error, trying to insert with SQLCustomType, with both 2.8.2 and trunk version under Ubuntu 10.04):

```
\<type 'exceptions.AttributeError'> 'str' object has no attribute 'utctimetuple'
```

It fails with SQLFORM, SQLFORM.grid and SQLFORM.smartgrid. It works fine if you replace type=ut_dt with 'datetime'.
- How to reproduce:
1. Code in a controller:

def custom():
    from gluon.dal import SQLCustomType
    from datetime import datetime
    from calendar import timegm

```
ut_dt = SQLCustomType(
    type    = 'datetime',
    native  = 'integer',
    encoder = (lambda dt: timegm(dt.utctimetuple())),
    decoder = (lambda ut: datetime.utcfromtimestamp(ut))
)

db = DAL('sqlite:memory:')
db.define_table('event',
    Field('day_and_time', type=ut_dt)
)

form = SQLFORM(db.event)

if form.process().accepted:
    db.event.insert(day_and_time=form.vars.day_and_time)

return dict(html=form)
```

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1879_
"
691,routes.example.py instructions are outdated/incorrect,2015-01-26T21:04:21Z,2015-05-03T20:12:30Z,"bug, imported, Priority-Medium",,,"_From [sourci..._at_gmail.com](https://code.google.com/u/114913277861479966039/) on January 25, 2014 00:21:44_

What steps will reproduce the problem? View routes.example.py file in the welcome application.  You will see the following instructions:

# To enable this route file you must do the steps:
#
#1. rename <web2py-root-dir>/router.example.py to routes.py
#2. rename this APP/routes.example.py to APP/routes.py
#    (where APP - is your application directory)
#3. restart web2py (or reload routes in web2py admin interfase)
#
# YOU CAN COPY THIS FILE TO ANY APPLICATION'S ROOT DIRECTORY WITHOUT CHANGES! What is the expected output? What do you see instead? The first line, ""rename <web2py-root-dir>/router.example.py to routes.py
"", is wrong because there is no router.example.py under the web2py root directory.

Instead there are the following files:
<web2py-root-dir>/examples/routes.parametric.example.py
and
<web2py-root-dir>/examples/routes.parametric.example.py

So instructions should reflect that.

Also ""interfase"" is a typo and should be ""interface"" What version of the product are you using? On what operating system? web2py 2.8.2, Windows 7 Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1860_
"
690,The Bayesian classifier turns 'one to one' into 'one-to-many' relationship,2015-01-26T21:04:06Z,2016-03-19T19:01:51Z,"bug, imported, Priority-Medium",,,"_From [matheus...._at_gmail.com](https://code.google.com/u/117634160511727602807/) on January 16, 2014 23:20:05_

What steps will reproduce the problem? 1. Use the populate.py module and populates TABLE A that is referenced by TABLE B
2. Populates with the same module the TABLE B with the same quantity of TABLE A What is the expected output? What do you see instead? TABLE B should have the same ids of TABLE A on the reference column. Instead of it, appears some repeated ids on TABLE B, turning a possible 'one to one' relationship (like a house and its address) between these tables onto a 'many-to-many' relationship (like a house with many addresses). What version of the product are you using? On what operating system? 2.7.4-stable+timestamp.2013.10.14.15.16.29
(Running on Rocket 1.2.6, Python 2.7.4) Please provide any additional information below. Code sample

#house_address has a reference column that points to house table

n = 9
populate(db.house,n=n)
populate(db.house_address,n=n)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1856_
"
689,OAuth: Move tokens under session.auth ,2015-01-26T21:03:57Z,,"bug, imported, Priority-High",,,"_From [michele...._at_gmail.com](https://code.google.com/u/104551602623805320646/) on December 20, 2013 19:18:36_

Implement Kablu porposed change:
- improve management of session tokens they need to be moved under session.auth.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1830_
"
688,Appadmin viewing one records results in an error,2015-01-26T21:03:55Z,2015-09-22T19:31:47Z,"bug, imported, Priority-Medium",ProgrammingError,"ProgrammingError: ('42000', ""[42000] [FreeTDS][SQL Server]Column 'Platform.ApplicationDomain' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause. (8120) (SQLExecDirectW)"")","_From [remco.boerma](https://code.google.com/u/remco.boerma/) on December 19, 2013 12:12:22_

When i use appadmin to view JobPlatform table and i click on a single row to view that entry i get an error.  

I open https://lvwaso01.rocdc.local/dc_jobs/appadmin/update/db/JobPlatform/3 and get: 
<class 'pyodbc.ProgrammingError'> ('42000', ""[42000] [FreeTDS][SQL Server]Column 'Platform.ApplicationDomain' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause. (8120) (SQLExecDirectW)"")

The error is about Platform.ApplicationDomain while i'm looking at JobPlatform table. That was a little odd to me. It might be because of the foreign key constraint, but then i don't know why application domain is used in an aggregate function. 

Here's the full traceback:
Traceback (most recent call last):
  File ""/home/www-data/web2py/gluon/restricted.py"", line 217, in restricted
    exec ccode in environment
  File ""/home/www-data/web2py/applications/dc_jobs/controllers/appadmin.py"", line 654, in <module>
  File ""/home/www-data/web2py/gluon/globals.py"", line 372, in <lambda>
    self._caller = lambda f: f()
  File ""/home/www-data/web2py/applications/dc_jobs/controllers/appadmin.py"", line 342, in update
    f='download', args=request.args[:1]))
  File ""/home/www-data/web2py/gluon/sqlhtml.py"", line 1145, in __init__
    inp = self.widgets.options.widget(field, default)
  File ""/home/www-data/web2py/gluon/sqlhtml.py"", line 270, in widget
    options = requires[0].options()
  File ""/home/www-data/web2py/gluon/validators.py"", line 559, in options
    self.build_set()
  File ""/home/www-data/web2py/gluon/validators.py"", line 545, in build_set
    records = self.dbset(table).select(_fields, *_dd)
  File ""/home/www-data/web2py/gluon/dal.py"", line 10335, in select
    return adapter.select(self.query,fields,attributes)
  File ""/home/www-data/web2py/gluon/dal.py"", line 1831, in select
    return self._select_aux(sql,fields,attributes)
  File ""/home/www-data/web2py/gluon/dal.py"", line 1796, in _select_aux
    self.execute(sql)
  File ""/home/www-data/web2py/gluon/dal.py"", line 1916, in execute
    return self.log_execute(_a, *_b)
  File ""/home/www-data/web2py/gluon/dal.py"", line 1910, in log_execute
    ret = self.cursor.execute(command, _a[1:], *_b)
ProgrammingError: ('42000', ""[42000] [FreeTDS][SQL Server]Column 'Platform.ApplicationDomain' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause. (8120) (SQLExecDirectW)"")

Troling uptward through the traceback i noticed that at File /home/www-data/web2py/gluon/validators.py in build_set at line 54 in the variables there is a group by defined:
dd: {'cache': None, 'cacheable': True, 'distinct': None, 'groupby': 'Platform.Straat', 'orderby': 'Platform.DocumentationLink'}
before that i didn't see it. 

Here's my model: 

VarcharMax = SQLCustomType(
     type ='text', # web2py type
     native='varchar(max)',
 )

db.define_table(""Job"",
      SQLField(""Description"", VarcharMax, notnull=True, default=''),
      SQLField(""DocumentationLink"", VarcharMax, default=''))

db.define_table(""Platform"",
      SQLField(""ApplicationDomain"", ""string"", length=30, notnull=True, default=None),
      SQLField(""ServerName"", ""string"", length=100, notnull=True, default=None),
      SQLField(""DocumentationLink"", VarcharMax, default=''),
      SQLField(""Straat"", ""string"", length=3, notnull=True, default=None),
      format='&#37;(ApplicationDomain)s:&#37;(ServerName)s')

db.define_table(""JobPlatform"",
      SQLField(""id_Job"", db.Job),
      SQLField(""id_Platform"", db.Platform),
      SQLField(""SecurityContext"", ""string"", length=100, notnull=True, default=None),
      SQLField(""LocalIdentifier"", ""string"", length=300, notnull=True, default=None),
      SQLField(""Description"", VarcharMax, notnull=True, default=None),
      SQLField(""DocumentationLink"", VarcharMax, default=None),
      format='&#37;(id_platform)s') 

I'm using revision f8df8f614cff (2.8.2)  (and not the latest from trunk because that breaks because of the sql server escaping)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1829_
"
687,GAE :: compute=lambda r: db.file.file.retrieve(r.file) # produces 404 NOT FOUND error,2015-01-26T21:03:33Z,,"bug, imported, Priority-Medium",,,"_From [james.bu..._at_gmail.com](https://code.google.com/u/104496800250039654192/) on December 18, 2013 19:52:21_

What steps will reproduce the problem? model:
db.define_table('file',
    Field('name', unique=True, compute=lambda r: db.file.file.retrieve(r.file)[0]),
    Field('file', 'upload'),
    Field('created_on', 'datetime', default=request.now),
    Field('created_by', 'reference auth_user', default=auth.user_id),
    format='&#37;(name)s')

controller:
__at__auth.requires_membership(""admin"")
def file():
 form = SQLFORM.grid(db.file, searchable=False, csv=False, user_signature=False)
 return dict(form=form)
1. Navigate to the file page.
2. Create click Add button on the grid
3. Select a file
4. Submit What is the expected output? What do you see instead? -Result should be the original filename inserted into the name Field
   -Instead it produces a 404 error on submit What version of the product are you using? On what operating system? -Version 2.7.4-stable+timestamp.2013.10.14.15.16.29
   -OSX - however the error only occurs on GAE, including the SDK

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1826_
"
686,dbg.set_trace doesn't stop when expected...,2015-01-26T21:03:24Z,,"bug, imported, Priority-Medium",,,"_From [loic.esp..._at_gmail.com](https://code.google.com/u/111390277489375531012/) on December 12, 2013 16:25:27_

See the detailed issue description (+screenshots) here : https://groups.google.com/forum/?fromgroups#!topic/web2py-developers/eyiqDADgjhw FYI I ran latest Web2py (from github repo) on Windows 7 pro x64 with Python 2.7

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1815_
"
685,DAL: auto imported tables fail because of an incompatible definition order,2015-01-26T21:03:09Z,,"bug, DAL, imported, Priority-Medium",,,"_From [spame..._at_gmail.com](https://code.google.com/u/101593372917288717692/) on December 04, 2013 15:35:13_

What steps will reproduce the problem? 1. Define a relational database model using foreign keys wich does not match table file retrieval order and model table definition order
2. Use cpdb module from the command line to clone data and definitions to a new database connection What is the expected output? What do you see instead? (check the mail list thread for the error output) Please use labels and text to provide additional information. https://groups.google.com/d/msg/web2py/TnYUXKYfnj0/OlssRRjVRf8J To avoid the order mismatch issue, cpdb could accept an optional list of table names specifying the table creation order.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1799_
"
684,Update button enhancements,2015-01-26T21:02:40Z,,"bug, imported, Priority-Medium",,,"_From [Snidely...._at_gmail.com](https://code.google.com/u/106552287511581026780/) on December 03, 2013 20:36:02_

On the site admin page, the version block has an update button that can be used when new versions of Web2py are released.  The following features might make this (relatively new) feature even more useful:

Currently, when the update activities launched by the button are complete, a flash message appears (in the default scheme); the button continues to read ""Update""

1) Change the flash background to RED if default CSS is in use

2) Change the button to ""Restart"" and have it stop the server

3) Display a checklist (tied to the release notes) of things to do between server shutdown and server restart, such as clearing sessions (required with 2.8.1+, due to session format change). And since it will take a while for all the pre-2.6.1 servers to be upgraded, detect the older server and  show the 2.6.1 checklist as well. What is the expected output? What do you see instead? What version of the product are you using? On what operating system? Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1798_
"
683,Record Versioning in DAL does not work with complicated joins,2015-01-26T21:02:38Z,,"bug, DAL, imported, Priority-Medium",,,"_From [salomond..._at_googlemail.com](https://code.google.com/u/113767937986504664044/) on November 12, 2013 08:55:38_

What steps will reproduce the problem? 1. In the attached file is a database model with helper functions (140 loc)
2. Copy the content of the attached file in db.py under models
3. call insert_testdata() and get_task_by_checklist_id(1) from a controller (eg. two controller functions and generate the testdata first and then make the select)

```
def testdata():
    insert_testdata()
    return dict()

def tasks():
    return get_tasks_by_checklist_id(1) What is the expected output? What do you see instead? The expected output should be the rows selected from the database, instead a exception is thrown:
```

<type 'exceptions.TypeError'> reduce() of empty sequence with no initial value What version of the product are you using? On what operating system? I am using the following Version (copied from the admin interface):
2.7.4-stable+timestamp.2013.10.14.15.16.29
(Running on Rocket 1.2.6, Python 2.7.3)

It was tested with the following operating system:
Ubuntu 12.04.3 LTS (3.2.0-23-generic `#36`-Ubuntu SMP Tue Apr 10 20:39:51 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux) Please provide any additional information below. In the attached file is a variable to toggle switch record versioning on an off. Without record versioning everything works fine.

I took a look in dal.py but it was to complicated for my to understand where the problem is. I hope this will help you.

**Attachment:** [db.py](http://code.google.com/p/web2py/issues/detail?id=1769)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1769_
"
682,alter table with geometry() as type,2015-01-26T21:02:23Z,,"bug, DAL, imported, Priority-Medium",,,"_From [paolo.va..._at_gmail.com](https://code.google.com/u/107767337307670204068/) on November 10, 2013 16:36:07_

What steps will reproduce the problem? 1. define a field as 'string' (for example)
2. change the field type as 'geometry()' 3. What is the expected output? What do you see instead? an update of the type field.
The update fails, the sql generated seems wrong, the error shows this message:
<class 'psycopg2.ProgrammingError'> syntax error at or near ""SELECT"" LINE 1: ALTER TABLE path ADD geometry__tmp SELECT AddGeometryColumn ... ^ Please use labels and text to provide additional information. 2.7.4 (postgres with postgis)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1767_
"
681,cookie handling stumbles on invalid key with colon,2015-01-26T21:01:54Z,2015-05-03T13:55:53Z,"bug, imported, Priority-Medium",,,"_From [ndegroot0](https://code.google.com/u/ndegroot0/) on October 30, 2013 23:11:51_

After an automatic Chrome update to 30.0.1599.101 and update to macos Maverick ( don't know if they were the real cause) I couldn't login in admin ( and probably not in the apps) using Chrome. Admin rejected wrong passwords as usual but didn't redirect after entering right password. Other browsers had no problems, Chrome Incognito mode worked too.

I investigated a little using the trunk version and found that web2py stumbled over the content of the current web2py cookie, see below. main.py tried to load the cookie, but generated an error 'invalid key' because of the 'ti:mid' key. This error is ignored (main.py: 435), but after that the cookie is invalid/ incomplete causing a circular redirect to  /admin/default/index?send=&#37;2Fadmin&#37;2Fdefault&#37;2Fsite. Removing the cookie solved the problem. I didn't discover how this cookie got made with this key...

I read a long discussion on maillist Python bugs about Cookie handling  in Python where adding the colon to the accepted characters is discussed, and resolved in python 3.3 but it did not get backported to 2.7 for a good reason: change of functionality.

To illustrate this I made an python fiddle with two suggested solutions. I'l be happy to implement one of the two  in a patch. http://pythonfiddle.com/cookie-accepting-a-colon-as-a-key Python discussion:: http://bugs.python.org/issue2193 Related: https://groups.google.com/forum/#!msg/web2py/RajWfv23ntA/pI8W9Z-onZsJ Additional information below.

http_cookie (4426069936)     str: __utma=96992031.2041186174.1349957326.1377589169.1377611835.32; __utmz=96992031.1349957326.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); 
ti:mid=91F9A2B7-4254-4875-8C1D-F17B58ADB740; 
session_id_admin=127.0.0.1-e8e6c902-cf9a-4618-a335-e60795c8b9f8

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1749_
"
680,Improve Gird,2015-01-26T21:01:26Z,2016-06-28T20:21:42Z,"bug, imported, Priority-Medium",,,"_From [massimo...._at_gmail.com](https://code.google.com/u/111721297562664670951/) on October 21, 2013 04:55:12_

1) make it a class
2) allow configuration using attributes of the grid object (not by passing parameters to funcion)
3) export headers should optionally be column labels, not field names
4) export should optionally include links (with scheme).

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1737_
"
679,Pagination problem with user-sorted grid,2015-01-26T21:01:04Z,2015-03-21T01:33:25Z,"bug, imported, Priority-Medium",,,"_From [ABasta..._at_gmail.com](https://code.google.com/u/103720714265511973715/) on October 11, 2013 03:03:54_

Using SQLFORM.grid (or .smartgrid), once the initial grid has loaded, if the user clicks on a column header to change the sort order, only that single field is used in the SQL ORDER BY clause. However, if the column used for sorting contains non-unique values, pagination may not work correctly, because the order in which the RDBMS returns records is not guaranteed to be the same with each query. For proper pagination, the records should be sorted on one or more columns that generate a single unique ordering.

Note, this problem occurs regardless of what is specified in the ""orderby"" argument to .grid() because the ""orderby"" argument is ignored when the user clicks on a grid header to sort the records.

A possible fix is to add the table ""id"" field to the ORDER BY clause in this case, which will guarantee a unique ordering (and shouldn't add too much processing time given that it is an indexed field). This is already done on the initial grid load if no ""orderby"" argument has been specified (due to the default orderby_on_limitby=True argument of the .select() method).

There is a more general problem with pagination in the grid. If the developer specifies an ""orderby"" argument in order to control the initial ordering of the displayed records, the table ""id"" field is no longer added to the ORDER BY clause, which could result in broken pagination. Since this is unlikely to be the intent in this case, perhaps the grid should always add the ""id"" fields to the ORDER BY. For the rare case where someone might want to prevent that for complete control over the ORDER BY clause, we could add an argument such as auto_pagination=True (set it to False to prevent the automatic behavior).

See https://groups.google.com/d/msg/web2py-developers/nklB1tRh_zU/ZbezJNLs4zgJ for further details.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1712_
"
678,Issue running doctest with decorated functions,2015-01-26T21:01:03Z,2016-10-02T18:03:20Z,"bug, imported, Priority-Medium",,,"_From [mscavaz..._at_gmail.com](https://code.google.com/u/104399081386327977160/) on October 04, 2013 08:32:28_

What steps will reproduce the problem? 1. create a function 'c' in controller 'b' in application 'a' and add a doctest to function 'c'
2. decorate the function 'c' with __at__auth.requires_login()
3. run the following command line : python web2py.py -T a/b/c What is the expected output? What do you see instead? Expected output is result of doctest
Actual output is http redirection due to authentication failure What version of the product are you using? On what operating system? Web2Py 2.5.1 on Ubuntu precise (12.04.2 LTS) Please provide any additional information below. A possible workaround could be to add the following lines somewhere where it is always called (cmd_options.test is None for normal use):
if request.global_settings.cmd_options.test:
    auth.login_bare('userlogin','userpassword')

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1703_
"
677,smartgrid problem on GAE,2015-01-26T21:01:01Z,,"bug, imported, Priority-Medium",,,"_From [massimo...._at_gmail.com](https://code.google.com/u/111721297562664670951/) on September 27, 2013 23:42:51_

https://groups.google.com/forum/#!topic/web2py/JrQI2yyQw84

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1693_
"
676,Force user to reenter password to save auth.profile() changes,2015-01-26T21:00:39Z,,"enhancement, imported, Priority-Medium",,,"_From [steve.va..._at_gmail.com](https://code.google.com/u/104525221136749765281/) on September 06, 2013 08:00:28_

What steps will reproduce the problem? no password required during save profile in default/user/profile What is the expected output? What do you see instead? force user to reenter password to save auth.profile() changes What version of the product are you using? On what operating system? 2.5.1-stable on windows 7 32 bit Please provide any additional information below. https://groups.google.com/forum/#!topic/web2py/00UTD1_YrvA

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1667_
"
675,DAL: Add support index creation ,2015-01-26T21:00:31Z,2015-05-03T14:26:32Z,"DAL, enhancement, imported, Priority-Medium",,,"_From [michele...._at_gmail.com](https://code.google.com/u/104551602623805320646/) on September 04, 2013 18:00:06_

Add new call or paramenters to define_table to allow creation of SQL indexes on Table and/or Field or tuple of Fields.

some examples:

db.create_table('t1', Field('f1'), Field('f2'), indexes=['f1', ('f1','f2')])
db.create_index(db.table, [db.field1, db.field2])
Field('uuid', create_index=True)

Discussed here: https://groups.google.com/d/msg/web2py-developers/Bm80JcZoz_g/QK4TMqeqM9cJ

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1665_
"
674,"insufficient info from error ticket, Deadlock found when trying to get lock; try restarting transaction",2015-01-26T21:00:28Z,2015-09-21T20:47:25Z,"bug, DAL, imported, Priority-Medium",InternalError,"InternalError: (1213, u'Deadlock found when trying to get lock; try restarting transaction')","_From [lapcc..._at_gmail.com](https://code.google.com/u/112961409058978860479/) on September 03, 2013 17:02:38_

What steps will reproduce the problem? we are using dal with mariadb galera cluster, some update query may return with deadlock error, we will have to handle it. we could see this error ticket once a while but we can't figure out where/which query we having problem.

Traceback (most recent call last):
  File ""/home/web2py/gluon/main.py"", line 599, in wsgibase
    BaseAdapter.close_all_instances('commit')
  File ""/home/web2py/gluon/dal.py"", line 560, in close_all_instances
    db._adapter.close(action)
  File ""/home/web2py/gluon/dal.py"", line 540, in close
    getattr(self, action)()
  File ""/home/web2py/gluon/dal.py"", line 1740, in commit
    if self.connection: return self.connection.commit()
  File ""/home/web2py/gluon/contrib/pymysql/connections.py"", line 631, in commit
    self.errorhandler(None, exc, value)
  File ""/home/web2py/gluon/contrib/pymysql/connections.py"", line 202, in defaulterrorhandler
    raise errorclass, errorvalue
InternalError: (1213, u'Deadlock found when trying to get lock; try restarting transaction')

that's all. we got in the ticket. What is the expected output? What do you see instead? we expect more details, from which controller and function, like usual error ticket. What version of the product are you using? On what operating system? CentOS release 6.4
MariaDB-Galera-server-5.5.32-1.x86_64 Please provide any additional information below. i was expected this error from session since we were testing it with session on database,  we did change to use client side cookies for session. however this kind of insufficient info ticket still appear once in a while.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1662_
"
673,Janrain/RPX widget migration,2015-01-26T21:00:27Z,2015-05-03T20:17:49Z,"bug, imported, Priority-Medium",,,"_From [molhokwai](https://code.google.com/u/molhokwai/) on August 31, 2013 10:12:09_

What steps will reproduce the problem? 1. Integration of Janrain/RPX login method 2. 3. What is the expected output? What do you see instead? Seemingly unstable widget... the legacy version of the janrain/rpx login widget is no longer supported: http://developers.janrain.com/documentation/widgets/legacy-sign-in-widget/ What version of the product are you using? On what operating system? Version 2.3.2 (2012-12-17 15:03:30) stable
Windows 7, SP1, x64 Please provide any additional information below. The migration guide: http://developers.janrain.com/documentation/widgets/legacy-sign-in-widget/social-sign-in-migration-guide/ Thanks...

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1656_
"
672,Detect record changes broken?,2015-01-26T21:00:18Z,,"bug, imported, Priority-Medium",,,"_From [massimo...._at_gmail.com](https://code.google.com/u/111721297562664670951/) on August 21, 2013 10:52:55_

https://groups.google.com/forum/#!topic/web2py/gG3LfES954M

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1646_
"
671,LDAP issue,2015-01-26T21:00:10Z,2015-10-13T20:17:36Z,"bug, imported, Priority-Medium",,,"_From [massimo...._at_gmail.com](https://code.google.com/u/111721297562664670951/) on August 21, 2013 10:50:57_

https://groups.google.com/forum/#!topic/web2py/sEpOWYk0mFA

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1645_
"
670,Date search on sqlform.grid not working for translated dates,2015-01-26T20:59:54Z,,"bug, imported, Priority-Medium",,,"_From [lightdot](https://code.google.com/u/lightdot/) on August 20, 2013 16:20:04_

Related thread: https://groups.google.com/d/msg/web2py/RSVl39iwXyI/tVP5r5BJ3vQJ Summary:
The search is performed in the database format which is ISO (Y/m/d). The grid is not smart enough to apply local settings (custom data formats) to the search field.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1640_
"
669,"when trying to use IS_IN_DB with a composite reference key, there is a no _id error reported",2015-01-26T20:59:32Z,2015-09-22T20:23:09Z,"bug, DAL, imported, Priority-Medium",,,"_From [anto..._at_tzorvas.com](https://code.google.com/u/108498664281537156435/) on August 19, 2013 12:51:12_
1. model: http://paste.kde.org/p90a9d2d6/09069137/ 2. from the appadmin create a station then a station_source and then a data record
2. in data record insert, there is a no _id error -- http://paste.kde.org/p48068f25/08969137/ The expected is to have a unique combination of stations_sources.station_id & stations_sources.source (which works) and for db.data.source to have a drop-down list with the referenced values

2.5.1-stable+timestamp.2013.06.06.15.39.19 on Linux x64(Gentoo)

with a combination of IS_NOT_IN_DB i can get the preferred behavior http://goo.gl/lgv88R

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1637_
"
668,manager_group_role admin page erroneous behavior,2015-01-26T20:59:03Z,,"bug, imported, Priority-Medium",,,"_From [make..._at_gmail.com](https://code.google.com/u/103084492779373537072/) on August 13, 2013 08:58:12_

What steps will reproduce the problem? 1. Create several tables and at least one user. 
2. Create an 'admin' user group and make the user a member of this group.
3. Add this row to db.py: 

   auth.settings.manager_group_role = 'admin'

...to assign admin privileges to the users belonging to this group.
4. Add a link to the administrator interface somewhere in your app:

   {{=A('Admin...',_href=URL('appadmin','manage',args=['auth']))}}
5. Launch your app and click the 'Admin...'-link. What is the expected output? What do you see instead? Initially everything is alright, all tables are visible and rows can be added.
As soon as a row is added to a table this table-content will not be visible, but instead the last table in the ""link column"" will be visible. If the user continues to add rows to other tables these tables will also be affected. The problem disappears when the page is reloaded. What version of the product are you using? On what operating system? Version 2.5.1-stable+timestamp.2013.06.06.15.39.19 on Windows 7 (6.1.7600.16385) Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1628_
"
667,DAL returns incorrect record ID on MySQL insert when manually specifying the ID value,2015-01-26T20:58:55Z,2015-05-04T23:12:24Z,"DAL, imported, Priority-Low",,,"_From [ABasta..._at_gmail.com](https://code.google.com/u/103720714265511973715/) on August 07, 2013 13:32:17_

See https://groups.google.com/d/msg/web2py/ipXEtxUbt2w/z_7iDdEuK6wJ . We may be able to use conn.mysql_insert_id(), at least when using the MySQLdb driver.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1620_
"
666,Firebird Adapter can't insert blobs greater than 64kb,2015-01-26T20:58:53Z,2015-10-13T20:16:33Z,"bug, DAL, imported, Priority-Medium",,,"_From [r..._at_tarkus.mx](https://code.google.com/u/104102434118943698957/) on July 03, 2013 00:30:23_

What steps will reproduce the problem? 1.- Define a table containing a blob field
2.- Try to insert or update a row assigning that field data > 64kb What is the expected output? What do you see instead? It's expected that the field will contain the data assigned, just as it functions when the data < 64kb What version of the product are you using? On what operating system? Using web2py 2.5.1, fdb 1.4 Please provide any additional information below. This occurs because Firebird has a 64kb limit on the size of parameters. According to fdb documentation, a blob parameter has to be manipulated as a file-like object.
cur.execute(""insert into blob_test values (?)"", (StringIO('abcdef'),))

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1571_
"
665,web2py.test integration?,2015-01-26T20:58:37Z,,"bug, imported, Priority-Medium",,,"_From [massimo...._at_gmail.com](https://code.google.com/u/111721297562664670951/) on June 27, 2013 08:35:29_

https://github.com/viniciusban/web2py.test

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1564_
"
664,"Misleading error:relation ""auth_user"" already exists'",2015-01-26T20:58:22Z,2015-09-03T16:36:55Z,"DAL, enhancement, imported, Priority-Medium",,,"_From [mjmare31..._at_gmail.com](https://code.google.com/u/114349152275557912536/) on June 22, 2013 22:07:09_

Using the trunk version (2.5.1-stable+timestamp.2013.06.22.01.45.55) of web2py I'm getting with both MySQL and Postgresql the error message ""table/relation auth_user already exists"" when providing an incorrect password for the database user. 
Correcting the password in the connection string makes the error go away. 

Although the error might be technically correct (wrong credentials will prevent access to tables) it is not helpful in fixing a configuration error.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1554_
"
663,"PostgreSQL Error: <class 'psycopg2.IntegrityError'> column ""name__tmp"" contains null values ",2015-01-26T20:58:13Z,,"bug, DAL, imported, Priority-Medium",,,"_From [A.M.Mar..._at_gmail.com](https://code.google.com/u/106714680262317839029/) on June 16, 2013 11:39:20_

What steps will reproduce the problem? 1. Make a new app with a postgres database connection
2. Define a table ""Table"" with a string-field ""Name""
3. Run the app
4. Add a record to the table with some string value
5. Add notnull=True to the field
6. Run the app What is the expected output? What do you see instead? It should add a not-null constraint to the field in the database.
It errors-out and opens a ticket. What version of the product are you using? On what operating system? web2py 2.51
windows 7 64-bit
python 2.6 64bit
psycopg2 2.5 64bit
PostgreSQL 9.1 64bit Please provide any additional information below. <Ticket attached>
- The migration in this case creates a new field, sets it's attributes, then copies the data to it. So it ""temporarily"" needs a default='' for this to work. It copies the entire column to a new-one, in which-case it ""temporarily"" has Nulls, then tries to set the attribute, and THEN copies the data...
  It may be an implementation-detail in psycopg2, but instead of letting it to try to copy the column and trip-on-itself in the process, an ALTER TABLE in the DAL would circumvent this issue... Would be much faster also...

**Attachment:** [127.0.0.1.2013-06-16.12-13-30.46c17b7f-aea1-4a6c-a3c8-789e713d9247](http://code.google.com/p/web2py/issues/detail?id=1537)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1537_
"
662,SQLFORM.smartgrid: Bug in links,2015-01-26T20:57:31Z,2016-07-11T09:06:33Z,"bug, imported, Priority-Medium",,,"_From [jjachuf_at_gmail.com](https://code.google.com/u/jjachuf_at_gmail.com/) on June 14, 2013 02:12:26_

What steps will reproduce the problem? 1. Given the following model:

from gluon.contrib.populate import populate

tb_a = db.define_table('ta',
    Field('name', 'string'),
    format='&#37;(name)s',
)

tb_b = db.define_table('tb',
    Field('fa', tb_a),
    Field('name', 'string'),
    format='&#37;(name)s',
)

if db(tb_a).isempty():
    populate(tb_a, 2)
    populate(tb_b, 8)

And the following function in controller:

def f():
    grid =SQLFORM.smartgrid(tb_a,
            csv=False,
            user_signature=False,)

```
return dict(grid=grid)
```

Performing the steps shown in the image ok.png, this works well!
1. Modifying the model table ""ta"" (name is changed by name2)

tb_a = db.define_table('ta',
    Field('name2', 'string'),
    format='&#37;(name2)s',
)

Fails, as shown in the image fail.png 
. 

Environment:
SO: Freebsd 9.1
Web2py: 2.5.1-stable+timestamp.2013.06.13.15.30.17

**Attachment:** [ok.png fail.png 127.0.0.1.2013-06-13.21-08-50.229aa122-bb03-4360-b256-fe445410b3f8](http://code.google.com/p/web2py/issues/detail?id=1528)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1528_
"
661,"AppAdmin creates no records, but it looks like records are created (!)",2015-01-26T20:24:16Z,,"bug, imported, Priority-Medium",,,"_From [mirek.zv...@gmail.com](https://code.google.com/u/104770267036676657627/) on May 23, 2013 13:46:47_

What steps will reproduce the problem? 1. Continue add records into some table using AppAdmin. After a time prompt for admin password appears.
2. After password entering the creating form appears again and you can continue add more new records. But... What is the expected output? What do you see instead? Creating form looks like well working, there is nothing not typical. However records inserted after the prompt for admin password are not created.
This is strange behaviour: If you decide use AppAdmin to pre-fill some tables, you can do lot of ""work"" which is not saved at all. What version of the product are you using? On what operating system? 2.4.6-stable+timestamp.2013.04.06.17.37.38, WinXP

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1502_
"
660,ImportError raised when application name is not matched exactly in url,2015-01-26T20:24:09Z,,"bug, imported, Priority-Medium",,,"_From [herman...@gmail.com](https://code.google.com/u/112993387440168441289/) on May 14, 2013 22:13:12_

What steps will reproduce the problem? 1. Create application with a capital letter in its name
2. Create python module in a applications/appName/modules folder
3. Import such a module from a model
4. Call the app with ""slightly wrong"" url, e.g. http://localhost/appname/default/index (instead of ..appName...) What is the expected output? What do you see instead? <type 'exceptions.ImportError'> No module named appname.modules exception is raised instead of either: not finding the application at all or correct loading of the module. What version of the product are you using? On what operating system? 2.4.6-stable+timestamp.2013.04.06.17.37.38
Apache/2.4.4 (Win64) mod_wsgi/3.5-BRANCH Python/2.7.3 PHP/5.4.3 Please provide any additional information below. URL: xxx/default/index, app name: Xxx -> error
URL: Xxx/default/index, app name: xxx -> error as well

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1491_
"
659,menu links dont work with mobile user agent,2015-01-26T20:24:07Z,,"bug, imported, Priority-Medium",,,"_From [kevin.be...@gmail.com](https://code.google.com/u/115286856162745374319/) on May 04, 2013 19:54:36_

What steps will reproduce the problem? 1. create a new simple app add a second page index2 for example.
2. modify menu.py like this: 
response.menu = [
    ('', False,A('Start',_href=URL('default','index'),_title=""Back to main page""), []),
    ('', False,A('Blub',_href=URL('default','index2'),_title=""Back to main page""), [])

] 3. What is the expected output? What do you see instead? works with firefox and crome (windows xp and 7 tested) but using android the link points to: ""&#37;3Ca&#37;20href="" What version of the product are you using? On what operating system? tested with web2py 2.4.6-stable+timestamp.2013.04.06.17.37.38
running on windows xp and ubuntu 12.04
exactly the same behavior.
Mobile user agent tests with Motorola Defy+ Samsung Galaxy S and Opera Mobile Emulator 

minimal app is attached to this issue

**Attachment:** [web2py.app.testmobilemenue.w2p](http://code.google.com/p/web2py/issues/detail?id=1475)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1475_
"
658,add gae datastore full-text search,2015-01-26T20:24:00Z,2015-05-03T20:07:08Z,"DAL, enhancement, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on April 30, 2013 16:27:07_

https://code.google.com/p/google-app-engine-samples/source/browse/trunk/search/python/search_demo.py

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1466_
"
657,possible problem with two ajax forms in page,2015-01-26T20:23:47Z,,"bug, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on April 21, 2013 17:18:04_

https://groups.google.com/forum/?fromgroups=#!topic/web2py/I0qpV7P_Vrw

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1457_
"
656,IS_IN_DB validator - add left argument for LEFT JOIN,2015-01-26T20:23:35Z,2015-03-05T22:26:04Z,"enhancement, imported, Priority-Medium",,,"_From [ato.st...@gmail.com](https://code.google.com/u/117176497741954485102/) on April 15, 2013 21:00:46_

Can a 'left' argument be added to include a left join in the SQL statment?  I had a situation where I needed to display the text from a related table in my dropdown list generated by web2py.  I got it working but the code is ugly and a 'left' argument would have been a more elegant solution.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1454_
"
655,List sites powered by web2py,2015-01-26T20:23:34Z,2015-03-20T21:56:50Z,"bug, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on April 15, 2013 06:10:36_

https://groups.google.com/forum/#!topic/web2py/DNg0Ibn8-UQ

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1450_
"
654,env.tar missing from current pypi distribution.,2015-01-26T20:23:32Z,2016-06-28T20:24:12Z,"bug, imported, Priority-Medium",,,"_From [lionel.b...@gmail.com](https://code.google.com/u/115507502388293301016/) on March 25, 2013 11:06:23_

What steps will reproduce the problem? 1. mkvirtualenv test_web2py
2. pip install web2py
3. w2p_apps ~/code/web2py_apps/

What is the expected output? 
- creation of the directory  ~/code/web2py_apps/ if it doesn't exists
- filling of the directory with the default app scaffolding.

What do you see instead?
Creating a web2py env in: /home/lionel/code/web2py_apps/
[Errno 2] No such file or directory: '/home/lionel/Envs/test_web2py/local/lib/python2.7/site-packages/gluon/env.tar'
Failed to create the web2py env
Please reinstall web2py from pip What version of the product are you using? On what operating system? OS : Ubuntu 12.04
Web2py Version : 2.1.1 Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1404_
"
653,notnull constraint not set on foreign key,2015-01-26T20:23:25Z,,"bug, DAL, imported, Priority-Medium",,,"_From [mrauch05@gmail.com](https://code.google.com/u/mrauch05@gmail.com/) on March 18, 2013 12:06:17_

What steps will reproduce the problem? 1. create two tables, add a field to reference the other table and set notnull=True. e.g.
db.define_table('mytable',  
    Field('name', 'string'))

db.define_table('mytable2',  
    Field('name', 'string'),
    Field('mytable', db.mytable, notnull=True)) What is the expected output? What do you see instead? the not null constraint is missing in the created db table:
CREATE TABLE mytable2
(
  id serial NOT NULL,
  ""name"" character varying(512),
  mytable integer,
  CONSTRAINT mytable2_pkey PRIMARY KEY (id),
  CONSTRAINT mytable2_mytable_fkey FOREIGN KEY (mytable)
      REFERENCES mytable (id) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE CASCADE
)
WITH (
  OIDS=FALSE
);
ALTER TABLE mytable2 OWNER TO postgres;

instead it should be
mytable integer NOT NULL,
for the mytable column. What version of the product are you using? On what operating system? web2py 2.4.4, Windows 7, Postgres 9.0

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1395_
"
652,import_from_csv_file error,2015-01-26T20:23:12Z,2015-05-03T14:07:42Z,"bug, DAL, imported, Priority-Medium",,,"_From [dediro...@gmail.com](https://code.google.com/u/111975680292908482998/) on March 13, 2013 16:43:29_

Here is the error I get:

Exception IntegrityError: insert or update on table ""auth_membership"" violates foreign key constraint ""auth_membership_user_id_fkey"" DETAIL: Key (user_id)=(3) is not present in table ""auth_user"".

I've tried to migrate from SqlLite to Postgresql using the export_from_csv_file and import_from_csv_file.

Backup went apparently fine; restore is more problematic.

To be complete, I must say I have truncated the postgresql tables first, before importing.

Have I done something wrong?

Here is the begining of the csv file:

TABLE auth_user
auth_user.id,auth_user.first_name,auth_user.last_name,auth_user.email,auth_user.password,auth_user.registration_key,auth_user.reset_password_key,auth_user.registration_id
1,Andr√©,Lehmann,andre.lehmann@soluster.ch,""pbkdf2(1000,20,sha512)$8041ad3ab81a8ed0$ 33b1dbcab3e89bc8702e06cf1e3513532dc64a29 "",,,
3,Pierre,Aubort,pierre.aubort@soluster.ch,""pbkdf2(1000,20,sha512)$9ee2baf84fc00e93$ 3d074dd12776ea1ff8fa942952328febc3bc0ade "",,,
4,Mario,Mineo,mario.mineo@here.ch,salut,,,
5,les moulinots,toto,toto.mozulinot@toto.com,""pbkdf2(1000,20,sha512)$99d4de06b8fcbe69$ 11f4cbda2846476a8150c396152d4637fef76812 "",,,
6,fhrgh,gfjht,¬ßrhgrijgpmp,""pbkdf2(1000,20,sha512)$806ddf5b67cf14f7$ 8cfe0f7cec3265fdb85427297a3d40671ba9db49 "",,,
8,Mario,Mineo,mario.mineo@ici.ch,""pbkdf2(1000,20,sha512)$b5cbea4373bae02d$ f580cc6203948f96d9030b20a4c49c9532b7dd2f "",,,

TABLE auth_group
auth_group.id,auth_group.role,auth_group.description
2,Administrateur,Acc√®s √† toutes les fonctions du Consismeter
3,Analyste,Personne ayant le droit de g√©rer les mesures et les r√©f√©rences
4,Laborant,Personne ayant le droit de faire des mesures et de calibrer l'appareil

TABLE auth_membership
auth_membership.id,auth_membership.user_id,auth_membership.group_id
1,1,2
2,2,2
4,8,2

TABLE auth_permission
auth_permission.id,auth_permission.group_id,auth_permission.name,auth_permission.table_name,auth_permission.record_id
28,2,edition_sonde,,0
29,2,edition_test,,0
30,2,edition_reference,,0
31,2,edition_produit,,0
32,2,suppression_mesure,,0
33,2,parametres,,0
34,2,calibration,,0
35,2,mesure,,0
36,3,edition_reference,,0
37,4,calibration,,0
38,4,mesure,,0

TABLE auth_event
auth_event.id,auth_event.time_stamp,auth_event.client_ip,auth_event.user_id,auth_event.origin,auth_event.description
1,2012-11-23 11:43:25,127.0.0.1,<NULL>,auth,Group 1 created
2,2012-11-23 11:43:25,127.0.0.1,1,auth,Utilisateur 1 enregistr√©
3,2012-12-05 15:38:41,127.0.0.1,1,auth,Utilisateur 1 connect√©
4,2012-12-05 16:09:01,127.0.0.1,1,auth,User 1 Logged-out
5,2012-12-11 07:50:10,127.0.0.1,1,auth,Utilisateur 1 connect√©
6,2013-02-13 13:54:36,127.0.0.1,1,auth,Utilisateur 1 connect√©

Done on Ubuntu 12.04 with trunk version of web2py (2.4.4-stable+timestamp.2013.03.11.20.32.00)

Thanks in advance for help!

Andre

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1387_
"
651,select all in grid and smargrid?,2015-01-26T20:22:48Z,,"enhancement, imported, Priority-Medium",,,"_From [steve.va...@gmail.com](https://code.google.com/u/104525221136749765281/) on March 12, 2013 02:24:04_

What version of the product are you using? On what operating system? 2.4.4-stable on lubuntu Please provide any additional information below. please add feature select all in grid and smartgrid
ref: https://groups.google.com/forum/?fromgroups=#!topic/web2py/qVPobr1TOz4

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1383_
"
650,plugin jqmobile and the menu,2015-01-26T20:22:47Z,,"bug, imported, Priority-Medium",,,"_From [mweis...@gmail.com](https://code.google.com/u/110665799752208780239/) on March 11, 2013 08:18:00_

What steps will reproduce the problem? 1. jqmobile 1.2.0-files copied from admin/ to static and view:

static
- plugin_jqmobile
  --  images
  --  dd_belatedpng.j
  --  jquery.mobile-1.2.0.min.css
  --  jquery.mobile-1.2.0.min.js

views
- plugin_jqmobile
  --  about.html
  --  index.html
  --  layout.html
1. Functions:

def a1():
    return ""Function a1""

def a2():
    return ""Function a2""

def b1():
    return ""Function b1""

def b2():
    return ""Function b2""
1. Menu:
   response.menu = [
   (T('Home'), False, URL('default', 'index'), []),
   ('A', False, None, [
       ('A1', False, URL('default', 'a1')),
       ('A2', False, URL('default', 'a2')),
      ]),
   ('B', False, None, [
       ('B1', False, URL('default', 'b1')),
       ('B2', False, URL('default', 'b2')),
      ]),
   ] What is the expected output? What do you see instead? Expected: a cascaded drop down list with clickable entries
   I see: only the first level. A click sends an error.
   Attached files:
2. Screenshot
3. Source code of the website

What version of the product are you using? 
Version 2.4.2 stable (2013-03-04 03:26:21)

On what operating system?
Windows 7 Please provide any additional information below.

**Attachment:** [mobile2.pcx mobile2-sourcecode.htm](http://code.google.com/p/web2py/issues/detail?id=1378)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1378_
"
649,Customize view of disabled apps,2015-01-26T20:21:32Z,,"enhancement, imported, Priority-Medium",,,"_From [paolo.va...@gmail.com](https://code.google.com/u/107767337307670204068/) on March 09, 2013 13:00:56_

What steps will reproduce the problem? 1. Disable an app from the appadmin 
2. Visit the app website
3. you will get the following code:

<html><body><h1>Temporarily down for maintenance</h1></body></html>

which comes from gluon/main.py:492

raise HTTP(503, ""<html><body><h1>Temporarily down for maintenance</h1></body></html>"") Please provide any additional information below. The best would be to load a specific view i.e, from applications/app/view/disabled.html

This will give the possibility to customize the disabled view for each application.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1371_
"
648,oauth2 issue,2015-01-26T20:21:13Z,,"enhancement, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on March 08, 2013 17:30:41_

https://groups.google.com/forum/?fromgroups=#!topic/web2py/7xD1tS7o_EI

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1369_
"
647,login ajax,2015-01-26T20:21:06Z,2015-10-13T20:08:54Z,"enhancement, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on February 20, 2013 15:41:27_

https://groups.google.com/forum/?fromgroups=#!topic/web2py/KWnrCnx4KvM

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1348_
"
646,support extending a block from an included file,2015-01-26T20:20:52Z,2015-05-04T21:25:30Z,"enhancement, imported, Priority-Medium",,,"_From [steve.va...@gmail.com](https://code.google.com/u/104525221136749765281/) on February 14, 2013 20:14:49_

What steps will reproduce the problem? 1. example code that not work
views/block_footer.html

{{block footer}}
custom_footer
{{end}}

views/default/blog.html 1. {{extend 'layout.html'}}
{{include 'block_footer.html'}} 2. {{extend 'layout.html'}}
{{extend 'block_footer.html'}} What is the expected output? What do you see instead? support extending a block from an included file, so that we are not modified the layout.html, just the block file. the code above is about block footer, maybe it can support for support sidebar (left and right)
the idea is create the block footer html file separate from layout.html and then the view file can use it to replace the default value that already define in layout.html What version of the product are you using? On what operating system? version 2.3.2 (stable) tested on lubuntu and centos Please provide any additional information below. https://groups.google.com/forum/?fromgroups=#!topic/web2py/o__13L0qCXE

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1335_
"
645,login expires when doing periodic jsonrpc requests,2015-01-26T20:20:50Z,,"bug, imported, Priority-Medium",,,"_From [gonva...@gmail.com](https://code.google.com/u/116862255945890836708/) on January 17, 2013 10:05:30_

What steps will reproduce the problem? 1. Set a low expiration value: auth.settings.expiration=60
2. Login to a web2py application
3. With the obtained cookie, start doing _only_ @service.jsonrpc requests, perioducally, every 5 s. What is the expected output? What do you see instead? auth.last_visit will be updated as expected, but the login will expire.
The login should not expire, since we are doing periodic requests and it should stay active forever. What version of the product are you using? On what operating system? Version 2.4.1-alpha.2+timestamp.2013.01.13.13.14.47
CrunchBang Linux statler (Debian GNU/Linux 6.0.6 (squeeze)) Please provide any additional information below. The same test but doing normal requests will keep the login active forever, as expected.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1287_
"
644,problems with SQLFORM.factory and multiple tables,2015-01-26T20:20:49Z,,"bug, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on January 09, 2013 18:06:42_

https://groups.google.com/forum/?fromgroups=#!topic/web2py/BhZwMBIyqKM

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1266_
"
643,Fix problem with is_active,2015-01-26T20:20:42Z,,"enhancement, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on January 09, 2013 17:53:27_

https://groups.google.com/forum/?fromgroups=#!topic/web2py/eRmlgsvxsh8

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1265_
"
642,port elasticbeanstalk to web2py,2015-01-26T20:20:35Z,2015-09-22T20:24:06Z,"enhancement, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on January 09, 2013 17:37:07_

http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/create_deploy_Python_django.html

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1264_
"
641,html5 forms,2015-01-26T20:20:28Z,,"enhancement, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on January 09, 2013 17:33:39_

https://groups.google.com/forum/?fromgroups=#!topic/web2py/EaN_I2c96dI

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1263_
"
640,AddGeometryColumn fails with a field name having capital letters,2015-01-26T20:20:15Z,2015-03-02T21:29:55Z,"bug, imported, Priority-Medium",,,"_From [paolo.va...@gmail.com](https://code.google.com/u/107767337307670204068/) on January 08, 2013 18:38:55_

What steps will reproduce the problem? 1. Define a table as follows:
db.define_table('test_geo1_name',
    Field('name_P', 'string'),
    Field('location_P','geometry()'),
)
2. in the db you will get the field name_p and location_P respectively What is the expected output? What do you see instead? to have the field name_p and location_p respectively What version of the product are you using? On what operating system? trunk Please provide any additional information below. See the discussion on the web2py group: https://groups.google.com/d/msg/web2py/6DDLVv4jt0w/E3NIhFEUrgsJ

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1259_
"
639,Polymodel class not working properly,2015-01-26T20:20:07Z,,"bug, DAL, imported, Priority-Medium",,,"_From [decur...@gmail.com](https://code.google.com/u/104717928243926350351/) on December 05, 2012 11:19:20_

What steps will reproduce the problem? 1. Model
define_table('location',
    Field('name', 'string'),
    Field('active', 'boolean'),
    polymodel = True)

define_table('location_outdoor',
    db.location,
    Field('country', 'string'),
    Field('city', 'string'),
    Field('postcode', 'string'),
    Field('street', 'string'),
    Field('building', 'string'),
    polymodel = db.location)

define_table('location_indoor',
    db.location
    Field('location_outdoor', db.location_outdoor),
    Field('floor', 'string'),
    Field('room', 'string'),
    polymodel = db.location)
1. Controller
   @auth.requires_signature()
   def form():
   
   table = request.args(0)
   if not table in db.tables(): redirect(URL('error'))
   db[table].id.readable = False
   form = SQLFORM.grid(db[table],args=request.args[:1], user_signature=True)
   return dict(form=form)
2. View
   Default What is the expected output? What do you see instead? I expect to be able to create / read / update / delete from db.location, db.location_outdoor and db.location_indoor.
   While there are no records in _outdoor or _indoor I'm able to read all the tables. Once I enter a record in _outdoor or _indoor I can't access the other one anymore.
   When I do call ""http://localhost:8080/init/location/form/location_outdoor?_signature=xxx' I receive: AttributeError: 'location' object has no attribute 'country'
   When I call ""http://localhost:8080/init/location/form/location_indoor?_signature=xxx' I receive: AttributeError: 'location_outdoor' object has no attribute 'location_outdoor' What version of the product are you using? On what operating system? web2py: 2.2.1
   Deployed on: Google App Engine (GAE) Please provide any additional information below. I'm trying to store all location information (outdoor / indoor) in one polymodel. I do want to take advantage of having to have only one reference between devices and locations.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1201_
"
638,How to add extra options to drop-drown menu in query section of SQLFORM.grid?,2015-01-26T20:20:00Z,,"enhancement, imported, Priority-Medium",,,"_From [Amit.Kha...@gmail.com](https://code.google.com/u/115187541222958550179/) on November 29, 2012 05:18:45_
1. I have two tables in my application:
   status_tbl:
   Fields:
   serial_no,
   event,
   updated_on,
   interval_time

device_config:
device_name,
owner_email_id,
serial_no
1. I have to display the grid view of status_tbl so when I display the grid of this table and checked the drop-down options of query field, it displays id,serial_no,event,updated_on and interval_time.

I want to display device_name and owner_email_id as well in option drop-down, so drop-down menu should display id,serial_no,event,updated_on,interval_time,device_name and owner_email_id.

Issues:
1. How to make it possible to display fields of other table in grid view of another table and upon selecting of extra fields , user should be able to execute the query(search, clear etc...)?
2. Please provide me the solution of displaying and hiding these extra fields on the grid means I may display some of these extra fields to the grid and some of not but query should work even those extra fields not displayed on the grid.

I am using web2py2.1.1 version on windows XP machine, but fix should work on other OS also.

I am flexible to move to latest version of web2py version so please provide me the solution of it and the version of web2py on which it will be fixed so i will migrate to that version.

Regards,
Amit

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1195_
"
637,common_filter not working,2015-01-26T20:19:47Z,2015-09-22T20:24:37Z,"bug, imported, Priority-Medium",,,"_From [b88z...@gmail.com](https://code.google.com/u/106236012710735055679/) on November 25, 2012 23:07:58_

What steps will reproduce the problem? 1. execute the attached py file What is the expected output? What do you see instead? Expect to see
1 ['Bob']
2 ['Bob']
3 ['Alice', 'Bob']
4 ['Bob']

instead, see
1 ['Alice', 'Bob']
2 ['Alice', 'Bob']
3 ['Alice', 'Bob']
4 ['Bob'] What version of the product are you using? On what operating system? git main 1b0e08 Please provide any additional information below.

**Attachment:** [test_common_filter.py](http://code.google.com/p/web2py/issues/detail?id=1184)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1184_
"
636,Profile update does not update auth.user object for computed field,2015-01-26T20:19:46Z,2017-05-01T14:13:20Z,"bug, imported, Priority-Medium",,,"_From [markruol...@gmail.com](https://code.google.com/u/114619454780239522399/) on November 14, 2012 21:46:56_

What steps will reproduce the problem? 1. Have both 'upload' field and computed field for auth_user table
2. Update the 'upload' field through auth.profile() form
3. Click on 'save profile' What is the expected output? What do you see instead? Expect that the auth.user object will be updated for all fields. Only the 'upload' field is updated; the computed field does not change in the auth.user object. What version of the product are you using? On what operating system? Web2py 2.2.1
Ubuntu 12.04 Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1164_
"
635,with_alias not transcribed adequatly at field level,2015-01-26T20:19:39Z,2015-02-27T14:30:12Z,"enhancement, imported, Priority-Medium",,,"_From [dediro...@gmail.com](https://code.google.com/u/111975680292908482998/) on November 05, 2012 15:23:16_

What steps will reproduce the problem? 1. define a table with define_table('test',Field('name'),Field('firstname'))
2. in the controller, have:
        count = db.test.id.count()
        data = db().select(db.test.ALL,
                           count.with_alias('newName'),
                           groupby=db.test.id,
                           orderby=db.test.name)
1. in the view displaying data, you get as headers:
   test.name    test.firstname    COUNT(test.id) AS newName What is the expected output? What do you see instead? test.name    test.firstname    newName What version of the product are you using? On what operating system? trunk, Windows 7

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1141_
"
634,.tables files generated by new define_tables doesn't match that of fake_migrate,2015-01-26T20:19:09Z,2015-05-03T14:28:20Z,"bug, imported, Priority-Medium",,,"_From [ato.st...@gmail.com](https://code.google.com/u/117176497741954485102/) on October 30, 2012 19:40:56_

What steps will reproduce the problem? 1. Create a table in an app - save and execute app to create in db
2. Now in a separate app reference the db and set migrate=False, fake_migrate = True
3. This should create the .table file in the databases directory for that app. What is the expected output? What do you see instead? I feel that the .table files from both apps should be the same

But, the .table file generated in step one has all lowercase field names whereas the .table file in step 2 creates the field names in mixed case

attached files -> testMachine file was generated from db.py
productionMachine file was generated from fake_migrate=True What version of the product are you using? On what operating system? Updated from trunk this morning, Version 2.2.1 (2012-10-29 22:25:15) Please provide any additional information below.

**Attachment:** [testMachine_district.table productionMachine_district.table](http://code.google.com/p/web2py/issues/detail?id=1126)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1126_
"
633,Consider integrating web2admin,2015-01-26T20:18:49Z,2016-06-28T20:27:59Z,"enhancement, imported, Priority-Low",,,"_From [rochacbruno](https://code.google.com/u/rochacbruno/) on October 19, 2012 05:37:17_

web2admin is a good start to a better data admin for web2py, It puts web2py closer to Django in terms of admin interface, filters, etc.

With the power of grid customization it would be a nice addition.

I am asking to consider the inclusion of web2admin (experimental for a while) as replacement for appadmin or as a supported option, but fully reviewed and integrated, maybe modified and with total support of web2py project.

The project page. https://github.com/rif/web2admin

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1103_
"
632,db.import_from_csv_file() doesn't maintain foreign keys when UUID field is present,2015-01-26T20:18:34Z,2016-07-11T08:46:07Z,"bug, imported, Priority-Medium",,,"_From [f...@aidiq.com](https://code.google.com/u/114533118083619344414/) on October 16, 2012 15:35:24_

What steps will reproduce the problem? stable = db.define_table(""source"", Field(""uuid""))
dtable = db.define_table(""data"", Field(""source_id"", db.source))
stable.insert(uuid=""First"")
stable.insert(uuid=""Second"")
stable.insert(uuid=""Third"")
db(stable.id==2).delete()
dtable.insert(source_id=3)
db.commit()
file = open(""test.csv"", ""w"")
db.export_to_csv_file(file)
file.close()
stable.truncate()
dtable.truncate()
file = open(""test.csv"", ""r"")
db.import_from_csv_file(file)
db(stable.id>0).select().json()
db(dtable.id>0).select().json() What is the expected output? What do you see instead? I would expect db(dtable.id==1).select().first().source_id to point to db(stable.uuid==""Third"").select().first().id
I see:
In [16]: db(dtable.id>0).select().json()
Out[16]: '[{""source_id"": 3, ""id"": 1}]'
In [17]: db(stable.id>0).select().json()
Out[17]: '[{""id"": 1, ""uuid"": ""First""}, {""id"": 2, ""uuid"": ""Third""}]' What version of the product are you using? On what operating system? Current Trunk ( 3a1ba53a4b86f0da79be3da78b63509fce401c7f , Mon Oct 15 21:49:43).
Have tried multiple OS (Win32, Linux) & multiple DBs (SQLite, Postgres)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1095_
"
631,smartgrid with lazy_tables=True and postgresql fails to show references,2015-01-26T20:17:58Z,2015-09-22T20:32:54Z,"bug, imported, Priority-Medium",,,"_From [LeonelCa...@gmail.com](https://code.google.com/u/111558504441537368591/) on October 15, 2012 14:41:55_

This bug report comes in the sequence of a conversation started here: https://groups.google.com/forum/?fromgroups=#!topic/web2py/nLLkD-2NZqE *\* What steps will reproduce the problem? **

Starting with a clean database and database folder:
1. In the model (db.py) have something like this:

db = DAL('postgres://teste:teste@localhost/teste', lazy_tables=True)

from gluon.tools import Auth
auth = Auth(db, hmac_key=Auth.get_or_create_key())

db.define_table('x', Field('name'), format='&#37;(name)s')
db.define_table('y', Field('name'), Field('x', 'reference x'), format='&#37;(name)s')
db.define_table('z', Field('name'), Field('x', 'reference x'), format='&#37;(name)s')

if db(db.x.id > 0).count() == 0:
    db.x.insert(name='test') 
1. In the controller have:

def index2():
    return dict(grid=SQLFORM.smartgrid(db.x)) 
1. In view index2.html have:
   {{extend 'layout.html'}}
   {{=grid}}
2. Visit index.html in your browser.
3. Visit index2.html
4. observe that the y and z references are not in the x grid
5. Set lazy_tables=False, visit index2.html notice visit index2.html again, see that y and z references are now present in the grid. Setting lazy_tables=True will make them disappear again.

*\* What is the expected output? What do you see instead? **

The y and z references should always appear in the smartgrid.

*\* What version of the product are you using? On what operating system? **

web2py 2.0.9, Windows 7, postgresql 9.2

*\* Please provide any additional information below. **

This was tested using the included rocket server.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1091_
"
630,dal fail to query on fields other than id on couchdb,2015-01-26T20:17:45Z,2016-07-11T08:33:44Z,"DAL, enhancement, imported, Priority-Medium",,,"_From [lapcc...@gmail.com](https://code.google.com/u/112961409058978860479/) on October 05, 2012 22:17:57_

What steps will reproduce the problem? db=DAL('couchdb://127.0.0.1:5984')
db.define_table('person',Field('name'))
db.person.insert(name='john')
print db(cdb.person.name == ""john"").select()
will alway return empty object What is the expected output? What do you see instead? return the correct object What version of the product are you using? On what operating system? web2py 2.0.9 Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1071_
"
629,routes_onerror,2015-01-26T20:17:10Z,,"bug, imported, Priority-Medium",,,"_From [lyn...@gmail.com](https://code.google.com/u/108351059455087753367/) on September 26, 2012 11:16:15_

I have this code in the app-specific routes.py

routes_onerror = [
  ('_/_', '/myapp/static/error.html')
]

I reload routes, but it still prints 
invalid function (nothing/here)

I am using:
Version 2.0.9 (2012-09-17 21:37:10) stable

But it works once I moved it to the main routes.py

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1034_
"
628,response.files with no file suffix,2015-01-26T20:17:02Z,2015-05-14T14:14:07Z,"bug, enhancement, imported, Priority-Medium",,,"_From [cfho...@cfhowes.com](https://code.google.com/u/117584905267195773078/) on September 22, 2012 17:44:59_

What steps will reproduce the problem? 1. add response.files.append(' http://maps.google.com/maps/api/js?sensor=false' )
2. render a view that includes web2py_ajax.html What is the expected output? What do you see instead? i expect the file to e output, but since it does not end in a matching suffix it is ignored. What version of the product are you using? On what operating system? 2.0.9 Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1025_
"
627,Enhancement: Autocomplete widget customized label name and capital letter,2015-01-26T20:16:50Z,,"enhancement, imported, Priority-Medium",,,"_From [ochib...@gmail.com](https://code.google.com/u/107398878481677837585/) on September 20, 2012 16:44:19_

Two enhancement requests related to Autocomplete widget
1. Use two fields value for the label name
db.TDMUSJ00.TRTRKN works fine but I want to do like db.TDMUSJ00.TRTRKN + ""("" + db.TDMUSJ00.TRTRCD + "")"" as label name.
1. Look up the data whether it's small or capital letter
   Value in the database (db.TDMUSJ00.TRTRKN) is all capital and autocomplete doesn't look up the data when user type by small letters. Please provide any additional information below. https://groups.google.com/forum/?fromgroups=#!topic/web2py/udfbnKcfDBM

_Original issue: http://code.google.com/p/web2py/issues/detail?id=1022_
"
626,Querying on 1:M Relationships in Grid  and Smartgrid,2015-01-26T20:16:36Z,2015-10-13T20:06:42Z,"enhancement, imported, Priority-Medium",,,"_From [mike.leo...@gmail.com](https://code.google.com/u/109626380233121956961/) on September 05, 2012 22:07:38_

Hello,

We're building a web2py application that leverages SQLFORM.smartgrid heavily.  Out of the box, this does not support filtering on 1:M relationships, or reference fields on the model. We understand the concerns about this: It could potentially be a huge performance hit, especially if the related table has a large number of rows.

On the other hand, this functionality is very valuable. Being able to filter on related tables is a very common need in applications.  Often, users need to filter on ""lookup"" tables that have a relatively small number of rows, and the performance hit is negligible. This is a very common feature in Django, and in Rails admin interfaces like ActiveScaffold and RailsAdmin.

Example:

Given a model like this:

db.define_table('book',
    Field('user_id', 'reference auth_user'),
    Field('title'),
    Field('genre'))

And a controller like this:

def index():
    grid = SQLFORM.smartgrid(db.book)
    return dict(grid=grid)

The query interface will look like this by default: http://i49.tinypic.com/2ugjt02.jpg Note how this includes title and genre, but not the auth_user reference.

We patched web2py to allow to for 1:M reference fields in the query interface. The resulting interface and generated query look something like this: http://i46.tinypic.com/28taq74.png Here is our simple patch to allow searching on reference fields like this (web2py version 1.99.7): https://gist.github.com/ff543a5c6d3bc14b9079 This is obviously NOT ready for production; it's a simple proof of concept.  Note the potentially very expensive ""ALL"" query. Because of the performance risks, something like this only makes sense if developers can opt in, i.e. explicitly say so if they want to include a given reference field in the query interface.
1. Would the web2py maintiners be interested in a feature like this if it is opt-in?  I'm willing to devote some time to submit a more robust patch if I could get some guidance.
2. I also have a simple implementation for querying on list:reference fields that I can share as well.

Finally, I just want to thank the web2py team. I've really enjoyed using the framework and hope to help out as much as I can.

Thanks,
Mike Leone
Principal, Engineering
Panoptic Development, Inc.

-----------------------

On Friday, August 31, 2012 5:48:17 PM UTC-4, Massimo Di Pierro wrote:
Hello Mike,

thanks for your patch? Would you please attach it to a google code issue so we do not forget. We cannot add new feaures until all 2.0.x issues have been resolved.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=979_
"
625,Add native edit support in SQLFORM.factory,2015-01-26T20:16:29Z,2015-09-22T20:32:29Z,"enhancement, imported, Priority-Medium",,,"_From [paolo.va...@gmail.com](https://code.google.com/u/107767337307670204068/) on September 04, 2012 09:27:23_

What steps will reproduce the problem? 1. SQLFORM.factory works great to create form with fields belonging to several tables.  The form generated allow user to just insert data, you are not able to edit preexisting 
2. A quite dirty and verbose way to do so is to change the default values of the fields before creating the form. https://groups.google.com/d/topic/web2py/wZHn9oiL1ZQ/discussion 3. What is the expected output? What do you see instead? The expected output is a form with inside the data that can be modified What version of the product are you using? On what operating system? Trunk, ubuntu 12.04 Please provide any additional information below.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=975_
"
624,include does not works combined with super in template blocks,2015-01-26T20:16:11Z,,"enhancement, imported, Priority-Medium",,,"_From [rochacbruno](https://code.google.com/u/rochacbruno/) on September 03, 2012 03:34:11_

What steps will reproduce the problem? 1. create a side file for the menu

# views/sidebar.html
<ul><li>Main</li></ul>
1. Create a block on layout.html and inside the block put {{include ''}}
   {{block sidebar}}
   <h1> Sidebar </h1>
   {{include 'sidebar.html'}}
   {{end}}
2. Now go to any view and try to override the block extending super
   # views/default/index.html

{{extend 'layout.html'}}
{{block sidebar}}
   {{super}}
   <ul>
      <li> a menu </li>
   </ul>
{{end}} 

What is the expected output? 

<h1> Sidebar </h1>
<ul><li>Main</li></ul>
   <ul>
      <li> a menu </li>
   </ul>

What do you see instead?

<h1> Sidebar </h1>
   <ul>
      <li> a menu </li>
   </ul> Please use labels and text to provide additional information. using {{super}} ignores the {{include ''}} that extended block has.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=971_
"
623,SQLFORM.factory + Multiple Tables + Upload Field + GAE Blob Problem,2015-01-26T20:15:46Z,,"bug, imported, Priority-Medium",,,"_From [KJungHyun](https://code.google.com/u/KJungHyun/) on August 21, 2012 07:12:47_

What steps will reproduce the problem? 1. Make two table, one should have file upload field
2. Make a form with the two tables with SQLFORM.factory
3. Upload file through the form on GAE
4. file_blob of a table is None What is the expected output? What do you see instead? file_blob should have binary data.
But the blob is None.
It occurs only with GAE server + SQLFORM.factory + Multiple Tables What version of the product are you using? On what operating system? 1.99.7 stable, I tested on Windows 7 and OS X. Please provide any additional information below. This issue was asked here. https://groups.google.com/forum/?fromgroups=#!topic/web2py/yUtVm40eGwk

_Original issue: http://code.google.com/p/web2py/issues/detail?id=948_
"
622,oauth2 improvement,2015-01-26T20:15:25Z,,"enhancement, imported, Priority-Medium",,,"_From [massimo....@gmail.com](https://code.google.com/u/111721297562664670951/) on August 15, 2012 02:46:40_

integrate with https://github.com/demianbrecht/sanction/blob/master/example/server.py

_Original issue: http://code.google.com/p/web2py/issues/detail?id=933_
"
621,Support for HTTP Digest Authentication,2015-01-26T20:14:44Z,2015-05-03T13:57:33Z,"enhancement, imported, Priority-Medium",,,"_From [Alec.Tay...@gmail.com](https://code.google.com/u/102483133075352664946/) on July 03, 2012 17:37:36_

Problem:
I'm building mobile apps using PhoneGap, whose frontend cannot be generated server-side using web2py views (templates).

Solution:
Build the frontend using JavaScript with JSONRPC calls to the web2py server. Control authentication using the RFCified Digest Access Authentication.

Example (from http://en.wikipedia.org/wiki/Digest_access_authentication ):

‚Ä¢ The client asks for a page that requires authentication but does not provide a username and password. Typically this is because the user simply entered the address or followed a link to the page.
‚Ä¢ The server responds with the 401 ""client-error"" response code, providing the authentication realm and a randomly-generated, single-use value called a nonce.
‚Ä¢ At this point, the browser will present the authentication realm (typically a description of the computer or system being accessed) to the user and prompt for a username and password. The user may decide to cancel at this point.
‚Ä¢ Once a username and password have been supplied, the client re-sends the same request but adds an authentication header that includes the response code.
‚Ä¢ In this example, the server accepts the authentication and the page is returned. If the username is invalid and/or the password is incorrect, the server might return the ""401"" response code and the client would prompt the user again.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=872_
"
620,Clarify the implications of reloading routes and/or using symlinks in the applications folder.,2015-01-26T20:14:25Z,2015-09-21T20:49:57Z,"enhancement, imported, Priority-Medium",,,"_From [douglas....@gmail.com](https://code.google.com/u/110212829783450100486/) on June 11, 2012 05:57:55_

I've spent far too much time trying to figure out if it is safe to use symlinks in the application folder.
What I've learned is that they are OK so long as they don't change while the server is running.
Similarly, reloading routes may cause problems on an active server.

Propose the following changes to The Book:

In http://web2py.com/books/default/chapter/29/4 In the section that talks about 'track changes', it seems to imply that all modules would be reloaded if changed. I assume from the language there that would include routes.py - I think that should be mentioned there as a concern to turning on track_changes on a production server if routes.py might be modified.

In the section that talks about Application init:
'Make a symbolic link from ""applications/init"" to your application's folder.'
Add: (Note: changing where the symbolic links points while web2py is running is not supported and could cause hard to find errors.)
or words to that effect

In the section on URL rewrite, where it says:
Notice that if you edit routes.py, you must reload it. This can be done in two ways: by restarting the web server or by clicking on the routes reload button in admin. If there is a bug in routes, they will not reload.
Add: (Note: reloading routes while web2py is running is not supported and could cause hard to find errors. Note also that setting track_changes can result in routes being reloaded whenever the routes file is changed, and this is also not supported)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=847_
"
619,Admin application-creating wizard's style for creating auth_user...,2015-01-26T20:14:12Z,,"enhancement, imported, Priority-Medium",,,"_From [douglas....@gmail.com](https://code.google.com/u/110212829783450100486/) on June 06, 2012 17:55:23_

I ran into a problem of my own creation when playing with an application that I generated using the admin application-creating wizard, which is how I stumbled onto this.

The appwizard creates a db.py for defining the auth_user table based on the web interaction, but it does so using a full-specified auth_user table definition instead of using the extra_fields capability.

It's probably just a matter of keeping all the moving parts in sync, but I wanted to create this issue so it doesn't get forgotten about.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=842_
"
618,Implement DAL list types as postgresql array types,2015-01-26T20:13:54Z,2015-01-28T22:30:18Z,"enhancement, imported, Priority-Medium",,,"_From [lewis_le...@hotmail.com](https://code.google.com/u/105606139747716317932/) on June 05, 2012 02:49:57_

Improve performance, especially for searching. 

Use backend specific implementation as already done for GAE 

Thanks for considering

_Original issue: http://code.google.com/p/web2py/issues/detail?id=835_
"
617,cron job request.folder is relative path name only,2015-01-26T20:13:35Z,2016-07-11T08:31:17Z,"bug, imported, Priority-Medium",,,"_From [simo...@gmail.com](https://code.google.com/u/115616376796056978244/) on May 31, 2012 21:35:36_

Fairly minor issue but with a cron request then request.folder is applications/myap

For all other requests request.folder provides the full path e.g. C:/web2py/applications/myap/

_Original issue: http://code.google.com/p/web2py/issues/detail?id=827_
"
616,Bug  when using external folders with option -f,2015-01-26T20:13:28Z,2015-11-23T13:03:48Z,"bug, imported, Priority-Medium",,,"_From [jredr...@gmail.com](https://code.google.com/u/114361343036436419611/) on May 11, 2012 12:35:19_

When using web2py with the ""-f"" option, it doesn't import correctly the files in the modules directory of the applications.
I.E.
python web2py.py -f /myprojects/web2py -a hello

starts web2py correctly, but trying to use

import test as a shortcut for from applications.appname.modules import test.

as explained at http://www.web2py.com/books/default/chapter/29/4?search=applications.appname.modules is not possible.

Actually, I think this has never worked

_Original issue: http://code.google.com/p/web2py/issues/detail?id=791_
"
615,Smart query (SmartGrid) errors with REST in GAE and datetime greater than query  (when time is not included),2015-01-26T20:13:26Z,,"bug, imported, Priority-Medium",ValueError,ValueError: invalid literal for int() with base 10: '' in version 1.99.7 and also in modified Trunk.,"_From [douglasw...@gmail.com](https://code.google.com/u/115813779162086248652/) on April 19, 2012 23:15:54_

What steps will reproduce the problem? 1. Create a table with a datetime field, and populate it with correct datetime data using the database administration console. I have called my table call below.
2. Create a smartquery REST interface. Something like:

@request.restful()
#@auth.requires_login()
def calldatasmart():
    response.view = 'generic.'+request.extension
    def GET(search):
        try:
            rows = db.smart_query([db.call],search).select()
            return dict(result=rows)
        except RuntimeError:
            raise HTTP(400,""Invalid search string"") 
    return locals()
1. In web2py on SQLlite you can call the REST interface with just a date query and it will work:
   If I put in: 

http://localhost:8000/api/calldatasmart.json?search=call.start is greater than ""2010-03-14""
I get a valid response.

In web2py on GAE, (and populate data in table call as above) when calling the same REST interface with just a date query, I get an error, however with a datetime query I get an error:

http://localhost:8000/api/calldatasmart.json?search=call.start is greater than ""2010-03-14""
Errors with 

ValueError: invalid literal for int() with base 10: '' in version 1.99.7 and also in modified Trunk.

http://localhost:8080/api/calldatasmart.json?search=call.start is greater than ""2010-03-14 20:58:54""
IT WORKS PERFECTLY, at least in the TRUNK - note have not tried this in 1.99.7 yet (however I hope it works) What is the expected output? What do you see instead? In GAE when I smartquery using a date only, I expect GAE and SQLLite to work the same. i.e. that it either returns a Null set or a valid row from the table. Similarly the query with datetime should work. Note I now know that a datetime request will work it seems so I can go forward as can others. What version of the product are you using? On what operating system? I tested this in 1.99.7 and also in the Trunk from as of at 18th April 2012. Please provide any additional information below. Massimo requested I create this bug, although as I said the workaround is fine for GAE, although it is not consistent that the call works in SQLLite and not in GAE.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=769_
"
614,Executing a select query on a latin-1 table with utf-8 character creates internal error,2015-01-26T20:13:19Z,,"bug, DAL, imported, Priority-Medium",InternalError,"InternalError: (1267, u""Illegal mix of collations (latin1_swedish_ci,IMPLICIT) and (utf8_general_ci,COERCIBLE) for operation '='"") What version of the product are you using? On what operating system? 1.99.4 on debian linux Please provide any additional information below. I tried setting the optional argument db_coded = 'latin1' when creating the DAL object, but this does not improve the situation","_From [blomqvis...@gmail.com](https://code.google.com/u/112186836547520256818/) on March 30, 2012 13:57:43_

What steps will reproduce the problem? 1. Set up a mysql database with a table using latin-1 
2. Create a page with a form that executes a select on this table
3. Input some character in the form that isn't in latin-1, such as ≈ã (alt-gr + u on linux, u'\u014b' in unicode) What is the expected output? What do you see instead? The request should not generate an internal error. The resulting ticket says: 
InternalError: (1267, u""Illegal mix of collations (latin1_swedish_ci,IMPLICIT) and (utf8_general_ci,COERCIBLE) for operation '='"") What version of the product are you using? On what operating system? 1.99.4 on debian linux Please provide any additional information below. I tried setting the optional argument db_coded = 'latin1' when creating the DAL object, but this does not improve the situation

I'm not sure what the desired result would be if you do this in a form though

_Original issue: http://code.google.com/p/web2py/issues/detail?id=744_
"
613,Link to Chrome extension that auto-opens error tickets,2015-01-26T20:13:11Z,2016-07-11T08:30:53Z,"enhancement, imported, Priority-Medium",,,"_From [tolaythi...@gmail.com](https://code.google.com/u/111288246042800407148/) on March 24, 2012 22:57:49_

Massimo asked me to make this ticket for him.

I wrote a Chrome extension that watches connections to localhost for web2py error pages. When it finds such a page, it creates an iframe and loads the ticket in the iframe. Saves me time and trouble during development. Massimo is going to add a link to the docs.

Source code is on github at https://github.com/agarden/web2py-devmode-chrome . A packed extension is on the download page: https://github.com/agarden/web2py-devmode-chrome/downloads .

_Original issue: http://code.google.com/p/web2py/issues/detail?id=732_
"
612,Using Translations in non-web based api's,2015-01-26T20:12:47Z,,"enhancement, imported, Priority-Medium",,,"_From [bruce.w...@gmail.com](https://code.google.com/u/108865490451280293922/) on March 20, 2012 16:41:53_

What steps will reproduce the problem? 1. Create a standalone python file, that uses DAL
2. Create a console application which tests the api in step 1
3. Need to translate the output What is the expected output? What do you see instead? Ideally would like to be able to use Translations with or without an output. Instead I found out you require an request to use API in a self contained script. What version of the product are you using? On what operating system? 1.99.7 Please provide any additional information below. Attached is an example application. The Console output and menu I would like to be able to translate.

Required: gluon must be in your python path.

**Attachment:** [api.py](http://code.google.com/p/web2py/issues/detail?id=725)

_Original issue: http://code.google.com/p/web2py/issues/detail?id=725_
"
611,"Suggestion: Add ""expecting version"" field for app, to allow changing defaults.",2015-01-26T20:12:22Z,2016-07-25T10:14:37Z,"enhancement, imported, Priority-Medium",,,"_From [i.like.p...@gmail.com](https://code.google.com/u/110204180798759823131/) on March 09, 2012 07:30:09_

web2py has maintained excellent backwards compatibility so far. However, sometimes, behavior SHOULD be changed. e.g., the response.generic_patterns default was changed because of a security problem, and this caused applications to break.

Suggested solution: add a call

web2py_configuration(version, ...) to the application's **init**.py file which states the assumptions of this version, e.g.

web2py_configuration(version=(1,99,4))

or alternatively a to a new CONFIG file int he web2py/applications/appname directory.

If there has been a breaking change, web2py could revert to old behavior and give a warning, or abort if there is no possible way to do that (or undesirable to do that).

e.g.

```
if global.web2py_configuration.version \< (1,94.1):
    warn(""Generic responses introduce a vulnerability. Please upgrade your app, notes at: http://web2py.com/upgrade-through-1-94-1"" )
    if global.web2py_configuration.if_vulnerable == 'Do not abort, I know what I am doing and take full responsibility':  response.generic_patterns = ['*']
    else: raise Exception('Need changes, see warnings')
```

(an example that would let the user ignore vulnerabilities by an elaborate setting; might not be a good idea).

Now, make the wizard insert the current version number in the **init**.py or CONFIG file; Refuse running if there is no version information (or alternatively, warn about it and assume 1.99.7). Make the user edit the file manually (or through the app admin) when they have done the upgrade.

Breaking changes I would _like_ to see:
- default sqlite setting to ""pragma foreign_keys=1;"" to enforce foreign key constraints. (I set it in my apps, but I think it should be default)
- default ondelete_action changed to 'RESTRICT' (or at least selectable). I personally set it to restrict always, because on a cross-linked database model, it is easy to accidentally cascade-delete millions of records when you are only trying to delete one.
- default for migration is off. migration can be enabled like today by changing the migrate=... flag, or through the admin app (in which case it turns off automatically after a transaction with a successful migration has occured)
- experimental features need to be turned on explicitly (e.g. a ""require_experimental=['feature1', 'feature2', ...] in web2py_configuration)
- optionally switching db query result set from list() to generator/iterator.

You might not agree with about these changes, but putting infrastructure for future-proofing is a good idea regardless of the specific breaking changes.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=702_
"
610,table format is not used if it is defined later than the reference,2015-01-26T20:12:15Z,2015-09-21T20:50:54Z,"DAL, enhancement, imported, Priority-Medium",,,"_From [i.like.p...@gmail.com](https://code.google.com/u/110204180798759823131/) on March 09, 2012 05:31:33_

What steps will reproduce the problem? 1. t1 = db.define_table('t1', Field('a', 'reference t2'))
2. t2 = db.define_table('t2', Field('a', 'string'), format='t2:&#37;(a)s') What is the expected output? What do you see instead? I expect t1.a.represent to use the t2 format, but it doesn't. If I reverse the order of the definitions, it works as expected.

If the tables have circular or mutual references, there is no order in which everything will work. What version of the product are you using? On what operating system? all Please provide any additional information below. The problem is that sqlhtml_validators() is applied at t1 definition time, when t2 does not exist yet (and therefore the format cannot be made to represent). My temporary solution: after all tables are defined, I fix representations with the following function:

```
from gluon.dal import sqlhtml_validators
def dalfix(tables, fields):
    for t in tables:
        for f in fields:
            t[f].requires = sqlhtml_validators(t[f])
```

And in this case, the fixing call would be:

```
dalfix([db.t1], ['a'])
```

(I use lists because in the real app I have multiple tables and multiple repeating fields to fix)

Note this this is related to issue `#648` , which was marked as a duplicate (of `#649`) but is not a duplicate and is still unsolved (but I cannot find a way to reopen). The discussion there offers a possible way to a solution.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=700_
"
609,Dynamic css injection feature,2015-01-26T20:11:56Z,2015-09-22T20:33:27Z,"enhancement, imported, Priority-Medium",,,"_From [RayLuo....@gmail.com](https://code.google.com/u/108081545747024445571/) on February 15, 2012 07:39:02_

Purpose of code changes on this branch: There are times that some pages of our app will be loaded inside an iframe (rather than in the main page via LOAD(..., ""foo.load"", ajax=True)). In this situation we will hope the loaded page displays no header, footer, topbar.

Instead of maintaining two independent copies of full-stuff page and contents-only page, I come up with a trick to let one same page have different appearances, controlled by different url parameters.

The normal, full-stuff page: http://my_site/app/cont/action

The contents-only page: http://my_site/app/cont/action#_css_injection_begin_ .header, .footer, .topbar, #header, #footer, #statusbar {display:none} _css_injection_end_

This feature is achieved by following code at the end of generic.html (or layout.html if you prefer):

<script><!-- Dynamic css injection. Called by url?..._css_injection_begin_.header,.footer,.topbar{display:none}_css_injection_end_ to hide those components. -->
var matched = new RegExp('_css_injection_begin_(.+)_css_injection_end_').exec(location.href);
if(matched){
    document.write(""<style>""+unescape(matched[1])+""</style>"");//Python escapes comma and colon, decodeURL() does not unescape them back, but unescape() does.
}
</script>

_Original issue: http://code.google.com/p/web2py/issues/detail?id=662_
"
608,Update legacy table using primarykey failed which type is not string failed,2015-01-26T20:11:55Z,,"bug, DAL, imported, Priority-Medium",SyntaxError,SyntaxError: user is tampering with form's record_id: {'mykey': ,"_From [ochib...@gmail.com](https://code.google.com/u/107398878481677837585/) on February 10, 2012 16:29:16_

It will failed with the follwing error. It works fine if the field type is string in web2py and varchar in MSSQL.

From the syntax error, it's ignore the 
'integer' from define_table and always tried with string... 

TRACEBACK 
----------------------------- 
SyntaxError: user is tampering with form's record_id: {'mykey': 
'111'} != {'mykey': 111} 

What steps will reproduce the problem? (Tested with MSSQL Server)
1. Create table
   CREATE TABLE [dbo].[Test]([mykey] [int] NOT NULL, 
       [myvalue] [varchar]%2850%29 NULL, 
   CONSTRAINT [PK_Test] PRIMARY KEY CLUSTERED 
   %28 
       [mykey] ASC 
   %29WITH %28PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY 
   = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON%29 ON [PRIMARY]) ON [PRIMARY] 
2. Add record
   mykey = 111
   myvalue = 'AAA' 
3. Model - define table
   db.define_table('Test', 
   Field('mykey','integer'), 
   Field('myvalue'), 
   primarykey=['mykey']) 
4. Contoller
   def index(): 
   form=crud.update(db.Test,db.Test(db.Test.mykey==111)) 
   return dict(form=form) 
5. View (default/index)
   {{extend 'layout.html'}}
   {{=form}} What is the expected output? What do you see instead? No error What version of the product are you using? On what operating system? Version 1.99.4 (2011-12-14 14:46:14) stable Please provide any additional information below. Forum link https://groups.google.com/group/web2py/browse_thread/thread/9df8d6b842594735/30bb082a5d5443e6#30bb082a5d5443e6

_Original issue: http://code.google.com/p/web2py/issues/detail?id=656_
"
607,Unique fields break table inclusion (inheritance),2015-01-26T20:11:25Z,,"bug, DAL, imported, Priority-Medium",,,"_From [i.like.p...@gmail.com](https://code.google.com/u/110204180798759823131/) on February 06, 2012 12:51:19_

What steps will reproduce the problem? 1. a = DAL.Table('a', 'u', 'string', unique=True)
2. b = DAL.define_table('b', a)
3. use x in form (or appadmin) What is the expected output? What do you see instead? Being able to use table 'b' with sqlform; but the IS_IN_DB() is put into the requires with respect to the (nonexistent) table 'a', which of course fails. What version of the product are you using? On what operating system? Any Please provide any additional information below. Simple sidestep: make the inherited field have ""requires=[]"" to disable automatic requires computation (and it can be added manually if it is needed)

In the database, uniqueness is enforced with respect to 'b', but in web2py in respect to 'a'; web2py should either not try to enforce this, or try to enforce this with respect to 'b'.

This is easy to do for non-db tables -- just keep the requires at DEFAULT until the real table is instantiated (and let _that_ compute requires).

With non-db tables, it's not as simple; not sure how to solve it.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=648_
"
606,SQLFORM.factory and upload field - uploadfolder,2015-01-26T20:11:23Z,,"bug, imported, Priority-Medium",,,"_From [ato.st...@gmail.com](https://code.google.com/u/117176497741954485102/) on January 03, 2012 22:36:32_

What steps will reproduce the problem? 1. See the first example here: http://web2py.com/books/default/chapter/29/7#SQLFORM.factory 2. it doesn't mention that the uploadfolder argument is required
3. If you pass garbage or a string that doesn't point to a folder, the file is not uploaded and saved.

What is the expected output? What do you see instead?  I feel that uploadfolder should NOT be required, as the example would imply.  But, if it is determined that uploadfolder is necessary then it should validate the folder that is passed and raise an exception if for some reason it cannot save the file there.  

Instead, I'm seeing that I can pass gibberish to the argument and the file is then not saved. What version of the product are you using? On what operating system? Trunk, updated around 8:30 central on 1/3/2012. Please provide any additional information below. In my opinion the uploadfolder arg should be optional.  In my situation, I'm processing the uploaded file (reading through a csv) and do not want it stored on the server, my code handles the processing and saving.  

Also, there should be some way to define an application-wide default.

If the uploadfolder arg is passed, then it needs to be validated to ensure that we can store a file there.  If the file is not successfully stored to the specified server location, and exception should be raised.

There are situations where one wants to specify an upload file, but does not want it to be automatically stored on the server.  Therefore, maybe another parm should be available to tell web2py not to save it after it is processed.

You can reference this discussion for more info: http://groups.google.com/group/web2py/browse_thread/thread/1444da35d5e12592/3c21747e67c1eb9f#3c21747e67c1eb9f

_Original issue: http://code.google.com/p/web2py/issues/detail?id=597_
"
605,"SQLFORM.grid/SQLTABLE does not work without ""id"" field",2015-01-26T20:10:53Z,2015-09-21T20:52:04Z,"bug, imported, Priority-Medium",,,"_From [ochib...@gmail.com](https://code.google.com/u/107398878481677837585/) on December 01, 2011 16:31:53_

What steps will reproduce the problem? 1. Create table without id field but another primary key field
2. Define table using primarykey
3. Create SQLFORM.grid or SQLTABLE just like you normally do What is the expected output? What do you see instead? They are great features and I want them to support primarykey. Otherwise, you can not really use the existing tables for it. In my case, no tables has ""id"" field. What version of the product are you using? On what operating system? Version 1.99.2
Tested with DB2 and SQL Server 2008 Please provide any additional information below. https://groups.google.com/group/web2py/browse_thread/thread/f069cefe96e0e08a/844522760b98572f?lnk=gst&q=What&#37;27s+the+best+way+to+paginate+without+SQLFORM.gird+&#37;3F+Options+#844522760b98572f

_Original issue: http://code.google.com/p/web2py/issues/detail?id=547_
"
604,datetime precision is silently truncated by web2py,2015-01-26T20:10:28Z,2015-12-29T19:37:29Z,"bug, imported, Priority-Medium",,,"_From [i.like.p...@gmail.com](https://code.google.com/u/110204180798759823131/) on December 01, 2011 00:40:38_

What steps will reproduce the problem? 1. create a table with a datetime column
2. insert a datetime value that has fractional seconds, e.g. value=datetime.datetime(2011,11,30,10,20,30,345678) or most likely value=datetime.datetime.now(), using table.insert(datetimecol=value)
3. check database directly, and you'll see that the fractions are missing.
4. insert using string notation table.insert(datetimecol=value.isoformat())
5. check database directly, and you'll see that the values _are_ in database
6. load the database row back 'print table[1].datetimecol' and see that the fractions are gone
7. export datetime value as csv and json, and observe that the fractions are silently truncated as well. What is the expected output? What do you see instead? Expected output is: when using a datetime value with fractional seconds, either the insert fails or the fractional seconds get to the database. When selecting, if the database has fractional seconds, I expect them to be retrieved and not silently truncated.
Similarly, I expect csv export followed by truncate followed by import to return a table to its existing state, without silently truncating values. What version of the product are you using? On what operating system? 1.99.2 (but it's been this way since at least 1.95), on Ubuntu 10.04 and on Win7 Please provide any additional information below. Not all databases support fractional seconds in datetime: sqlite, postgres do; oracle, mysql, db2 don't. 

Specifically on sqlite, if you force sqlite to do the string->datetime translation (by passing driver_args={'detect_types': sqlite3.PARSE_DECLTYPES}), and you always insert the values as string, then you actually get fractional seconds. But you're still getting truncated in csv and json exports, perhaps also xml.

Suggested solution:
1. refactor datetime<->text and text<->datetime conversions; these are currently repeated in
   serializers.py once (json serialization), tools.py once (csv output), dal.py (base represent(), oracle/informix/db2 represent_exceptions(), Rows as_dict(), Rows export_to_csv_file none_exception; parsing repeated in parse() and GoogleSQL code); and make them hookable so that an app can request higher precision handling if needed; also mark in adapter that this resolution is NOT AVAILABLE on Oracle, MySQL, etc. and trigger error if time has second fractions.
2. Just add a warning/error in all the places where second fractions are silently dropped

I would much prefer option (1), but (2) is the lesser of two evils.

If I submit a patch that does (1), will it be accepted? if not, will you accept a patch that does (2)?

See also discussion in < https://groups.google.com/d/topic/web2py/ddBzw0VgDnA/discussion >

_Original issue: http://code.google.com/p/web2py/issues/detail?id=542_
"
603,Adapter to OrientDB,2015-01-26T20:09:49Z,2015-12-29T19:36:41Z,"enhancement, imported, Priority-Medium",,,"_From [yanosh...@gmail.com](https://code.google.com/u/102304726775744565779/) on September 03, 2011 20:23:02_

What steps will reproduce the problem? 1. 2. 3. What is the expected output? What do you see instead? What version of the product are you using? On what operating system? Please provide any additional information below. I wish to collaborate on/test one as I am not a super Python pro yet.  This Document-Graph database has a SQL syntax, RESTful interface, and the Gremlin graph traversal language bundled into it.

That brings untold power to web2py to store/retrieve schema-less, schema-mixed and schema-full data which can be traversed orders of magnitude faster than traditional RDBMS.

ACID, transactions, network pooling, more that I haven't discovered yet.

Thank you all for your work.  web2py is the best and adding OrientDB communication to it would make heads explode across the globe.

_Original issue: http://code.google.com/p/web2py/issues/detail?id=407_
"
602,Fulltext search support in web2py,2015-01-26T20:09:32Z,2015-05-04T21:32:58Z,"enhancement, imported, Priority-Medium",,,"_From [elff...@gmail.com](https://code.google.com/u/115166821933243869368/) on February 18, 2011 11:03:54_

sqlite supports full text search http://www.sqlite.org/fts3.html ""FTS4 is an enhancement to FTS3. FTS3 has been available since SQLite version 3.5.0 in 2007-09-04. The enhancements for FTS4 were added with SQLite version 3.7.4 on 2010-12-08.""

full text search is also supported in 

mysql: http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html sql server: http://msdn.microsoft.com/en-us/library/ms142571.aspx oracle: http://download.oracle.com/docs/cd/B28359_01/text.111/b28304/cqrypkg.htm postgresql: http://www.postgresql.org/docs/8.3/static/textsearch.html and so on, but I think this list is enough to add full text search capabilities in DAL

_Original issue: http://code.google.com/p/web2py/issues/detail?id=197_
"
601,Bug fix SQLFORM.factory,2015-01-25T21:56:21Z,2015-01-27T07:25:11Z,,,,"...was crashing with a NameError. Import at the module level doesn't seem to work.
"
600,Issue 2037: apply truncate correctly,2015-01-25T19:03:33Z,2015-01-25T19:15:22Z,,,,
599,From DAL to pyDAL as git submodule,2015-01-25T12:40:20Z,2015-01-25T18:13:08Z,,,,"Implementation strategy:
- git submodule in `gluon/packages/dal`
- pyDAL module import to sys.modules in `gluon/__init__.py`

Major changes in web2py:
- dal imports rewrite
- DAL subclassing to add web2py's features
- pyDAL exceptions handling
- removed old DAL tests
- `RuntimeError` exception when pydal is not available
- introduced specific web2py DAL tests (to be expanded)

TODO:
- check applications for old imports
- check contrib modules for old imports
"
598,Script for centos7 now also installs 'unzip' package,2015-01-23T10:30:05Z,2015-01-23T18:10:47Z,,,,"Some virtual server providers (like DigitalOcean) do not have unzip
installed in their centos7 image so we need to install it in our script.
"
597,Add support for ST_SimplifyPreserveTopology,2015-01-22T11:46:57Z,2015-01-23T18:10:18Z,,,,
596,Issue 2035: Fix the caching on Windows,2015-01-21T18:08:06Z,2015-01-23T18:09:48Z,,,,"Issue 2035: Fix the caching on Windows - issue with filenames greater than 256 chars""
"
595,DAL imports portalocker from gluon to avoid conflict with another portal...,2015-01-21T14:44:26Z,2015-01-21T15:33:11Z,,AttributeError,AttributeError: 'module' object has no attribute 'LockedFile',"...ocker module

web2py 2.9.12 started failing with error
  File ""/usr/srv/web2py/gluon/dal/adapters/base.py"", line 146, in file_open
    fileobj = portalocker.LockedFile(filename,mode)
AttributeError: 'module' object has no attribute 'LockedFile'

The ""portalocker"" module in web2py was conflicting with another ""portalocker"" module we have installed: https://pypi.python.org/pypi/portalocker

This commit modifies gluon/dal/_load.py to import portalocker from gluon.
"
594,auth.settings.*_case_sensitivity support for password retrieval,2015-01-21T00:51:51Z,2015-01-21T15:32:34Z,,,,"There is a missing IS_LOWER() validator when username or email should be validated without case sesitivity.
"
593,Issue/2035: cache to support filenames greater than 256 chars on Windows,2015-01-20T19:46:12Z,2015-01-21T14:00:32Z,,,,
592,Make app_cleanup use recursive_unlink to clean the cache folder. This fi...,2015-01-19T23:51:59Z,2015-01-21T15:32:01Z,,,,"...xes a bug with the admin cleaning of an app seen here:

https://groups.google.com/d/msg/web2py/YMpbAlMLln8/VFuY_xQ7WFYJ
"
591,Fix: Exporting from a SQLFORM.grid with customized search queries,2015-01-16T15:43:09Z,2015-01-16T19:06:26Z,,,,"Massimo manually committed older diff file [ Commit ID: c6cc06f6c033ae8a8d24bbe6a677d26414ba96e3 ]
He also merged my optimized code diff file [Commit ID: 5958704509ca8cd37def98822a46ecd741b99068] 
some code got repeated because of this.

I've removed and tested redundant code.
"
590,Fix: Exporting from a SQLFORM.grid with customized search queries,2015-01-15T16:34:01Z,2015-01-16T14:51:58Z,,,,
589,fix issuer comparison,2015-01-14T12:16:59Z,2015-01-14T17:07:28Z,,,,"the issuer looks like gmail.login.persona.org and the expected value was login.persona.org
"
588,Initial simple change for adding geospatial support to Teradata adaptor.,2015-01-14T01:34:53Z,2015-01-14T17:06:38Z,,,,"1.  Initial Step to add Geospatial support to Teradata dal adaptor.  Using Postgres as a guide. Not functional by itself.
2.  First time use of github so this is just a simple test of my use of github forks and sourcetree (mac).   Feedback welcome.
"
587,fix import issue for gluon classes (ie: from dal import DAL),2015-01-13T20:09:47Z,2015-04-02T21:26:43Z,,,,"This PR makes
- the following two import to load the same class

```
from dal import DAL
from gluon import DAL
```
- allows users to have an app-module called as one in gluon/\* without conflicts (i.e.: tools.py)
- allows us to have a contrib module which internally has an import to other internal module called as one in gluon/\* (This weird case happens for simplejson which has a module called decorator)
"
586,Initial tests for auth,2015-01-12T08:16:03Z,2015-01-16T14:43:40Z,,,,
585,fix issue 2023: common_filter issue in _enable_record_versioning,2015-01-10T17:12:11Z,2015-01-11T02:40:26Z,,,,
584,GoogleSQLAdapter: Fix NDB orderby without limitby broken in 2.9.6,2015-01-10T01:52:01Z,2015-01-11T02:36:46Z,,,,"Commit 8d648f6137cea5 (""restore beahvior in gae that if no limitby,
returns iterator"") made select_raw() store the query iterator in a
wrong variable (""rows"", which is unused, should be ""items""), causing
unsorted results to be returned.

Fix the assignment.
"
583,fixes issue 2025 - Encode filenames using base32 if you're running on wi...,2015-01-07T21:38:40Z,2015-01-11T02:35:43Z,,,,"...ndows to avoid invalid characters.
"
582,Catalan translation for messages of Welcome app of web2py,2015-01-06T20:43:59Z,2015-01-11T02:35:24Z,,,,"Catalan translation for messages of Welcome app of web2py
"
581,added support for POST variable passing to LOAD function,2015-01-03T20:13:39Z,2015-01-05T20:17:24Z,,,,"A new post_vars parameter allows controllers to pass POST varaibles through LOAD as appropriate. GET variables are currently passed by default (via vars).
"
580,Fix expression evaluation with postgres,2015-01-03T13:17:33Z,2015-01-05T20:15:45Z,,,,
579,fix issue 2003: double translation,2015-01-03T10:59:05Z,2015-01-05T20:14:44Z,,,,
578,Added grid support to export xls and xlsx documents.,2014-12-29T21:05:53Z,2014-12-29T22:14:57Z,,,,"Using pyheaderfile project [1] added xlsx and xls support to web2py grid exports.

[1] https://github.com/kappius/pyheaderfile
"
577,fix issue 2011: capital letters in it.py,2014-12-28T16:22:18Z,2014-12-29T09:38:24Z,,,,
576,more consistent badges with shields.io,2014-12-23T20:26:36Z,2014-12-25T18:16:44Z,,,,
575,Fix incorrect namespace in SOAP webservice response,2014-12-23T19:59:47Z,2014-12-25T18:16:17Z,,,,"https://code.google.com/p/pysimplesoap/issues/detail?id=168
"
574,fix issue 2027: bug in query serialization,2014-12-23T18:31:20Z,2014-12-25T18:15:17Z,,,,"discussion https://groups.google.com/d/topic/web2py/Gviq0NJIBsQ/discussion
issue https://code.google.com/p/web2py/issues/detail?id=2027
"
573,Fix bootstrap 3 icon name,2014-12-23T09:58:36Z,2014-12-23T10:01:56Z,,,,"Created one typo while trying to fix two.  Thanks Erikmontes
"
572,class typo fix,2014-12-23T04:42:22Z,2014-12-23T13:11:36Z,,,,
571,new module appconfig.py,2014-12-21T19:36:00Z,2014-12-23T04:32:35Z,,,,
570,fix issue 2029: response.stream bug with spaces in filename,2014-12-20T16:57:36Z,2014-12-23T04:31:57Z,,,,"fix suggested by @leonelcamara 
"
569,fix issue 1931: preserve vars in grid search,2014-12-19T13:53:08Z,2014-12-23T04:31:13Z,,,,"As @abastardi proposed in https://groups.google.com/d/topic/web2py/xlQfmCUZci0/discussion, I created hidden fields for all url vars but keywords and page.

This PR should fix also issue 2020

It might be useful for https://github.com/web2py/web2py/pull/548
"
568,Fix issue 1966: Avoid inserting duplicate archive records with record versioning,2014-12-19T09:38:09Z,2014-12-22T12:51:13Z,,,,
567,Fix the problem with chunked encoding with an empty body.,2014-12-19T01:55:50Z,2014-12-25T18:21:06Z,,,,"When the response body is empty, rocket won't send the final zero-length
terminating chunk for chunked encoding. I think this causes the browser
to wait for the connection close in order to tell the end of a
response. The symptom of this is that of a slow response, and it arises when, for example, one tries to use `gluon.streamer.streamer` directly, passing it an opened file object that is either an empty file or a file that has no more data to read from.
"
566,leave autocommit off,2014-12-18T23:03:13Z,2014-12-19T20:52:10Z,,,,
565,better assignment (tasks go to not running workers only). Thanks @PengfeiYu,2014-12-18T22:50:41Z,2014-12-23T04:28:26Z,,,,"- pep8 adjustments
- tasks were assigned to all ACTIVE workers... if a worker is busy processing a task, 
  there's no point on assigning tasks to it
"
564,issue 2024 response.json sets default content-type to application/json,2014-12-17T16:57:38Z,2014-12-23T04:27:43Z,,,,
563,fix cache clear with regex and tests,2014-12-16T19:44:09Z,2014-12-23T04:26:35Z,,,,"Discussion here: https://groups.google.com/forum/?fromgroups#!topic/web2py/72vUKgyDkxQ
"
562,Enable map_hyphen to work for application names,2014-12-16T12:12:20Z,2014-12-23T13:13:12Z,,,,"1) Set self.map_hyphen early in map_app(), so the first call to harg0 properly replaces hyphens with underscores.  Without this, the rewriter can't find the application, and reverts to the default

2) Disable hyphen mapping of the application when producing /static URLs.  Without this, the generated URL will be to a non-existent folder.
"
561,From DAL to new pyDAL,2014-12-15T22:15:31Z,2015-01-23T20:26:54Z,,,,"Implementation strategy:
- git submodule in `gluon/packages/dal`
- pyDAL module import to sys.modules in `gluon/__init__.py`

Major changes in web2py:
- dal imports rewrite
- DAL subclassing to add web2py's features
- pyDAL exceptions handling
- removed old DAL tests
- introduced specific web2py DAL tests (to be expanded)

TODO:
- check applications for old imports
- check contrib modules for old imports
"
560,test with_alias and basic opetarions for Expression,2014-12-15T19:03:40Z,2014-12-16T08:03:24Z,,,,
559,Fix debugger interaction due new DAL,2014-12-15T18:47:28Z,2014-12-23T04:08:11Z,,,,"Originally, **all** was used to filter DAL and Field globals, but now the new module doesn't explicity set that attribute, so this filter was removed.
Note that using **dict** as a replacement is not an option, as the new dal module exports a lot of common names like connection, base, etc.
For more info, see:
https://groups.google.com/d/msg/web2py/zbSgN5qAQi0/pBWjsv6EElAJ
"
558,Update sqlhtml.py,2014-12-15T11:04:01Z,2014-12-23T04:06:48Z,,,,"Correcting some bootstrap3 icon classes
"
557,updated _extractall (python 2.4 support was dropped),2014-12-11T13:46:18Z,2014-12-12T11:12:26Z,,,,
556,test for w2p_pack/w2p_unpack,2014-12-11T12:41:29Z,2014-12-12T11:11:15Z,,,,"Tests are against welcome app but we can add admin and examples if necessary.
"
555,Fix and initial tests for bigint,2014-12-11T12:26:44Z,2014-12-12T11:10:20Z,,`OperationalError,`OperationalError: AUTOINCREMENT is only allowed on an INTEGER PRIMARY KEY`,"In sqlite a primary autoincrement id must be defined as INTEGER. Otherwise the following error raises:
`OperationalError: AUTOINCREMENT is only allowed on an INTEGER PRIMARY KEY`
As stated here http://www.sqlite.org/autoinc.html the field will still be a 64-bit signed integer.
"
554,Make web2py's custom_import work with circular imports.,2014-12-05T21:26:33Z,2014-12-12T11:21:13Z,,,,"Ok, I believe this is how it should work.

The problem with original code that looks up `itemname` in `new_mod` is that in the case of circular import, `new_mod` won't have `itemname` because the original import that started the whole chain of imports hasn't finished yet.

For reference, previous attempt: https://github.com/web2py/web2py/pull/553
"
553,Make the custom_import work with circular imports.,2014-12-04T20:44:52Z,2014-12-05T19:48:16Z,,,,"Although circular imports isn't a good idea, I met this problem while trying to import the `pytz` package that I placed under `modules/`. Turns out `pytz` package's `__init__.py` imports `tzinfo.py` under the package which imports `pytz` again.

Since python's built-in import allows circular imports, I think web2py should support it too.
"
552,tests,2014-12-04T13:01:44Z,2014-12-10T02:59:52Z,,,,"Added tests
Fix an issue with geometry field case
"
551,Fix search widget in SQLFORM.grid for SQLCustomType values,2014-12-01T16:17:06Z,2014-12-10T02:57:21Z,,TypeError,TypeError: unsupported operand type(s) for +: 'SQLCustomType' and 'str',"Using a SQLCustomtype in sqlform.grid raises the exception: 

```
Traceback (most recent call last):
  File ""/home/pvalleri/src/web2py.ilvalle/gluon/restricted.py"", line 224, in restricted
    exec ccode in environment
  File ""/home/pvalleri/src/web2py.ilvalle/applications/welcome/controllers/default.py"", line 77, in <module>
  File ""/home/pvalleri/src/web2py.ilvalle/gluon/globals.py"", line 393, in <lambda>
    self._caller = lambda f: f()
  File ""/home/pvalleri/src/web2py.ilvalle/applications/welcome/controllers/default.py"", line 25, in index
    return dict(grid=SQLFORM.grid(db.product, user_signature=False))
  File ""/home/pvalleri/src/web2py.ilvalle/gluon/sqlhtml.py"", line 2383, in grid
    search_menu = SQLFORM.search_menu(sfields, prefix=prefix)
  File ""/home/pvalleri/src/web2py.ilvalle/gluon/sqlhtml.py"", line 1846, in search_menu
    _class=(field.type or '')+' form-control')
TypeError: unsupported operand type(s) for +: 'SQLCustomType' and 'str'
```
"
550,Fix NULL values with SQLCustomType,2014-11-30T19:07:56Z,2014-12-10T02:56:30Z,,,,"An initial fix for SQLCustomType, the current implementation stores 'None' instead of 'NULL'
Example test:

```
    db = DAL('sqlite://memory')
    from gluon.dal.helpers.classes import SQLCustomType
    simple_t = SQLCustomType(
        type = ""double"",
        native = ""double"",
    )
    db.define_table('product', 
        Field(""price_base"", ""double""),
        Field(""price_custom"", simple_t),
    )
    db.product.insert(price_base=None)    
    db.product.insert(price_custom=None)
```

The first insert works, the second fails.
"
549,added Burmese (Myanmar) localization to admin and welcome apps.,2014-11-30T04:23:01Z,2014-12-10T02:54:58Z,,,,"added Burmese (Myanmar) language.
"
548,Fix for search after sort in SQLFORM.grid (over ajax) #2020,2014-11-26T09:02:21Z,2015-02-15T22:48:15Z,,,,"https://code.google.com/p/web2py/issues/detail?id=2020
"
547,Issues/2017,2014-11-26T02:52:45Z,2014-11-28T17:05:35Z,,,,"sqlform.grid search widget uses checkboxes when adding boolean fields to a search. The javascript was returning the ""value"" of the checkbox, which ignores whether it is checked or not. 
"
546,timeout = 0 leads to erratic behaviour. ,2014-11-25T20:20:22Z,2014-11-28T17:04:52Z,,,,"Allowing timeout = 0 is to be considered unsafe
"
545,"boolean widgets in the SQLFORM.grid search widget should be ""off"" if unc...",2014-11-24T12:39:59Z,2014-11-26T01:52:16Z,,,,"...hecked.
Boolean widgets are currently always ""on"" when the search query is built. The javascript code from sqlhtml.py doesn't allow for boolean widgets as checkboxes. Using jQuery .val() always returns ""on"" regardless of the checked/unchecked nature of the checkbox. But please carefully verify this patch. My jQuery is googling StackOverflow. 
"
544,fix issue with rname and oracle. Thanks @fernando. Fixes #2013,2014-11-16T17:50:40Z,2014-11-17T05:17:41Z,,,,
543,enable dropdown-toggle when user logged in,2014-11-13T18:16:38Z,2014-11-17T05:16:19Z,,,,
542,Fix unable to sum() time fields,2014-11-13T12:29:39Z,2014-11-13T22:36:00Z,,ValueError,ValueError: need more than 2 values to unpack,"When sum() is used on time field, here the error :
ValueError: need more than 2 values to unpack

Please have a look, I hope that I made this correctly.
"
541,Added support for show_if in readonly sqlform (ex: sqlform.grid view ),2014-11-11T11:49:56Z,2014-11-17T05:15:37Z,,,,
540,streamline behaviour of component (trapped) forms with multiple submit buttons,2014-11-08T22:06:51Z,2014-11-09T15:31:31Z,,,,"this is because jquery can't know what button was pressed when the 
submit event is triggered. We circumvent it adding an hidden field before
triggering the submission

BTW: don't know why the commit seems huge. I just changed a bit the trap_form
function to handle the corner case and streamlined what disableElement, 
enableElement, disableFormElements, enableFormElements do, 
along with formInputClickSelector
"
539,table callbacks panel in admin editor,2014-11-05T09:09:52Z,2014-11-17T05:14:11Z,,,,"The panel is currently called 'hooks'
"
538,"update dependencies only if COMPLETED, allow to set status on a specific...",2014-10-30T20:58:19Z,2014-11-03T13:08:48Z,,,,"... worker
"
537,Add option of using offical ibm_db_dbi driver instead of ODBC driver for DB2 ,2014-10-24T19:28:49Z,2014-10-24T22:27:57Z,,,,"In order to take advantage of this driver, you will also have to install the IBM Data Server Driver Package and configure a DSN in etiher the db2cli.ini or the db2dsdriver.cfg files. 

And example db2dsdriver.cfg file would look like this:

```
<configuration>
   <dsncollection>
      <dsn alias=""DB2"" name=""database_name"" host=""database.host.FQDN"" port=""50000""/>
   </dsncollection>
</configuration>
```

After setting up the Data Server Driver Package and a DSN, you need to export the IBM_DB_HOME envar

```
export IBM_DB_HOME=/install/path/to/dsdriver/
```

Then you can install ibm_db from pypi

```
pip install ibm_db
```

Finally you need to set LD_LIBRARY_PATH envar to include the dsdriver/lib folder

```
export LD_LIBRARY_PATH=/install/path/to/dsdriver/lib:$LD_LIBRARY_PATH
```

You can now test the driver using Python like this:

```
import ibm_db_dbi
conn = ibm_db_dbi.connect('DB2', 'db2_user', 'db2_pass') #DB2 is the value of alias in db2dsdriver.cfg
cur = conn.cursor()
cur.execute(""SELECT current date FROM sysibm.sysdummy1"")
cur.fetchone() 
```

The corresponding new connection string in web2py looks like this: 

```
'db2:ibm_db_dbi://DSN=dsn;UID=user;PWD=pass'
```

And the updated one for ODBC connections:

```
'db2:pyodbc://driver=DB2;hostname=host;database=database;uid=user;pwd=password;port=port'    
```

Similar changes could be made for the Informix adapter since the ibm_db_db/ibm_db_dbi driver supports it however I do not have the resources to test that database. 
"
536,Fixed missing update for new DAL structure,2014-10-24T19:18:29Z,2014-10-29T18:06:52Z,,,,"Other values were updated in 5e5e649c28a4f3615f917cec3476f0c32e358777 but this was missing from that commit.
"
535,fix binaries build. thanks @David Ripplinger ,2014-10-22T20:52:38Z,2014-10-23T02:29:52Z,,,,"some freezers publish also **file** in globals()
"
534,fixes issue 1998,2014-10-21T19:35:24Z,2014-10-23T02:29:15Z,,,,
533,Cleanup: Removed presumed debug print statement.,2014-10-21T14:06:32Z,2014-10-23T02:28:35Z,,,,"I think this `print` is safe to delete.
"
532,pg8000 doesn't support json at all,2014-10-18T18:22:16Z,2014-10-23T02:28:12Z,,,,
531,Fix for sanitize('&#x27;') returning '&amp;#x27;' instead of '&#x27;',2014-10-18T11:40:00Z,2014-10-23T02:25:49Z,,,,
530,experimental pg8000 on travis-ci,2014-10-17T18:29:53Z,2014-10-23T02:33:11Z,,,,"Few tests require to be updated in order to check what pg8000 supports and what it doesn't support (i.e., json field)
"
529,Fix for issue 1996,2014-10-17T18:12:56Z,2014-10-18T20:23:05Z,,,,"This bug was caused by appadmin creating unnecessary files in the cache folder.
"
528,"renamed postgre.py into postgres.py, removed 2 overriding PG",2014-10-17T16:06:15Z,2014-10-18T20:18:40Z,,,,"removed startswith/endswith from pg adapter
"
527,"few more tests: gis functions, starts/endswith",2014-10-17T09:28:32Z,2014-10-18T16:41:22Z,,,,
526,ilike was wronlgy defined,2014-10-16T20:29:11Z,2014-10-16T21:13:53Z,,,,
525,updated .gitignore for progress.log and temp directory,2014-10-16T19:57:54Z,2014-10-16T21:12:32Z,,,,
524,"Waiting for a sane ""prefixing"", a much more efficient way to find errors",2014-10-16T19:11:02Z,2014-10-16T21:12:05Z,,,,"This comes from an unfortunate choice of naming conventions and the fact that 
manage errors gets called even on the full document on page load.
I had a table full of .error-""classed"" elements and it took nearly 30 seconds for that
snippet to hide and fade them in. We should definitevely prefix every css class with
something that won't clash with everything else.
"
523,fix for GAE tests often failing for no apparent reason,2014-10-16T19:02:21Z,2014-10-16T21:11:39Z,,,,
522,fix issue 1993: git push in the admin console throw an error,2014-10-16T13:08:57Z,2014-10-16T21:09:11Z,,,,
521,Fix for issue 1932: Aggregrate function won't show up in SQLTABLE,2014-10-16T12:04:11Z,2014-10-16T21:08:33Z,,,,"Addresses issue https://code.google.com/p/web2py/issues/detail?id=1932

in SQLTABLE, reverted or fixed use of REGEX_TABLE_DOT_FIELD leading to ignoring calculated / aggregate columns

Use of REGEX_TABLE_DOT_FIELD.match() leads to failure to detect aggregate function columns, at least when using postgresql backend. Replace where completely unnecessary, catch otherwise, making sure to retain copy/reference behavior.
"
520,refactor main_hook to a function,2014-10-14T21:44:15Z,2014-10-16T21:07:47Z,,,,
519,Fix DB2 Adapter for executesql and placeholders,2014-10-14T21:20:53Z,2014-10-16T21:07:03Z,,,,"Allow usesers of DB2 to take advantage of parameterized/pre-compiled quries using the optional placeholders parameter.

The issue stems from the DB2 adapter not supporting the placeholders parameter in the execute method. It is likely this issue exists in other DB adapters however I have not checked. 
"
518,Added back DAL.Table for backward compatibility,2014-10-12T20:57:21Z,2014-10-16T21:05:32Z,,,,"For details please check: https://groups.google.com/forum/#!topic/web2py-developers/nX_q6LU2M6g
"
517,Added initial gis tests,2014-10-11T18:27:10Z,2014-10-16T21:04:36Z,,,,
516,Change reset_password to send the password as GET query var instead of a...,2014-10-07T14:16:42Z,2014-10-16T21:02:37Z,,,,"...s an argument.

Added some more Portuguese Translations to the Admin application.
"
515,Made reset password use request.vars.key instead of request.args(1) to store the key,2014-10-03T15:29:40Z,2014-10-07T14:01:03Z,,,,"I also made some Portuguese translations of the Admin application just because.
"
514,added coverage template in makefile,2014-10-01T20:03:05Z,2014-10-16T21:14:47Z,,,,
513,"with dal new structure, API doc generation was left out of the picture. ...",2014-09-30T21:39:19Z,2014-10-16T20:59:04Z,,,,"...GROAN!
"
512,fixes issue 1980,2014-09-30T19:40:51Z,2014-10-16T20:48:55Z,,,,"and pyflaked the module, at least a bit. Sometimes I feel developers are in a contest
where less characters and lines win. Concise implementation wins over verbose one,
but less SLOC DON'T mean somewhat better code. Just reading through 
this module makes my brain hurt a bit
"
511,added ssl option for tornado,2014-09-30T11:48:13Z,2014-10-16T20:48:04Z,,,,
510,fixes issue 1985,2014-09-25T20:50:56Z,2014-09-30T00:46:01Z,,,,"plus made a pass to jsbeautifier for improved reading
plus fixed an annoying trailing comma that could cause issues with IE >= 8
"
509,always stringify decimals. Better docstrings and a few PEP8.,2014-09-25T19:33:16Z,2014-09-30T00:45:17Z,,,,
508,added https option for tornado,2014-09-25T12:53:11Z,2014-09-30T00:45:07Z,,,,"now tornado can be called by https
"
507,hooks panel in appadmin for _before_*/_after_* callbacks,2014-09-25T11:41:26Z,2014-09-30T00:39:41Z,,,,"This early panel is useful when there are several methods attached to the _before_*/_after_* callbacks.
By default it doesn't show built_in methods as _delete_uploaded_files_, but it can be actived by changing with_build_it=True. In the future it would be better to add a checkbox directly in the panel
"
506,added tests for gluon/html.py and gluon/serializers.py,2014-09-24T20:25:52Z,2014-09-30T00:38:04Z,,,,
505,"better types for mssql3://, given that we're on 2005 at least",2014-09-22T22:06:12Z,2014-09-24T18:35:08Z,,,,
504,fix for StorageList and tests added,2014-09-21T06:34:06Z,2014-09-24T18:34:20Z,,,,"gluon/storage.py
StorageList had a recursion error (please check the implementation before committing)

gluon/tests*
added the fix_path module to avoid those ugly lines at the beginning of each test file
added tests for gluon.contenttype and test_fileutils
added tests for missing Storage methods
"
503,"improved coverage, fix bug with IS_LIST_OF and items not being strings",2014-09-18T22:16:45Z,2014-09-20T17:55:57Z,,,,
502,"fix cache.increment, added tests",2014-09-16T22:00:18Z,2014-09-20T17:55:15Z,,,,"in addition to that, weird things happen with coverage when test cases have the same name..... go figure. Anyway, the coverage for cache.py is now up to 61% vs 29%.
"
501,"fixed bug on contains(), smart_query uses ilike instead of like",2014-09-14T20:47:54Z,2014-09-14T21:00:00Z,,,,
500,postgresql: identifies what adapter auto-loads json values,2014-09-14T14:40:32Z,2014-09-14T19:53:45Z,,,,
499,added more tests for json Field,2014-09-14T14:05:41Z,2014-09-14T19:53:16Z,,,,
498,Improve the graphing to show the name of the application.,2014-09-13T17:28:23Z,2014-09-14T19:52:32Z,,,,"Just made it so it would say more than ""Undefined"" in the top of the graph of the model.  It now says the name of the application that the model is in.
"
497,"Fixed #1810: DAL.select(left=...) causes ""Unknown column 't1.i1' in 'on ...",2014-09-13T00:27:56Z,2014-09-14T19:55:38Z,,,,"...clause'""

According to the MySQL 5.5 manual [1], comma-separated table references in joins
should be wrapped in parenthesis or JOIN should be used instead of comma.

Further explanation from the manual: The ON clause takes precedence since
a couple of versions so the operands for the ON clause change:

SELECT \* FROM t1, t2 JOIN t3 ON (t1.i1 = t3.i3);

The operands for the ON are t2 and t3. t1.i1 is not known at this point.

[1] https://dev.mysql.com/doc/refman/5.5/en/join.html
"
496,fix infinite loop in request_password,2014-09-12T22:05:39Z,2014-09-12T22:44:40Z,,,,"fix issue 1979 on google code
"
495,Forces scheduler_worker.worker_stats to be JSON string,2014-09-12T13:39:57Z,2014-09-14T13:25:01Z,,,,"In gluon/scheduler we attempt to send a Storage() variable to the worker_stats field, which gets converted to a string during the INSERT.

For (at least) PostgreSQL JSON fields, this isn't valid:

```
2014-09-12 05:28:26,421 - web2py.scheduler.bastille-9.local#29597 - send_heartbeat scheduler ERROR - Error retrieving status: invalid input syntax for type json
LINE 1: ...heartbeat) VALUES ('ACTIVE','2014-09-12 05:28:26','<Storage ...
                                                             ^
DETAIL:  Token ""<"" is invalid.
CONTEXT:  JSON data, line 1: <...
```

This PR uses the simplejson dumps/loads functions to convert between Storage() and JSON field content. It needs further review to see if it will break other things down the line.
"
494,refactored pickling of sessions,2014-09-11T20:53:06Z,2014-09-12T02:13:47Z,,,,
493,"refactored pickle everywhere but Session, removed unused imports",2014-09-10T17:13:45Z,2014-09-10T17:27:34Z,,,,
492,added test for storage pickling,2014-09-10T16:26:05Z,2014-09-10T17:26:26Z,,,,
491,new structure in revised README,2014-09-10T16:09:21Z,2014-09-10T17:26:11Z,,,,
490,fix web2py.js with show_if and grid,2014-09-05T14:20:49Z,2014-09-08T13:02:44Z,,,,"Given this example (with or without rows)

``` python
    db.define_table('stuff',
        Field('approved', 'boolean'),
        Field('approved_on', 'datetime')
    )
    db.stuff.approved_on.show_if = (db.stuff.approved == True)
    grid = SQLFORM.grid(db.stuff, user_signature=False)
    return dict(grid=grid)
```

web2py.js fails raising a javascript exception 
"
489,fix custom view delimiters,2014-09-04T11:20:18Z,2014-09-05T03:06:29Z,,,,"Revert back to pre 2.9.6 behavior of checking for existence response.delimiters.
"
488,avoid multiple cascade paths,2014-09-03T19:10:35Z,2014-09-05T03:05:14Z,,,,
487,fix grid groupby with more than 2 Fields in the expression,2014-09-03T17:42:47Z,2014-09-05T03:04:05Z,,,,"There is an issue with SQLFORM.grid when we pass a groupby composed of more than 2 fields.
This PR is a way to fix it, I suppose there are other approaches to fix it
Test case

``` python
db = DAL('sqlite://test_grid')
db.define_table('person',
    Field('name'), Field('city'), Field('age', 'integer')
)
def test_grid():
    grid=SQLFORM.grid(db.person, user_signature=False, formname='grid')
    return {'grid':grid, 'grid_js':LOAD('test', 'grid_js', ajax=True)}

def grid_js():
    groupby = db.person.name|db.person.age|db.person.city
    grid=SQLFORM.grid(db.person, fields=[db.person.name], groupby=groupby, user_signature=False, formname='gridjs')
    return grid
```

A workaround is

``` python
    groupby = db.person.name|(db.person.age|db.person.city)
```
"
486,"Added modular DAL, updated gluon imports to new structure",2014-09-03T10:51:34Z,2014-09-30T05:24:26Z,,Notes,Notes:,"Updated to commit: f17493b52c34db33fb641974d5d6a3d8926fbafd
This replaces (already closed) PR https://github.com/web2py/web2py/pull/483, adding correct imports from gluon.

A modular version of DAL. Please check https://groups.google.com/forum/#!topic/web2py-developers/0B8Bg_Evmj4 for reference.

Notes:
- Missing latest PEP8 commits, @mdipierro I'm sorry about that, we should re-validate to PEP8 after merge.
- Missing test_all() function as I don't know how you want to manage tests with this modular version
- Tested with sqlite3, **needs debugging**!
"
485,Fix LOAD on action @request.restful(),2014-09-02T16:17:05Z,2014-09-05T03:04:35Z,,,,"LOAD didn't work on action decorated with @request.restful() when args and/or vars are passed because the restful method is called with the main ""request"" object (browser url action) instead of the ""other_request"" object used by LOAD.
So I have injected the restful method with the good object context.
It's a bit nasty, so if someone knows how to do it better, I'm happy.
"
484,Clear passwords on failed registration,2014-08-27T18:49:24Z,2014-08-27T19:36:01Z,,,,"For security, when the register form fails validation, do not return the plain text passwords in the HTML.
"
483,Modular DAL,2014-08-26T09:00:08Z,2014-09-03T10:52:16Z,,Notes,Notes:,"A modular version of DAL. Please check https://groups.google.com/forum/#!topic/web2py-developers/0B8Bg_Evmj4 for reference.

Updated to commit: bac9039c6ea44c5ab6f09b1b8a2dd810a0e6afd8

Notes:
- Missing latest PEP8 commits, @mdipierro I'm sorry about that, we should re-validate to PEP8 after merge.
- Missing copyreg.pickle(<various classes>): I didn't understand why using copyreg (is for C extensions types isn't it?). Can be added after merge btw
- Missing test_all() function as I don't know how you want to manage tests with this modular version
- Tested with sqlite3, **needs debugging**!
"
482,doc fixes,2014-08-21T20:50:42Z,2014-08-26T19:36:44Z,,,,
481,too many cert_file arguments,2014-08-21T20:38:14Z,2014-08-28T17:06:55Z,,,,
480,bootstrap3 formstyle improvements,2014-08-16T18:31:21Z,2014-08-21T02:16:56Z,,,,"Better bootstrap3 formstyles (I hope).

I modified the formstyle_bootstrap3 and added a formstyle_bootstrap3_horizontal to gluon/sqlhtml.py.

They can be tested with welcome application. You can append in the browser ?h=1 to see the
horizontal formstyle.

Do not blindly merge this pull request. Probably it will need to be discussed first.

Does make sense to ship 2 formstyles?
if not, which one?
"
479,reverse_geocode,2014-08-13T15:15:39Z,2014-08-15T00:53:35Z,,,,"This is useful now that we have other spatial features and it makes sense to have if we have geocode.

I've added a function reverse_geocode that does as the name implies - it generates an address from a latitude and longitude using the google maps api (the geocode function already uses it), by default that address will be in current.T.accepted_language.
"
478,Option to limit inline display of linked tables,2014-08-05T18:22:29Z,2014-08-06T19:45:23Z,,,,"Added a new option to smartgrid: ""max_linked_inline"".
When set to a value greater than zero, it will limit the inline display of linked tables (in grid, edit and details).
In case there are a number of linked tables greater than the setting, the links will be displayed in a select list menu.
"
477,new feature (task dependencies) and a little bit of refactoring,2014-08-04T19:47:53Z,2014-08-05T06:44:11Z,,,,
476,Small Refactoring of BaseAdapter.delete,2014-08-02T10:02:12Z,2014-08-10T17:39:30Z,,,,"I removed SQLite special case code, which should not be in the BaseAdapter, and moved it to SQLiteAdapter. This makes the code more readable and should provide a negligible performance boost in most adapters including SQLiteAdapter. 
"
475,Changed a condition in order to not show `None` if there is no errors,2014-08-01T14:59:15Z,2014-08-06T19:44:14Z,,,,"Changed a condition in order to not show `None` if there is not error. When we don't get errors ""None"" is printed: `message or T('None')`.

I guess is better not to print anything: `message or ''` because we don't have errors.  `message` has the same effect as `message or T('None')`
"
474,Added an optional render argument to as_trees that if True causes it to ...,2014-07-29T17:08:43Z,2014-08-01T06:43:36Z,,,,"Added an optional ""render"" argument to as_trees that if True causes it render the rows before building the tree

As discussed here:
https://groups.google.com/forum/#!topic/web2py-developers/DpX0mNBMRmg
"
473,Deleted unnecessary variable,2014-07-28T16:36:31Z,2014-08-01T06:37:35Z,,now,now:,"before:
        iso_format = iso_format = {'_data-w2p_datetime_format' : '%Y-%m-%d %H:%M:%S'}

now:
        iso_format = {'_data-w2p_datetime_format' : '%Y-%m-%d %H:%M:%S'}
"
472,editor:potential fix for requests cancelled due to same origin policy,2014-07-22T10:26:40Z,2014-07-27T15:54:23Z,,,,"This PR should few issues encountered due to the ajax requests made by the online editor (tested with nginx)
Reporting issue:
https://groups.google.com/forum/?fromgroups#!searchin/web2py/raspberry$20pi/web2py/PV8UHqc3AW4/Gr2sDPuzwm8J
"
471,Typo. Your -> You,2014-07-21T00:12:35Z,2014-07-27T15:53:54Z,,,,"Typo. Your -> You
"
470,German translation,2014-07-16T18:04:39Z,2014-07-27T15:53:28Z,,,,
469,Fix default validator when unique=True,2014-07-09T17:53:29Z,2014-07-10T07:07:46Z,,,,"Append the IS_NOT_IN_DB validator so it is applied to the final value after any previous validators may have altered the original value.
"
468,Fix default validator when unique=True,2014-07-09T16:46:11Z,2014-07-09T16:57:08Z,,,,"Append the IS_NOT_IN_DB validator so it is applied to the final value after any previous validators may have altered the original value.
"
467,fix show_if with belongs,2014-07-08T10:29:18Z,2014-07-10T07:06:40Z,,,,"This PR fix this example:

```
db.table.field.show_if = db.table.other_field.belongs([arbitrary_values])
```
"
466,pt-br translations for admin and welcome apps,2014-07-04T02:17:23Z,2014-07-04T06:47:22Z,,,,"Some corrections and some untranslated texts.
"
465,Update sqlhtml.py,2014-07-01T21:25:10Z,2014-07-04T06:46:17Z,,,,"Improved readability in code
"
464,Added dict based meta generation,2014-06-24T13:55:39Z,2014-06-25T06:02:07Z,,,,"include_meta() function can convert dicts to meta tags, is easier to implement SEO and Open Graph, among others.
"
463,Added dict based meta generation,2014-06-23T13:57:13Z,2014-06-23T14:19:20Z,,,,"include_meta() function can convert dicts to meta tags, is easier to implement SEO and Open Graph, among others.
"
462,a DISABLED worker shouldn't resume after completing a task,2014-06-15T15:42:40Z,2014-06-16T03:20:17Z,,,,
461,DISABLED worker shouldn't resume after completing a task,2014-06-15T15:37:03Z,2014-06-15T15:37:41Z,,,,
460,removed leftover print,2014-06-15T13:16:11Z,2014-06-16T02:02:25Z,,,,
459,Remove duplicate import,2014-06-11T17:39:27Z,2014-06-14T18:15:09Z,,,,
458,fix like behaviour as ANSI-SQL LIKE,2014-06-10T20:43:04Z,2014-06-14T03:16:22Z,,,,
457,scheduler's refactoring,2014-06-08T20:52:50Z,2014-06-14T03:11:40Z,,,,"- refactored internals
- pep8(ish)
- worker stats
- kill(), terminate(), resume(), disable() have a new ""limit"" parameter
- first steps towards autoscaling
- needs an additional column (easiest migration possible)
"
456,mssql4 adapter enhancements,2014-06-03T21:37:06Z,2014-06-08T05:29:15Z,,,,"Given that mssql4 requires MSSQL2012, we can use newer types for data
without worrying about compatibility with older MSSQL versions
"
455,fix rewrite tests under Windows,2014-06-03T21:33:41Z,2014-06-08T05:28:15Z,,,,"loads of tests failing under windows :(
@jlundell : take a look at this
"
454,Added support for stdlib's pbkdf2,2014-06-03T06:27:00Z,2014-08-10T17:45:56Z,,,,"This change should default the pbkdf2 implementation to the stdlib's whenever it is available. This is currently only Python 3.4 but should be available for Python [2.7.8](https://docs.python.org/2.7/library/hashlib.html#hashlib.pbkdf2_hmac) whenever it is released.

Nothing _should_ break although I am not 100% confident of this because this bit of code doesn't appear to be covered by tests.
"
453,we don't want gluon/tests to be covered,2014-06-02T20:41:44Z,2014-06-03T02:36:43Z,,,,
452,fix multiprocessing tests under windows,2014-06-02T14:36:53Z,2014-06-03T02:36:09Z,,,,
451,added tests and refactored incorrect docstrings,2014-05-29T21:44:45Z,2014-06-03T02:32:38Z,,,,"as a nice bonus, we don't need to wait a fixed number of seconds to see if the server started, we have webclient for it (launch ./web2py.py --run_system_tests and enjoy ~10 seconds less of wait time ^_^)
"
450,coding utf8 and improve comment,2014-05-26T14:57:49Z,2014-05-27T03:29:56Z,,,,
449,python idomatic,2014-05-26T14:48:52Z,2014-05-27T03:29:18Z,,,,
448,Update cache.py,2014-05-24T05:40:34Z,2014-05-27T03:28:21Z,,,,"Why iteration the whole dictionary entirely when the desired item is found, it is better to terminate the iteration by break
"
447,fixing pypdf table rendering issues due attribute sanitization,2014-05-21T18:24:54Z,2014-05-22T13:12:41Z,,,,"gluon.sanitizer.sanitize() is removing width and other need attributes to correctly render tables with pyfpdf

This change doesn't touch sanitize itself, it only add allowed attributes to gluon.generics.pyfpdf_from_html(html), so it should not pose any security issue, but please review if I'm missing something

See the related discussion in https://groups.google.com/d/msg/web2py/61hDnA7gQaY/gMUFl1r3yGQJ

Missing the test, sorry (but in the thread there are steps to reproduce and make a basic test)
"
446,Add support of --folder paramter for cron.,2014-05-21T14:04:46Z,2014-05-22T13:11:42Z,,,,"Before this change crontab file was ignored if ""--folder"" parameter set.
"
445,Fix IS_STRONG used with validate_and_update,2014-05-16T14:14:40Z,2014-05-17T03:26:05Z,,,,"Fix no error return with IS_STRONG validator because it returns a gluon.html.XML instead of str, so when pushed to response.errors that is a Row, it isn't display because Row object filters his output and doesn't support XML objects.
"
444,Add customization of bootstrap 3 forms,2014-05-15T21:48:05Z,2014-05-16T19:10:38Z,,,,"I commonly use the bootstrap 3 form style, but it is not very customizable.  For example, the widths of all elements are fixed, the button colours are fixed, etc.

These changes are intended to address this for the bootstrap 3 style, although it could be extended to other form styles as well.

Everything should be backwards compatible.

I'm not sure if this is ready to me merged yet.  I'm looking to start a discussion (i) does this approach make sense and (ii) how can I add some tests to make sure it is working properly?
"
443,Easier S/Mime (X.509) ,2014-05-14T07:20:32Z,2014-05-17T03:25:21Z,,,,"S/Mime (X.509) keyfile, sign_certfile, sign_chainfile, crypt_certfile can be strings.
mail.send() function can set signing and encryption settings.
"
442,Prevent error in restful decorator from swallowing up stacktrace,2014-05-13T17:56:30Z,2014-05-17T03:24:39Z,,,,"by passing the exception to the raise in the restful decorator, all previous stacktrace is lost, making debugging quite difficult.  Removing the exception just raises the current exception, preserving the stacktrace.
"
441,Fix LOAD() in restful context,2014-05-12T15:43:33Z,2014-05-17T03:21:15Z,,TypeError,TypeError: 'NoneType' object is not callable,"When you call LOAD() on a controller who has some actions decorates with @request.restful(), it fail with:

```
@request.restful()
TypeError: 'NoneType' object is not callable
```

Because LOAD use other_request variable who are a Request but without all methods and therefore without restful method.
I've just inject the restful method.
You can also use LOAD() to call an action decorates with @request.restful().
"
440,Better HTTP code for method not supported,2014-05-12T14:54:22Z,2014-05-17T03:19:49Z,,,,"Change HTTP code to raise from 400 to 405 (Method Not Allowed).
"
439,Add Auth signature date format,2014-05-09T11:27:27Z,2014-05-17T03:19:27Z,,,,"Add a setting to be able to define the format of signature dates (created_on and modified_on).
This setting use the translation system.
"
438,Add support for certificate chaining for s/mime sign in Mail,2014-05-07T07:24:57Z,2014-05-07T22:10:13Z,,,,
437,ley -> key,2014-05-04T16:12:20Z,2014-05-07T22:09:26Z,,,,
436,PEP8 improvements white space here and there,2014-05-04T16:02:13Z,2014-05-07T22:05:37Z,,,,"I search with regexp "",[^\s-]"" to spot missing space after comma. I also, add double break line in front of function or class. I change a couple of comparator in order to add space in front and after "" == "" for instance.
"
435,cgi.parse_qs deprecated -> urlparse.parse_qs,2014-05-02T19:38:58Z,2014-05-07T22:03:31Z,,,,"Ref: https://docs.python.org/2/library/cgi.html#cgi.parse_qs
"
434,PEP8 improvements white space here and there,2014-05-02T19:27:47Z,2014-05-07T22:00:34Z,,,,"I search with regexp "",[^\s-]"" to spot missing space after comma. I also, add double break line in front of function or class. I change a couple of comparator in order to add space in front and after "" == "" for instance.
"
433,"Update dal.py, validate_and_insert",2014-05-01T17:27:17Z,2014-05-04T04:11:02Z,,,,"Fixed: Field(..., required=True), Now is recognized and validated correctly.
"
432,commented out bare setting in AD for username allowing a user@domain.com...,2014-04-29T21:37:15Z,2016-07-29T13:34:17Z,,,,"... to import ldap groups properly.
"
431,Added support for two-step authentication.,2014-04-27T05:46:07Z,2014-05-27T03:27:23Z,,,,"The login function will email a 6-digit code to users if the user is part of a group with role 'web2py Two-Step Authentication'. This goes along with pull request 202 (https://github.com/mdipierro/web2py-book/pull/202) on the web2py book repository.
"
430,fix comments,2014-04-26T18:52:44Z,2014-04-26T21:04:18Z,,,,
429,PEP8 improvements white space here and there,2014-04-24T16:25:40Z,2014-04-26T21:03:27Z,,,,"I search with regexp "",[^\s-]"" to spot missing space after comma. I also, add double break line in front of function or class. I change a couple of comparator in order to add space in front and after "" == "" for instance.
"
428,Switch for .grid() advanced_search widget,2014-04-23T18:34:32Z,2014-04-24T05:00:04Z,,,,"Virtual basic search widget only by removing the _onfocus trigger even that prevent the advanced search to unfold. advanced_search is True by default for backward compatibility...
"
427,apply same rules as DAL's to find tables and fields in column names,2014-04-23T07:51:11Z,2014-04-24T04:59:14Z,,,,"This should fix SQLTABLE when using case sensitive field names (DAL option ""quoted_entities"")
"
426,Check whether memdb record is None before trying to read its keys,2014-04-14T05:59:28Z,2014-04-15T14:48:32Z,,,,"In memdb table.**call**(), check whether record is None before trying to read its keys otherwise app crashes.
"
425,time_expire=0 should clear memcache entry,2014-04-14T05:36:19Z,2014-04-15T14:47:26Z,,,,"If time_expire=0, then the cache should be cleared and reset with the
latest value to stay compatible with documented web2py functionality of
how caching works. Previous change broke this compatibility while adding
efficiency in other cases.
"
424,Updated regex to manage white space in titles,2014-04-10T13:46:41Z,2014-04-13T15:39:53Z,,,,"Addition of `\s*` in some regex in order to have the same behavior as in markmin2html. That is:

```
# Title
```

and

```
#Title
```

or:

```
## Title
```

and

```
##Title
```

will be equivalent.
"
423,Rewritten a regex,2014-04-09T21:51:15Z,2014-04-09T23:10:50Z,,,,"Rewritten a regular expression from two lines to one line.
"
422,"Adding HEADER, FOOTER, SECTION html helpers",2014-04-09T15:53:53Z,2014-04-09T16:28:26Z,,,,"Adding helpers not found in web2py, those are very helpful for bootstrap3 style in forms. 

http://www.w3schools.com/tags/tag_header.asp
http://www.w3schools.com/tags/tag_footer.asp
http://www.w3schools.com/tags/tag_section.asp
"
421,"few ""fashion"" tweaks plus sphinx over epydoc docs",2014-04-08T21:04:45Z,2014-04-09T03:48:40Z,,,,
420,Deleted repeated line,2014-04-08T15:48:01Z,2014-04-09T03:49:39Z,,,,"Deleted repeated line
"
419,sphinx compatible doc-generation,2014-04-06T18:51:11Z,2014-04-07T17:02:54Z,,,,
418,fixed bug in defition of decimal types,2014-04-02T14:59:40Z,2014-04-05T22:27:05Z,,,,"A postgresql column of type numeric(10,4) was mapped as just decimal, so the parse_decimal of dal.py will fail. The correct mapping is decimal(10,4) in the web2py model.
"
417,"jQuery 1.9 removed toggle(function(), function()). And nobody noticed.",2014-04-01T22:04:24Z,2014-04-05T22:25:36Z,,,,
416,routes.py search path fixed to application_parent,2014-03-31T15:37:50Z,2014-04-01T00:44:47Z,,,,"Now routes.py will be gotten from applications_parent in case of using main.HttpServer
Previous behavior: route.py must be located in gluon_parent which is wrong.

Also some stylistic fixes.

Manual testing and pylint testing done.
"
415,sphinx-compatible docstrings (and we're finished!!!!!),2014-03-27T22:06:03Z,2014-03-29T22:08:53Z,,,,
414,Find VERSION when started from outside web2py dir,2014-03-27T17:25:58Z,2014-03-29T22:06:15Z,,,,"When started from outside web2py root dir, the version read fails. It's happens when running web2py on OpenShift because the app has a initial CWD set to $HOME, not web2py root dir.
"
413,Updated the pt-br welcome application translation.,2014-03-25T23:38:55Z,2014-03-26T05:29:53Z,,,,
412,codemirror 4.0.3 (new upstream major release),2014-03-25T12:00:32Z,2014-03-25T17:17:45Z,,,,
411,sphinx-compatible docstring (only DAL remains),2014-03-24T21:38:29Z,2014-03-25T17:16:42Z,,,,
410,sphinx-compatible docstrings (7 modules remaining...),2014-03-23T20:51:12Z,2014-03-25T17:15:45Z,,,,
409,Modify Table class so that uploadfs is respected when uploads_in_blob is set to True,2014-03-20T03:52:34Z,2014-03-20T23:00:43Z,,,,"This patch addresses an issue where a database adapter has `uploads_in_blob = True` (e.g. `HerokuPostgresAdapter`) and an upload field has `uploadfs` specified.  Currently, the specified `uploadfs` is not used, and the data is stored as a blob in the database.  The solution presented here checks whether `uploadfs` is set before setting the file to be stored as a blob. 
"
408,Update gluon.validators.py to process a string of values submitted through a multiselect form field,2014-03-19T20:52:05Z,2014-03-20T22:58:55Z,,,,"This update would allow a string of values to be used to update a list:reference field through a form (e.g., '1,2,3,4' would be parsed by the validator into the ['1','2','3','4'] list format expected by web2py's DAL when updating a list:reference field). This update would require import and use of ast.literal_eval to transform the string into a list of values. 
"
407,Added language pt-br file to admin application,2014-03-19T14:59:51Z,2014-03-19T17:35:06Z,,,,
406,Update translation to pt-br.,2014-03-18T17:12:41Z,2014-03-19T17:31:00Z,,,,"Added and updated some translations to Brazilian Portuguese.
"
405,static_version setup enabled by default,2014-03-17T20:35:29Z,2014-03-18T14:28:48Z,,,,"There was a time where scripts/\* were intended as blueprints. More and more users are instead intending them as one-click solutions. Now that static_version is tested and used, it may be the right time to add that feature by default also in scripts.
"
404,Don't write translation file when T.is_writable == False,2014-03-17T07:09:28Z,2014-03-18T14:27:29Z,,,,"Web2py manual says in [Translating variables section](http://web2py.com/books/default/chapter/29/04/the-core#Translating-variables) one can disable write of translation files to improve performance with this setting:

`T.is_writable = False`

But Web2py 2.9.5 just checks if filesystem is writable, ignoring T.is_writable at all.

This PR fixes this behaviour.
"
403,Update default.py,2014-03-14T01:04:26Z,2014-03-16T02:09:44Z,,,,"new alert: it's a plugin is not an application
"
402,Added db_hash for custom hash,2014-03-12T21:34:56Z,2014-03-29T22:18:14Z,,,,"If a password is changed migration need to be done again
"
401,sphinx-compatible docstrings,2014-03-12T21:26:18Z,2014-03-16T02:08:05Z,,,,
400,better error handling in jsonrpc requests,2014-03-12T20:33:20Z,2014-03-16T02:07:31Z,,,,"left over from the 1898 fix is the out-of-order error handling which obscures useful messages
"
399,jsonrpc2 requests need mandatory key/pair jsonrpc:'2.0',2014-03-12T11:42:53Z,2014-03-12T18:39:05Z,,,,"closes 1898
jsonrpc2 errors out with error number -32600 if the request dict does not have a key 'jsonrpc' with value '2.0'
There was no mechanism for the ServerProxy class to know if it was sending a request to jsonrpc2 or jsonrpc so I added a keyword argument version=None
If defined, it adds the missing key to data. Only a value of version='2.0' will work with jsonrpc2.
None falls back to current jsonrpc behaviour.
"
398,sphinx-compatible docstrings,2014-03-11T21:27:24Z,2014-03-12T18:37:42Z,,,,
397,dal.py:class Table:__call__ working also for non integer keys,2014-03-11T11:07:52Z,2014-03-29T22:19:06Z,,,,
396,sphinx-compatible docstrings,2014-03-10T21:27:48Z,2014-03-11T15:51:31Z,,,,"for html.py. Boy this sucked my brain dry. ^_^
"
395,"dal.py: attribute ""unique"" added for tables",2014-03-10T18:20:29Z,2015-03-30T20:16:50Z,,,,"The 'unique' attribute is also added in dal.py. In this way, alternative keys different than the primary key can be included in the 'unique' attribute when defining the database tables, for example:

db.define_table('variant',
                Field('id', 'integer'),
                Field('chromosome_id', 'integer'),
                Field('genome_id', 'integer'),
                Field('start', 'integer'),
                Field('reference_allele', 'string'),
                Field('variant_allele', 'string'),
                Field('type', 'string'),
                Field('created', 'datetime'),
                Field('updated', 'datetime'),
                Field('user_id', 'integer'),
                Field('flanking_sequence', 'string'),
                primarykey=['id'],
                unique=['chromosome_id', 'genome_id', 'start', 'reference_allele', 'variant_allele'],
                migrate=False)

Changes in validate_and_update, update_or_insert, _insert and validate_and_update_or_insert make it possible for the api to insert or update records only by passing the alternative keys (those defined in the 'unique' attribute) to the update or insert method, and finally getting the primary key from the updated or inserted record.
"
394,Issue 1892: Move the inline styling to a css file,2014-03-10T00:26:19Z,2014-03-29T22:22:07Z,,,,"Details: https://code.google.com/p/web2py/issues/detail?id=1892
"
393,fix travis.yml to fetch the latest release of gae,2014-03-09T13:20:49Z,2014-03-09T14:11:03Z,,,,"needs manual update whenever a new archive is ready at http://code.google.com/p/googleappengine/downloads/list
"
392,Fix for session unique_key query,2014-03-08T19:54:00Z,2014-03-08T20:32:27Z,,,,"Redis session only verified the session id.
This change allows for comparing the session id and unique key and so that redis session can be used with the latest globals.py changes (ie. table(record_id, unique_key=unique_key).
"
391,oauth strip encoding part in content-type response from server.,2014-03-07T16:43:07Z,2014-03-08T20:31:32Z,,,,"Thanx to Jayadevan M.
"
390,Fix DAL ADD method,2014-03-06T16:58:41Z,2014-03-08T20:30:42Z,,NameError,NameError: global name 'gluon' is not defined,"Fix regression of ADD method:
NameError: global name 'gluon' is not defined
"
389,"add Recaptcha(...ajax=True) to use ajax api, fix Recaptcha in LOAD issue/1888",2014-03-05T22:48:53Z,2014-03-08T20:29:58Z,,,,"the current implementation of recaptcha doesn't work in LOAD(...ajax=True). 
the new argument to the Recaptcha constructor, ajax= True | False, uses the ajax API to recaptcha.
The new argument defaults to False to keep existing behaviour.
"
388,"dal.py: Table class: validate_and_update_or_insert method created, validate_and_update minor changes",2014-03-05T17:09:42Z,2014-03-08T20:15:43Z,,,,"dal.py: Table class: validate_and_update_or_insert method created, and minor changes in validate_and_update

¬∑ these methods should be working even in case of tables with multiple primary keys
¬∑ the validate_and_update_or_insert method assumes that in case that no primary keys are provided, all table fields marked as ""required"" will be used for searching the record to update (or to insert, in case that the record doesn't yet exist)
"
387,Added 'from_address' to allow for separation of 'envelope sender' and 'f...,2014-03-04T18:19:16Z,2014-03-05T04:39:40Z,,,,"...rom' in email. The return-path can not be added in an additional header as the MTA will use the envelope sender. This allows for having a different 'from' address added in the header then the envelope address.
"
386,change button & icon classes for bootstrap 3 (SQLFORM.grid),2014-03-01T01:26:30Z,2014-03-02T22:53:53Z,,,,
385,Update es.py,2014-02-27T11:35:58Z,2014-03-02T22:51:28Z,,,,"Major spanish language revision.
"
384,Update tools.py,2014-02-27T11:09:44Z,2014-03-02T22:50:40Z,,,,"Internationalize 'ACCESS DENIED' message.
"
383,Fix email date header format,2014-02-25T13:20:16Z,2014-03-02T22:49:50Z,,,,"Fixed email date header not respecting the RFC2822 defined format  

See:
https://groups.google.com/forum/#!topic/web2py/0Mb99H9kJOw
"
382,Added password option for redis_cache and redis_session,2014-02-25T00:08:40Z,2014-03-02T22:48:16Z,,,,"Added the password option to both redis_cache and redis_session so that they can be used in Redis installations with a server password set.
"
381,dal.py: DAL: parse_as_rest: solved problem when displaying tables containing more than one PK,2014-02-18T15:33:07Z,2014-02-19T14:50:51Z,,,,"dal.py: DAL: parse_as_rest: solved problem when displaying tables containing more than one primary key
"
380,added bootstrap class btn to export widget,2014-02-17T19:20:45Z,2014-02-19T14:50:16Z,,,,
379,"Issues/1866 (grid export): change csv export to use represent, no change to csv hidden cols or others.",2014-02-14T21:13:48Z,2014-02-15T04:35:05Z,,,,"Also, add title (ie 'tooltips') to the export buttons so there is guidance on what they do. 
Replace ""Excel"" with ""Spreadsheet"" in description of TSV format.
make the virtual field represent lambda function more compatible with other parts of DAL.
"
378,Update dal.py Table:validate_and_update,2014-02-14T14:33:07Z,2014-02-15T04:34:10Z,,,,"Validation has been fixed on validate_and_update method
"
377,"CSV and TSV now use represent, 'hidden' versions don't, for speed.",2014-02-13T11:40:27Z,2014-02-13T19:24:17Z,,,,"as well, I refactored to remove the ExportClass reimplementation of the ""represent"" functionality in the rows class (I don't know if this is wise, feedback requested)
"
376,Issue#1870: Captials for non-English translations,2014-02-13T05:01:43Z,2014-02-13T08:13:01Z,,,,"Details here: https://code.google.com/p/web2py/issues/detail?id=1870, and in the commit messages
"
375,dal.py: BaseAdapter: insert: solved problem when creating new record wit...,2014-02-10T18:51:23Z,2014-02-15T04:33:20Z,,,,"In dal.py: BaseAdapter Class: method insert: solved problem when creating new record without passing the primary key as argument
"
374,greater flexibility for SQLTABLE row customization by using css,2014-02-06T15:27:27Z,2014-02-15T17:35:07Z,,,,
373,Better button labels for grid search widget,2014-02-02T07:19:30Z,2014-02-02T22:33:08Z,,,,"This is a second attempt at search widget buttons.
The create ""+Add"" is now ""+Add Record"".
The first search button becomes ""New Search"", and the And and Or buttons become ""+ And"" and ""+ Or"" (to hint that they add terms to the search). There are tool tips on all these buttons now.
"
372,Minor usability improvement to grid search widget,2014-01-31T05:47:44Z,2014-01-31T23:09:06Z,,,,"changed the button ""New"" to ""Add"" and added a title attribute (view on hover) explaining what this button does
"
371,Issues/1859 export from grid fails when virtual fields are present,2014-01-31T02:47:38Z,2014-01-31T23:08:21Z,,,,"This fix assumes there are either real fields or virtual fields in a grid. It works in my test cases and is a big improvement over current functionality (tickets are no longer generated and export behaves as expected). But more work may be needed.
"
370,more docstring fixes,2014-01-29T22:07:05Z,2014-01-30T14:07:11Z,,,,
369,Fixes issue1828,2014-01-29T13:56:19Z,2014-01-30T14:06:34Z,,,,"http://code.google.com/p/web2py/issues/detail?id=1828
"
368,Design cleanup,2014-01-29T11:08:17Z,2014-01-30T14:05:48Z,,,,"Minor cosmetic cleanup
"
367,fixed a bug in SQLFORM.grid where export would fail if a search filter a...,2014-01-29T07:59:26Z,2014-01-30T14:04:56Z,,,,"...pplied to a non-visible column
"
366,Add mongodb and imap tests for dal,2014-01-28T20:57:25Z,2014-01-28T21:43:07Z,,,,"- Added mongodb uri string for tests
- New gluon/contrib/mockimaplib for mock imap unit testing (released under LPGLv3)
"
365,added entity_quoting (False by default) parameter to DAL ,2014-01-28T16:50:45Z,2014-01-28T21:42:37Z,,,,"Optionally enable entity name quoting by adapters.
"
364,docstrings fixes,2014-01-27T22:00:18Z,2014-01-28T21:41:41Z,,,,
363,docstrings refactored,2014-01-24T21:24:19Z,2014-01-25T02:32:50Z,,,,
362,remove disable_with if not needed,2014-01-23T21:06:36Z,2014-01-24T04:37:22Z,,,,
361,remove disable_with if not needed,2014-01-22T21:31:39Z,2014-01-23T20:46:35Z,,,,
360,NoSQL dal tests,2014-01-22T11:58:08Z,2014-01-24T04:36:09Z,,,,
359,Non sql dal tests (for now only GoogleDatastore),2014-01-21T15:46:03Z,2014-01-22T09:02:17Z,,,,"I have managed to solve the following issues for adapting test_dal to test_dal_nosql:
- removed assert commands requiring JOIN queries
- checked for long type instead of specific id integers

There are many tests skipped because of lack of implementation or unsupported commands for datastore (pending fixes).
"
358,online editor: shortcuts in a separated frame and style review,2014-01-21T15:38:50Z,2014-01-24T04:34:44Z,,,,
357,added the prevent_drift parameter,2014-01-20T21:48:34Z,2014-01-24T04:33:40Z,,,,
356,someone forgot tests.... grrrr!,2014-01-20T20:33:10Z,2014-01-20T21:14:37Z,,,,
355,debugger and soap contrib update and fixes,2014-01-19T17:09:38Z,2014-01-20T05:41:25Z,,,,"fixed issues 
- 1839: catch exception if source code cannot be opened in the debugger
- 1839: catch exception if source code cannot be opened in the debugger

For more info see 
- https://code.google.com/p/web2py/issues/detail?id=1839
- https://code.google.com/p/web2py/issues/detail?id=153

This should be two different pull request but I'm burnout this Sunday afternoon and I cannot figure out how to split it...
"
354,fix bug related to upgrade setuptools / pip,2014-01-18T13:06:42Z,2014-01-18T18:39:47Z,,,,"Tested in Ubuntu 12.04.3 VMs
"
353,codemirror 3.21,2014-01-18T12:47:09Z,2014-01-18T18:38:59Z,,,,"codemirror monthly update (see https://groups.google.com/forum/?fromgroups#!topic/codemirror/HlsihxhQVDw)
added a new theme pastel-on-dark
"
352,"Allow empty reference field in form without IS_EMPTY_OR() validator, avoiding constraint violation exception.",2014-01-17T20:26:53Z,2014-01-18T18:37:39Z,,,,"This situation occurs when you have a child table with a parent field and you don't want to see the dropdown in form and, for some reason, you don't validate your data using Web2py validators (IS_EMPTY_OR(IS_IN_DB()).
"
351,Update error_messages; capitalize first character,2014-01-16T05:35:51Z,2014-01-18T18:36:33Z,,,,"Result of a discussion: https://groups.google.com/forum/#!topic/web2py/IDkr4w_wKv4
The intent is to convert the first character of all error messages to a capital letter.

Submitted for issue: https://code.google.com/p/web2py/issues/detail?id=1853
"
350,Minor fix for ubuntu 12.04 installs script,2014-01-15T16:31:54Z,2014-01-15T21:24:08Z,,,,"When i try to install web2py using the ubuntu script inside a VM notice that the pip upgrade has some issues and produces an incomplete installation
"
349,Create tr.py,2014-01-14T11:31:05Z,2014-01-15T04:11:23Z,,,,
348,Update tr.py,2014-01-14T11:27:28Z,2014-01-15T04:10:56Z,,,,
347,first steps to a cleaner DAL and rname integration,2014-01-13T23:03:46Z,2014-01-15T04:10:26Z,,,,"plus some pep fixes
"
346,Fix concurrency handling in order to avoid that some workers get the same task at the same time.,2014-01-13T14:32:20Z,2014-01-15T06:17:34Z,,,,"With using 20 workers instances of the same group with 50 tasks in the queue the problem occurs, some tasks are executed 2 times by 2 different workers.
"
345,related to issue 1708 - bugfix to allow no expiration for gae_memcache,2014-01-13T06:02:30Z,2014-01-15T04:08:28Z,,,,"When gae_memcache passed expiration time to memcache Client
(see commit 59290534bc2faad501ba13c495aeb051d619314),
logic is no longer needed to calculate time delta, since memcache
handles that for us.  Also, time_expire=0 was expiring values
immediately, instead of the documented behavior where 0 signified
no expiration.

Kept timestamp in value for backwards compatibility (is this
necessary since cached data is transient?)
"
344,admin: Catch remote plugin api errors,2014-01-11T16:46:49Z,2014-01-15T04:07:58Z,,,,"Patch for issue 1850

http://code.google.com/p/web2py/issues/detail?id=1850
"
343,Remove illegal nosql command implementations,2014-01-11T12:58:26Z,2014-01-11T13:07:04Z,,,,"I have removed any _command from imap and mongodb as they don't follow the nosql base implementation.
"
342,"Second attempt at fixing regex. This time, use match.",2014-01-10T02:15:09Z,2014-01-14T12:12:26Z,,,,"Use match and get the field name by using the named pattern ""name""
"
341,Added _insert for App Engine,2014-01-09T12:50:19Z,2014-01-10T14:25:21Z,,,,"Returns a dictionary with processed values without applying the changes to datastore.
Now .insert uses _insert for data representation
Usage: this can be used for pre-processing data before lower level I/O (i.e. using google api for storing entities)

Discussion: https://groups.google.com/d/msg/web2py/lFKiIGary0c/h5jxr1gxiVoJ
"
340,fix to the regex added re issue 1836,2014-01-09T12:27:08Z,2014-01-10T02:15:57Z,,,,"I think this fixes 1848 & 1849. 
"
339,Fix for orderby_on_limitby with Table aliases,2014-01-07T22:38:57Z,2014-01-08T15:51:41Z,,,,"When using Table aliases the Field.sqlsafe fails as Field._table doesn't use the Alias.
There may be better solutions as this seems a more general problem, but this fix works for my usecase at least.
"
338,"fix issue 1840, CAS failing due to redirect loop",2014-01-07T06:08:57Z,2014-01-07T07:58:37Z,,,,"there seems to be a minor bug with commit c87bf5, and therefore it solves the redirect loop preventing CAS authentication from working.
In my testing this patch fixes it. Note that this reverts to prior behaviour of checking the CAS provider to see if username is used to identify users. I'm not sure how this would work if the CAS provider was not web2py, I know nothing about CAS. But it was the old behaviour. 
"
337,Adapted admin cache action for gae,2013-12-28T10:57:35Z,2013-12-29T05:17:15Z,,,,"Fixes issue 1835
"
336,removed debug print statements,2013-12-27T20:29:39Z,2013-12-27T23:09:50Z,,,,
335,Save current working session in the online editor,2013-12-21T14:41:48Z,2013-12-24T03:33:07Z,,,,"with current working session I mean the list of file currently open
It works by adding a new section in the settings.cfg, which will contain a row for each different file list saved. 
it also fix an issue related to the config parser which requires to remove all entries in the [default] section.

still missing a simple way to remove sessions :( 
"
334,Changed RPXAccount login_form due to end-of-life for Janrain legacy widget,2013-12-20T19:45:17Z,2013-12-20T20:49:41Z,,,,"Migrated Janrain's Legacy Sign-in Widget to the current Social Sign-in Widget due to end-of-of-live for legacy widget.

For more info: http://developers.janrain.com/documentation/widgets/legacy-sign-in-widget/social-sign-in-migration-guide/
"
333,fix issue 1825,2013-12-19T08:53:31Z,2013-12-20T04:29:10Z,,,,
332,admin app: enhanced ticket support for gae,2013-12-18T19:26:43Z,2013-12-18T19:50:45Z,,,,"This pr adds 3 Bugfixes for admin on GAE (Python sdk 1.8.8 tested in production):
- prevents the controller to try writing to the fs (crontab default file)
- fixes an indexerror exception due to a missing default ""error"" object when storing tickets to database
- corrects a wrong key reference to the ticket hash for db ticket storage
"
331,Enable admin app for GAE (experimental),2013-12-16T20:32:22Z,2013-12-17T20:00:27Z,,,,"Allows to browse for installed app files, check db error ticket, (probably) issuing commands trough the shell. For now, any feature within the design page writing to the filesystem is ignored (returns a not supported flash message)
"
330,"fix mssql quoting issue, disabled some tests",2013-12-15T14:07:35Z,2013-12-15T16:17:21Z,,,,"Tests now pass on mssql. I think we need to agree on what's going on
with DAL, or we risk shipping a module with lots of changes that are
breaking backward compatibility. I'll start a thread on
web2py-developers
"
329,a more harmonic create_file in admin editor,2013-12-14T08:42:35Z,2013-12-14T18:23:28Z,,,,"this commit removes the nested $.ajax(...) calls introduced in https://github.com/web2py/web2py/pull/322 to use functions already present in web2py.js
"
328,Manage w2p:enable-with in order to reuse form,2013-12-13T11:22:03Z,2013-12-14T02:39:15Z,,,,"The current situation doesn't allows a simple html form to be reused. 
The submit of a single form (ajax submit) fires several activities which all managed the variable el.data('w2p:enable-with'). Namely, disableElement is called two times, and one time is called disableFormElements.

Due to those several calls the value of el.data('w2p:enable-with') is initially and correctly set to the value of the element but then is re-set to 'working ...' because this latter is the value of the element. When you call enableElement you will find in el.data('w2p:enable-with')  'working ...' instead of the right one.

@niphlod do you agree?
"
327,invalidate function in web2py.js,2013-12-11T14:53:58Z,2013-12-11T19:12:33Z,,,,"This PR lets to trigger a web2py component to be reloaded.
"
326,convert session to dict before pickling,2013-12-10T23:03:36Z,2013-12-11T02:48:39Z,,,,"Session was constantly being pickled without converting to dict as it
should be.
"
325,fixed naming bug. Thanks @Peter Govers for the patch,2013-12-10T20:09:10Z,2013-12-11T02:29:48Z,,,,
324,Fix error on create files from edit.html,2013-12-10T13:05:24Z,2013-12-10T14:22:41Z,,,,"```
modified:   applications/admin/controllers/default.py
modified:   applications/admin/views/default/edit.html
```
"
323,select the right app in the file list editor sidebar,2013-12-10T08:56:10Z,2013-12-10T14:34:20Z,,,,"Fix issue introduced in https://github.com/web2py/web2py/pull/322
"
322,"Allow create files from editor page in ""files toggle"" ",2013-12-10T02:34:56Z,2013-12-10T03:20:38Z,,,,"Adds a ""create"" button inside ""files toggle"" sidebar to create files and reload ""files toggle"" using ajax
"
321,toggleComment in admin editor,2013-12-09T13:43:11Z,2013-12-10T00:37:15Z,,,,"By clicking ""Ctrl-/"" you will comment/uncomment the current line/selection
It works with html/python/js/css files. 
As of today It doesn't comment correctly python code in html files.
"
320,admin plugins page: show license information and small enhancements,2013-12-08T14:06:30Z,2013-12-08T14:28:08Z,,,,
319,better style for todolist panel (admin editor),2013-12-08T09:19:36Z,2013-12-08T14:27:26Z,,,,
318,Todolist panel in admin editor,2013-12-06T15:28:29Z,2013-12-07T02:28:18Z,,,,"This PR adds a TODO panel in the admin editor, by clicking on each TODO the involved file will be opened (or selected if already open) and the cursor will be placed at the right line.
Further commits will come to:
- improve style
- improve compatibility (tested only Chrome/Firefox on ubuntu)
- support other keyword (ex: FIXME and so on)
- support other file types (at the moment works for .py only)
"
317,quoting of tablenames and field names,2013-12-03T11:44:30Z,2013-12-04T16:34:52Z,,,,"fix for wrong sequence name quoting

fix for wrong sequence name quoting 2

reverted test to quoted rname

rname passed asis. freedom in table names and field names. Case sensitivity in field and table names

removed test of allowed char sequence in table and field names, there is no limit anymore

fixed some troubles with postgresql drop(). Better Row.**getitem**(): should not be much slower.  Added a ignore_field_case parameter to allow Field('F')!=Field('f') on databases supporting case sesitivity.

different mysql drivers handled in quoting test.

improved handling of foreing keys

fix with quoted names in SQLTABLE.  fix for ORDER BY

handle references on non ""id"" fields

check reference expression against table list first
"
316,Fix list types in GAE NDB after entity write,2013-12-02T21:30:49Z,2013-12-03T03:41:26Z,,,,"As per
http://code.google.com/p/appengine-ndb-experiment/issues/detail?id=208
(""List items from repeated StringProperty get mutated to _BaseValue on
put"") it seems to be expected behavior that lists in NDB models get
mutated to _BaseValue lists after .put() is called.

In web2py this corresponds to:

```
db.define_table('listintegertest',
    Field('dummy', 'boolean'),
    Field('integerlist', 'list:integer'),
    Field('stringlist', 'list:string'),
)

iidee = db.listintegertest.insert(
    integerlist=[1,2,3,4],
    stringlist=[""1"",""2"",""3"",""4""]
)
row = db.listintegertest(iidee)
db.listintegertest[row.id] = dict(dummy=True)

print ""type is %s"" % (type(row.integerlist[0]))
print ""type is %s"" % (type(row.stringlist[0]))
```

The output of the above is currently:

```
type is <class 'google.appengine.ext.ndb.model._BaseValue'>
type is <class 'google.appengine.ext.ndb.model._BaseValue'>
```

while this is expected:

```
type is <type 'int'>
type is <type 'unicode'>
```

The workaround is to copy the list from the NDB model instead of
relying on it not being changed afterwards.

list:reference is not affected since parse_list_references() already
recreates the list in NoSQLAdapter case.
"
315,Use translitcodec for urlify,2013-12-02T21:04:15Z,2014-03-02T23:24:07Z,,,,"[`urlify`](https://github.com/web2py/web2py/blob/231fa489cbe35408dba0ee41253750a065fa1fff/gluon/validators.py#L2505) does its job and does it well. However, for some languages `unicodedata.normalize('NFKD', s)` does not lead to a common replacement. For example
https://de.wikipedia.org/wiki/Gr%C3%BCn
is rather converted into
https://de.wikipedia.org/wiki/Gruen
than into
https://de.wikipedia.org/wiki/Grun.

[translitcodec](https://pypi.python.org/pypi/translitcodec) has a built-in translation table for common replacements which makes use of Markus Kuhn‚Äôs [transtab package](http://www.cl.cam.ac.uk/~mgk25/download/transtab.tar.gz).
"
314,extract_oracle_models.py script,2013-12-02T15:15:37Z,2013-12-02T16:18:44Z,,,,"Generates a web2py model from an existing (legacy) Oracle 11g database
"
313,Fix for conflict,2013-12-02T00:25:16Z,2013-12-02T01:50:35Z,,,,
312,Fix references with GAE in NDB mode,2013-12-01T21:47:14Z,2013-12-02T07:29:14Z,,,,"For reference types the IntegerProperty class (no matter if NDB or
not) constructor is passed the referenced table name as the first
parameter.

For non-NDB, the first parameter is 'verbose_name'. For NDB, the first
parameter is 'name'.

In NDB mode this causes the property to have a wrong identity and
therefore references fail to work properly.

The verbose_name set in non-NDB mode is relatively harmless in
comparison, but seems to be wrong as well as it does not really make
sense.

Do not pass referenced table name to the IntegerProperty constructor in
either case.
"
311,Update access.py,2013-12-01T16:39:45Z,2013-12-02T01:48:43Z,,,,"<type 'exceptions.AttributeError'> 'dict' object has no attribute 'is_mobile'""
"
310,Update buttons.py,2013-12-01T16:38:12Z,2013-12-02T01:48:05Z,,,,"<type 'exceptions.AttributeError'> 'dict' object has no attribute 'is_mobile'""
"
309,Enhance encoding header of languages/*.py,2013-11-29T12:09:10Z,2013-11-30T22:50:43Z,,,,
308,fixes issue 1780,2013-11-25T22:14:22Z,2013-11-27T18:00:49Z,,,,
307,Comment documentation typo correction,2013-11-25T18:35:01Z,2013-11-25T18:50:05Z,,,,
306,fix issue-1789,2013-11-25T09:10:58Z,2013-11-25T18:49:05Z,,,,"this PR fix issue 1789 and it allows to make expression against geometry fields, however imho it is more a workaround. It doesn't brake the backward compatibility, on the other hand I think that adding .st_astext() to all geometry fields by default is not the best way we can follow. 
The st_astext() converts the binary content of the database in a more readable form. However, the st_astext is not the only function we can use to convert the binary content (es in postgis we can use st_asewkt).
My view is to fix the issue with this PR, and review the whole code in a future release ex: by removing the explicit call to .st_astext, user can still add the .st_astext when needed.
"
305,fix form action in admin settings,2013-11-23T23:24:09Z,2013-11-24T03:50:22Z,,,,"broken after this commit 643e9455400f285da30220107a4af4fb717ca988

web2py.js:265 doesn't test (action === undefined), I don't know if this is wanted or is an issue.
"
304,customize the keys of the dict returned by executesql (with as_dict=True...,2013-11-22T14:06:49Z,2013-11-22T14:39:05Z,,,,"see https://groups.google.com/d/msg/web2py/6c0iPBa4xH4/ndkXpteKy-gJ
"
303,Retire the Splash Screen and Beautify GUI.,2013-11-19T21:50:41Z,2013-11-20T15:19:50Z,,,,"Lets give 5 seconds back to most users on startup by retiring the
artificial Splash Screen. Replace with a prettier server manager window.

-Makes product feel faster.
-Looks much better
-Fixes bug where two windows are created when using (-Q)
-Blocks resize on UI window.
-Window is now labeled ProgramName
"
302,Static versioning in URL() function,2013-11-18T00:25:49Z,2014-05-29T16:02:41Z,,,,"Option to add response.static_version to static url generated with URL() function.

For more details please take a look at: https://groups.google.com/forum/#!topic/web2py-developers/ONWD7BpZAis
"
301,Issue #1772: let the user choose uploads_in_blob with mongodb,2013-11-18T00:07:50Z,2013-11-20T15:17:49Z,,,,"About this issue:
https://code.google.com/p/web2py/issues/detail?id=1772

and because of @mdipierro commit https://github.com/web2py/web2py/commit/97739e9e8a9cac642c47f1d7e0adbc9cc5ec4cc8

this give users the possibility to choose, also doesn't break compatibility to apps using blob storage in web2py 2.7.4 and above.
"
300,MongoDB: fixed object_id function (hex values),2013-11-16T20:20:44Z,2013-11-17T15:15:34Z,,,,"Google Code issue 1778
"
299,Mongodb dal.py typos,2013-11-16T16:13:59Z,2013-11-16T17:51:16Z,,,,
298,Update ru.py,2013-11-15T10:07:16Z,2013-11-16T09:28:14Z,,,,
297,Added two libs and icon path to setup.py,2013-11-15T09:25:24Z,2013-11-16T09:27:39Z,,,,"setup.py sdist didn't work with the image path, and when it worked, dist didn't include that two modules.
"
296,quoting of tablenames and field names,2013-11-14T15:12:53Z,2013-12-03T11:38:52Z,,,,"Better quoting for sql objects.
"
295,improved performance on mssql4,2013-11-13T22:20:34Z,2013-11-16T09:24:55Z,,,,"that's because web2py by default fetches references without an orderby. Anyway, now it uses TOP that is still faster for a little margin when not needing to skip some of the rows of the resultset (offset).
"
294,replace write to stderr with LOGGER in failed database connection attemp...,2013-11-13T06:44:29Z,2013-11-16T09:24:18Z,,,,"...t
( see https://code.google.com/p/web2py/issues/detail?id=1773 where I explain that the write to stderr causes an exception when running rocket as a windows service)
"
293,Adds bind capability to OpenLDAP,2013-11-11T17:54:04Z,2013-11-16T09:23:30Z,,,,"Adds to OpenLDAP (mode=uid and mode=cn) the capability to bind to the directory with an admin account in order to search it.
"
292,Support HTTP Status 509,2013-11-08T10:47:10Z,2013-11-11T15:43:56Z,,,,"Whilst this isn't an official RFC, it's documented on e.g. Wikipedia. http://en.wikipedia.org/wiki/List_of_HTTP_status_codes#5xx_Server_Error
"
291,Make component forms submit to their own action property,2013-11-06T21:45:25Z,2013-11-06T22:55:12Z,,,,"Massimo, this PR allows a form inside a component to make submission to its own action, without any class customization.

I think this PR fixes bug to submit to component url. Not the previous one, sent my email.
"
290,Closed html commment.,2013-11-05T22:09:12Z,2013-11-06T16:32:01Z,,,,
289,simple fix for wrong type detection of SQLCustomTypes,2013-11-05T15:10:57Z,2013-11-06T16:31:34Z,,,,
288,Translate the formatters for DATE/DATETIME_IN_RANGE validators,2013-11-01T21:48:41Z,2013-11-06T16:31:06Z,,,,"IS_DATE and IS_DATETIME translate the format string to given everybody the opportunity to change it for each language.

Unfortunately the same format string is not translated when we use IS_DATE_IN_RANGE and IS_DATETIME_IN_RANGE. It would be nice if we could translate them using the same technique. 
"
287,"fixes issue 1753, web2py.js doesn't set the disabled state for inputs with name",2013-10-31T20:12:22Z,2013-11-01T14:34:56Z,,,,
286,fix for empty python file in admin editor,2013-10-28T09:20:03Z,2013-10-29T21:05:21Z,,,,"It's a codemirror issue, I'm sending a PR to codemirror too
"
285,"fixed issue with ordereddict in python < 2.7, added rname support also for fields",2013-10-27T13:40:48Z,2013-10-29T21:03:22Z,,,,
284,Admin app: changed string interpolation in T calls,2013-10-27T13:31:41Z,2013-10-29T21:01:38Z,,,,
283,Fixed wiki get render method,2013-10-27T00:43:01Z,2013-10-27T01:25:44Z,,,,"From Google code issue 1740

http://code.google.com/p/web2py/issues/detail?id=1740
"
282,Make executesql as dict ordered,2013-10-25T21:15:05Z,2013-10-27T01:24:57Z,,,,
281,update pypyodbc to 1.2.0,2013-10-25T19:44:03Z,2013-10-27T01:24:25Z,,,,
280,Fixing mongodb binary repr,2013-10-25T08:42:22Z,2013-10-27T01:23:52Z,,,,"If value is not a basestring we got type Exception in converting to Binary. This commit solve the issue.

For more details please take a look at https://groups.google.com/forum/#!topic/web2py-developers/6MKjeIzYhxI
"
279,Dynamic tab width in editor settings,2013-10-24T14:21:24Z,2013-10-27T01:23:16Z,,,,"Two more things in admin editor:
- The tab size is now a function of the number of tabs already opened. It seems to work well, It could need more test & improvements though.
- two new configurable options
"
278,allow unordered references (NOT recommended but still possible with limitations),2013-10-23T19:51:20Z,2013-10-24T00:46:09Z,,,,
277,codemirror 3.19 and directory cleanup,2013-10-23T11:45:06Z,2013-10-24T00:44:15Z,,,,
276,"inject W2P_TASK in current, so you can use current.W2P_TASK in imported ...",2013-10-22T22:03:57Z,2013-10-24T00:43:36Z,,,,"...modules. Thanks @Xiaonuo for the feature request
"
275,bootstrapSwitch in admin,2013-10-22T15:39:25Z,2013-10-22T22:04:01Z,,,,"This PR introduces a plugin for bootstrap switch in admin app, it is used in the admin editor settings
"
274,bootstrap3 formstyle,2013-10-22T14:47:34Z,2013-10-22T21:59:48Z,,,,
273,"Anthony's patch for model ordering issue ...he says: ""The problem is that gluon.compileapp.model_cmp sorts",2013-10-22T01:57:57Z,2013-10-22T02:30:06Z,,,,"based on number of ""."" characters, which works for compiled apps but not
for non-compiled apps (should sort on os.path.sep in the latter case).
Attached is a patch that fixes that."" (thanks Anthony)
"
272,bumped bootstrap to 2.3.2,2013-10-21T21:17:43Z,2013-10-22T02:34:58Z,,,,
271,fix building on windows. New handler for gevented webserver,2013-10-21T19:54:02Z,2013-10-22T02:32:34Z,,,,
270,"fix for references, DAL tests pass also on MSSQL now",2013-10-21T19:28:38Z,2013-10-22T02:31:50Z,,,,
269,Fix config to save checkboxes values when they are unchecked (false),2013-10-21T08:07:55Z,2013-10-22T02:31:14Z,,,,"In settings.cfg we must store if a preference is enabled(true) or disabled(false).
Given the fact that checkbox are not serialized when unchecked, this trick allows us to set them as 'false'.

We can think about the possibility to move that piece of code directly in the config class but we must know which language (javascript/python) to use to save the value. Currently for the editor section I use javascript, namely the unchecked value is set as 'false' instead of 'False'.
"
268,imap: use common field types plus appadmin support,2013-10-20T11:52:50Z,2013-10-20T14:56:59Z,,,,"- Fixes issue 1731
- Fixes an issue with imap insert default datetime
- Adds step variable to appadmin select action (100 by default or 3 if it finds an imap db). Required for slow remote queries. Note: appadmin could also set the pagination step with user input.
- Adds fields list for appadmin select action (filtered for imap dbs). Required for faster queries and because some message contents can raise sqlform decoding errors.
- Allows imap insert and update with appadmin
"
267,Tab width (new option in editor settings),2013-10-20T06:48:40Z,2013-10-20T14:56:18Z,,,,"- better options management to simplify the integration of others (if any)
- added two options for handling tab ('tab width' and 'indent with tabs')
"
266,remove winservice support,2013-10-19T18:45:40Z,2013-10-19T22:34:56Z,,,,
265,Fixed imap get_last_message to return positive integer (google code issue 1729),2013-10-19T13:01:02Z,2013-10-19T22:33:46Z,,,,
264,Code folding in admin editor,2013-10-19T10:24:28Z,2013-10-19T22:32:04Z,,,,"For the time being, It is disabled by default, you should enable it in the editor settings
"
263,"add support for rname (meaning ""real name"") for table names",2013-10-17T22:13:22Z,2013-10-20T20:45:01Z,,,,"Warning: high experimental.
TODO: 
- add support for rname for fields too
- figure out something for the current .table files, to be able to auto-import everything
- expect lots of fiddles for everything that is not SQLite, MySQL and PostgreSQL. MSSQL will be tested on the weekend
"
262,"turn on SQLITE FK support by default, added static_version",2013-10-17T19:34:29Z,2013-10-20T20:42:09Z,,,,
261,Editor cleanup,2013-10-17T14:24:30Z,2013-10-18T17:30:36Z,,,,"- removed dead code referring to the former editors
- editor fix to work again when is_mobile=True (We/I broke it several months ago)
- fix editor in javascript mode, see https://groups.google.com/forum/#!topic/web2py/CA2vixMUSZk
"
260,New admin app plugin download,2013-10-14T18:19:27Z,2013-10-16T14:15:08Z,,,,"New feature:
Clicking on the button ""download plugins"" (design) shows a list of available plugins from web2pyslices api (cached in session). You can install any available plugin with a single command. Note: It requires that the slice download link points to a .w2p file.
"
259,mssql 2012 support for pagination,2013-10-13T21:06:18Z,2013-10-14T01:50:08Z,,,,"enable true pagination support for MSSQL (only available on 2012). Has a quirk, though: if there's no order specified, the new statements can't be used (probably a good limitation). 
So, this adapter adds a truly random orderby clause, inferring that the user indeed ""seeked"" randomness not specifying a proper orderby statement (currently achievable only if select(limitby=(0,10), orderby_on_limitby=False))
"
258,return the correct content-type for the graph,2013-10-13T19:32:04Z,2013-10-14T01:48:56Z,,,,"without the proper content-type, all you see is a garbled binary output....
"
257,response.static_version support in admin,2013-10-13T19:27:43Z,2013-10-14T01:48:04Z,,,,"We have response.static_version or a while in stable. 
Users keep trumping in cache errors that we can avoid. 
Why don't we ?
Its about time :-D
"
256,"removed unmaintained test.sh, ported validators doctests to unittests (and more added), fixed an issue with IS_MATCH() that never worked",2013-10-13T15:53:51Z,2013-10-14T13:39:58Z,,,,"I'd vote for stripping the doctests code from gluon/validators.py too. 
It's a mess of everyone's standards (ending in a ""whatever works"" soup) accumulated in time.
Since we decided to go with tests only with unittests, let's keep strictly what's needed to generate the docs (remember, we should start switching to sphinx in the near future) inside the source code of gluon/*
"
255,IMAP: insert support for base64 attachment payload,2013-10-12T20:33:36Z,2013-10-13T13:27:16Z,,,,"This patch adds support for encoded binary attachment contents for the insert. The imapdb.insert command will automatically set the transfer encoding part header when specified. By default expects a text file attachment with utf-8 charset.
"
254,Improvements for number range validators,2013-10-12T20:20:07Z,2013-10-13T13:26:27Z,,,,"First commit is fixes, especially that 0 wasn't accepted, for example `IS_INT_IN_RANGE(-5,5)(0)` misbehaved.

Second commit is for consistency. `IS_INT_IN_RANGE(None,None,'')('foo')` misbehaved because unlike the other eleven cases, `error_message` wasn't compared against None. And the word `decimal` was inconsistent with the other seven decimal/float cases, especially the corresponding None/None case of the float range validator.

Third commit is a rewrite of the three number range validator constructors. I found especially the old integer one very complicated, confusing and repetitive. Unless my thinking and tests failed, this should be a pure code rewrite, no change in behavior. My first two commits prepared for this.

Doctests and unittests look good, and I additionally ran a lot of tests with which I found the errors/inconsistencies fixed by my first two commits. My additional tests compared attributes and validation results of the validators before and after my third commit. They find no differences. Here's the code, in case you'd like to see:

```
mins = [-10, None]
maxs = [10, None, 9.5, 10.5, -10**98, 10**98, 2**31, 2**31-1, 2**31+1, 2**60, 10**10]
error_messages = ['foo', None, '']
values = [-11, -10, -9, -1, 0, 1, 9, 10, 11, '+2', 'bar', None, '', '0xF', '3.14', 3.14, '3.0', 3.0, 10**99, -10**99]
vali_pairs = ((new2_IS_INT_IN_RANGE, curr_IS_INT_IN_RANGE),
              (new2_IS_FLOAT_IN_RANGE, curr_IS_FLOAT_IN_RANGE),
              (new2_IS_DECIMAL_IN_RANGE, curr_IS_DECIMAL_IN_RANGE))

def compare_attributes(a, b):
    for attr in dir(a):
        if attr not in dir(b):
            print(""differ:\n  {}\n  has '{}'\n  {}\n  doesn't"".format(
                  a, attr, b))
        else:
            if not attr.startswith('__') and getattr(a, attr) != getattr(b, attr):
                print(""differ:\n  {}\n  '{}' is '{}'\n  {}\n  '{}' is '{}'"".format(
                    a, attr, getattr(a, attr), b, attr, getattr(b, attr)))
    for attr in dir(b):
        if attr not in dir(a):
            print(""differ:\n  {}\n  has '{}'\n  {}\n  doesn't"".format(
                  b, attr, a))

print('start comparing')
for vali_new, vali_cur in vali_pairs:
    print(""  comparing {}"".format(vali_new))
    for min in mins:
        for max in maxs:
            for error_message in error_messages:
                v_new = vali_new(min, max, error_message)
                v_cur = vali_cur(min, max, error_message)
                compare_attributes(v_new, v_cur)
                for value in values:
                    if v_new(value) != v_cur(value):
                        print(min, max, error_message, value, v_new(value), v_cur(value))
print('done comparing')
```

I'm fairly new to Python/web2py/git/GitHub, but I think my improvements are good and that I did things correctly. If not, please let me know.
"
253,use appropriate module for IPython 1.0.0,2013-10-12T19:56:01Z,2013-10-13T13:24:13Z,,,,"Maybe it works also for IPython 1.1
"
252,Issue/1692v3 OK merged my fix for virtual fields when fields argument is specified,2013-10-12T12:31:29Z,2013-10-12T14:23:25Z,,,,
251,build web2py also with bbfreeze,2013-10-12T12:26:51Z,2013-10-12T14:21:37Z,,,,"fixed little errors with the build process with py2exe, added the possibility to build also with bbfreeze
"
250,Add git pull and git push to the experimental mobile interface,2013-10-12T06:09:28Z,2013-10-12T14:20:26Z,,,,
249,Issue/1692v3 OK :) I merged my fix for virtual fields. ,2013-10-12T03:40:47Z,2013-10-12T11:47:05Z,,,,"Hi Massimo, in an recent commit you used a different approach to detect virtual fields in the case where the fields argument is not used. I have reverted to my approach because I didn't see the advantage of your approach (or didn't understand it).

The real benefit of this PR is to fix virtual fields in the probably-more important situation where fields= is used with SQLFORM.grid
"
248,New Codemirror option in editor config page to enable/disable autoclose-tag,2013-10-12T03:13:08Z,2013-10-12T14:17:44Z,,,,"Some unused directories have been removed.
Some functions have been optimized.
"
247,fix virtual fields with SQLFORM.grid fields=,2013-10-09T23:24:23Z,2013-10-11T23:38:40Z,,,,
246,Typo correction,2013-10-09T00:59:39Z,2013-10-11T23:37:08Z,,,,"""simply"" not ""simple""
"
245,Issue/1692 part 2: fix virtual fields when fields= is used in SQLFORM.grid,2013-10-08T23:03:27Z,2013-10-09T22:34:17Z,,,,"for some reason virtualfields do not get their tablename attribute set which was causing problems with the virtualfields changes to SQLFORM.grid. 
The first PR fixed this in cases where no fields argument was passed to the grid. 
This PR fixes it when fields is used. 

As well, I make sure that virtual fields appear after real fields in the order of columns in the case when the fields argument is not passed to SQLFORM.grid, which looks better; all sortable headings come earlier. 
"
244,fix for Issue 1692 virtual fields in SQLFORM.grid,2013-10-08T02:34:29Z,2013-10-08T16:35:51Z,,,,"fix for Issue 1692 virtual fields in SQLFORM.grid: this gets rid of the virtual field names from the SQL and at least in a simple test case shows the virtual field on the grid.
"
243,more spanish translations,2013-10-07T13:53:01Z,2013-10-08T16:34:16Z,,,,"more spanish translations
"
242,fix for using the shell with IPython >= 1.0,2013-10-06T22:20:16Z,2013-10-07T02:37:56Z,,,,"I have IPython 1.1 installed and needed this fix to start the shell
"
241,IMAP fixed patch for google code issue 1707,2013-10-06T18:46:49Z,2013-10-07T02:37:11Z,,,,"Now the convert_date function reads rfc5322 without weekday.
"
240,IMAP .insert support for custom date (Google Code issue 1707),2013-10-06T15:25:53Z,2013-10-06T17:20:39Z,,,,"The patch adds the Date header to the message inserted values (which on message retrieval returns a void field if not properly set). It also adds RFC5322 date format conversion for datetime input
"
239,Fixed problem with Rows.render,2013-10-06T13:06:38Z,2013-10-06T15:15:09Z,,,,"When calling Rows.render() without a record index, the recursive call mistakenly used the old method name (self.repr) instead of the current name (self.render).
"
238,Support for HTTP Status Code: 429 - Too Many Requests,2013-10-05T14:43:26Z,2013-10-06T15:09:52Z,,,,"Currently raising HTTP 429 results in HTTP 500 being sent.  This patch resolves that issue.
(As per RFC 6585 - https://tools.ietf.org/html/rfc6585)
"
237,Added gitignore restrictions and changes for admin.py,2013-10-05T13:01:31Z,2013-10-06T15:13:58Z,,,,
236,fixed gevent workers,2013-10-05T12:02:40Z,2013-10-06T15:11:03Z,,,,
235,Multiple changes and fixes,2013-10-05T03:24:24Z,2013-10-05T13:23:05Z,,,,"Using the ""inspect code"" from pycharm i have notice a lot of problems or non pep good practices in the code....
"
234,suppress logging from gevent,2013-10-03T21:59:52Z,2013-10-05T11:36:10Z,,,,"pass the entire set of options to allow workers (and optionally other configs to come for other servers (SSL, anyone ? ))
"
233,fixed import for taskbar,2013-10-01T18:46:41Z,2013-10-01T20:18:01Z,,,,
232,Updated jquery-ui css resource to fix 404 error,2013-09-28T20:50:11Z,2013-10-01T15:04:16Z,,,,"As per issue 1695, the css for the jquery-ui enabling code is out of date. By default this code section is commented out. I have replaced the now-missing base theme with the theme ui-lightness. 
"
231,codemirror 3.18 with enabled the fullscreen addon,2013-09-26T19:59:41Z,2013-09-26T21:37:47Z,,,,
230,Add _return_record to update_or_insert,2013-09-26T09:35:00Z,2013-09-26T21:40:16Z,,,,"From the web2py discussion @
https://groups.google.com/forum/#!topic/web2py/vjU9sYCoxU0 this
implements Anthony's suggestion to return the full record after a
successful update with update_or_insert.

To use pass '_return_record=True' before arguments.

The default action of returning None is retained.

In [3]: db.auth_user.update_or_insert(email='user')
Out[3]: 1L

In [4]: db.auth_user.update_or_insert(email='user')

In [5]: db.auth_user.update_or_insert(_return_record=True, email='user')
Out[5]: <Row {'first_name': '', 'last_name': '', 'registration_id': '',
'id': 1L, 'reset_password_key': '', 'password': None,
'registration_key': '', 'email': 'user'}>
"
229,add a class to each TD in SQLFORM.grid identifying it by table_fieldname,2013-09-25T11:30:45Z,2013-09-26T07:47:17Z,,,,"I think it would be handy for jquery purposes to have the columns in SQLFORM.grid identified by class. 
This is my attempt at doing it. Note that I'm not sure that field.tablename + '_' + field.name is always a legal CSS class name. 
"
228,pass the correct element when trapping links,2013-09-24T22:10:17Z,2013-09-24T22:23:07Z,,,,
227,Update location of handlers so that make_min_web2py.py works again,2013-09-24T20:47:54Z,2013-09-24T22:24:39Z,,IOError,IOError: [Errno 2] No such file or directory: 'fcgihandler.py',"The location of the handlers changed in 07f74c63621 and since then
this error blocked the creation of a minizimed web2py instance:

IOError: [Errno 2] No such file or directory: 'fcgihandler.py'
"
226,update pbkdf2_ctypes.py to upstream,2013-09-24T16:09:03Z,2013-09-24T18:51:34Z,,,,"Fixes related to detect old unsupported OS X versions. Comply to PATH environment in loading DLL on Windows.  
"
225,"fixed line not found issues in set breakpoint (linecache patch, used by the debugger)",2013-09-24T06:03:10Z,2013-09-24T18:44:22Z,,,,"It seems that the python debugger framework (bdb, used by the online debugger) uses linecache.getline that is not working under py2exe for user applications (maybe because py2exe monkey patch it)

Also, that function stores a internal line cache, so it doesn't work very well with web2py ""eval"" execution model, and may not find new lines added to a controller after a breakpoint was set (it doesn't refresh the file source code if modified).

This PR fixes both.

Please note that the debug interact view reads the full source code using readlines, so linecache is not used there and is not affected by this issue.
"
224,"session2trash.py: easier to use within a module, e.g. in the scheduler",2013-09-23T20:42:27Z,2013-09-24T18:41:29Z,,,,
223,Fixes and improvements in admin editor,2013-09-22T23:13:39Z,2013-09-23T15:35:05Z,,,,"Fix lost flash message in case of error when save editor (crtl-s). Change Esc to Shift-Esc to exit from Fullscreen mode, because this cause collision with the Vim mode (Esc key). Add a select into the config button to select 'default', 'vim' or 'emacs' editor
"
222,Various Minor Auth Additions,2013-09-21T23:56:56Z,2013-09-23T15:34:28Z,,,,"These are various small changes I have in my local copy of web2py to let met setup user registration/login forms for some of my sites.  I thought they would make sense in the main repo.
Thanks,
Charles
"
221,update vars only if FieldStorage holds actually something,2013-09-21T12:12:29Z,2013-09-21T23:15:02Z,,,,"Groans with the upper ""G"" to FieldStorage. If it's empty, it's not an empty dict, so the following post_vars.update() goes into exception. 
"
220,Edited cookie handling code when using a db to store sessions,2013-09-20T19:31:17Z,2013-09-20T19:51:49Z,,,,"- Session id cookie is always sent back to client in response
- When no cookie is sent in as a request, a new session id is created
"
219,fixed issue when target is none. removed useless file in admin/static/js,2013-09-19T19:53:53Z,2013-09-19T21:44:03Z,,,,
218,"startswith, endswith and contains for upload fields",2013-09-19T09:01:18Z,2013-09-19T19:10:07Z,,,,
217,Minor but important fix with script for uwsgi / ubuntu,2013-09-19T02:22:40Z,2013-09-19T05:31:23Z,,,,"Basicly copies the proper handler (wsgi) to the web2py root
"
216,Set document title when an ajax fragment has got a <title> element,2013-09-18T15:41:02Z,2013-09-19T19:09:01Z,,,,"This commit adds the possibility to set the title page when a fragment is loaded through ajax_page and contains a <title> element.
"
215,prevent .load to propagate in case of component redirect on login page,2013-09-18T14:09:12Z,2014-03-02T23:14:09Z,,,,
214,fixes keyboard shortcuts in admin when modifying js or css files,2013-09-15T09:24:41Z,2013-09-18T15:05:49Z,,,,
213,Fix imap insert multipart detection,2013-09-14T19:10:45Z,2013-09-18T15:05:05Z,,,,"The current imap adapter does not detect some messages with attachments as multipart. This change fixes this and also avoids a type error when setting attachment mime types as None
"
212,never got to understand ASI. Let's behave and have a semicolon.,2013-09-13T22:24:44Z,2013-09-13T22:27:46Z,,,,
211,Pointless to set session.flash before session.renew,2013-09-12T10:33:41Z,2013-09-13T20:41:12Z,,,,"The logout message would be removed by session.renew => this commit switches the order of action
"
210,spaces instead of tabs,2013-09-12T10:12:18Z,2013-09-13T20:38:53Z,,,,
209,Allow raising a custom Service.JsonRpcException inside a jsonrpc2 action,2013-09-11T16:06:08Z,2013-09-11T16:22:05Z,,,,"Second try...

Allows generating custom JsonRpcException  in any jsonrpc2 method:

raise Service.JsonRpcException(1000, 'a custom code and a custom error message'
"
208,Allow raising a custom Service.JsonRpcException inside a jsonrpc2 action,2013-09-11T15:53:39Z,2013-09-11T16:03:07Z,,,,"With this any jsonrpc2 call can raise a custom exception.
For instance:

raise Service.JsonRpcException(1000, 'a custom error with a custom error code')
"
207,"fixed redis_session.py, thanks @Giovanni for discovering",2013-09-09T19:33:20Z,2013-09-09T21:59:55Z,,,,
206,Add 'set' to serializable types in Query.as_dict,2013-09-09T13:03:05Z,2013-09-09T17:53:26Z,,,,"Sets were missing from serializable types - added by this commit.
"
205,More control over the destination container of a web2py_ajax call,2013-09-09T06:51:13Z,2013-09-09T17:52:39Z,,,,"The patch adds the destination container as a parameter of the event fired by web2py_ajax.
"
204,grid search widget always use ISO format for date(time) fields,2013-09-08T16:30:30Z,2013-09-09T17:51:44Z,,,,"fixes issue 1640
"
203,Update validators.py,2013-09-07T23:58:03Z,2013-09-08T01:47:32Z,,,,"Updated the IS_DATETIME validator; otherwise it would fail when creating a new record with SQLFORM, for dates that have an empty default.
"
202,"streamlined the ""working..."" status handling and added an example",2013-09-07T13:35:11Z,2013-09-07T14:22:14Z,,,,"do I want http://lab.hakim.se/ladda/ in web2py? Badly ^___^
"
201,little speedup for table init,2013-09-06T13:30:20Z,2013-09-06T18:58:58Z,,,,
200,Lazy tables recursion fix 3,2013-09-06T03:18:23Z,2013-09-06T18:52:37Z,,,,"Try to solve the missing lazy table references see: https://groups.google.com/d/msg/web2py-developers/txdJ_6to8VA/Dl70CZ3hE2MJ

DO NOT MERGE AS IS!
"
199, download static file via http,2013-09-04T22:06:40Z,2013-09-06T19:00:35Z,,,,"i'm from colombia, I'm not very good at writing in English, but this new functionality allows automatically download static files via http.... is very useful
"
198,help preventing double submissions for normal forms too. ,2013-09-04T21:23:43Z,2013-09-05T19:24:53Z,,,,"Helps with issue #1644
"
197,DAL dict parameters (issue 1639). Fixed tests (again),2013-09-04T19:30:25Z,2013-09-05T19:24:02Z,,,,"Now it passes all tests. Fixed serializers.py so it traverses the obj tree (including iterables)  
"
196,DAL dict parameters (issue 1639). Fixed tests,2013-09-03T22:49:51Z,2013-09-03T23:13:36Z,,,,
195,attach datetime/date/time validators only on events,2013-09-03T19:01:46Z,2013-09-04T01:37:11Z,,,,
194,Fixing some typos inside tests and unneeded modules,2013-09-03T00:35:34Z,2013-09-03T01:37:49Z,,,,"After trying to fix a bug for the autocomplete widget (which i notice was fixed in the last version), i have fix some minor problems and typos
"
193,seems that --use-mirrors is ATM borked.,2013-08-31T23:16:11Z,2013-08-31T23:54:33Z,,,,"Anyway, --use-mirrors is going to de deprecated in future releases of pip.
Pypi infrastructure is more reliable than a year ago, let's hope we don't incur in any
downtimes.
"
192,fix scripts fetching handlers from /handlers,2013-08-31T12:25:22Z,2013-08-31T14:45:05Z,,,,
191,fix anyserver with logging and/or profiler,2013-08-30T20:47:17Z,2013-08-30T23:25:46Z,,,,
190,fix examples app,2013-08-30T20:06:23Z,2013-08-30T23:25:06Z,,,,
189,fixed issue 1584 (grid export with left join),2013-08-30T19:15:02Z,2013-08-30T23:24:29Z,,,,
188,Popen objects leak fixed,2013-08-30T12:54:11Z,2013-08-30T23:23:47Z,,,,"In windows web2py cron is not delete Popen object after task ends.
"
187,fixed the order of response.js execution. Thanks @Anthony,2013-08-29T19:00:20Z,2013-08-29T23:43:12Z,,,,
186,auth navbar - added bare mode and PEP8 tweaks,2013-08-29T18:45:09Z,2013-08-29T18:58:12Z,,,,"auth navbar more flexible. Now it's simple to obtain a customized navbar like this (see the example in the commited code):  

![_navbar1](https://f.cloud.github.com/assets/3496662/1052229/c16c4158-10d9-11e3-8ab4-92e91676c16a.jpg)
![_navbar2](https://f.cloud.github.com/assets/3496662/1052228/c15dcf92-10d9-11e3-8f8d-2f29b19f4169.jpg)

without to create several navbar modes. Moreover the navbar function is more compliant with PEP8 rules.
"
185,send session cookie always. ,2013-08-28T22:52:44Z,2013-08-29T03:10:52Z,,,,"Please test it carefully with session data stored in cookies.
"
184,Rewrite navbar & added sublime to gitignore,2013-08-27T13:05:52Z,2013-08-27T22:27:09Z,,,,"Does not follow PEP8 completely and have not tested for performance.
If necessarily i can fix it to follow PEP8.
"
183,added boilerplate to be able to run tests from anywhere,2013-08-25T16:45:46Z,2013-08-26T00:26:10Z,,,,"Before sys.path was not the same as the default configuration if tests were run from different places as getcwd().
Now instead they are consistently as the normal web2py environment. Everyone creating new tests files from those stubs will incur in no issues.

Added test for validate_and_insert() too.
"
182,redis_session: support new session logic,2013-08-24T14:42:20Z,2013-08-24T21:30:59Z,,,,
181,fix issue with scheduler namespace. Thanks @limedrop for spotting this.,2013-08-24T12:07:38Z,2013-08-24T12:57:30Z,,,,"https://groups.google.com/d/msg/web2py/itMQc2OnA3w/EUwHytOrxcsJ
"
180,Support querying for null values in mongoDB,2013-08-23T11:21:49Z,2013-08-24T10:19:36Z,,,,"This should be a very simple fix of issue 1641.
Please see:
https://code.google.com/p/web2py/issues/detail?id=1641
https://groups.google.com/forum/#!topic/web2py-developers/jDBEM-lbvsk
"
179,Ability to send emails with empty message body.,2013-08-22T21:03:26Z,2013-08-24T10:18:37Z,,UnboundLocalError,UnboundLocalError: local variable 'attachment' referenced before assignment,"Attempts to send emails with empty message body (message="""") lead to an UnboundLocalError:

File ""/home/rms/prod/gluon/tools.py"", line 450, in send
    payload_in = attachment
UnboundLocalError: local variable 'attachment' referenced before assignment

This fixes it.
"
178,fixed issue 1647,2013-08-22T19:20:52Z,2013-08-24T09:35:34Z,,,,
177,session id null on cookieless client.,2013-08-21T10:20:19Z,2013-08-21T12:14:57Z,,,,
176,Update dal.py,2013-08-21T09:13:27Z,2013-08-21T22:24:08Z,,,,"I think It will be useful to update the table contents and to validate the data previously.

On the other hand, I think there is something weird in the update_or_insert definition (Class table) because it is not working properly on data updating.
"
175,fix for issue 1642,2013-08-20T20:23:07Z,2013-08-21T07:44:24Z,,,,
174,figure out correctly the content-type for request.restful. Thanks @mcabo,2013-08-20T19:23:59Z,2013-08-21T07:42:59Z,,,,
173,standardized keyprefix,2013-08-20T19:04:39Z,2013-08-21T07:41:19Z,,,,
172,Fix in redis_session.py select: prevent errors when value is integer/long,2013-08-20T14:53:51Z,2013-08-20T16:00:22Z,,,,"See discussion on google groups: https://groups.google.com/forum/#!topic/web2py-developers/JvbFzXFXNWY
"
171,Update contenttype.py,2013-08-20T14:37:41Z,2013-08-20T18:35:06Z,,,,"To accept filename without point

https://groups.google.com/forum/#!topicsearchin/web2py/restful$20content-type/web2py/yHAsCqjAOWg
"
170,profiler now save dumps in a dir,2013-08-17T12:04:03Z,2013-08-17T16:08:42Z,,,,
169,pyfpdf contrib template & html updates,2013-08-16T05:34:45Z,2013-08-17T16:18:31Z,,,,"some cumulative minor fixes:
- template Row.copy() -> dict(row) (issue 1255)
- html fonts, heading sizes and align
"
168,fixed issue with request.body. Needs refactoring,2013-08-13T21:46:32Z,2013-08-14T16:30:27Z,,,,
167,NEEDS TESTING,2013-08-13T07:23:04Z,2013-08-13T13:58:42Z,,,,"first() backed by limitby to avoid memory and cpu cycles wasting

TESTED with --run_system_tests but I suspect not everything is covered
"
166,removed wrong exception that masked other errors,2013-08-13T06:57:20Z,2013-08-13T13:57:02Z,,,,
165,"added enhancement 1626, marker shown in grid also for default orderby",2013-08-12T22:00:00Z,2013-08-13T13:55:11Z,,,,"and removed a few unused imports
"
164,fixed issue #1622. Thanks @kyleflanagan for reporting it,2013-08-09T19:06:36Z,2013-08-09T19:08:46Z,,,,
163,fixed issue with grid and groupby,2013-08-07T13:40:50Z,2013-08-07T14:30:49Z,,,,
162,The disabled_with message should be translatable,2013-08-05T11:19:00Z,2013-08-05T12:39:43Z,,,,"The disabled_with message should be translatable...
"
161,Fixing bson binary TypeOf exception after fixing issue 1612,2013-08-04T21:34:00Z,2013-08-06T13:58:12Z,,,,"After fixing issue 1612, sometimes (encountered with auth) we have values that are not strings, so we had to convert them. See topic on developers group: https://groups.google.com/forum/#!topic/web2py-developers/6MKjeIzYhxI
"
160,fixed issue 1611 (scheduler's migrate should follow Auth's migrate behaviour),2013-08-04T18:58:11Z,2013-08-04T21:35:51Z,,,,
159,fixed bug with Mysql. Thanks @Adi for reporting.,2013-08-03T15:57:07Z,2013-08-04T21:35:05Z,,,,
158,fix issue with sys.path. ,2013-08-03T00:53:48Z,2013-08-03T07:49:22Z,,,,"Now the path looks like ['root/gluon', 'root/site-packages', 'root'] like in a normal web request. Given that the recommended way to start the scheduler on its own is to do 

```
 python gluon/scheduler.py -u .....
```

there are no problems with the sys.path at all: the sys.path dance is not needed and we're back having exactly the same sys.path as every other web request/shell environment . Discussion on the sys.path dance has been done here https://github.com/web2py/web2py/pull/156

Hope it's the final one.
Thanks again to @jklundell for reviewing and the patience.  
"
157,"fixed bug introduced with commit ""no more removal of ORDERBY in MSSQL""",2013-08-02T19:15:32Z,2013-08-03T07:48:11Z,,,,"commit df4d8a523860eaa60547539188faf4fed1d7cf74
"
156,fixed sys.path dance at top,2013-08-02T18:40:56Z,2013-08-03T00:31:19Z,,,,"thanks @jlundell for pointing it out
"
155,fix typo in dal.py,2013-08-02T14:59:14Z,2013-08-03T07:47:17Z,,,,
154,Fix form validators in admin application.,2013-08-01T14:50:28Z,2013-08-03T07:46:24Z,,,,
153,call to build_parsemap() on __init__ instead of at every select(),2013-07-31T22:12:07Z,2013-08-01T06:59:42Z,,,,"hard to give a consistent figure, but for ~10 select()s the speedup is ~3%. Speedup grows with the number of select()s for every request (if DAL is used within a web env) or for every select() done in a single connection (e.g. in a script). 

There's a small performance penalty only if the application has a DAL connection but the controller doesn't need any select(). Anyway, given that in that case the time to build one-time the parsemap dict is the same one saved for each and every select() operation, I think that this behaviour (calling on **init**) is better than calling it in parse() for the majority of the applications. 

This commit limits users fiddling with the undocumented build_parsemap() function, because it's not possible to specify a custom parsemap after connecting to a database. Given that such users are pretty advanced, they can circumvent the limit overriding the adapter with a custom build_parsemap().
"
152,"added better handling of missing library, added (unstable) code for supporting OS X",2013-07-31T22:04:07Z,2013-08-01T13:22:35Z,,,,"**must be tested on OS X**
"
151,Pbkd2f darwin,2013-07-31T21:56:57Z,2013-07-31T21:57:58Z,,,,"Added support for Common Crypto. Works on Linux, 
**must be tested on OS X**
"
150,added roadmap in the community docs section,2013-07-31T19:52:33Z,2013-08-01T06:54:41Z,,,,
149,oauth1 timeout. pbkdf2_ctypes repository reference in docstring,2013-07-30T21:49:01Z,2013-08-01T06:53:29Z,,,,"Two little fixes
1. timeout for oauth1 on sockets
2. exception handling fixed in pbkdf2 
"
148,[READ BEFORE APPLYING] pbkdf2 implemented ctypes wrapper around OpenSSL native implementation.,2013-07-27T14:44:20Z,2013-07-30T13:59:49Z,,,,"...6x speedup

The code was only tested on linux and windows xp + OpenSSL-win32.  Needs to be tested on OS X and other OS's. Could be that on different OS's the code needs to be adapted point to correct library. 
"
147,fixed auth_event logging,2013-07-26T08:38:13Z,2013-07-27T11:58:24Z,,,,"logging_enabled was in auth.messages instead of auth.settings. logging logic had a typo
"
146,improved json validator to output meaningful error,2013-07-22T13:10:34Z,2013-07-22T19:40:37Z,,,,"Typo fix and improved error reporting in case of malformed json
"
145,bugfix native json fields were not supported correcly,2013-07-21T21:37:44Z,2013-07-21T21:51:12Z,,,,"should manage native json fields
"
144,changed way to detect missing key since None is already a possible value,2013-07-21T14:51:19Z,2013-07-21T21:53:26Z,,,,"Please check before applying
"
143,fix for postgresql when using an alias.,2013-07-19T08:26:26Z,2013-07-19T17:13:33Z,,,,"Before applying see here:

https://code.google.com/p/web2py/issues/detail?id=1593
"
142,get virtual fields with SQLFORM.grid working,2013-07-18T22:13:09Z,2013-07-19T17:12:53Z,,,,
141,admin - site page - small visual enhancements,2013-07-18T19:13:56Z,2013-07-19T17:11:09Z,,,,"![small_enhancements](https://f.cloud.github.com/assets/3496662/821613/0ba1a33e-efde-11e2-82be-f3236df8d0f8.jpg)
"
140,"files toggle in admin, maybe as Massimo would want it",2013-07-18T00:24:39Z,2013-07-18T07:24:48Z,,,,"files list sliding sidebar.
When we land on the admin edit page, the sidebar is intentionally shown and hidden after 1000 milliseconds so the user knows that it is there. By moving the mouse pointer on left margin of the page, the sidebar is shown again in order to select another file to be edited. The sidebar is on the top of the edit area that covers the whole page width.

![files_menu_bar](https://f.cloud.github.com/assets/3496662/816290/e86dc0ee-ef3f-11e2-8cfe-420bc6fe95a3.jpg)
"
139,removed pycrypto leaving only strxor for speeding up pbkdf2,2013-07-17T23:00:19Z,2013-07-18T07:23:53Z,,,,"pycrypto is performing very bad only strxor is worth keeping.
"
138,fix issue 1592,2013-07-17T21:23:19Z,2013-07-17T22:19:37Z,,,,
137,settings tab in admin editor,2013-07-17T10:01:08Z,2013-09-06T21:37:11Z,,,,"Initial commit that saves user's preferences 
"
136,optimizations. Switch to PyCrypto support in pbkdf2 when possible.,2013-07-17T01:06:07Z,2013-07-17T12:24:20Z,,,,"Optimizations. Handle with care!
"
135,customization of upload package input in admin interface,2013-07-14T21:34:29Z,2013-07-15T14:50:24Z,,,,"now this control has the same appearance in different browsers (tested in Chrome - last version, Firefox - last version, Opera - last version, IE10, IE9, IE8 but it should work also in IE7 and previous versions of Ch, Ff, Op) and it is better integrated in bootstrap form.  The functions of origin control are preserved, therefore in Chrome and Firefox we can also drag-and-drop a file.
Moreover the placeholder text can be translated (T function) and with javascript disabled the original control is rendered.

![immagine22](https://f.cloud.github.com/assets/3496662/795090/6a76b774-ecdb-11e2-90d5-1a925e141d91.jpg)
"
134,first step to a nicer code style of admin,2013-07-14T18:14:24Z,2013-07-14T19:37:03Z,,,,"small bits of refactor here and there
"
133,"normalized behaviour in A() handler, fixed anonymous function block.",2013-07-14T17:44:56Z,2013-07-14T19:36:00Z,,,,
132,updating jquery mobile to 1.3.1,2013-07-12T10:24:19Z,2013-07-14T19:35:27Z,,NOTE,NOTE: http://web2py.com/plugins/static/web2py.plugin.jqmobile.w2p needs to be updated manually,"JQuery mobile plugin is broken with new versions of jQuery.
This patch updates plugin_jqmobile and admin's mobile layout to use latest jQuery mobile (1.3.1).

NOTE: http://web2py.com/plugins/static/web2py.plugin.jqmobile.w2p needs to be updated manually
"
131,"allows add multiple submit buttons in ""selectable"" mode in SQLFORM.grid ...",2013-07-11T16:18:33Z,2013-07-14T19:34:51Z,,,,"...(with different decorate css classes)

second try :) see https://groups.google.com/d/topic/web2py-developers/nZXG6bc9qIs/discussion
"
130,some fixes for small visual bugs in bootstrap layout,2013-07-10T14:20:09Z,2013-07-11T17:54:03Z,,,,"- form input error text when formstyle='bootstrap' has fixed width.
  In narrow screens (see image):
- topbar has space in left and right sides;
- login button in topbar is unaligned.

![immagine](https://f.cloud.github.com/assets/3496662/775167/aeb1aa20-e96b-11e2-8bb8-7131c4b5a0fe.jpg)
"
129,speedup in case of keyed  tables,2013-07-09T07:10:00Z,2013-07-11T17:51:21Z,,,,
128,updating jQueryUI version,2013-07-08T10:04:22Z,2013-07-11T17:52:58Z,,,,"jQuery 1.9/1.10 breaks older versions of jQuery UI.
1.8 is not working with jQuery 1.10.

Updating UI to 1.10 to match jQuery version.
"
127,"multiple submit buttons can be used in ""selectable"" mode in SQLFORM.grid ...",2013-07-08T07:59:06Z,2013-07-11T16:19:42Z,,,,"...(with different decorate classes)

as proposal..

It seems logical to have several actions with selected items. 
What do you think?
"
126,fix for deprecated input-xlarge class to make input and select fields...,2013-07-08T07:54:30Z,2013-07-08T08:03:54Z,,,,"...the same size.

see twitter/bootstrap#3413

plus some small addition for .gitignore :)
"
125,fix for deprecated input-xlarge class to make input and select fields...,2013-07-08T03:06:05Z,2013-07-08T07:38:43Z,,,,"...the same size.

see https://github.com/twitter/bootstrap/issues/3413

plus some small addition for .gitignore
"
124,Adding some charsets,2013-07-04T16:59:02Z,2013-07-14T19:33:27Z,,,,"Newer versions of MySQL have more UTF-8 collations in addition to the new utf8_mb4 family.

For some additional information about utf8_mb4, please refer to [the manual](http://dev.mysql.com/doc/refman/5.5/en/charset-unicode-utf8mb4.html).

In my case, my server is configured to use utf8mb4_unicode_ci as default collation. This was raising a `KeyError: 224` during the connection attempts.

The command to retrieve the list was slightly modified as follows

``` bash
mysql -N -s -e""select id, character_set_name, collation_name, concat(\""'\"", is_default, \""'\"") from information_schema.collations order by id"" | xargs printf ""_charsets.add(Charset(%s, '%s', '%s', '%s'))\n""
```

but the output is quite same and I didn't removed the present instructions.

Hope it helps.
"
123,Row speedup3,2013-07-04T14:39:21Z,2013-07-05T07:09:35Z,,,,"profiling results of 2 runs on _new_ code followed by 2 runs on _old_ code:

https://gist.github.com/michele-comitini/5928306
"
122,Merge pull request #1 from web2py/web2py,2013-07-02T13:52:44Z,2013-07-02T13:53:15Z,,,,"pull request
"
121,This looks to be a typo left behind from previous code when checking for an __memcache_client,2013-07-01T17:45:42Z,2013-07-02T12:13:56Z,,,,
120,pull request,2013-07-01T11:25:45Z,2013-07-01T11:32:18Z,,,,"last versions
"
119,fixed issue 1567 with scheduler and Mysql,2013-06-29T20:49:53Z,2013-06-29T22:03:19Z,,,,
118,"fixed the collapse function, refactored LOAD() to use new web2py.js",2013-06-27T20:33:51Z,2013-06-28T09:47:59Z,,,,
117,Some speedups,2013-06-27T20:24:53Z,2013-06-29T16:17:37Z,,,,"Nothing spectacular
N.B. why there was a regexp in **getitem**() ?
find('.') seems faster than split('.') + len()

UPDATE:
_Restored_ the REGEXP since **getitem**() can be called with an Expression object _or_ the result of str(<Expression>) so isinstance cannot be used to reason on that 
"
116,"fixed the collapse function, refactored LOAD() to use new web2py.js",2013-06-27T20:21:02Z,2013-06-27T20:27:17Z,,,,
115,"nicer alignment, removed leftovers, new listwidget and passwordwidget",2013-06-26T22:30:26Z,2013-06-27T06:01:05Z,,,,
114,"nicer alignment, removed leftovers, new listwidget and passwordwidget",2013-06-26T22:03:58Z,2013-06-26T22:23:07Z,,,,
113,Session renewal fix + record versioning fix + postgres fk reference fix,2013-06-23T23:04:09Z,2013-06-24T13:48:58Z,,,,"1. When there is no session and sessions are stored on db by settings, login_user() failed because it tries to renew an None session.
2. record versioning must skip tables without '_id' field.
3. postgresql ""reference <table>.<field>"" fix on ""keyed"" tables i.e. with ""primarykey""
"
112,codemirror 3.14,2013-06-21T14:08:02Z,2013-06-21T15:06:04Z,,,,"- update codemirror
- added addon trailing space highlight
"
111,Codemirror 3.14,2013-06-21T08:40:29Z,2013-06-21T15:10:12Z,,,,"- update codemirror
- added  addon trailing space highlight
"
110,allow compute fields to depend on compute fields defined earlier,2013-06-20T17:29:48Z,2013-06-21T15:12:43Z,,,,"allow compute fields to depend on compute fields defined earlier
"
109,added pickle.HIGHEST_PROTOCOL to all dump() and dumps() calls.,2013-06-14T20:09:11Z,2013-06-14T20:23:19Z,,,,"added pickle.HIGHEST_PROTOCOL to all dump() and dumps() calls.
"
108,Editor improvements,2013-06-14T07:27:12Z,2013-06-15T18:54:52Z,,,,"- input box for search and open files
- warning message when closing an unsaved files
- buttons to change font-size (useful with projector etc)

tested on FF and Chrome (ubuntu 12.04)
"
107,Fixed Uncaught CodeMirror.Pass,2013-06-14T02:37:01Z,2013-06-14T03:45:01Z,,,," Uncaught CodeMirror.Pass on expand abbreviation with tab. Now the autoindent works
"
106,MongoDBAdapter insert,2013-06-11T19:41:39Z,2013-06-12T20:42:58Z,,,,"Removing the insert function from MongoDBAdapter breaks it, since the default adapter then tries to call the execute function, which raises a ""Not supported"" error in the NoSQLAdapter.  This adds it back and also fixes the earlier list:reference bug.
"
105,Codemirror Fixed active line,2013-06-11T01:34:58Z,2013-06-11T02:26:50Z,,,,
104,admin editor: fix theme selector and full screen,2013-06-10T13:24:06Z,2013-06-10T13:31:55Z,,,,"fix full-screen and theme selector
"
103,fix admin editor  (full-screen and theme selector),2013-06-09T17:54:36Z,2013-06-10T00:15:32Z,,,,"fixed:
-  inconsistent spacing between the style dropdown and the rest of the buttons on the right above the editor
- theme selected is applied to the new tabs too
- full-screen fix

(tested on FF and Chrome on top ubuntu 12.04)
"
102,allow to process post vars in DELETE requests,2013-06-04T19:28:13Z,2013-06-06T15:32:48Z,,NOTE,"NOTE: the spec is fuzzy on this point, but we feel that this change doesn't actually hurt anything so is worthy of inclusion for flexibility-sake ","Our use case for requiring post_vars variables in a DELETE is that we wanted
our interface to support a bulk deleting method so as to reduce the number of
requests needed to be made.

As part of our miration path of getting our app to speak JSON from end-to-end,
we also wanted to ensure it was able to take a message body similar to a web
form submission.

e.g.
[form data]
    DELETE /app/rest/categoryofobjects HTTP/1.1
    ...
    Content-Type: application/x-www-form-urlencoded
    Content-Length: ...

```
ids=1&ids=2ids=3...
```

[JSON]
    DELETE /app/rest/categoryofobjects HTTP/1.1
    ...
    Content-Type: application/json
    Content-Length: ...

```
{
    ""ids"": [1, 2, 3, ...]
}
```

NOTE: the spec is fuzzy on this point, but we feel that this change doesn't actually hurt anything so is worthy of inclusion for flexibility-sake 
"
101,monkey patch eventlet,2013-06-03T23:43:13Z,2013-06-06T15:33:36Z,,,,"Eventlet monkey patch  in anyserver.py
"
100,fixed serving static files with static_version,2013-06-01T12:03:40Z,2013-06-03T02:43:45Z,,,,"thanks to Andriy for checking.
"
99,removed useless orderby,2013-05-31T14:00:44Z,2013-06-03T02:44:44Z,,,,"removed orderby on db.table(id) call and db.table[id] expression
"
98,Online editor with tabs,2013-05-28T12:38:44Z,2013-06-06T15:51:29Z,,,,"Added tab to the online editor.
see https://groups.google.com/d/topic/web2py-developers/yq2NyWDT0sw/discussion
"
97,Use T operator fot title attribute of grid buttons,2013-05-23T11:01:54Z,2013-05-24T16:44:44Z,,,,
96,lock in redis session,2013-05-18T22:38:25Z,2013-05-20T00:12:53Z,,,,"Optional lock in redis sessions

RedisClient accepts one more optional parameter, with_lock, that defaults to False

Also a minor optimization, mainly to minimize network round trips when executing a set of redis commands.
"
95,fix small error in parse_boolean,2013-05-17T19:24:27Z,2013-05-17T19:34:44Z,,,,"see http://code.google.com/p/web2py/issues/detail?id=1380
"
94,new and improved redis_cache,2013-05-15T22:46:08Z,2013-05-17T19:33:44Z,,,,"Got distributed locking and faster clear() function.
also, the .increment() was a little bit bugged.

See the docstring for further explanations
"
93,double -> float,2013-05-13T23:46:15Z,2013-05-14T17:06:24Z,,,,"python does not have a built-in double type
"
92,typo in contrib/gateways/fcgi.py,2013-05-13T23:22:21Z,2013-05-14T17:05:35Z,,,,"Don't know if there are people using this file, but should be fixed just in case.
"
91,redis_session.py small fixes,2013-05-13T20:39:44Z,2013-05-14T17:04:58Z,,,,"issues when using self.session_expiry
"
90,dal typo,2013-05-13T20:09:37Z,2013-05-14T17:04:14Z,,,,"Typo in BaseAdapter represent
"
89,new french translation + fixed errors in existing translations,2013-05-07T11:58:56Z,2013-05-14T17:03:24Z,,,,"I've added some translations for strings in French, and fixed errors in existing translations
"
88,minor typo correction in welcome app,2013-05-04T12:14:50Z,2013-05-14T17:02:44Z,,,,
87,fix oauth issues if redirecting in a form | http custom status error message,2013-05-02T00:47:01Z,2013-05-04T03:22:21Z,,,,"Changed redirections signalling from 307 (moved temporarily) to 302 (found) to avoid using wrong request method

Added custom status message in HTTP.
"
86,cache.action now works with actions raising HTTP internally,2013-04-29T19:07:39Z,2013-05-01T13:46:02Z,,,,
85,File list sidebar on Admin,2013-04-29T07:04:07Z,2013-05-01T13:45:18Z,,,,"This patch provides a simple sidebar for showing the file list while editing a page in admin. Improvements that can be added are a lot! Just to name a few:
- refactory, the side bar should be an ajax component, loaded dynamically.
- ajax support, a new page is loaded dynamically without reloading the whole page.
- warning alert, to block the loading of a new page if the current one has not been saved yet.
- Latest on top, to put above the list a list of the most recent edited files.
- better sub-directory handling. 
- ...

Hope it helps.
Paolo
"
84,better T in grid/smartgrid,2013-04-28T18:35:29Z,2013-05-01T13:44:04Z,,,,"removed unused imports, fixes issue 1464 (wrong and missing T in grid and smartgrid), fixes issue 1465 (translation of ""None"" message).

It remains ""unfixed"" the point on issue 1465 on having an empty row shown in the table, but I'm not for it.

The fix would involve changing line 2429 from
htmltable = DIV(T('No records found'))
to
htmltable = DIV(TABLE(TR(), TR(T('No records found'))))
"
83,Turkish language support for Welcome app,2013-04-27T20:04:54Z,2013-04-27T23:30:00Z,,,,
82,Mail - Added hostname to settings before locking,2013-04-25T14:35:09Z,2013-04-26T15:32:00Z,,,,"Added settings.hostname before locking settings, the class may need a comment explaining when is settings.hostname needed
"
81,fixed issue 1459,2013-04-23T21:07:01Z,2013-04-24T04:25:56Z,,,,"fixed issue 1459 (SQLFORM.grid doesn't honour deletable argument when creating the edit form)
"
80,fixed issue 1458,2013-04-23T21:05:43Z,2013-04-24T04:25:17Z,,,,"fixed issue 1458 (delete label on Crud)
"
79,Adds Query.__rand__ and dal.Query.__ror__,2013-04-18T13:19:29Z,2013-04-20T17:39:55Z,,,,"Adds **rand** == **and** and **ror** == **or**.

Useful for cases like this:

``` python
q = True
if condition:
    q = table.order.belongs(...)
full_condition &= q & other_condition
```

Also strips trailing spaces.
"
78,add doctest hook for markmin. It wasn't run previously.,2013-04-17T21:57:00Z,2013-04-17T22:11:30Z,,,,"previous hook didn't work. Also if not included in the coverage reports it's still useful to run all the doctests included in the source of markmin2html.py
"
77,new arg to SQLFORM.grid to help with large datasets,2013-04-17T21:20:22Z,2013-04-17T22:11:38Z,,,,"accepts a tuple, an integer or a callable. Should suffice for the most crazy setups.
"
76,coverage integration,2013-04-16T20:51:03Z,2013-04-16T21:19:58Z,,,,"so, we have web2py.py working ok with coverage, travis updated to report to coveralls.io.

Additionally a typo on contenttype.py was fixed.

Hurray from my very first PR on github :+1: 
"
75,isempty() IS_NOT_IN_DB() speedup,2013-04-12T22:09:50Z,2013-04-15T03:46:44Z,,,,"removed unnecessary ordering
"
74,Modified app admin page dropdowns,2013-04-12T03:38:01Z,2013-04-12T05:27:10Z,,,,"Very minor change.
- changed span3 -> span4
"
73,"Add language file: zh-cn.py, zh-tw.py",2013-04-10T04:48:51Z,2013-04-10T16:09:29Z,,,,"Add zh-cn.py for chinese-simplified (China, Mainland);
Add zh-tw.py for chinese-big5 (China, Taiwan).
fix language code in zh.py: from 'zh-cn' to 'zh-tw'.
"
72,Add migrate control to Auth.wiki(),2013-04-05T16:29:30Z,2013-04-08T02:39:26Z,,,,"The Auth.wiki() function does not allow for control of the migration
settings, always defaulting to migrate=True. In some instances the
developer may want to not force migration. This change adds the
ability to set the migrate option. Fake_migrate was not added but
can be if desired.
"
71,Adds IS_IPADDRESS() to gluon/validators.py,2013-04-05T16:22:35Z,2013-04-08T02:41:25Z,,,,"IS_IPADDRESS() is mostly a meta function that will call IS_IPV4()
or IS_IPV6 accordingly based upon both dev-configured logic and
library checking of the address given. For instance:

```
 >>> IS_IPADDRESS()('192.168.1.5')
 ('192.168.1.5', None)
```

will run through the IS_IPV4() function since the ipaddr.py lib
recognizes it as an IPv4 address. Specific v4 or v6 validation
can be done by setting is_ipv4=True or is_ipv6=True:

```
 >>> IS_IPADDRESS(is_ipv4=True)('fe80::126c:8ffa:fe22:b3af')
 ('fe80::126c:8ffa:fe22:b3af', 'enter valid IP address')
 >>> IS_IPADDRESS(is_ipv6=True)('192.168.1.1')
 ('192.168.1.1', 'enter valid IP address')
```

The same arguments for IS_IPV4() and IS_IPV6() are supported and
no changes have been made to either of these two functions. The
goal of this function is to allow IPv4 or IPv6 addresses in a
textfield:

```
 INPUT(_type='text', _name='name', requires=IS_IPADDRESS())
```
"
70,Render form content instead,2013-03-29T21:25:59Z,2013-03-31T23:14:54Z,,,,"{{=form}} should be used rather than {{form}} in the simple example given on About page.
"
69,Adds IS_IPV6() validator using Google ipaddr.py library,2013-03-29T16:26:30Z,2013-03-31T23:16:50Z,,,,"ipaddr.py library rev/3144 has been approved as a standard python
library for python3. IS_IPV4() was not modified to use the library.

Includes doctests!
"
68,Added an ANY_OF validator,2013-03-26T16:28:02Z,2013-03-31T23:17:48Z,,,,"When using multiple validators, a value is usually only valid if all validators are successful. This validator allows a value to be valid according to _any_ of a list of validators.
"
67,avoid ordering on limitby,2013-03-26T14:34:18Z,2013-03-28T20:05:09Z,,,,"avoid full ordering when using limitby in .select() args
"
66,Improved process handling an error handling in web2py.archlinux.sh,2013-03-26T12:51:23Z,2013-03-28T20:09:40Z,,,,"The original startup script crashed when I used it. Part of that was my fault, but the script wasn't sound either. I extended the feedback to users, and made it more robust.
"
65,HTTP exceptions in jsonrpc2,2013-03-14T20:56:11Z,2013-03-15T14:25:55Z,,,,"I think this also needs to be implemented in jsonrpc1.
What do you think?
"
64,uwsgi doen't like unicode headers,2013-03-11T17:45:58Z,2013-03-11T19:24:38Z,,,,"a u slipped in front of the www-authenticate header.  rocket works, uwsgi does not!
"
63,rfc basic auth challenge,2013-03-11T13:05:14Z,2013-03-11T14:46:30Z,,,,"Should make basic auth more rfc compliant by making a challenge response with HTTP 401 code if the client did not send or sent wrong authentication credentials.

   if basic_auth_realm is defined is a callable it's return value
   is used to set the basic authentication realm, if it's a string
   its content is used instead.  Otherwise basic authentication realm
   is set to the application name.
   If basic_auth_realm is None or False (the default) the behavior
   is to skip sending any challenge.
"
62,jsonrpc-2.0,2013-03-09T20:41:23Z,2013-03-10T20:58:18Z,,,,"missing current in building a backtrace report while handling an exception
"
61,"Improved Ingres support, no longer needs IngresDBI, uses pyodbc instead",2013-03-09T02:12:01Z,2013-03-10T20:56:55Z,,,,"Tested small demodb app with Ingres 10.0
"
60,oauth 2 fixes,2013-03-08T17:40:15Z,2013-03-08T18:13:17Z,,,,"http_x_forwarded_for removed.  Thanx Leo Rocha: https://groups.google.com/forum/?fromgroups=#!topic/web2py/7xD1tS7o_EI

added timeout to url opener open call.
"
59,Update gluon/globals.py,2013-02-18T19:36:33Z,2013-03-08T18:11:51Z,,,,"typescript support (http://www.typescriptlang.org/)
"
58,"Cryptographic vulnerabilities: Key as IV, insecure HMAC comparison",2013-01-27T17:26:58Z,2013-02-10T23:17:54Z,,,,"I defined `AES_new` as a function that returns an AES cipher object and a new secure random IV if None was specified. If an attacker can exhibit control over any ciphertext fed to the decrypter, recovering the secret key is a trivial exercise as described in [Key as Initialization Vector](http://www.gnu.org/software/shishi/manual/html_node/Key-as-initialization-vector.html).

See the following [gist](https://gist.github.com/4649506) for an example showing how this can be exploited.

I also noticed `compare()` provides a contant-time comparison function for comparing HMAC signatures, however was never called anywhere. This patch updates the `secure_loads()` function to use `compare()` when comparing HMAC signatures.
"
57,OAuth 2.0 rfc6749 compliance,2013-01-24T01:13:12Z,2013-02-10T23:15:44Z,,,,"Works with google and facebook
"
56,"Switching style class for auto-generated form help to ""help-block""",2013-01-22T05:06:46Z,2013-02-10T23:14:40Z,,,,"Due to the organization of the generation of the bootstrap forms, if using the ""help-inline"" style, help messages end up misaligned and harder to read. This changes the behavior to always put the help text in the ""help-block"" style, which aligns it to the left of the form field.
"
55,Make the menu html serializer pass LI items through as-is (allows for separators),2013-01-22T03:29:30Z,2013-02-10T23:12:15Z,,,,"When using the menu model, it can be useful to put dividers into the menu. This is most easily done by passing an `LI` object into the menu arguments, but the menu serializer always assumes tuples describing clickable menu items. This fix passes through `LI` objects as-is if they exist in the menu.
"
54,Fixed bug in messageBoxHandler,2013-01-21T01:19:36Z,2013-01-21T14:39:31Z,,,,"Message box handler did not closed and was annoying when using linux.
tkMessageBox, only works fine when included inside an Tk root app.

Also using Tkinter,Text makes possible to developer to copy the text from messageBox.
"
53,jsonrpc-2.0,2013-01-19T22:57:33Z,2013-01-21T14:35:28Z,,,,"Should implement **MUST** parts of http://www.jsonrpc.org/specification
"
52,Fixing indentation in readme,2013-01-15T23:11:32Z,2013-01-17T17:11:37Z,,,,"Nothing big, just removing some tabs and replacing them with an appropriate number of spaces.
"
51,Change/deletion in call to python interpreter,2013-01-13T22:38:09Z,2013-01-17T17:11:18Z,,,,"Calls to python need to respect virtual envs in use and some calls were not needed at all.
"
50,Enable renaming of downloaded file,2013-01-10T16:46:10Z,2013-01-17T17:10:44Z,,,,"We are developing a submission review and ranking system, and we needed to be able to rename files downloaded, so that something uploaded as dealfaro_paper.pdf would be renamed to (e.g.) submission_23.pdf on download.  
The simplest way to do this was to add an extra optional parameter to request.download, allowing the specification of a new file name for download. 
We are wondering whether this may be of wider interest. 
Note that we are not checking that the original and new filenames have the same extension.  This would have to be done separately.  We did not want to hard-code this, since it may be reasonable to use this parameter to change e.g. Picture1.JPG into picture1.jpg on download. 
"
49,sudo isn't needed for PostgreSQL drivers,2012-12-26T18:13:39Z,2013-01-17T17:08:44Z,,,,
48,New DB URL name,2012-12-26T18:10:21Z,2012-12-26T18:13:19Z,,,,
47,Update gluon/contrib/gae_memcache.py,2012-12-21T13:16:10Z,2012-12-31T20:53:48Z,,,,"GAE allows delete_multi and it is necessary to avoid hundreds of RPC calls to flush some subset os cache keys.
This allows all cache keys be cleaned in 1 RPC call.
"
46,Update applications/examples/controllers/simple_examples.py,2012-12-12T03:14:54Z,2012-12-14T20:27:35Z,,,,"Updated rss_aggregator() to return rss.to_xml(encoding='utf-8') instead.
"
45,Added required=True argument to IS_IN_DB,2012-12-08T00:45:52Z,2012-12-14T20:24:42Z,,,,"Added an optional argument

required=

(default: True)

to the IS_IN_DB validator.   If set to False, then the validator return value None (and no error) in case no value has been selected. 

Rationale:

Some fields in databases are not required.  Thus, it makes sense to have an option so that the IS_IN_DB validator checks that either the value is in the specified DB set (as now), _or_, the selection has been left empty. 

For instance, assume that I have a field as follows:

Field('teaching_assistant', db.person),

The database accepts a None value (because db....teaching_assistant.required has not been set to True).  So if I have a set of possible TAs q (as defined by a query), and I want the teaching assistant to be either selected from q, or left blank, I can now use:

IS_IN_DB(q, required=False)

to allow leaving the TA choice empty.
"
44,explorigin/Rocket merged and IPv6 support added,2012-11-18T07:24:57Z,2012-11-24T16:06:54Z,,,,"I've merged the upstream changes in Rocket to bring web2py's version more in line with upstream.  See https://github.com/cwinebrinner/Rocket/tree/web2py .

The web2py.py command-line script (and related files) and the Tk widget have been updated to make use of IPv6.

Some related code has been refactored.

Several bugs have been squished (and hopefully none introduced).

Some documentation errors have been corrected and some documentation has been added (--help and in the source).

If everything checks out okay, I'll update the book and send a pull request soon.

Try it out:

```
./web2py.py

./web2py.py -a x -i ::1

./web2py.py -a x --interfaces=""[::1]:8000;127.0.0.1:8000;[2001:470:c28c::1]:8000""
```
"
43,Fixed CAS provider login,2012-11-07T17:28:54Z,2012-11-09T20:11:36Z,,,,"Fixed unhandled question mark separator in service parameter.
"
42,Fixed RSS serialization,2012-11-04T01:55:19Z,2012-11-09T20:09:42Z,,,,"Apparently the API of gluon/contrib/rss2.py has changed.  This updates gluon/serializers.py to reflect this change.
"
41,script to create model from legacy sqlite schema,2012-10-29T10:25:11Z,2012-10-31T15:23:52Z,,,,"Some parts are from the script for mysql databases
"
40,This allows to customize the A in a MENU,2012-10-23T09:19:51Z,2012-10-31T15:22:18Z,,,,"This patch allows to set several parameters to the A helper that the MENU is going to set and doesn't brake the compatibility with the previous version.
"
39,Reverted to import with fromlist,2012-10-15T09:31:12Z,2012-10-15T10:56:26Z,,,,"I reverted a piece back to the import with fromlist even for ""improt x""
I kept the traceback so it makes a meaningful trace.
"
38,web2py_uuid 2x speedup,2012-10-09T22:09:50Z,2012-10-14T19:20:30Z,,,,"When you think there is no more room for improvement, read the manual again. ;-)
"
37,"Fix issue 1072, ""global name 'dbs' is not defined""",2012-10-07T15:16:25Z,2012-10-08T23:09:55Z,,,,"Applies patch from http://code.google.com/p/web2py/issues/detail?id=1072.
"
36,apos entity fix,2012-09-22T21:16:55Z,2012-09-24T17:48:44Z,,,,"web2pyHTMLParser is missing 'apos' entity.  This patch should fix compatibility and add some speedup at the price of a infinitesimal startup slowdown.
"
35,Optimized script for nginx and uwsgi on ubuntu 12.04,2012-09-22T14:10:33Z,2012-09-24T17:44:49Z,,,,"I installed this script on several machines and after a month of testing I figured out the basic configuration for a performatic uwsgi.

Without this settings uwsgi can be a memory eater. (see the thread about wsgi by Bruce Wade on the list, this script was based on Bruce tips)

Explanations:
1. Use unix socket instead of tcp
2. set the app to start the **master** process - it is useful for monitoring with uwsgitop and also for **no-orphans**
3. set the **processes** to 4 (but this depends on the installed machine, for web2py 4 is the minimum)
4. **harakiri** 60 - Every request that will take longer than the seconds specified in the harakiri timeout will be dropped and the corresponding worker recycled.
5. set the maximum amount of seconds to wait for a worker death during a graceful reload
6. **cpu-affinity** - http://lists.unbit.it/pipermail/uwsgi/2011-March/001594.html
7. **Stats** - output the stats on tmp so you can use $uwsgitop /tmp/stats.socket to monitoring the workers
## THE MOST IMPORTANT FOR WEB2PY
1. **reload-mercy** - set the maximum amount of seconds to wait for a worker death during a graceful reload
2. **limit-as** limit the address space usage of each uWSGI process using POSIX/UNIX setrlimit()
3. **max-requests** 2000 - set the maximum number of requests for each worker. When a worker reaches this number it will get recycled. You can use this option to dumb fight memory leaks (even if reload-on-as and reload-on-rss are more useful for this kind of problem)
4.  **reload-on-as** recycle a workers when its address space usage is over the limit specified
5. **reload-on-rss** Works as reload-on-as but it control the physical unshared memory. You can enable both
6. **no-orphans** automatically kill workers without a master process
7. **vacuum** - automatically remove unix socket and pidfiles on server exit

I did a lot of tests and on a Linode 1024 machine with Ubuntu 12.04 that is the best setup. 
If running a Linode 2048 (or any machine with 2GB RAM)  the config can be doubled to:

**max-requests** - 4000, **reload-on-as** 512, **reload-on-rss** 192, **limit-as** 1024 , **processes** 8, **cpu-affinity** 3

It is important: http://lists.unbit.it/pipermail/uwsgi/2011-March/001594.html

Also on nginx.conf it is usefull to set the number of processes/workers - I am using 12

``` javascript
user www-data;
worker_processes 12;
pid /var/run/nginx.pid;

events {
    worker_connections 768;
    # multi_accept on;
}

http {
....
}
```

Code

``` xml
<uwsgi>
    <plugin>python</plugin>
    <socket>/run/uwsgi/app/web2py/web2py.socket</socket>
    <pythonpath>/home/www-data/web2py/</pythonpath>
    <app mountpoint=""/"">
        <script>wsgihandler</script>
    </app>
    <master/>
    <processes>4</processes>
    <harakiri>60</harakiri> 
    <reload-mercy>8</reload-mercy>
    <cpu-affinity>1</cpu-affinity>
    <stats>/tmp/stats.socket</stats>
    <max-requests>2000</max-requests>
    <limit-as>512</limit-as>
    <reload-on-as>256</reload-on-as>
    <reload-on-rss>192</reload-on-rss>
    <no-orphans/>
    <vacuum/>    
</uwsgi>
```

and

``` javascript
location / {
                uwsgi_pass      unix:///run/uwsgi/app/web2py/web2py.socket;
                include         uwsgi_params;
                uwsgi_param     UWSGI_SCHEME $scheme;
                uwsgi_param     SERVER_SOFTWARE    nginx/$nginx_version;
        }
```
"
34,enable custom attributes for the generated crud forms,2012-09-20T13:33:19Z,2012-09-24T17:43:27Z,,,,"just wanted to add a class to a crud generated form... which is not possible at the moment. The patch adds an **attributes parameter to crud.create and crud.update to pass it on to SQLFORM.

(BTW: I'm not sure if that also makes sense for crud.read)
"
33,do the read of the CLOBs in the fetch,2012-09-18T08:58:26Z,2012-09-24T17:39:38Z,,,,"Using the fetchall method with cx_oracle invalidates the CLOB objects resulting in a ‚ÄúLOB variable no longer valid after subsequent fetch‚Äù error. See also:

http://cx-oracle.sourceforge.net/html/lob.html

The patch works around this problem by iterating over the cursor if there is a CLOB column in the result set.

This also makes the oracle specific parse_value function obsolete as the clobs are read already.
"
32,fix typo in setup-web2py-ubuntu script,2012-09-12T08:06:28Z,2012-09-14T14:23:43Z,,,,
31,make fdb the new default driver to try first ,2012-08-30T12:44:16Z,2012-08-30T20:10:56Z,,,,"fdb is the new official driver that is supported by the project 

http://www.firebirdnews.org/?p=7456
"
30,speedups with map and dict,2012-08-27T22:10:33Z,2012-08-28T14:35:43Z,,,,"Watch out that some code could be untested by myself (esp. reduce of postprocessing). This should give an idea for removing some for loops.

 Dal changes have to be ignored.

mic
"
29,more speed to storage,2012-08-25T23:09:31Z,2012-08-26T23:56:52Z,,,,"Another optimization: _____slots_____ = ()
"
28,added missing table_permission function,2012-08-24T11:54:51Z,2012-08-24T13:57:33Z,,,,"fix for Issue #956
http://code.google.com/p/web2py/issues/detail?id=956
"
27,Updated bootstrap to version 2.1.0,2012-08-22T10:09:17Z,2012-09-24T17:31:31Z,,,,
26,proper generation of token_url for rpx_account,2012-08-21T23:28:46Z,2012-08-24T14:26:41Z,,,,"This fixes the generation of token_url needed by janrain in case of routes_out usage.
"
25,Gluon app_cleanup() doesn't appear to clear cache,2012-08-21T15:02:10Z,2012-08-24T14:24:53Z,,,,"While ambling through the Admin app I noticed app_cleanup() tries to clear the cache by removing things from <application>/sessions instead of <application>/cache. Looks like a copy/paste error to me, so here's a patch for it.
"
24,Oracle clob fix,2012-08-17T13:41:56Z,2012-08-24T14:23:16Z,,,,"Fixes the problem with oracle CLOB Fields (text, blob, list:integer, list:string, list:reference) in a more general way
"
23,fix to work around the parantheses in expression,2012-08-12T18:36:47Z,2012-08-24T15:05:25Z,,,,"this simple fix prevents the Expression class adding the brackets around the field when the field is given as a string (modification to 1906817df8a4bb64fbd3faf9edaa5be1145e50f2) 
"
22,fixed value -> text in simple_hash,2012-08-10T08:59:47Z,2012-08-10T17:56:47Z,,,,"e27321a22ad8831d0d0641a8c076efe79fad5613 introduced a bug as value is not defined in the simple_hash function
"
21,fixed problem with duplicate fields in insert of computed fields,2012-08-09T17:17:23Z,2012-08-24T14:16:01Z,,,,"The following code produces duplicate fields in the insert:

``` python
db = DAL('sqlite://test.sqlite')
db.define_table('tree',Field('a',compute=lambda x: x.b),Field('b',compute=lambda x:x.a))
db.tree._insert(a=1,b=2)

""INSERT INTO tree(a,b,a,b) VALUES ('1','2','2','1');""
```

which does not produce an error in sqlite, but oracle does not like it...

The attached fix basically reverts the commit: a508e9f8ab3b8063d3337932f937a5bd10f90513
Unfortunately I don't know what problem this commit fixed...
"
20,(re-)enable field names in selects given as a string,2012-08-07T09:35:11Z,2012-08-08T17:34:48Z,,,,"db(db.table.id > 0).select(db.table.id,'name')

will throw an AttributeError as a string unfortunately does not have a type attribute.

The patch catches this exception and simply does not parse the value which is, well maybe not the best way to do it as the parse_value function seems to handle the ""string"" case(?):

``` python
elif field_type in ('string', 'text', 'password', 'upload', 'dict'):
```

This used to work in earlier web2py versions and I hope this feature will remain!
"
19,Changed oracle insert trigger to allow a predefined primary key in an insert,2012-08-07T09:00:05Z,2012-08-08T17:30:29Z,,,,"If I want to insert data into an oracle table, the primary key gets recalculated even though a value is given for it.

The new trigger resets the sequence so the next value will be the one given in the data.

A problem with this is, that the sequence is not reset back to the original value afterwards (and this is not easily possible as the lastrowid function depends on the sequence pointing to the last id.

What do you think?
"
18,Fixed git_push to be thread safe,2012-07-23T15:37:44Z,2012-07-29T03:38:09Z,,,,"removed dependency on os.chdir() for git index.add
"
17,Basic git support,2012-07-20T14:28:01Z,2012-07-22T01:41:54Z,,,,"The functionality includes:
- Importing an application from a remote git repo 
- Pulling changes from that repo to the imported applications
- Pushing changes to that  repo from the imported applications

Any merge conflicts will need to be handled manually.

I tested as much as I could but this will probably need to be tested by others as well to flush out kinks.

I didn't make any changes to welcome, just used it as my dummy app for importing. I'm not sure if you can ignore changes in the pull around that. 

Basically my changes are in:

admin/controllers/default.py
admin/views/default/site.html
admin/views/default/git_pull.html
admin/views/default/git_push.html
"
16,Basic git support,2012-07-20T14:05:10Z,2012-07-20T14:08:41Z,,,,"The functionality includes:
- Importing an application from a remote git repo 
- Pulling changes from that repo to the imported applications
- Pushing changes to that  repo from the imported applications

Any merge conflicts will need to be handled manually.

I've done some preliminary testing but will probably need some help from others testing this for issues.
"
15,Typo in doc string in x509_auth,2012-07-20T13:17:07Z,2012-07-20T21:47:59Z,,,,"just a typo of mine
"
14,Display current year's copyright date,2012-07-15T13:31:50Z,2012-07-20T21:45:22Z,,,,"I modified widget.py to always display the current year's copyright date, instead of the now-outdated 2011.
"
13,custom_qualifier for Field constructor,2012-07-04T02:55:03Z,2012-07-06T03:06:57Z,,,,"Yesterday I was trying to create an SQLite database with a field that had an 'ON CONFLICT IGNORE' but I couldn't figure out how to do it. Looking at the source code I found the places where `Field` was used and I believe I have made the right modifications to make adding 'ON CONFLICT IGNORE' possible through the use of the extra attribute `custom_qualifier`. So if the `Field` constructor is passed `custom_qualifier = 'SOME QUALIFIER'` then that string will be tacked onto `ftype` by `ftype += (' %s' % field.custom_qualifier)` so that the generated SQL for creating the table will have the added qualifier.
"
12,gluon.globals.py->Response.download(): contenttype already imported,2012-06-07T23:22:34Z,2012-07-06T03:09:19Z,,,,"Maybe think about adding a 'Last-Modified' header to make use of the browser cache?
"
11,custom import problem 325,2012-06-07T00:20:19Z,2012-07-06T03:10:02Z,,,,"https://code.google.com/p/web2py/issues/detail?id=325
"
10,Openshift Deployer,2012-06-05T22:35:09Z,2012-07-06T03:21:41Z,,,,"I've been working on a deployer in the admin page for the Openshift PaaS. I've added the controller openshift.py, openshift/deploy.html view, and a modification to the default/site.html view to expose it on the admin page under the GAE deployer. 

Beyond the openshift web2py prerequisites it also requires GitPython to function.
"
9,speedup and simplify https detection,2012-05-15T20:46:11Z,2012-06-06T11:09:01Z,,,,"The code in appadmin was almost redundant to that in gluon/main.py,  but did not handle all cases.
This also speeds up things a bit.

Massimo I do not do the merge myself because that code is partially unknown to me, so please check if I am missing something.
"
8,setup-web2py-nginx-uwsgi-ubuntu.sh doesn't work for Ubuntu Server version 11.10 (Oneiric Ocelot),2012-04-18T01:04:27Z,2012-05-06T21:06:49Z,,,,"I run web2py on Amazon AWS on their recommended Ubuntu distribution.

There is a problem with this script in the way it sets up the uwsgi packages, primarily uwsgi-python has been replaced with uwsgi and uwsgi-plugin-python. 

It's an easy fix and I'm happy to do it, but seeing as this script was written for 10.4 I wonder if it should be a new script for 11.10?

Thoughts?

Cheers,
Robin
"
7,Fixes allowed_groups for active directory.,2012-04-05T17:35:48Z,2012-04-06T14:33:13Z,,,,"Currently allowed_groups does not work with Active Directory. This little patch fixes that.
The filter for active directory needs to be the full ldap string instead of just the username.
(ex. 'CN=Administrator,DC=example,DC=com'
(If I need to submit this somewhere else let me know.)
Kory
"
6,DAL and Schema/Database descriptor,2012-03-25T07:22:20Z,2012-05-06T21:08:21Z,,,,"I open this issue as per http://groups.google.com/group/web2py/browse_thread/thread/40ce800177e6ae3c/c343765565744f14?show_docid=c343765565744f14 

i've done little customization on DAL, you could check here 
https://github.com/adesst/MyDAL
"
5,Short syntax to fetch a record for GAE keys (id or name),2012-03-22T19:39:07Z,2012-05-06T21:05:22Z,,,,"With this patch, the following short syntax to get a single record will work on GAE for both id and named keys:

``` python
db.table_name[key]
```

The patch also simplifies the already working code for getting the record by key the long way:

``` python
db(db.table_name.id == key).select().first()
db.table_name(db.table_name.id == key)
```
"
4,MENU helper issue,2012-03-09T09:08:53Z,2012-05-06T21:00:51Z,,,,"I think that there is small issue in the serialize function  provided by the MENU helper. At line 2110 (html.py) the variable link should be replaced by the variable name. The code should be:

``` python
[...]
(name, active, link) = item[:3]
    if isinstance(name,DIV):
        li = LI(name)
[...]
```

instead of :

``` python
[...]
(name, active, link) = item[:3]
    if isinstance(link,DIV):
        li = LI(link)
[...]
```
"
3,Deliver pyodbc binaries with Windows distribution,2012-02-25T12:43:20Z,2012-05-06T20:59:08Z,,,,"It's a common case, IMO, that Windows users of web2py downloading the Windows Installer against sources are trying both Python and web2py, maybe for the first time.

For Windows users, the market share of MS SQL Server database is high, but new users of web2py are unable to connect with your existing environment with the web2py default Windows installer, because pyodbc.pyd is missing.

This was my case, except that I already had a Python27 setup, making a bit harder to get a python25 pyodbc, because windows installer of pyodbc detects python from registry and blocks if the version is incompatible.

Following the principle of include in the distro all necessary software, I'm asking if is this possible.

If helps, I have the python 2.5 pyodbc.pyd binary file, its just drop it into web2py install folder.

Best regards,
"
2,Source last updated 2009?,2011-10-12T10:58:13Z,2012-02-23T16:49:06Z,,,,"Is there any way of making this current? I enjoy using the github osx app.
"
1,"CAS consumer incorrectly expecting username, email and user ID?",2011-04-30T01:11:36Z,2012-05-06T20:58:14Z,,,,"I don't think the CAS consumer is correct - it seems to assume it's receiving a username, email address and user ID from the provider. While the CAS protocol states that the login response contains the username and the word 'yes'.

Also, which is the correct reference:

http://www.web2py.com/book/default/chapter/08#Central-Authentication-Service
http://web2py.com/cas

Thanks
"
